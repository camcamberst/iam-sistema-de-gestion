"use strict";exports.id=6678,exports.ids=[6678],exports.modules={26678:(e,s,r)=>{r.d(s,{Z:()=>n});var a=r(95344),t=r(3729),o=r(72829);function n({userId:e,userGroups:s,userRole:r="modelo"}){let[n,l]=(0,t.useState)([]),[i,d]=(0,t.useState)(!0),[c,m]=(0,t.useState)(!1),[u,x]=(0,t.useState)(new Set),[h,g]=(0,t.useState)(!1);(0,t.useEffect)(()=>{let s=`announcements_read_${e}`,r=localStorage.getItem(s);if(r)try{let e=JSON.parse(r);x(new Set(e))}catch(e){console.warn("⚠️ [ANNOUNCEMENTS-WIDGET] Error parseando publicaciones le\xeddas:",e)}},[e]),(0,t.useEffect)(()=>{p();let s=o.supabase.channel(`announcements-realtime-${e}`).on("postgres_changes",{event:"*",schema:"public",table:"announcements"},e=>{console.log("\uD83D\uDCE2 [ANNOUNCEMENTS-WIDGET] Cambio detectado en tiempo real:",e);let s=e.eventType||e.event;if("INSERT"===s||"UPDATE"===s){let s=e.new;s&&!0===s.is_published&&(console.log("\uD83D\uDD04 [ANNOUNCEMENTS-WIDGET] Recargando anuncios por cambio en tiempo real"),p())}else"DELETE"===s&&(console.log("\uD83D\uDD04 [ANNOUNCEMENTS-WIDGET] Recargando anuncios por eliminaci\xf3n"),p())}).subscribe(e=>{console.log("\uD83D\uDCE1 [ANNOUNCEMENTS-WIDGET] Estado de suscripci\xf3n:",e)});return()=>{console.log("\uD83E\uDDF9 [ANNOUNCEMENTS-WIDGET] Limpiando suscripci\xf3n"),o.supabase.removeChannel(s)}},[e,s]),(0,t.useEffect)(()=>{if(0===n.length){g(!1);return}g(n.some(e=>!u.has(e.id)));let s=`announcements_read_${e}`;!localStorage.getItem(s)&&n.length>0&&console.log("\uD83C\uDD95 [ANNOUNCEMENTS-WIDGET] Primera carga: todas las publicaciones son nuevas")},[n,u,e]);let p=async()=>{try{d(!0);let{data:{session:s}}=await o.supabase.auth.getSession();if(!s){console.warn("⚠️ [ANNOUNCEMENTS-WIDGET] No hay sesi\xf3n activa");return}let{data:a,error:t}=await o.supabase.from("user_groups").select("group_id").eq("user_id",e);t&&console.error("❌ [ANNOUNCEMENTS-WIDGET] Error obteniendo grupos:",t);let n=a?.map(e=>e.group_id)||[],i=n.length>0?n.join(","):"";console.log("\uD83D\uDD0D [ANNOUNCEMENTS-WIDGET] Cargando anuncios para:",{userId:e,userGroupIds:n,userGroupsParam:i});let c=await fetch(`/api/announcements?limit=5&userId=${e}&userRole=${r}${i?`&userGroups=${i}`:""}`,{headers:{Authorization:`Bearer ${s.access_token}`}});if(!c.ok){console.error("❌ [ANNOUNCEMENTS-WIDGET] Error en respuesta:",c.status,c.statusText);return}let m=await c.json();console.log("\uD83D\uDCCA [ANNOUNCEMENTS-WIDGET] Resultado:",{success:m.success,count:m.data?.length||0,data:m.data}),m.success?l(m.data||[]):console.error("❌ [ANNOUNCEMENTS-WIDGET] Error en respuesta:",m.error)}catch(e){console.error("❌ [ANNOUNCEMENTS-WIDGET] Error cargando anuncios:",e)}finally{d(!1)}},b=s=>{let r=`announcements_read_${e}`,a=new Set(u);a.add(s),x(a),localStorage.setItem(r,JSON.stringify(Array.from(a))),g(n.some(e=>!a.has(e.id)))},N=e=>{let s=new Date(e),r=new Date().getTime()-s.getTime(),a=Math.floor(r/6e4),t=Math.floor(r/36e5),o=Math.floor(r/864e5);return a<1?"Ahora":a<60?`hace ${a} min`:t<24?`hace ${t} h`:o<7?`hace ${o} d`:s.toLocaleDateString("es-CO",{day:"numeric",month:"short"})};if(i)return a.jsx("div",{className:"relative bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-4 sm:p-6",children:a.jsx("div",{className:"flex items-center justify-center py-6 sm:py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 sm:h-6 sm:w-6 border-b-2 border-blue-600"})})});let f=c?n:n.slice(0,3),y=n.filter(e=>!u.has(e.id)).length;return(0,a.jsxs)("div",{className:"relative bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15",children:[a.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200/50 dark:border-gray-600/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3 min-w-0 flex-1",children:[(0,a.jsxs)("div",{className:"relative flex-shrink-0",children:[a.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md",children:a.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})})}),h&&a.jsx("div",{className:"absolute -top-0.5 -right-0.5",children:(0,a.jsxs)("div",{className:"relative w-3 h-3 sm:w-3.5 sm:h-3.5 bg-red-500 rounded-full border-2 border-white dark:border-gray-700 shadow-sm",children:[y>1&&a.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[7px] sm:text-[8px] font-semibold text-white leading-none",children:y>9?"9+":y}),a.jsx("span",{className:"absolute inset-0 bg-red-500 rounded-full animate-ping opacity-40"})]})})]}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[a.jsx("h2",{className:"text-sm sm:text-lg font-semibold text-gray-900 dark:text-white leading-tight",children:"Corcho Informativo"}),a.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-300 hidden sm:block",children:"Informaci\xf3n relevante para ti"})]})]}),n.length>3&&a.jsx("button",{onClick:()=>m(!c),className:"text-[10px] sm:text-xs font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors flex-shrink-0 whitespace-nowrap",children:c?"Ver menos":`Ver todas (${n.length})`})]})}),0===n.length?(0,a.jsxs)("div",{className:"p-4 sm:p-6 text-center",children:[a.jsx("div",{className:"text-gray-400 dark:text-gray-500 mb-2",children:a.jsx("svg",{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})})}),a.jsx("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"No hay publicaciones disponibles en este momento"}),a.jsx("p",{className:"text-[10px] sm:text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Las publicaciones aparecer\xe1n aqu\xed cuando los administradores las creen"})]}):a.jsx("div",{className:"p-4 sm:p-6 space-y-3 sm:space-y-4",children:f.map(e=>{let s=!u.has(e.id);return(0,a.jsxs)("div",{onClick:()=>{b(e.id);let s=`/announcements/${e.id}`;window.open(s,"_blank","width=800,height=900,scrollbars=yes,resizable=yes")},className:`relative cursor-pointer group rounded-lg p-3 sm:p-4 border transition-all duration-200 hover:shadow-md ${s?"bg-blue-50/60 dark:bg-blue-900/10 border-blue-200/60 dark:border-blue-500/30":"bg-gray-50/50 dark:bg-gray-600/30 border-gray-200/50 dark:border-gray-500/30 hover:border-blue-300 dark:hover:border-blue-500/50"}`,children:[s&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("style",{children:`
                    @keyframes badgeBlink {
                      0%, 100% { opacity: 1; }
                      50% { opacity: 0.5; }
                    }
                    .badge-nuevo-blink {
                      animation: badgeBlink 1.5s ease-in-out infinite;
                    }
                  `}),(0,a.jsxs)("span",{className:"badge-nuevo-blink absolute top-2 right-2 sm:top-4 sm:right-4 inline-flex items-center gap-0.5 sm:gap-1 px-1 sm:px-1.5 py-0.5 text-[10px] sm:text-xs font-medium text-white bg-gradient-to-r from-red-500 via-pink-500 to-red-500 rounded-full shadow-sm shadow-red-500/30 hover:shadow-md hover:shadow-red-500/50 transition-all duration-200 z-10",children:[(0,a.jsxs)("span",{className:"relative flex h-0.5 w-0.5 sm:h-1 sm:w-1",children:[a.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-70"}),a.jsx("span",{className:"relative inline-flex rounded-full h-0.5 w-0.5 sm:h-1 sm:w-1 bg-white"})]}),a.jsx("span",{className:"relative",children:"Nuevo"}),a.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-red-400 via-pink-400 to-red-400 rounded-full opacity-40 blur-sm -z-10 animate-pulse"})]})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-2 sm:space-x-3",children:[(()=>{let s=e.featured_image_url||(e.image_urls&&e.image_urls.length>0?e.image_urls[0]:null);return s?a.jsx("img",{src:s,alt:e.title,className:"w-12 h-12 sm:w-16 sm:h-16 object-cover rounded-lg flex-shrink-0"}):a.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-lg flex items-center justify-center flex-shrink-0 text-lg sm:text-2xl",style:{backgroundColor:e.category?.color?`${e.category.color}20`:"#3B82F620",color:e.category?.color||"#3B82F6"},children:e.category?.icon||"\uD83D\uDCCC"})})(),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center flex-wrap gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[e.is_pinned&&a.jsx("span",{className:"text-[10px] sm:text-xs text-blue-600 dark:text-blue-400",children:"\uD83D\uDCCC"}),e.priority>0&&a.jsx("span",{className:`text-[10px] sm:text-xs px-1 sm:px-1.5 py-0.5 rounded ${2===e.priority?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300"}`,children:2===e.priority?"Urgente":"Alta"}),e.category&&a.jsx("span",{className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 rounded font-medium",style:{backgroundColor:`${e.category.color}20`,color:e.category.color},children:e.category.name})]}),a.jsx("h3",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors mb-1.5 sm:mb-2.5 leading-snug",children:e.title}),a.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-300 line-clamp-2 mb-2 sm:mb-3 leading-relaxed",children:e.excerpt}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-1.5 sm:pt-2 border-t border-gray-200/30 dark:border-gray-600/30",children:[a.jsx("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400",children:N(e.published_at||e.created_at)}),a.jsx("span",{className:"text-[10px] sm:text-xs text-blue-600 dark:text-blue-400 font-medium group-hover:underline",children:"Leer m\xe1s →"})]})]})]})]},e.id)})})]})}}};