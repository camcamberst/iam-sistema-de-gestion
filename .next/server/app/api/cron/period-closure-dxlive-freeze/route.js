"use strict";(()=>{var e={};e.id=7915,e.ids=[7915],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},43513:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>E,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>D,staticGenerationBailout:()=>y});var o={};t.r(o),t.d(o,{GET:()=>m});var i=t(95419),a=t(69108),s=t(99678),n=t(78070),l=t(72964),d=t(18539),c=t(1065),p=t(37863);let u=(0,l.createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});async function m(e){try{if(console.log("\uD83D\uDD50 [CRON-DXLIVE-FREEZE] Verificando congelaci\xf3n de DX Live..."),!(0,d.UX)()){let e=new Date().toLocaleDateString("en-CA",{timeZone:"America/Bogota"}),r=parseInt(e.split("-")[2]);return n.Z.json({success:!0,message:"No es d\xeda de cierre de per\xedodo (1, 15, 16 o 31)",current_day:r})}let e=(0,d.Bm)(),[r,t]=e.split(" ")[1]?.split(":")||["00","00"],o=parseInt(r),i=parseInt(t);if(!(10===o&&i>=0&&i<=10))return n.Z.json({success:!0,message:`No es hora de congelaci\xf3n de DX Live (10:00 AM Colombia). Hora actual: ${o}:${String(i).padStart(2,"0")}`});let a=(0,d.iR)(),s=(0,d.im)();console.log(`ðŸ”’ [CRON-DXLIVE-FREEZE] Iniciando congelaci\xf3n de DX Live a las 10:00 AM Colombia...`);let{data:l}=await u.from("calculator_early_frozen_platforms").select("id").eq("period_date",a).eq("platform_id","dxlive").limit(1);if(l&&l.length>0)return console.log("âš ï¸ [CRON-DXLIVE-FREEZE] DX Live ya fue congelado hoy"),n.Z.json({success:!0,message:"DX Live ya fue congelado hoy",already_executed:!0});let{data:m,error:g}=await u.from("users").select("id, email, name").eq("role","modelo").eq("is_active",!0);if(g)return console.error("âŒ [CRON-DXLIVE-FREEZE] Error obteniendo modelos:",g),n.Z.json({success:!1,error:"Error obteniendo modelos"},{status:500});console.log(`ðŸ”„ [CRON-DXLIVE-FREEZE] Procesando ${m?.length||0} modelos...`);let E=[],D=0,f=0;for(let e of m||[])try{let r=await (0,c.vk)(a,e.id,["dxlive"]);r.success?(D++,E.push({model_id:e.id,model_email:e.email,status:"success"}),await (0,p.MW)(e.id,"periodo_cerrado","DX Live ha sido bloqueado para edici\xf3n. El per\xedodo est\xe1 cerrado para esta plataforma.")):(f++,E.push({model_id:e.id,model_email:e.email,status:"error",error:r.error}))}catch(r){f++,console.error(`âŒ [CRON-DXLIVE-FREEZE] Error procesando modelo ${e.email}:`,r),E.push({model_id:e.id,model_email:e.email,status:"error",error:r instanceof Error?r.message:"Error desconocido"})}return console.log("âœ… [CRON-DXLIVE-FREEZE] Congelaci\xf3n de DX Live completada:",{total:m?.length||0,success:D,errors:f}),n.Z.json({success:!0,message:"Congelaci\xf3n de DX Live completada",period_date:a,period_type:s,results:{total_models:m?.length||0,successful:D,failed:f},frozen_platform:"dxlive",details:E})}catch(e){return console.error("âŒ [CRON-DXLIVE-FREEZE] Error:",e),n.Z.json({success:!1,error:"Error interno del servidor",details:e instanceof Error?e.message:"Error desconocido"},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/cron/period-closure-dxlive-freeze/route",pathname:"/api/cron/period-closure-dxlive-freeze",filename:"route",bundlePath:"app/api/cron/period-closure-dxlive-freeze/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\cron\\period-closure-dxlive-freeze\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:E,staticGenerationAsyncStorage:D,serverHooks:f,headerHooks:h,staticGenerationBailout:y}=g,v="/api/cron/period-closure-dxlive-freeze/route";function x(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:D})}},18539:(e,r,t)=>{t.d(r,{Bm:()=>i,Ck:()=>u,UX:()=>m,Y:()=>n,a9:()=>s,g5:()=>l,iR:()=>o,im:()=>d,ns:()=>p,o8:()=>a,sF:()=>c});let o=()=>new Date().toLocaleDateString("en-CA",{timeZone:"America/Bogota"}),i=()=>new Date().toLocaleString("sv-SE",{timeZone:"America/Bogota"}),a=e=>{let r=e||new Date,t=new Intl.DateTimeFormat("en-CA",{timeZone:"Europe/Berlin",year:"numeric",month:"2-digit",day:"2-digit"}).format(r),o=new Intl.DateTimeFormat("en-US",{timeZone:"Europe/Berlin",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(r),i={};o.forEach(e=>{"literal"!==e.type&&(i[e.type]=e.value)});let a=new Date(`${i.year}-${i.month}-${i.day}T00:00:00Z`),s=null;for(let e of[1,2]){let r=new Date(a.getTime()-36e5*e);if("00:00:00"===new Intl.DateTimeFormat("en-US",{timeZone:"Europe/Berlin",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(r)){s=r;break}}s||(s=new Date(a.getTime()-54e5));let n=new Intl.DateTimeFormat("en-US",{timeZone:"America/Bogota",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(s),l={};return n.forEach(e=>{"literal"!==e.type&&(l[e.type]=e.value)}),{colombiaTime:`${l.hour}:${l.minute}:${l.second}`||"00:00:00",colombiaDate:`${l.year}-${l.month}-${l.day}`,colombiaDateTime:s,europeDate:t}},s=()=>{let e=new Date,r=i(),t=a(e),[o,s]=r.split(" ")[1]?.split(":")||["00","00"],[n,l]=t.colombiaTime.split(":");return 5>=Math.abs(60*parseInt(o)+parseInt(s)-(60*parseInt(n)+parseInt(l)))},n=()=>{let e=i(),[r,t]=e.split(" ")[1]?.split(":")||["00","00"],o=parseInt(r),a=parseInt(t);return 0===o&&a>=0&&a<=15},l=["superfoon","livecreator","mdh","777","xmodels","big7","mondo","vx","babestation","dirtyfans"],d=()=>{let e=parseInt(o().split("-")[2]);return e>=1&&e<=15?"1-15":"16-31"},c=()=>{let e=o(),[r,t,i]=e.split("-").map(Number);if(1===i){let e=1===t?12:t-1,o=1===t?r-1:r;return new Date(o,e,0).getDate(),{periodDate:`${o}-${String(e).padStart(2,"0")}-16`,periodType:"16-31"}}return 16===i?{periodDate:`${r}-${String(t).padStart(2,"0")}-01`,periodType:"1-15"}:{periodDate:e,periodType:i<=15?"1-15":"16-31"}},p=()=>{let e=o(),[r,t,i]=e.split("-").map(Number);return 1===i?{periodDate:e,periodType:"1-15"}:16===i?{periodDate:e,periodType:"16-31"}:{periodDate:e,periodType:i<=15?"1-15":"16-31"}},u=()=>{let e=parseInt(o().split("-")[2]);return 1===e||16===e},m=()=>{let[e,r,t]=o().split("-").map(Number);return 15===t||t===new Date(e,r,0).getDate()}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1638,6206,2964,7863,1065],()=>t(43513));module.exports=o})();