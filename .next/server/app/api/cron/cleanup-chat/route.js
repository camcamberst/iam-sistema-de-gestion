"use strict";(()=>{var e={};e.id=1683,e.ids=[1683],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},41047:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>g,originalPathname:()=>T,patchFetch:()=>O,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>S,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>h});var r={};a.r(r),a.d(r,{GET:()=>u,POST:()=>l});var o=a(95419),s=a(69108),n=a(99678),i=a(78070),c=a(37542);async function u(e){try{console.log("\uD83D\uDD50 [CRON] Ejecutando limpieza autom\xe1tica de chat...");let t=e.headers.get("authorization"),a=process.env.CRON_SECRET;if(a&&t!==`Bearer ${a}`)return i.Z.json({success:!1,error:"No autorizado"},{status:401});return await (0,c.GZ)(),console.log("✅ [CRON] Limpieza autom\xe1tica completada"),i.Z.json({success:!0,message:"Limpieza autom\xe1tica de chat completada",timestamp:new Date().toISOString()})}catch(e){return console.error("❌ [CRON] Error en limpieza autom\xe1tica:",e),i.Z.json({success:!1,error:"Error ejecutando limpieza autom\xe1tica",details:e instanceof Error?e.message:"Error desconocido"},{status:500})}}async function l(e){return u(e)}let d=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/cron/cleanup-chat/route",pathname:"/api/cron/cleanup-chat",filename:"route",bundlePath:"app/api/cron/cleanup-chat/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\cron\\cleanup-chat\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:S,headerHooks:g,staticGenerationBailout:h}=d,T="/api/cron/cleanup-chat/route";function O(){return(0,n.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:m})}},37542:(e,t,a)=>{a.d(t,{GZ:()=>i,MY:()=>s,lH:()=>n});var r=a(8234);async function o(e,t){try{console.log(`📊 [CHAT-STATUS] Actualizando estado de usuario ${e}: ${t?"EN L\xcdNEA":"OFFLINE"}`);let{error:a}=await r.O.from("chat_user_status").upsert({user_id:e,is_online:t,last_seen:new Date().toISOString(),updated_at:new Date().toISOString()});a?console.error("❌ [CHAT-STATUS] Error actualizando estado:",a):console.log(`✅ [CHAT-STATUS] Estado actualizado exitosamente: ${t?"EN L\xcdNEA":"OFFLINE"}`)}catch(e){console.error("❌ [CHAT-STATUS] Error general:",e)}}async function s(e){await o(e,!0)}async function n(e){await o(e,!1)}async function i(){try{let e=new Date(Date.now()-6e4).toISOString(),{count:t}=await r.O.from("chat_user_status").select("*",{count:"exact",head:!0}).lt("updated_at",e).eq("is_online",!0),{error:a}=await r.O.from("chat_user_status").update({is_online:!1}).lt("updated_at",e).eq("is_online",!0);a?console.error("❌ [CHAT-STATUS] Error limpiando usuarios inactivos:",a):t&&t>0&&console.log(`✅ [CHAT-STATUS] ${t} usuarios inactivos marcados como offline`)}catch(e){console.error("❌ [CHAT-STATUS] Error en limpieza:",e)}}},8234:(e,t,a)=>{a.d(t,{O:()=>i});var r=a(86843);let o=(0,r.createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\lib\supabase.ts`),{__esModule:s,$$typeof:n}=o;o.default;let i=(0,r.createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\lib\supabase.ts#supabase`)},86843:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createProxy",{enumerable:!0,get:function(){return r}});let r=a(18195).createClientModuleProxy},50482:(e,t,a)=>{e.exports=a(20399)},18195:(e,t,a)=>{e.exports=a(50482).vendored["react-rsc"].ReactServerDOMWebpackServerEdge}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[1638,6206],()=>a(41047));module.exports=r})();