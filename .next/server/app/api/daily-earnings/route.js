"use strict";(()=>{var e={};e.id=8168,e.ids=[8168],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},28831:(e,a,r)=>{r.r(a),r.d(a,{headerHooks:()=>I,originalPathname:()=>A,patchFetch:()=>y,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>E,staticGenerationAsyncStorage:()=>S,staticGenerationBailout:()=>f});var n={};r.r(n),r.d(n,{GET:()=>g,POST:()=>p,dynamic:()=>u});var s=r(95419),t=r(69108),o=r(99678),i=r(78070),d=r(66569),l=r(37863);let u="force-dynamic",c=d.R;async function g(e){try{let{searchParams:a}=new URL(e.url),r=a.get("modelId"),n=a.get("date")||new Date().toISOString().split("T")[0];if(!r)return i.Z.json({success:!1,error:"modelId es requerido"},{status:400});console.log("\uD83D\uDD0D [DAILY-EARNINGS] Getting earnings for:",{modelId:r,date:n});let{data:s,error:t}=await c.from("daily_earnings").select("earnings_amount, earnings_date, updated_at").eq("model_id",r).eq("earnings_date",n).single();if(t){if("PGRST116"===t.code)return console.log("✅ [DAILY-EARNINGS] No earnings found for date, returning 0"),i.Z.json({success:!0,earnings:0,date:n,modelId:r});if("PGRST205"===t.code)return console.warn("⚠️ [DAILY-EARNINGS] Tabla daily_earnings no existe en schema cache, retornando 0. Ejecuta create_daily_earnings_table.sql en Supabase."),i.Z.json({success:!0,earnings:0,date:n,modelId:r,warning:"Tabla daily_earnings no configurada - ejecuta el script SQL"});return console.error("❌ [DAILY-EARNINGS] Error:",t),i.Z.json({success:!1,error:t.message},{status:500})}let o=s?.earnings_amount||0;return console.log("✅ [DAILY-EARNINGS] Found earnings:",o),i.Z.json({success:!0,earnings:o,date:n,modelId:r})}catch(e){return console.error("❌ [DAILY-EARNINGS] Error:",e),i.Z.json({success:!1,error:e.message||"Error interno del servidor"},{status:500})}}async function p(e){try{let{modelId:a,earnings:r,date:n}=await e.json();if(!a||void 0===r)return i.Z.json({success:!1,error:"modelId y earnings son requeridos"},{status:400});let s=n||new Date().toISOString().split("T")[0];console.log("\uD83D\uDD0D [DAILY-EARNINGS] Saving earnings:",{modelId:a,earnings:r,earningsDate:s});let{data:t,error:o}=await c.from("daily_earnings").upsert({model_id:a,earnings_date:s,earnings_amount:parseFloat(r.toString())},{onConflict:"model_id,earnings_date"}).select().single();if(o){if("PGRST205"===o.code)return console.warn("⚠️ [DAILY-EARNINGS] Tabla daily_earnings no existe en schema cache, omitiendo guardado. Ejecuta create_daily_earnings_table_FORCE.sql en Supabase SQL Editor."),i.Z.json({success:!0,message:"Ganancias no guardadas - tabla daily_earnings no configurada",warning:"La tabla daily_earnings no existe. Ejecuta create_daily_earnings_table_FORCE.sql en Supabase SQL Editor para forzar la creaci\xf3n.",skipped:!0});return console.error("❌ [DAILY-EARNINGS] Error saving:",o),i.Z.json({success:!1,error:o.message},{status:500})}console.log("✅ [DAILY-EARNINGS] Earnings saved successfully:",t);try{let{data:e}=await c.from("calculator_config").select("min_quota_override, group_min_quota, daily_goal_override, group_daily_goal").eq("model_id",a).eq("active",!0).single();if(e){let n=e.daily_goal_override||e.group_daily_goal||0;if(e.min_quota_override||e.group_min_quota,n>0&&r>=n){await (0,l.jH)(a);let{data:e}=await c.from("users").select("name").eq("id",a).single();e?.name&&await (0,l.QO)(a,e.name,"d\xeda"),console.log("✅ [DAILY-EARNINGS] Meta del d\xeda alcanzada, notificaciones enviadas")}}}catch(e){console.warn("⚠️ [DAILY-EARNINGS] Error verificando metas:",e)}return i.Z.json({success:!0,data:t,message:"Ganancias del d\xeda guardadas correctamente"})}catch(e){return console.error("❌ [DAILY-EARNINGS] Error:",e),i.Z.json({success:!1,error:e.message||"Error interno del servidor"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:t.x.APP_ROUTE,page:"/api/daily-earnings/route",pathname:"/api/daily-earnings",filename:"route",bundlePath:"app/api/daily-earnings/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\daily-earnings\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:_,staticGenerationAsyncStorage:S,serverHooks:E,headerHooks:I,staticGenerationBailout:f}=m,A="/api/daily-earnings/route";function y(){return(0,o.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:S})}},66569:(e,a,r)=>{r.d(a,{A:()=>i,R:()=>o});var n=r(72964);let s="https://mhernfrkvwigxdubiozm.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY||"",o=(0,n.createClient)(s,t,{auth:{autoRefreshToken:!1,persistSession:!1}}),i=(0,n.createClient)(s,t,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var a=require("../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),n=a.X(0,[1638,6206,2964,7863],()=>r(28831));module.exports=n})();