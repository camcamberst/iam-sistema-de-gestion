"use strict";(()=>{var r={};r.id=9979,r.ids=[9979],r.modules={30517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:r=>{r.exports=require("http")},95687:r=>{r.exports=require("https")},85477:r=>{r.exports=require("punycode")},12781:r=>{r.exports=require("stream")},57310:r=>{r.exports=require("url")},59796:r=>{r.exports=require("zlib")},57698:(r,e,t)=>{t.r(e),t.d(e,{headerHooks:()=>g,originalPathname:()=>_,patchFetch:()=>h,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>E});var a={};t.r(a),t.d(a,{GET:()=>l,POST:()=>c});var o=t(95419),s=t(69108),n=t(99678),i=t(78070);let u=(0,t(72964).createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"");async function l(r){try{if(!process.env.SUPABASE_SERVICE_ROLE_KEY)return i.Z.json({error:"Configuraci\xf3n de base de datos no disponible"},{status:503});let{searchParams:e}=new URL(r.url),t="true"===e.get("include_stats"),a=u.from("calculator_platforms").select("id, name").order("name",{ascending:!0}),{data:o,error:s}=await a;if(s)return console.error("Error fetching platforms catalog:",s),i.Z.json({error:s.message},{status:500});if(!t)return i.Z.json(o||[]);let n=await Promise.all((o||[]).map(async r=>{let{data:e,error:t}=await u.from("modelo_plataformas").select("status").eq("platform_id",r.id);if(t)return console.error(`Error fetching stats for platform ${r.id}:`,t),{...r,total_models:0,status_counts:{}};let a=(e||[]).reduce((r,e)=>(r[e.status]=(r[e.status]||0)+1,r),{});return{...r,total_models:e?.length||0,status_counts:a}}));return i.Z.json(n)}catch(r){return console.error("Error in GET /api/plataformas-catalogo:",r),i.Z.json({error:"Error interno del servidor"},{status:500})}}async function c(r){try{if(!process.env.SUPABASE_SERVICE_ROLE_KEY)return i.Z.json({error:"Configuraci\xf3n de base de datos no disponible"},{status:503});let{id:e,name:t,created_by:a}=await r.json();if(!e||!t||!a)return i.Z.json({error:"Faltan campos requeridos: id, name, created_by"},{status:400});let{data:o,error:s}=await u.from("users").select("role").eq("id",a).single();if(s||!o||"super_admin"!==o.role)return i.Z.json({error:"Solo Super Admins pueden agregar plataformas"},{status:403});let{data:n,error:l}=await u.from("calculator_platforms").insert({id:e.toLowerCase(),name:t.toUpperCase()}).select().single();if(l){if("23505"===l.code)return i.Z.json({error:"Ya existe una plataforma con ese ID"},{status:409});return console.error("Error creating platform:",l),i.Z.json({error:l.message},{status:500})}return i.Z.json({success:!0,data:n,message:"Plataforma agregada al cat\xe1logo"})}catch(r){return console.error("Error in POST /api/plataformas-catalogo:",r),i.Z.json({error:"Error interno del servidor"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/plataformas-catalogo/route",pathname:"/api/plataformas-catalogo",filename:"route",bundlePath:"app/api/plataformas-catalogo/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\plataformas-catalogo\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:f,headerHooks:g,staticGenerationBailout:E}=p,_="/api/plataformas-catalogo/route";function h(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}}};var e=require("../../../webpack-runtime.js");e.C(r);var t=r=>e(e.s=r),a=e.X(0,[1638,6206,2964],()=>t(57698));module.exports=a})();