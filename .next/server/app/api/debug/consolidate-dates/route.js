"use strict";(()=>{var e={};e.id=9122,e.ids=[9122],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},55087:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>D,originalPathname:()=>S,patchFetch:()=>E,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>g});var o={};t.r(o),t.d(o,{POST:()=>d});var s=t(95419),a=t(69108),n=t(99678),i=t(78070);let l=(0,t(72964).createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function d(e){try{console.log("\uD83D\uDD27 [CONSOLIDATE-DATES] Iniciando consolidaci\xf3n de fechas...");let{data:e,error:r}=await l.from("model_values").select("*").order("updated_at",{ascending:!1});if(r)return console.error("❌ [CONSOLIDATE-DATES] Error loading values:",r),i.Z.json({success:!1,error:r.message},{status:500});console.log("\uD83D\uDD0D [CONSOLIDATE-DATES] Total values found:",e?.length||0);let t=new Map;e?.forEach(e=>{let r=`${e.model_id}-${e.platform_id}`;if(!t.has(r)){let o=new Date().toISOString().split("T")[0];t.set(r,{...e,period_date:o,consolidated:!0})}});let o=Array.from(t.values());console.log("\uD83D\uDD0D [CONSOLIDATE-DATES] Consolidated values:",o.length);let{error:s}=await l.from("model_values").delete().neq("id","00000000-0000-0000-0000-000000000000");if(s)return console.error("❌ [CONSOLIDATE-DATES] Error deleting old values:",s),i.Z.json({success:!1,error:s.message},{status:500});let a=o.map(e=>({model_id:e.model_id,platform_id:e.platform_id,value:e.value,period_date:e.period_date,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),{data:n,error:d}=await l.from("model_values").insert(a).select();if(d)return console.error("❌ [CONSOLIDATE-DATES] Error inserting consolidated values:",d),i.Z.json({success:!1,error:d.message},{status:500});return console.log("✅ [CONSOLIDATE-DATES] Consolidation completed successfully"),i.Z.json({success:!0,message:"Fechas consolidadas exitosamente",summary:{originalValues:e?.length||0,consolidatedValues:o.length,insertedValues:n?.length||0,newDate:new Date().toISOString().split("T")[0]}})}catch(e){return console.error("❌ [CONSOLIDATE-DATES] Error:",e),i.Z.json({success:!1,error:e.message||"Error interno del servidor"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/debug/consolidate-dates/route",pathname:"/api/debug/consolidate-dates",filename:"route",bundlePath:"app/api/debug/consolidate-dates/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\debug\\consolidate-dates\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:m,headerHooks:D,staticGenerationBailout:g}=u,S="/api/debug/consolidate-dates/route";function E(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1638,6206,2964],()=>t(55087));module.exports=o})();