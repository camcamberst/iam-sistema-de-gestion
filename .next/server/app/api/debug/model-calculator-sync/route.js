"use strict";(()=>{var e={};e.id=3742,e.ids=[3742],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},74416:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>D,originalPathname:()=>b,patchFetch:()=>_,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>S,staticGenerationBailout:()=>$});var a={};r.r(a),r.d(a,{GET:()=>p,dynamic:()=>u});var o=r(95419),n=r(69108),l=r(99678),s=r(78070),d=r(72964),i=r(13532);let u="force-dynamic",c=(0,d.createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function p(e){let{searchParams:t}=new URL(e.url),r=t.get("modelId");if(!r)return s.Z.json({success:!1,error:"modelId es requerido"},{status:400});try{let e=(0,i.iR)(),{data:t,error:a}=await c.from("model_values").select("*").eq("model_id",r).gte("period_date",new Date(new Date().setDate(new Date().getDate()-7)).toISOString().split("T")[0]).order("updated_at",{ascending:!1}),{data:o,error:n}=await c.from("calculator_totals").select("*").eq("model_id",r).gte("period_date",new Date(new Date().setDate(new Date().getDate()-7)).toISOString().split("T")[0]).order("updated_at",{ascending:!1}),{data:l,error:d}=await c.from("users").select("id, email, name, role").eq("id",r).single(),u=new Date(e),p=u.getFullYear(),g=u.getMonth(),m=u.getDate(),S=new Date(p,g+1,0).getDate(),h=m<=15?`${p}-${String(g+1).padStart(2,"0")}-01`:`${p}-${String(g+1).padStart(2,"0")}-16`,D=m<=15?`${p}-${String(g+1).padStart(2,"0")}-15`:`${p}-${String(g+1).padStart(2,"0")}-${String(S).padStart(2,"0")}`,{data:$,error:b}=await c.from("calculator_totals").select("*").eq("model_id",r).gte("period_date",h).lte("period_date",D).order("updated_at",{ascending:!1});return s.Z.json({success:!0,model:l||null,periodDate:e,quincenaRange:{start:h,end:D},modelValues:{count:t?.length||0,data:t||[],error:a?.message||null},calculatorTotals:{count:o?.length||0,data:o||[],error:n?.message||null},totalsInQuincenaRange:{count:$?.length||0,data:$||[],error:b?.message||null},diagnosis:{hasModelValues:(t?.length||0)>0,hasTotals:(o?.length||0)>0,hasTotalsInRange:($?.length||0)>0,needsSync:(t?.length||0)>0&&0===($?.length||0),latestModelValueDate:t?.[0]?.period_date||null,latestTotalDate:o?.[0]?.period_date||null,latestTotalInRangeDate:$?.[0]?.period_date||null}})}catch(e){return console.error("❌ [DEBUG-SYNC] Error:",e),s.Z.json({success:!1,error:e.message||"Error interno del servidor"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/debug/model-calculator-sync/route",pathname:"/api/debug/model-calculator-sync",filename:"route",bundlePath:"app/api/debug/model-calculator-sync/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\debug\\model-calculator-sync\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:S,serverHooks:h,headerHooks:D,staticGenerationBailout:$}=g,b="/api/debug/model-calculator-sync/route";function _(){return(0,l.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:S})}},13532:(e,t,r)=>{r.d(t,{Bs:()=>n,Jz:()=>o,iR:()=>l,lm:()=>a});let a=()=>{let[e,t,r]=l().split("-").map(Number);return`${e}-${String(t).padStart(2,"0")}-${String(r<=15?1:16).padStart(2,"0")}`},o=e=>{try{if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return console.warn("⚠️ [DATE-UTILS] Formato de fecha inv\xe1lido para normalizar:",e),a();let[t,r,o]=e.split("-").map(Number);if(!t||!r||!o)return a();return`${t}-${String(r).padStart(2,"0")}-${String(o<=15?1:16).padStart(2,"0")}`}catch(e){return console.error("❌ [DATE-UTILS] Error normalizando fecha:",e),a()}},n=e=>{try{let[t,r,a]=e.split("-").map(Number),o=a<=15,n=`${t}-${String(r).padStart(2,"0")}-${o?"01":"16"}`,l="";if(o)l=`${t}-${String(r).padStart(2,"0")}-15`;else{let e=new Date(t,r,0).getDate();l=`${t}-${String(r).padStart(2,"0")}-${e}`}let s=`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][r-1]} ${t} - Per\xedodo ${o?"1":"2"}`;return{startDate:n,endDate:l,name:s,isP1:o}}catch(t){return console.error("❌ [DATE-UTILS] Error calculando detalles del per\xedodo:",t),{startDate:e,endDate:e,name:`Per\xedodo ${e}`,isP1:!0}}},l=()=>new Date().toLocaleDateString("en-CA",{timeZone:"America/Bogota"})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,2964],()=>r(74416));module.exports=a})();