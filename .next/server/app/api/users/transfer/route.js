"use strict";(()=>{var r={};r.id=6706,r.ids=[6706],r.modules={30517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:r=>{r.exports=require("http")},95687:r=>{r.exports=require("https")},85477:r=>{r.exports=require("punycode")},12781:r=>{r.exports=require("stream")},57310:r=>{r.exports=require("url")},59796:r=>{r.exports=require("zlib")},17128:(r,e,s)=>{s.r(e),s.d(e,{headerHooks:()=>f,originalPathname:()=>v,patchFetch:()=>_,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>g});var t={};s.r(t),s.d(t,{POST:()=>p});var o=s(95419),a=s(69108),i=s(99678),u=s(78070),n=s(72964);async function p(r){try{let e=(0,n.createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),{current_user:s,target_user_id:t,to_group_id:o}=await r.json()||{};if(!s||!t||!o)return u.Z.json({success:!1,error:"Par\xe1metros incompletos"},{status:400});let a={id:s.id,role:s.role,groups:s.groups||[]},{data:i,error:p}=await e.from("users").select("id, name, email, role, is_active").eq("id",t).single();if(p||!i)return u.Z.json({success:!1,error:"Usuario objetivo no encontrado"},{status:404});let{data:d,error:c}=await e.from("user_groups").select("groups(id,name)").eq("user_id",t);if(c)return u.Z.json({success:!1,error:"Error obteniendo grupos del usuario"},{status:500});let l={id:i.id,name:i.name,email:i.email,role:i.role,is_active:i.is_active,groups:(d||[]).map(r=>({id:r.groups?.id,name:r.groups?.name})).filter(r=>r.id)};if(!function(r,e){if("super_admin"===r.role)return!0;if("admin"===r.role){let s=r.groups.map(r=>r.id),t=e.groups.map(r=>r.id);return"modelo"===e.role&&t.some(r=>s.includes(r))}return!1}(a,l))return u.Z.json({success:!1,error:"No autorizado para transferir este usuario"},{status:403});let{data:m,error:f}=await e.from("groups").select("id, name").eq("id",o).single();if(f||!m)return u.Z.json({success:!1,error:"Grupo destino no v\xe1lido"},{status:400});let{error:g}=await e.from("user_groups").delete().eq("user_id",t);if(g)return u.Z.json({success:!1,error:"Error removiendo grupos actuales"},{status:500});let{error:v}=await e.from("user_groups").insert([{user_id:t,group_id:o,is_manager:!1}]);if(v)return u.Z.json({success:!1,error:"Error asignando grupo destino"},{status:500});return u.Z.json({success:!0,message:"Usuario transferido correctamente",user_id:t,to_group_id:o,role:l.role})}catch(r){return console.error("âŒ [API] Transfer error:",r),u.Z.json({success:!1,error:"Error interno"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/users/transfer/route",pathname:"/api/users/transfer",filename:"route",bundlePath:"app/api/users/transfer/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\users\\transfer\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:m,headerHooks:f,staticGenerationBailout:g}=d,v="/api/users/transfer/route";function _(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}}};var e=require("../../../../webpack-runtime.js");e.C(r);var s=r=>e(e.s=r),t=e.X(0,[1638,6206,2964],()=>s(17128));module.exports=t})();