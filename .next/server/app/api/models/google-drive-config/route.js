"use strict";(()=>{var e={};e.id=2816,e.ids=[2816],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},17121:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>E,originalPathname:()=>v,patchFetch:()=>G,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>O});var s={};o.r(s),o.d(s,{GET:()=>d,POST:()=>c,dynamic:()=>l});var t=o(95419),a=o(69108),n=o(99678),i=o(78070),u=o(66569);let l="force-dynamic";async function d(e){try{let{searchParams:r}=new URL(e.url),o=r.get("modelId");if(!o)return i.Z.json({success:!1,error:"modelId es requerido"},{status:400});let s=u.R,{data:t,error:a}=await s.from("users").select("id, email, name, google_drive_folder_url").eq("id",o).eq("role","modelo").single();if(a)return console.error("❌ [GOOGLE-DRIVE-CONFIG] Error al obtener modelo:",a),i.Z.json({success:!1,error:"Modelo no encontrado"},{status:404});let n=t.google_drive_folder_url||null,l=null;if(n){let e=n.match(/\/folders\/([a-zA-Z0-9_-]+)/);l=e?e[1]:null}return i.Z.json({success:!0,folderUrl:n,folderId:l})}catch(e){return console.error("❌ [GOOGLE-DRIVE-CONFIG] Error general:",e),i.Z.json({success:!1,error:e.message||"Error interno del servidor"},{status:500})}}async function c(e){try{let{modelId:r,folderUrl:o,folderId:s}=await e.json();if(!r||!o)return i.Z.json({success:!1,error:"modelId y folderUrl son requeridos"},{status:400});let t=u.R,{data:a,error:n}=await t.from("users").select("id, role").eq("id",r).eq("role","modelo").single();if(n||!a)return console.error("❌ [GOOGLE-DRIVE-CONFIG] Error al verificar modelo:",n),i.Z.json({success:!1,error:"Modelo no encontrado"},{status:404});let{error:l}=await t.from("users").update({google_drive_folder_url:o,updated_at:new Date().toISOString()}).eq("id",r);if(l)return console.error("❌ [GOOGLE-DRIVE-CONFIG] Error al actualizar configuraci\xf3n:",l),i.Z.json({success:!1,error:"Error al guardar configuraci\xf3n"},{status:500});return console.log("✅ [GOOGLE-DRIVE-CONFIG] Configuraci\xf3n guardada para modelo:",r),i.Z.json({success:!0,message:"Configuraci\xf3n guardada correctamente",folderUrl:o,folderId:s})}catch(e){return console.error("❌ [GOOGLE-DRIVE-CONFIG] Error general:",e),i.Z.json({success:!1,error:e.message||"Error interno del servidor"},{status:500})}}let g=new t.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/models/google-drive-config/route",pathname:"/api/models/google-drive-config",filename:"route",bundlePath:"app/api/models/google-drive-config/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\models\\google-drive-config\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:f,headerHooks:E,staticGenerationBailout:O}=g,v="/api/models/google-drive-config/route";function G(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:p})}},66569:(e,r,o)=>{o.d(r,{A:()=>i,R:()=>n});var s=o(72964);let t="https://mhernfrkvwigxdubiozm.supabase.co",a=process.env.SUPABASE_SERVICE_ROLE_KEY||"",n=(0,s.createClient)(t,a,{auth:{autoRefreshToken:!1,persistSession:!1}}),i=(0,s.createClient)(t,a,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),s=r.X(0,[1638,6206,2964],()=>o(17121));module.exports=s})();