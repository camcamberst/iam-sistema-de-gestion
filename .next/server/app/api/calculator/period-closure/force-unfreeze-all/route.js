"use strict";(()=>{var e={};e.id=5945,e.ids=[5945],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},16878:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>m,originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>E,staticGenerationBailout:()=>h});var s={};o.r(s),o.d(s,{GET:()=>i,POST:()=>l});var t=o(95419),a=o(69108),c=o(99678),n=o(78070);let u=(0,o(72964).createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});async function l(e){try{let r=e.headers.get("x-unfreeze-secret"),o=process.env.CRON_SECRET_KEY||"cron-secret";if(r!==o)return n.Z.json({success:!1,error:"No autorizado"},{status:401});console.log("\uD83D\uDEA8 [FORCE-UNFREEZE] Iniciando desbloqueo forzado de TODAS las plataformas...");let{data:s,error:t}=await u.from("calculator_early_frozen_platforms").delete().neq("id","00000000-0000-0000-0000-000000000000").select();if(t)return console.error("❌ [FORCE-UNFREEZE] Error:",t),n.Z.json({success:!1,error:t.message},{status:500});let a=s?.length||0;return console.log(`✅ [FORCE-UNFREEZE] Desbloqueo completado: ${a} registros eliminados`),n.Z.json({success:!0,deleted_count:a,message:`Todas las plataformas han sido desbloqueadas. ${a} registros eliminados.`})}catch(e){return console.error("❌ [FORCE-UNFREEZE] Error:",e),n.Z.json({success:!1,error:e instanceof Error?e.message:"Error desconocido"},{status:500})}}async function i(e){try{let{data:e,error:r}=await u.from("calculator_early_frozen_platforms").select("period_date, platform_id, model_id, frozen_at").order("frozen_at",{ascending:!1}).limit(100);if(r)return n.Z.json({success:!1,error:r.message},{status:500});let o=new Map;return e?.forEach(e=>{let r=e.period_date;o.has(r)||o.set(r,[]),o.get(r).push(e)}),n.Z.json({success:!0,total_records:e?.length||0,records_by_period:Object.fromEntries(o),records:e||[]})}catch(e){return console.error("❌ [FORCE-UNFREEZE] Error:",e),n.Z.json({success:!1,error:e instanceof Error?e.message:"Error desconocido"},{status:500})}}let d=new t.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/calculator/period-closure/force-unfreeze-all/route",pathname:"/api/calculator/period-closure/force-unfreeze-all",filename:"route",bundlePath:"app/api/calculator/period-closure/force-unfreeze-all/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\calculator\\period-closure\\force-unfreeze-all\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:E,serverHooks:f,headerHooks:m,staticGenerationBailout:h}=d,g="/api/calculator/period-closure/force-unfreeze-all/route";function _(){return(0,c.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:E})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),s=r.X(0,[1638,6206,2964],()=>o(16878));module.exports=s})();