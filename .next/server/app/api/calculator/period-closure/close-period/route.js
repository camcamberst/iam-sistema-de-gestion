"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/calculator/period-closure/close-period/route";
exports.ids = ["app/api/calculator/period-closure/close-period/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute&page=%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute.ts&appDir=C%3A%5CUsers%5Ccamca%5COneDrive%5CDocumentos%5CGitHub%5Ciam-sistema-de-gestion%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ccamca%5COneDrive%5CDocumentos%5CGitHub%5Ciam-sistema-de-gestion&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute&page=%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute.ts&appDir=C%3A%5CUsers%5Ccamca%5COneDrive%5CDocumentos%5CGitHub%5Ciam-sistema-de-gestion%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ccamca%5COneDrive%5CDocumentos%5CGitHub%5Ciam-sistema-de-gestion&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_camca_OneDrive_Documentos_GitHub_iam_sistema_de_gestion_app_api_calculator_period_closure_close_period_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/calculator/period-closure/close-period/route.ts */ \"(rsc)/./app/api/calculator/period-closure/close-period/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/calculator/period-closure/close-period/route\",\n        pathname: \"/api/calculator/period-closure/close-period\",\n        filename: \"route\",\n        bundlePath: \"app/api/calculator/period-closure/close-period/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\camca\\\\OneDrive\\\\Documentos\\\\GitHub\\\\iam-sistema-de-gestion\\\\app\\\\api\\\\calculator\\\\period-closure\\\\close-period\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_camca_OneDrive_Documentos_GitHub_iam_sistema_de_gestion_app_api_calculator_period_closure_close_period_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/calculator/period-closure/close-period/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjYWxjdWxhdG9yJTJGcGVyaW9kLWNsb3N1cmUlMkZjbG9zZS1wZXJpb2QlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmNhbGN1bGF0b3IlMkZwZXJpb2QtY2xvc3VyZSUyRmNsb3NlLXBlcmlvZCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmNhbGN1bGF0b3IlMkZwZXJpb2QtY2xvc3VyZSUyRmNsb3NlLXBlcmlvZCUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNjYW1jYSU1Q09uZURyaXZlJTVDRG9jdW1lbnRvcyU1Q0dpdEh1YiU1Q2lhbS1zaXN0ZW1hLWRlLWdlc3Rpb24lNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q2NhbWNhJTVDT25lRHJpdmUlNUNEb2N1bWVudG9zJTVDR2l0SHViJTVDaWFtLXNpc3RlbWEtZGUtZ2VzdGlvbiZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNvRjtBQUNqSztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHVHQUF1RztBQUMvRztBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzZKOztBQUU3SiIsInNvdXJjZXMiOlsid2VicGFjazovL3Npc3RlbWEtZ2VzdGlvbi1haW0vPzQ3MmIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcY2FtY2FcXFxcT25lRHJpdmVcXFxcRG9jdW1lbnRvc1xcXFxHaXRIdWJcXFxcaWFtLXNpc3RlbWEtZGUtZ2VzdGlvblxcXFxhcHBcXFxcYXBpXFxcXGNhbGN1bGF0b3JcXFxccGVyaW9kLWNsb3N1cmVcXFxcY2xvc2UtcGVyaW9kXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jYWxjdWxhdG9yL3BlcmlvZC1jbG9zdXJlL2Nsb3NlLXBlcmlvZC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NhbGN1bGF0b3IvcGVyaW9kLWNsb3N1cmUvY2xvc2UtcGVyaW9kXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9jYWxjdWxhdG9yL3BlcmlvZC1jbG9zdXJlL2Nsb3NlLXBlcmlvZC9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXGNhbWNhXFxcXE9uZURyaXZlXFxcXERvY3VtZW50b3NcXFxcR2l0SHViXFxcXGlhbS1zaXN0ZW1hLWRlLWdlc3Rpb25cXFxcYXBwXFxcXGFwaVxcXFxjYWxjdWxhdG9yXFxcXHBlcmlvZC1jbG9zdXJlXFxcXGNsb3NlLXBlcmlvZFxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9jYWxjdWxhdG9yL3BlcmlvZC1jbG9zdXJlL2Nsb3NlLXBlcmlvZC9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute&page=%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute.ts&appDir=C%3A%5CUsers%5Ccamca%5COneDrive%5CDocumentos%5CGitHub%5Ciam-sistema-de-gestion%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ccamca%5COneDrive%5CDocumentos%5CGitHub%5Ciam-sistema-de-gestion&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/calculator/period-closure/close-period/route.ts":
/*!*****************************************************************!*\
  !*** ./app/api/calculator/period-closure/close-period/route.ts ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _utils_period_closure_dates__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/utils/period-closure-dates */ \"(rsc)/./utils/period-closure-dates.ts\");\n/* harmony import */ var _lib_calculator_period_closure_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/calculator/period-closure-helpers */ \"(rsc)/./lib/calculator/period-closure-helpers.ts\");\n/* harmony import */ var _lib_chat_bot_notifications__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/chat/bot-notifications */ \"(rsc)/./lib/chat/bot-notifications.ts\");\n\n\n\n\n\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_4__.createClient)(\"https://mhernfrkvwigxdubiozm.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\n/**\r\n * POST: Cierra período completo (00:00 Colombia)\r\n */ async function POST(request) {\n    try {\n        console.log(\"\\uD83D\\uDD12 [CLOSE-PERIOD] Iniciando cierre completo de per\\xedodo...\");\n        const currentDate = (0,_utils_period_closure_dates__WEBPACK_IMPORTED_MODULE_1__.getColombiaDate)();\n        const periodType = (0,_utils_period_closure_dates__WEBPACK_IMPORTED_MODULE_1__.getCurrentPeriodType)();\n        // Verificar modo testing desde header\n        const testingMode = request.headers.get(\"x-testing-mode\") === \"true\";\n        // Verificar que es día de cierre y hora correcta (o si está en modo testing)\n        if (!testingMode && !(0,_utils_period_closure_dates__WEBPACK_IMPORTED_MODULE_1__.isClosureDay)()) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"No es d\\xeda de cierre (d\\xedas 1 y 16)\"\n            }, {\n                status: 400\n            });\n        }\n        if (!testingMode && !(0,_utils_period_closure_dates__WEBPACK_IMPORTED_MODULE_1__.isFullClosureTime)()) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"No es momento de cierre completo (00:00 Colombia)\"\n            }, {\n                status: 400\n            });\n        }\n        if (testingMode) {\n            console.log(\"\\uD83E\\uDDEA [CLOSE-PERIOD] MODO TESTING ACTIVADO\");\n        }\n        // Verificar estado actual\n        const { data: currentStatus } = await supabase.from(\"calculator_period_closure_status\").select(\"status\").eq(\"period_date\", currentDate).order(\"created_at\", {\n            ascending: false\n        }).limit(1).single();\n        if (currentStatus?.status === \"completed\") {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: true,\n                message: \"Per\\xedodo ya fue cerrado\",\n                already_closed: true\n            });\n        }\n        // Actualizar estado a closing_calculators\n        await (0,_lib_calculator_period_closure_helpers__WEBPACK_IMPORTED_MODULE_2__.updateClosureStatus)(currentDate, periodType, \"closing_calculators\");\n        // Obtener todos los modelos activos\n        const { data: models, error: modelsError } = await supabase.from(\"users\").select(\"id, email, name\").eq(\"role\", \"modelo\").eq(\"is_active\", true);\n        if (modelsError) {\n            console.error(\"❌ [CLOSE-PERIOD] Error obteniendo modelos:\", modelsError);\n            await (0,_lib_calculator_period_closure_helpers__WEBPACK_IMPORTED_MODULE_2__.updateClosureStatus)(currentDate, periodType, \"failed\", {\n                error: \"Error obteniendo modelos\"\n            });\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Error obteniendo modelos\"\n            }, {\n                status: 500\n            });\n        }\n        console.log(`🔄 [CLOSE-PERIOD] Procesando ${models?.length || 0} modelos...`);\n        // FASE 1: Archivar valores de todas las calculadoras\n        const archiveResults = [];\n        let archiveSuccessCount = 0;\n        let archiveErrorCount = 0;\n        for (const model of models || []){\n            try {\n                const archiveResult = await (0,_lib_calculator_period_closure_helpers__WEBPACK_IMPORTED_MODULE_2__.archiveModelValues)(model.id, currentDate, periodType);\n                if (archiveResult.success) {\n                    archiveSuccessCount++;\n                    archiveResults.push({\n                        model_id: model.id,\n                        model_email: model.email,\n                        status: \"archived\",\n                        archived_count: archiveResult.archived\n                    });\n                } else {\n                    archiveErrorCount++;\n                    archiveResults.push({\n                        model_id: model.id,\n                        model_email: model.email,\n                        status: \"error\",\n                        error: archiveResult.error\n                    });\n                }\n            } catch (error) {\n                archiveErrorCount++;\n                console.error(`❌ [CLOSE-PERIOD] Error archivando modelo ${model.email}:`, error);\n                archiveResults.push({\n                    model_id: model.id,\n                    model_email: model.email,\n                    status: \"error\",\n                    error: error instanceof Error ? error.message : \"Error desconocido\"\n                });\n            }\n        }\n        console.log(`✅ [CLOSE-PERIOD] Archivo completado: ${archiveSuccessCount} exitosos, ${archiveErrorCount} errores`);\n        // FASE 2: Esperar 2.5 minutos (150 segundos) para que Resumen de Facturación reciba última actualización\n        console.log(\"⏳ [CLOSE-PERIOD] Esperando para \\xfaltima actualizaci\\xf3n del resumen...\");\n        await (0,_lib_calculator_period_closure_helpers__WEBPACK_IMPORTED_MODULE_2__.updateClosureStatus)(currentDate, periodType, \"waiting_summary\");\n        // TEMPORAL PARA TESTING: 5 segundos en lugar de 150 segundos\n        const waitTime = testingMode ? 5000 : 150000;\n        if (testingMode) {\n            console.log(\"\\uD83E\\uDDEA [CLOSE-PERIOD] Modo testing: espera reducida a 5 segundos\");\n        }\n        await new Promise((resolve)=>setTimeout(resolve, waitTime));\n        console.log(\"✅ [CLOSE-PERIOD] Tiempo de espera completado\");\n        // FASE 3: El resumen de facturación se actualiza automáticamente leyendo de calculator_history\n        // No necesitamos endpoint especial - solo esperamos y luego continuamos\n        await (0,_lib_calculator_period_closure_helpers__WEBPACK_IMPORTED_MODULE_2__.updateClosureStatus)(currentDate, periodType, \"closing_summary\");\n        // FASE 4: Resetear todas las calculadoras\n        await (0,_lib_calculator_period_closure_helpers__WEBPACK_IMPORTED_MODULE_2__.updateClosureStatus)(currentDate, periodType, \"archiving\");\n        const resetResults = [];\n        let resetSuccessCount = 0;\n        let resetErrorCount = 0;\n        for (const model of models || []){\n            try {\n                const resetResult = await (0,_lib_calculator_period_closure_helpers__WEBPACK_IMPORTED_MODULE_2__.resetModelValues)(model.id, currentDate);\n                if (resetResult.success) {\n                    resetSuccessCount++;\n                    resetResults.push({\n                        model_id: model.id,\n                        model_email: model.email,\n                        status: \"reset\",\n                        deleted_count: resetResult.deleted\n                    });\n                } else {\n                    resetErrorCount++;\n                    resetResults.push({\n                        model_id: model.id,\n                        model_email: model.email,\n                        status: \"error\",\n                        error: resetResult.error\n                    });\n                }\n            } catch (error) {\n                resetErrorCount++;\n                console.error(`❌ [CLOSE-PERIOD] Error reseteando modelo ${model.email}:`, error);\n                resetResults.push({\n                    model_id: model.id,\n                    model_email: model.email,\n                    status: \"error\",\n                    error: error instanceof Error ? error.message : \"Error desconocido\"\n                });\n            }\n        }\n        // FASE 5: Notificar a modelos\n        for (const model of models || []){\n            try {\n                await (0,_lib_chat_bot_notifications__WEBPACK_IMPORTED_MODULE_3__.sendBotNotification)(model.id, \"periodo_cerrado\", 'El per\\xedodo ha cerrado. Tus valores han sido archivados y puedes revisarlos en \"Mi Historial\". La calculadora se ha reiniciado para el nuevo per\\xedodo. Puedes comenzar a ingresar valores nuevamente.');\n            } catch (error) {\n                console.error(`❌ [CLOSE-PERIOD] Error notificando modelo ${model.email}:`, error);\n            }\n        }\n        // FASE 6: Notificar a admins/super_admins\n        const { data: admins } = await supabase.from(\"users\").select(\"id, email, name\").in(\"role\", [\n            \"admin\",\n            \"super_admin\"\n        ]).eq(\"is_active\", true);\n        for (const admin of admins || []){\n            try {\n                await (0,_lib_chat_bot_notifications__WEBPACK_IMPORTED_MODULE_3__.sendBotNotification)(admin.id, \"periodo_cerrado\", `Período ${periodType} cerrado exitosamente. El resumen está disponible en \"Consulta Histórica\" del Dashboard de Sedes. Nuevo período iniciado.`);\n            } catch (error) {\n                console.error(`❌ [CLOSE-PERIOD] Error notificando admin ${admin.email}:`, error);\n            }\n        }\n        // FASE 7: Marcar como completado\n        await (0,_lib_calculator_period_closure_helpers__WEBPACK_IMPORTED_MODULE_2__.updateClosureStatus)(currentDate, periodType, \"completed\", {\n            archive_results: {\n                total: models?.length || 0,\n                successful: archiveSuccessCount,\n                failed: archiveErrorCount\n            },\n            reset_results: {\n                total: models?.length || 0,\n                successful: resetSuccessCount,\n                failed: resetErrorCount\n            },\n            completed_at: new Date().toISOString()\n        });\n        console.log(\"✅ [CLOSE-PERIOD] Cierre completo exitoso\");\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            message: \"Cierre de per\\xedodo completado exitosamente\",\n            period_date: currentDate,\n            period_type: periodType,\n            archive_summary: {\n                total: models?.length || 0,\n                successful: archiveSuccessCount,\n                failed: archiveErrorCount\n            },\n            reset_summary: {\n                total: models?.length || 0,\n                successful: resetSuccessCount,\n                failed: resetErrorCount\n            },\n            details: {\n                archived: archiveResults,\n                reset: resetResults\n            }\n        });\n    } catch (error) {\n        console.error(\"❌ [CLOSE-PERIOD] Error:\", error);\n        const currentDate = (0,_utils_period_closure_dates__WEBPACK_IMPORTED_MODULE_1__.getColombiaDate)();\n        const periodType = (0,_utils_period_closure_dates__WEBPACK_IMPORTED_MODULE_1__.getCurrentPeriodType)();\n        await (0,_lib_calculator_period_closure_helpers__WEBPACK_IMPORTED_MODULE_2__.updateClosureStatus)(currentDate, periodType, \"failed\", {\n            error: error instanceof Error ? error.message : \"Error desconocido\",\n            failed_at: new Date().toISOString()\n        });\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: false,\n            error: \"Error interno del servidor\",\n            details: error instanceof Error ? error.message : \"Error desconocido\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2NhbGN1bGF0b3IvcGVyaW9kLWNsb3N1cmUvY2xvc2UtcGVyaW9kL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUF3RDtBQUNIO0FBTWY7QUFLVztBQUNrQjtBQUVuRSxNQUFNVSxXQUFXVCxtRUFBWUEsQ0FDM0JVLDBDQUFvQyxFQUNwQ0EsUUFBUUMsR0FBRyxDQUFDRSx5QkFBeUIsRUFDckM7SUFDRUMsTUFBTTtRQUNKQyxrQkFBa0I7UUFDbEJDLGdCQUFnQjtJQUNsQjtBQUNGO0FBR0Y7O0NBRUMsR0FDTSxlQUFlQyxLQUFLQyxPQUFvQjtJQUM3QyxJQUFJO1FBQ0ZDLFFBQVFDLEdBQUcsQ0FBQztRQUVaLE1BQU1DLGNBQWNwQiw0RUFBZUE7UUFDbkMsTUFBTXFCLGFBQWFwQixpRkFBb0JBO1FBRXZDLHNDQUFzQztRQUN0QyxNQUFNcUIsY0FBY0wsUUFBUU0sT0FBTyxDQUFDQyxHQUFHLENBQUMsc0JBQXNCO1FBRTlELDZFQUE2RTtRQUM3RSxJQUFJLENBQUNGLGVBQWUsQ0FBQ25CLHlFQUFZQSxJQUFJO1lBQ25DLE9BQU9MLGtGQUFZQSxDQUFDMkIsSUFBSSxDQUFDO2dCQUN2QkMsU0FBUztnQkFDVEMsT0FBTztZQUNULEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUNuQjtRQUVBLElBQUksQ0FBQ04sZUFBZSxDQUFDcEIsOEVBQWlCQSxJQUFJO1lBQ3hDLE9BQU9KLGtGQUFZQSxDQUFDMkIsSUFBSSxDQUFDO2dCQUN2QkMsU0FBUztnQkFDVEMsT0FBTztZQUNULEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUNuQjtRQUVBLElBQUlOLGFBQWE7WUFDZkosUUFBUUMsR0FBRyxDQUFDO1FBQ2Q7UUFFQSwwQkFBMEI7UUFDMUIsTUFBTSxFQUFFVSxNQUFNQyxhQUFhLEVBQUUsR0FBRyxNQUFNdEIsU0FDbkN1QixJQUFJLENBQUMsb0NBQ0xDLE1BQU0sQ0FBQyxVQUNQQyxFQUFFLENBQUMsZUFBZWIsYUFDbEJjLEtBQUssQ0FB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QUFPOUIsUUFBUUUsVUFBVTtnQkFDekI2QixZQUFZVjtnQkFDWlcsUUFBUVY7WUFDVjtZQUNBbUIsU0FBUztnQkFDUDNCLFVBQVVYO2dCQUNWdUMsT0FBT3RCO1lBQ1Q7UUFDRjtJQUVGLEVBQUUsT0FBT2pDLE9BQU87UUFDZFQsUUFBUVMsS0FBSyxDQUFDLDJCQUEyQkE7UUFDekMsTUFBTVAsY0FBY3BCLDRFQUFlQTtRQUNuQyxNQUFNcUIsYUFBYXBCLGlGQUFvQkE7UUFFdkMsTUFBTUcsMkZBQW1CQSxDQUFDZ0IsYUFBYUMsWUFBWSxVQUFVO1lBQzNETSxPQUFPQSxpQkFBaUI0QixRQUFRNUIsTUFBTVcsT0FBTyxHQUFHO1lBQ2hENkMsV0FBVyxJQUFJUixPQUFPQyxXQUFXO1FBQ25DO1FBRUEsT0FBTzlFLGtGQUFZQSxDQUFDMkIsSUFBSSxDQUFDO1lBQ3ZCQyxTQUFTO1lBQ1RDLE9BQU87WUFDUHNELFNBQVN0RCxpQkFBaUI0QixRQUFRNUIsTUFBTVcsT0FBTyxHQUFHO1FBQ3BELEdBQUc7WUFBRVYsUUFBUTtRQUFJO0lBQ25CO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zaXN0ZW1hLWdlc3Rpb24tYWltLy4vYXBwL2FwaS9jYWxjdWxhdG9yL3BlcmlvZC1jbG9zdXJlL2Nsb3NlLXBlcmlvZC9yb3V0ZS50cz82YjFiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XHJcbmltcG9ydCB7IFxyXG4gIGdldENvbG9tYmlhRGF0ZSwgXHJcbiAgZ2V0Q3VycmVudFBlcmlvZFR5cGUsXHJcbiAgaXNGdWxsQ2xvc3VyZVRpbWUsXHJcbiAgaXNDbG9zdXJlRGF5XHJcbn0gZnJvbSAnQC91dGlscy9wZXJpb2QtY2xvc3VyZS1kYXRlcyc7XHJcbmltcG9ydCB7IFxyXG4gIHVwZGF0ZUNsb3N1cmVTdGF0dXMsXHJcbiAgYXJjaGl2ZU1vZGVsVmFsdWVzLFxyXG4gIHJlc2V0TW9kZWxWYWx1ZXNcclxufSBmcm9tICdAL2xpYi9jYWxjdWxhdG9yL3BlcmlvZC1jbG9zdXJlLWhlbHBlcnMnO1xyXG5pbXBvcnQgeyBzZW5kQm90Tm90aWZpY2F0aW9uIH0gZnJvbSAnQC9saWIvY2hhdC9ib3Qtbm90aWZpY2F0aW9ucyc7XHJcblxyXG5jb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcclxuICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgYXMgc3RyaW5nLFxyXG4gIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgYXMgc3RyaW5nLFxyXG4gIHtcclxuICAgIGF1dGg6IHtcclxuICAgICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXHJcbiAgICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZVxyXG4gICAgfVxyXG4gIH1cclxuKTtcclxuXHJcbi8qKlxyXG4gKiBQT1NUOiBDaWVycmEgcGVyw61vZG8gY29tcGxldG8gKDAwOjAwIENvbG9tYmlhKVxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coJ/CflJIgW0NMT1NFLVBFUklPRF0gSW5pY2lhbmRvIGNpZXJyZSBjb21wbGV0byBkZSBwZXLDrW9kby4uLicpO1xyXG5cclxuICAgIGNvbnN0IGN1cnJlbnREYXRlID0gZ2V0Q29sb21iaWFEYXRlKCk7XHJcbiAgICBjb25zdCBwZXJpb2RUeXBlID0gZ2V0Q3VycmVudFBlcmlvZFR5cGUoKTtcclxuXHJcbiAgICAvLyBWZXJpZmljYXIgbW9kbyB0ZXN0aW5nIGRlc2RlIGhlYWRlclxyXG4gICAgY29uc3QgdGVzdGluZ01vZGUgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LXRlc3RpbmctbW9kZScpID09PSAndHJ1ZSc7XHJcbiAgICBcclxuICAgIC8vIFZlcmlmaWNhciBxdWUgZXMgZMOtYSBkZSBjaWVycmUgeSBob3JhIGNvcnJlY3RhIChvIHNpIGVzdMOhIGVuIG1vZG8gdGVzdGluZylcclxuICAgIGlmICghdGVzdGluZ01vZGUgJiYgIWlzQ2xvc3VyZURheSgpKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdObyBlcyBkw61hIGRlIGNpZXJyZSAoZMOtYXMgMSB5IDE2KSdcclxuICAgICAgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXRlc3RpbmdNb2RlICYmICFpc0Z1bGxDbG9zdXJlVGltZSgpKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdObyBlcyBtb21lbnRvIGRlIGNpZXJyZSBjb21wbGV0byAoMDA6MDAgQ29sb21iaWEpJ1xyXG4gICAgICB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAodGVzdGluZ01vZGUpIHtcclxuICAgICAgY29uc29sZS5sb2coJ/Cfp6ogW0NMT1NFLVBFUklPRF0gTU9ETyBURVNUSU5HIEFDVElWQURPJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmVyaWZpY2FyIGVzdGFkbyBhY3R1YWxcclxuICAgIGNvbnN0IHsgZGF0YTogY3VycmVudFN0YXR1cyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2NhbGN1bGF0b3JfcGVyaW9kX2Nsb3N1cmVfc3RhdHVzJylcclxuICAgICAgLnNlbGVjdCgnc3RhdHVzJylcclxuICAgICAgLmVxKCdwZXJpb2RfZGF0ZScsIGN1cnJlbnREYXRlKVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLmxpbWl0KDEpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoY3VycmVudFN0YXR1cz8uc3RhdHVzID09PSAnY29tcGxldGVkJykge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogJ1BlcsOtb2RvIHlhIGZ1ZSBjZXJyYWRvJyxcclxuICAgICAgICBhbHJlYWR5X2Nsb3NlZDogdHJ1ZVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBY3R1YWxpemFyIGVzdGFkbyBhIGNsb3NpbmdfY2FsY3VsYXRvcnNcclxuICAgIGF3YWl0IHVwZGF0ZUNsb3N1cmVTdGF0dXMoY3VycmVudERhdGUsIHBlcmlvZFR5cGUsICdjbG9zaW5nX2NhbGN1bGF0b3JzJyk7XHJcblxyXG4gICAgLy8gT2J0ZW5lciB0b2RvcyBsb3MgbW9kZWxvcyBhY3Rpdm9zXHJcbiAgICBjb25zdCB7IGRhdGE6IG1vZGVscywgZXJyb3I6IG1vZGVsc0Vycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgndXNlcnMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgZW1haWwsIG5hbWUnKVxyXG4gICAgICAuZXEoJ3JvbGUnLCAnbW9kZWxvJylcclxuICAgICAgLmVxKCdpc19hY3RpdmUnLCB0cnVlKTtcclxuXHJcbiAgICBpZiAobW9kZWxzRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIFtDTE9TRS1QRVJJT0RdIEVycm9yIG9idGVuaWVuZG8gbW9kZWxvczonLCBtb2RlbHNFcnJvcik7XHJcbiAgICAgIGF3YWl0IHVwZGF0ZUNsb3N1cmVTdGF0dXMoY3VycmVudERhdGUsIHBlcmlvZFR5cGUsICdmYWlsZWQnLCB7XHJcbiAgICAgICAgZXJyb3I6ICdFcnJvciBvYnRlbmllbmRvIG1vZGVsb3MnXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnRXJyb3Igb2J0ZW5pZW5kbyBtb2RlbG9zJ1xyXG4gICAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGDwn5SEIFtDTE9TRS1QRVJJT0RdIFByb2Nlc2FuZG8gJHttb2RlbHM/Lmxlbmd0aCB8fCAwfSBtb2RlbG9zLi4uYCk7XHJcblxyXG4gICAgLy8gRkFTRSAxOiBBcmNoaXZhciB2YWxvcmVzIGRlIHRvZGFzIGxhcyBjYWxjdWxhZG9yYXNcclxuICAgIGNvbnN0IGFyY2hpdmVSZXN1bHRzID0gW107XHJcbiAgICBsZXQgYXJjaGl2ZVN1Y2Nlc3NDb3VudCA9IDA7XHJcbiAgICBsZXQgYXJjaGl2ZUVycm9yQ291bnQgPSAwO1xyXG5cclxuICAgIGZvciAoY29uc3QgbW9kZWwgb2YgbW9kZWxzIHx8IFtdKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgYXJjaGl2ZVJlc3VsdCA9IGF3YWl0IGFyY2hpdmVNb2RlbFZhbHVlcyhtb2RlbC5pZCwgY3VycmVudERhdGUsIHBlcmlvZFR5cGUpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChhcmNoaXZlUmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICAgIGFyY2hpdmVTdWNjZXNzQ291bnQrKztcclxuICAgICAgICAgIGFyY2hpdmVSZXN1bHRzLnB1c2goe1xyXG4gICAgICAgICAgICBtb2RlbF9pZDogbW9kZWwuaWQsXHJcbiAgICAgICAgICAgIG1vZGVsX2VtYWlsOiBtb2RlbC5lbWFpbCxcclxuICAgICAgICAgICAgc3RhdHVzOiAnYXJjaGl2ZWQnLFxyXG4gICAgICAgICAgICBhcmNoaXZlZF9jb3VudDogYXJjaGl2ZVJlc3VsdC5hcmNoaXZlZFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGFyY2hpdmVFcnJvckNvdW50Kys7XHJcbiAgICAgICAgICBhcmNoaXZlUmVzdWx0cy5wdXNoKHtcclxuICAgICAgICAgICAgbW9kZWxfaWQ6IG1vZGVsLmlkLFxyXG4gICAgICAgICAgICBtb2RlbF9lbWFpbDogbW9kZWwuZW1haWwsXHJcbiAgICAgICAgICAgIHN0YXR1czogJ2Vycm9yJyxcclxuICAgICAgICAgICAgZXJyb3I6IGFyY2hpdmVSZXN1bHQuZXJyb3JcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBhcmNoaXZlRXJyb3JDb3VudCsrO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBbQ0xPU0UtUEVSSU9EXSBFcnJvciBhcmNoaXZhbmRvIG1vZGVsbyAke21vZGVsLmVtYWlsfTpgLCBlcnJvcik7XHJcbiAgICAgICAgYXJjaGl2ZVJlc3VsdHMucHVzaCh7XHJcbiAgICAgICAgICBtb2RlbF9pZDogbW9kZWwuaWQsXHJcbiAgICAgICAgICBtb2RlbF9lbWFpbDogbW9kZWwuZW1haWwsXHJcbiAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsXHJcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRXJyb3IgZGVzY29ub2NpZG8nXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZyhg4pyFIFtDTE9TRS1QRVJJT0RdIEFyY2hpdm8gY29tcGxldGFkbzogJHthcmNoaXZlU3VjY2Vzc0NvdW50fSBleGl0b3NvcywgJHthcmNoaXZlRXJyb3JDb3VudH0gZXJyb3Jlc2ApO1xyXG5cclxuICAgIC8vIEZBU0UgMjogRXNwZXJhciAyLjUgbWludXRvcyAoMTUwIHNlZ3VuZG9zKSBwYXJhIHF1ZSBSZXN1bWVuIGRlIEZhY3R1cmFjacOzbiByZWNpYmEgw7psdGltYSBhY3R1YWxpemFjacOzblxyXG4gICAgY29uc29sZS5sb2coJ+KPsyBbQ0xPU0UtUEVSSU9EXSBFc3BlcmFuZG8gcGFyYSDDumx0aW1hIGFjdHVhbGl6YWNpw7NuIGRlbCByZXN1bWVuLi4uJyk7XHJcbiAgICBhd2FpdCB1cGRhdGVDbG9zdXJlU3RhdHVzKGN1cnJlbnREYXRlLCBwZXJpb2RUeXBlLCAnd2FpdGluZ19zdW1tYXJ5Jyk7XHJcbiAgICBcclxuICAgIC8vIFRFTVBPUkFMIFBBUkEgVEVTVElORzogNSBzZWd1bmRvcyBlbiBsdWdhciBkZSAxNTAgc2VndW5kb3NcclxuICAgIGNvbnN0IHdhaXRUaW1lID0gdGVzdGluZ01vZGUgPyA1MDAwIDogMTUwMDAwO1xyXG4gICAgaWYgKHRlc3RpbmdNb2RlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfwn6eqIFtDTE9TRS1QRVJJT0RdIE1vZG8gdGVzdGluZzogZXNwZXJhIHJlZHVjaWRhIGEgNSBzZWd1bmRvcycpO1xyXG4gICAgfVxyXG4gICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIHdhaXRUaW1lKSk7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ+KchSBbQ0xPU0UtUEVSSU9EXSBUaWVtcG8gZGUgZXNwZXJhIGNvbXBsZXRhZG8nKTtcclxuXHJcbiAgICAvLyBGQVNFIDM6IEVsIHJlc3VtZW4gZGUgZmFjdHVyYWNpw7NuIHNlIGFjdHVhbGl6YSBhdXRvbcOhdGljYW1lbnRlIGxleWVuZG8gZGUgY2FsY3VsYXRvcl9oaXN0b3J5XHJcbiAgICAvLyBObyBuZWNlc2l0YW1vcyBlbmRwb2ludCBlc3BlY2lhbCAtIHNvbG8gZXNwZXJhbW9zIHkgbHVlZ28gY29udGludWFtb3NcclxuICAgIFxyXG4gICAgYXdhaXQgdXBkYXRlQ2xvc3VyZVN0YXR1cyhjdXJyZW50RGF0ZSwgcGVyaW9kVHlwZSwgJ2Nsb3Npbmdfc3VtbWFyeScpO1xyXG5cclxuICAgIC8vIEZBU0UgNDogUmVzZXRlYXIgdG9kYXMgbGFzIGNhbGN1bGFkb3Jhc1xyXG4gICAgYXdhaXQgdXBkYXRlQ2xvc3VyZVN0YXR1cyhjdXJyZW50RGF0ZSwgcGVyaW9kVHlwZSwgJ2FyY2hpdmluZycpO1xyXG5cclxuICAgIGNvbnN0IHJlc2V0UmVzdWx0cyA9IFtdO1xyXG4gICAgbGV0IHJlc2V0U3VjY2Vzc0NvdW50ID0gMDtcclxuICAgIGxldCByZXNldEVycm9yQ291bnQgPSAwO1xyXG5cclxuICAgIGZvciAoY29uc3QgbW9kZWwgb2YgbW9kZWxzIHx8IFtdKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcmVzZXRSZXN1bHQgPSBhd2FpdCByZXNldE1vZGVsVmFsdWVzKG1vZGVsLmlkLCBjdXJyZW50RGF0ZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHJlc2V0UmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICAgIHJlc2V0U3VjY2Vzc0NvdW50Kys7XHJcbiAgICAgICAgICByZXNldFJlc3VsdHMucHVzaCh7XHJcbiAgICAgICAgICAgIG1vZGVsX2lkOiBtb2RlbC5pZCxcclxuICAgICAgICAgICAgbW9kZWxfZW1haWw6IG1vZGVsLmVtYWlsLFxyXG4gICAgICAgICAgICBzdGF0dXM6ICdyZXNldCcsXHJcbiAgICAgICAgICAgIGRlbGV0ZWRfY291bnQ6IHJlc2V0UmVzdWx0LmRlbGV0ZWRcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXNldEVycm9yQ291bnQrKztcclxuICAgICAgICAgIHJlc2V0UmVzdWx0cy5wdXNoKHtcclxuICAgICAgICAgICAgbW9kZWxfaWQ6IG1vZGVsLmlkLFxyXG4gICAgICAgICAgICBtb2RlbF9lbWFpbDogbW9kZWwuZW1haWwsXHJcbiAgICAgICAgICAgIHN0YXR1czogJ2Vycm9yJyxcclxuICAgICAgICAgICAgZXJyb3I6IHJlc2V0UmVzdWx0LmVycm9yXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmVzZXRFcnJvckNvdW50Kys7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIFtDTE9TRS1QRVJJT0RdIEVycm9yIHJlc2V0ZWFuZG8gbW9kZWxvICR7bW9kZWwuZW1haWx9OmAsIGVycm9yKTtcclxuICAgICAgICByZXNldFJlc3VsdHMucHVzaCh7XHJcbiAgICAgICAgICBtb2RlbF9pZDogbW9kZWwuaWQsXHJcbiAgICAgICAgICBtb2RlbF9lbWFpbDogbW9kZWwuZW1haWwsXHJcbiAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsXHJcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRXJyb3IgZGVzY29ub2NpZG8nXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBGQVNFIDU6IE5vdGlmaWNhciBhIG1vZGVsb3NcclxuICAgIGZvciAoY29uc3QgbW9kZWwgb2YgbW9kZWxzIHx8IFtdKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgc2VuZEJvdE5vdGlmaWNhdGlvbihcclxuICAgICAgICAgIG1vZGVsLmlkLFxyXG4gICAgICAgICAgJ3BlcmlvZG9fY2VycmFkbycsXHJcbiAgICAgICAgICAnRWwgcGVyw61vZG8gaGEgY2VycmFkby4gVHVzIHZhbG9yZXMgaGFuIHNpZG8gYXJjaGl2YWRvcyB5IHB1ZWRlcyByZXZpc2FybG9zIGVuIFwiTWkgSGlzdG9yaWFsXCIuIExhIGNhbGN1bGFkb3JhIHNlIGhhIHJlaW5pY2lhZG8gcGFyYSBlbCBudWV2byBwZXLDrW9kby4gUHVlZGVzIGNvbWVuemFyIGEgaW5ncmVzYXIgdmFsb3JlcyBudWV2YW1lbnRlLidcclxuICAgICAgICApO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBbQ0xPU0UtUEVSSU9EXSBFcnJvciBub3RpZmljYW5kbyBtb2RlbG8gJHttb2RlbC5lbWFpbH06YCwgZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRkFTRSA2OiBOb3RpZmljYXIgYSBhZG1pbnMvc3VwZXJfYWRtaW5zXHJcbiAgICBjb25zdCB7IGRhdGE6IGFkbWlucyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3VzZXJzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIGVtYWlsLCBuYW1lJylcclxuICAgICAgLmluKCdyb2xlJywgWydhZG1pbicsICdzdXBlcl9hZG1pbiddKVxyXG4gICAgICAuZXEoJ2lzX2FjdGl2ZScsIHRydWUpO1xyXG5cclxuICAgIGZvciAoY29uc3QgYWRtaW4gb2YgYWRtaW5zIHx8IFtdKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgc2VuZEJvdE5vdGlmaWNhdGlvbihcclxuICAgICAgICAgIGFkbWluLmlkLFxyXG4gICAgICAgICAgJ3BlcmlvZG9fY2VycmFkbycsXHJcbiAgICAgICAgICBgUGVyw61vZG8gJHtwZXJpb2RUeXBlfSBjZXJyYWRvIGV4aXRvc2FtZW50ZS4gRWwgcmVzdW1lbiBlc3TDoSBkaXNwb25pYmxlIGVuIFwiQ29uc3VsdGEgSGlzdMOzcmljYVwiIGRlbCBEYXNoYm9hcmQgZGUgU2VkZXMuIE51ZXZvIHBlcsOtb2RvIGluaWNpYWRvLmBcclxuICAgICAgICApO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBbQ0xPU0UtUEVSSU9EXSBFcnJvciBub3RpZmljYW5kbyBhZG1pbiAke2FkbWluLmVtYWlsfTpgLCBlcnJvcik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBGQVNFIDc6IE1hcmNhciBjb21vIGNvbXBsZXRhZG9cclxuICAgIGF3YWl0IHVwZGF0ZUNsb3N1cmVTdGF0dXMoY3VycmVudERhdGUsIHBlcmlvZFR5cGUsICdjb21wbGV0ZWQnLCB7XHJcbiAgICAgIGFyY2hpdmVfcmVzdWx0czoge1xyXG4gICAgICAgIHRvdGFsOiBtb2RlbHM/Lmxlbmd0aCB8fCAwLFxyXG4gICAgICAgIHN1Y2Nlc3NmdWw6IGFyY2hpdmVTdWNjZXNzQ291bnQsXHJcbiAgICAgICAgZmFpbGVkOiBhcmNoaXZlRXJyb3JDb3VudFxyXG4gICAgICB9LFxyXG4gICAgICByZXNldF9yZXN1bHRzOiB7XHJcbiAgICAgICAgdG90YWw6IG1vZGVscz8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgICAgc3VjY2Vzc2Z1bDogcmVzZXRTdWNjZXNzQ291bnQsXHJcbiAgICAgICAgZmFpbGVkOiByZXNldEVycm9yQ291bnRcclxuICAgICAgfSxcclxuICAgICAgY29tcGxldGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCfinIUgW0NMT1NFLVBFUklPRF0gQ2llcnJlIGNvbXBsZXRvIGV4aXRvc28nKTtcclxuXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBtZXNzYWdlOiAnQ2llcnJlIGRlIHBlcsOtb2RvIGNvbXBsZXRhZG8gZXhpdG9zYW1lbnRlJyxcclxuICAgICAgcGVyaW9kX2RhdGU6IGN1cnJlbnREYXRlLFxyXG4gICAgICBwZXJpb2RfdHlwZTogcGVyaW9kVHlwZSxcclxuICAgICAgYXJjaGl2ZV9zdW1tYXJ5OiB7XHJcbiAgICAgICAgdG90YWw6IG1vZGVscz8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgICAgc3VjY2Vzc2Z1bDogYXJjaGl2ZVN1Y2Nlc3NDb3VudCxcclxuICAgICAgICBmYWlsZWQ6IGFyY2hpdmVFcnJvckNvdW50XHJcbiAgICAgIH0sXHJcbiAgICAgIHJlc2V0X3N1bW1hcnk6IHtcclxuICAgICAgICB0b3RhbDogbW9kZWxzPy5sZW5ndGggfHwgMCxcclxuICAgICAgICBzdWNjZXNzZnVsOiByZXNldFN1Y2Nlc3NDb3VudCxcclxuICAgICAgICBmYWlsZWQ6IHJlc2V0RXJyb3JDb3VudFxyXG4gICAgICB9LFxyXG4gICAgICBkZXRhaWxzOiB7XHJcbiAgICAgICAgYXJjaGl2ZWQ6IGFyY2hpdmVSZXN1bHRzLFxyXG4gICAgICAgIHJlc2V0OiByZXNldFJlc3VsdHNcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfinYwgW0NMT1NFLVBFUklPRF0gRXJyb3I6JywgZXJyb3IpO1xyXG4gICAgY29uc3QgY3VycmVudERhdGUgPSBnZXRDb2xvbWJpYURhdGUoKTtcclxuICAgIGNvbnN0IHBlcmlvZFR5cGUgPSBnZXRDdXJyZW50UGVyaW9kVHlwZSgpO1xyXG4gICAgXHJcbiAgICBhd2FpdCB1cGRhdGVDbG9zdXJlU3RhdHVzKGN1cnJlbnREYXRlLCBwZXJpb2RUeXBlLCAnZmFpbGVkJywge1xyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRXJyb3IgZGVzY29ub2NpZG8nLFxyXG4gICAgICBmYWlsZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3InLFxyXG4gICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdFcnJvciBkZXNjb25vY2lkbydcclxuICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiY3JlYXRlQ2xpZW50IiwiZ2V0Q29sb21iaWFEYXRlIiwiZ2V0Q3VycmVudFBlcmlvZFR5cGUiLCJpc0Z1bGxDbG9zdXJlVGltZSIsImlzQ2xvc3VyZURheSIsInVwZGF0ZUNsb3N1cmVTdGF0dXMiLCJhcmNoaXZlTW9kZWxWYWx1ZXMiLCJyZXNldE1vZGVsVmFsdWVzIiwic2VuZEJvdE5vdGlmaWNhdGlvbiIsInN1cGFiYXNlIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJhdXRoIiwiYXV0b1JlZnJlc2hUb2tlbiIsInBlcnNpc3RTZXNzaW9uIiwiUE9TVCIsInJlcXVlc3QiLCJjb25zb2xlIiwibG9nIiwiY3VycmVudERhdGUiLCJwZXJpb2RUeXBlIiwidGVzdGluZ01vZGUiLCJoZWFkZXJzIiwiZ2V0IiwianNvbiIsInN1Y2Nlc3MiLCJlcnJvciIsInN0YXR1cyIsImRhdGEiLCJjdXJyZW50U3RhdHVzIiwiZnJvbSIsInNlbGVjdCIsImVxIiwib3JkZXIiLCJhc2NlbmRpbmciLCJsaW1pdCIsInNpbmdsZSIsIm1lc3NhZ2UiLCJhbHJlYWR5X2Nsb3NlZCIsIm1vZGVscyIsIm1vZGVsc0Vycm9yIiwibGVuZ3RoIiwiYXJjaGl2ZVJlc3VsdHMiLCJhcmNoaXZlU3VjY2Vzc0NvdW50IiwiYXJjaGl2ZUVycm9yQ291bnQiLCJtb2RlbCIsImFyY2hpdmVSZXN1bHQiLCJpZCIsInB1c2giLCJtb2RlbF9pZCIsIm1vZGVsX2VtYWlsIiwiZW1haWwiLCJhcmNoaXZlZF9jb3VudCIsImFyY2hpdmVkIiwiRXJyb3IiLCJ3YWl0VGltZSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsInJlc2V0UmVzdWx0cyIsInJlc2V0U3VjY2Vzc0NvdW50IiwicmVzZXRFcnJvckNvdW50IiwicmVzZXRSZXN1bHQiLCJkZWxldGVkX2NvdW50IiwiZGVsZXRlZCIsImFkbWlucyIsImluIiwiYWRtaW4iLCJhcmNoaXZlX3Jlc3VsdHMiLCJ0b3RhbCIsInN1Y2Nlc3NmdWwiLCJmYWlsZWQiLCJyZXNldF9yZXN1bHRzIiwiY29tcGxldGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwicGVyaW9kX2RhdGUiLCJwZXJpb2RfdHlwZSIsImFyY2hpdmVfc3VtbWFyeSIsInJlc2V0X3N1bW1hcnkiLCJkZXRhaWxzIiwicmVzZXQiLCJmYWlsZWRfYXQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/calculator/period-closure/close-period/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/calculator/period-closure-helpers.ts":
/*!**************************************************!*\
  !*** ./lib/calculator/period-closure-helpers.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   archiveModelValues: () => (/* binding */ archiveModelValues),\n/* harmony export */   freezePlatformsForModel: () => (/* binding */ freezePlatformsForModel),\n/* harmony export */   getFrozenPlatformsForModel: () => (/* binding */ getFrozenPlatformsForModel),\n/* harmony export */   isPlatformFrozen: () => (/* binding */ isPlatformFrozen),\n/* harmony export */   resetModelValues: () => (/* binding */ resetModelValues),\n/* harmony export */   updateClosureStatus: () => (/* binding */ updateClosureStatus)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/**\r\n * 🔧 HELPERS PARA CIERRE DE PERÍODOS\r\n * \r\n * Funciones auxiliares para el proceso de cierre\r\n */ \nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://mhernfrkvwigxdubiozm.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\n/**\r\n * Crea o actualiza el estado de cierre de período\r\n */ const updateClosureStatus = async (periodDate, periodType, status, metadata)=>{\n    try {\n        // Verificar si existe registro\n        const { data: existing } = await supabase.from(\"calculator_period_closure_status\").select(\"id\").eq(\"period_date\", periodDate).single();\n        if (existing) {\n            // Actualizar\n            const { error } = await supabase.from(\"calculator_period_closure_status\").update({\n                status,\n                metadata: metadata || {},\n                updated_at: new Date().toISOString()\n            }).eq(\"id\", existing.id);\n            if (error) throw error;\n        } else {\n            // Crear nuevo\n            const { error } = await supabase.from(\"calculator_period_closure_status\").insert({\n                period_date: periodDate,\n                period_type: periodType,\n                status,\n                metadata: metadata || {}\n            });\n            if (error) throw error;\n        }\n        return {\n            success: true\n        };\n    } catch (error) {\n        console.error(\"❌ [CLOSURE-HELPERS] Error actualizando estado:\", error);\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : \"Error desconocido\"\n        };\n    }\n};\n/**\r\n * Marca plataformas como congeladas anticipadamente\r\n */ const freezePlatformsForModel = async (periodDate, modelId, platformIds)=>{\n    try {\n        const records = platformIds.map((platformId)=>({\n                period_date: periodDate,\n                model_id: modelId,\n                platform_id: platformId,\n                frozen_at: new Date().toISOString()\n            }));\n        // Usar upsert para evitar duplicados\n        const { error } = await supabase.from(\"calculator_early_frozen_platforms\").upsert(records, {\n            onConflict: \"period_date,model_id,platform_id\",\n            ignoreDuplicates: false\n        });\n        if (error) throw error;\n        return {\n            success: true\n        };\n    } catch (error) {\n        console.error(\"❌ [CLOSURE-HELPERS] Error congelando plataformas:\", error);\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : \"Error desconocido\"\n        };\n    }\n};\n/**\r\n * Verifica si una plataforma está congelada para un modelo\r\n */ const isPlatformFrozen = async (periodDate, modelId, platformId)=>{\n    try {\n        const { data, error } = await supabase.from(\"calculator_early_frozen_platforms\").select(\"id\").eq(\"period_date\", periodDate).eq(\"model_id\", modelId).eq(\"platform_id\", platformId).single();\n        if (error && error.code !== \"PGRST116\") throw error;\n        return !!data;\n    } catch (error) {\n        console.error(\"❌ [CLOSURE-HELPERS] Error verificando congelaci\\xf3n:\", error);\n        return false;\n    }\n};\n/**\r\n * Obtiene todas las plataformas congeladas para un modelo\r\n */ const getFrozenPlatformsForModel = async (periodDate, modelId)=>{\n    try {\n        const { data, error } = await supabase.from(\"calculator_early_frozen_platforms\").select(\"platform_id\").eq(\"period_date\", periodDate).eq(\"model_id\", modelId);\n        if (error) throw error;\n        return data?.map((r)=>r.platform_id) || [];\n    } catch (error) {\n        console.error(\"❌ [CLOSURE-HELPERS] Error obteniendo plataformas congeladas:\", error);\n        return [];\n    }\n};\n/**\r\n * Archiva valores de un modelo para el período\r\n */ const archiveModelValues = async (modelId, periodDate, periodType)=>{\n    try {\n        // Obtener valores actuales\n        const { data: values, error: valuesError } = await supabase.from(\"model_values\").select(\"*\").eq(\"model_id\", modelId).eq(\"period_date\", periodDate);\n        if (valuesError) throw valuesError;\n        if (!values || values.length === 0) {\n            return {\n                success: true,\n                archived: 0\n            };\n        }\n        // Preparar datos históricos\n        const historicalData = values.map((value)=>({\n                model_id: value.model_id,\n                platform_id: value.platform_id,\n                value: value.value,\n                period_date: value.period_date,\n                period_type: periodType,\n                archived_at: new Date().toISOString(),\n                original_updated_at: value.updated_at\n            }));\n        // Insertar en historial\n        const { error: archiveError } = await supabase.from(\"calculator_history\").insert(historicalData);\n        if (archiveError) throw archiveError;\n        return {\n            success: true,\n            archived: values.length\n        };\n    } catch (error) {\n        console.error(\"❌ [CLOSURE-HELPERS] Error archivando valores:\", error);\n        return {\n            success: false,\n            archived: 0,\n            error: error instanceof Error ? error.message : \"Error desconocido\"\n        };\n    }\n};\n/**\r\n * Resetea valores de un modelo (elimina del período actual)\r\n */ const resetModelValues = async (modelId, periodDate)=>{\n    try {\n        const { data, error } = await supabase.from(\"model_values\").delete().eq(\"model_id\", modelId).eq(\"period_date\", periodDate).select();\n        if (error) throw error;\n        return {\n            success: true,\n            deleted: data?.length || 0\n        };\n    } catch (error) {\n        console.error(\"❌ [CLOSURE-HELPERS] Error reseteando valores:\", error);\n        return {\n            success: false,\n            deleted: 0,\n            error: error instanceof Error ? error.message : \"Error desconocido\"\n        };\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvY2FsY3VsYXRvci9wZXJpb2QtY2xvc3VyZS1oZWxwZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTs7OztDQUlDLEdBRW9EO0FBSXJELE1BQU1DLFdBQVdELG1FQUFZQSxDQUMzQkUsMENBQW9DLEVBQ3BDQSxRQUFRQyxHQUFHLENBQUNFLHlCQUF5QixFQUNyQztJQUNFQyxNQUFNO1FBQ0pDLGtCQUFrQjtRQUNsQkMsZ0JBQWdCO0lBQ2xCO0FBQ0Y7QUFHRjs7Q0FFQyxHQUNNLE1BQU1DLHNCQUFzQixPQUNqQ0MsWUFDQUMsWUFDQUMsUUFDQUM7SUFFQSxJQUFJO1FBQ0YsK0JBQStCO1FBQy9CLE1BQU0sRUFBRUMsTUFBTUMsUUFBUSxFQUFFLEdBQUcsTUFBTWQsU0FDOUJlLElBQUksQ0FBQyxvQ0FDTEMsTUFBTSxDQUFDLE1BQ1BDLEVBQUUsQ0FBQyxlQUFlUixZQUNsQlMsTUFBTTtRQUVULElBQUlKLFVBQVU7WUFDWixhQUFhO1lBQ2IsTUFBTSxFQUFFSyxLQUFLLEVBQUUsR0FBRyxNQUFNbkIsU0FDckJlLElBQUksQ0FBQyxvQ0FDTEssTUFBTSxDQUFDO2dCQUNOVDtnQkFDQUMsVUFBVUEsWUFBWSxDQUFDO2dCQUN2QlMsWUFBWSxJQUFJQyxPQUFPQyxXQUFXO1lBQ3BDLEdBQ0NOLEVBQUUsQ0FBQyxNQUFNSCxTQUFTVSxFQUFFO1lBRXZCLElBQUlMLE9BQU8sTUFBTUE7UUFDbkIsT0FBTztZQUNMLGNBQWM7WUFDZCxNQUFNLEVBQUVBLEtBQUssRUFBRSxHQUFHLE1BQU1uQixTQUNyQmUsSUFBSSxDQUFDLG9DQUNMVSxNQUFNLENBQUM7Z0JBQ05DLGFBQWFqQjtnQkFDYmtCLGFBQWFqQjtnQkFDYkM7Z0JBQ0FDLFVBQVVBLFlBQVksQ0FBQztZQUN6QjtZQUVGLElBQUlPLE9BQU8sTUFBTUE7UUFDbkI7UUFFQSxPQUFPO1lBQUVTLFNBQVM7UUFBSztJQUN6QixFQUFFLE9BQU9ULE9BQU87UUFDZFUsUUFBUVYsS0FBSyxDQUFD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NUIsV0FBVztnQkFDOUJDLGFBQWFqQjtnQkFDYjZDLGFBQWEsSUFBSWpDLE9BQU9DLFdBQVc7Z0JBQ25DaUMscUJBQXFCRixNQUFNakMsVUFBVTtZQUN2QztRQUVBLHdCQUF3QjtRQUN4QixNQUFNLEVBQUVGLE9BQU9zQyxZQUFZLEVBQUUsR0FBRyxNQUFNekQsU0FDbkNlLElBQUksQ0FBQyxzQkFDTFUsTUFBTSxDQUFDNEI7UUFFVixJQUFJSSxjQUFjLE1BQU1BO1FBRXhCLE9BQU87WUFBRTdCLFNBQVM7WUFBTXdCLFVBQVVILE9BQU9FLE1BQU07UUFBQztJQUNsRCxFQUFFLE9BQU9oQyxPQUFPO1FBQ2RVLFFBQVFWLEtBQUssQ0FBQyxpREFBaURBO1FBQy9ELE9BQU87WUFDTFMsU0FBUztZQUNUd0IsVUFBVTtZQUNWakMsT0FBT0EsaUJBQWlCVyxRQUFRWCxNQUFNWSxPQUFPLEdBQUc7UUFDbEQ7SUFDRjtBQUNGLEVBQUU7QUFFRjs7Q0FFQyxHQUNNLE1BQU0yQixtQkFBbUIsT0FDOUJ6QixTQUNBeEI7SUFFQSxJQUFJO1FBQ0YsTUFBTSxFQUFFSSxJQUFJLEVBQUVNLEtBQUssRUFBRSxHQUFHLE1BQU1uQixTQUMzQmUsSUFBSSxDQUFDLGdCQUNMNEMsTUFBTSxHQUNOMUMsRUFBRSxDQUFDLFlBQVlnQixTQUNmaEIsRUFBRSxDQUFDLGVBQWVSLFlBQ2xCTyxNQUFNO1FBRVQsSUFBSUcsT0FBTyxNQUFNQTtRQUVqQixPQUFPO1lBQUVTLFNBQVM7WUFBTWdDLFNBQVMvQyxNQUFNc0MsVUFBVTtRQUFFO0lBQ3JELEVBQUUsT0FBT2hDLE9BQU87UUFDZFUsUUFBUVYsS0FBSyxDQUFDLGlEQUFpREE7UUFDL0QsT0FBTztZQUNMUyxTQUFTO1lBQ1RnQyxTQUFTO1lBQ1R6QyxPQUFPQSxpQkFBaUJXLFFBQVFYLE1BQU1ZLE9BQU8sR0FBRztRQUNsRDtJQUNGO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL3Npc3RlbWEtZ2VzdGlvbi1haW0vLi9saWIvY2FsY3VsYXRvci9wZXJpb2QtY2xvc3VyZS1oZWxwZXJzLnRzPzU5ZmUiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIPCflKcgSEVMUEVSUyBQQVJBIENJRVJSRSBERSBQRVLDjU9ET1NcclxuICogXHJcbiAqIEZ1bmNpb25lcyBhdXhpbGlhcmVzIHBhcmEgZWwgcHJvY2VzbyBkZSBjaWVycmVcclxuICovXHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5pbXBvcnQgeyBDbG9zdXJlU3RhdHVzIH0gZnJvbSAnLi9wZXJpb2QtY2xvc3VyZS1zdGF0ZXMnO1xyXG5pbXBvcnQgeyBFQVJMWV9GUkVFWkVfUExBVEZPUk1TIH0gZnJvbSAnQC91dGlscy9wZXJpb2QtY2xvc3VyZS1kYXRlcyc7XHJcblxyXG5jb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcclxuICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgYXMgc3RyaW5nLFxyXG4gIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgYXMgc3RyaW5nLFxyXG4gIHtcclxuICAgIGF1dGg6IHtcclxuICAgICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXHJcbiAgICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZVxyXG4gICAgfVxyXG4gIH1cclxuKTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhIG8gYWN0dWFsaXphIGVsIGVzdGFkbyBkZSBjaWVycmUgZGUgcGVyw61vZG9cclxuICovXHJcbmV4cG9ydCBjb25zdCB1cGRhdGVDbG9zdXJlU3RhdHVzID0gYXN5bmMgKFxyXG4gIHBlcmlvZERhdGU6IHN0cmluZyxcclxuICBwZXJpb2RUeXBlOiAnMS0xNScgfCAnMTYtMzEnLFxyXG4gIHN0YXR1czogQ2xvc3VyZVN0YXR1cyxcclxuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cclxuKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IGVycm9yPzogc3RyaW5nIH0+ID0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gVmVyaWZpY2FyIHNpIGV4aXN0ZSByZWdpc3Ryb1xyXG4gICAgY29uc3QgeyBkYXRhOiBleGlzdGluZyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2NhbGN1bGF0b3JfcGVyaW9kX2Nsb3N1cmVfc3RhdHVzJylcclxuICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAuZXEoJ3BlcmlvZF9kYXRlJywgcGVyaW9kRGF0ZSlcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChleGlzdGluZykge1xyXG4gICAgICAvLyBBY3R1YWxpemFyXHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2NhbGN1bGF0b3JfcGVyaW9kX2Nsb3N1cmVfc3RhdHVzJylcclxuICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgIHN0YXR1cyxcclxuICAgICAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YSB8fCB7fSxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmVxKCdpZCcsIGV4aXN0aW5nLmlkKTtcclxuXHJcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBDcmVhciBudWV2b1xyXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdjYWxjdWxhdG9yX3BlcmlvZF9jbG9zdXJlX3N0YXR1cycpXHJcbiAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICBwZXJpb2RfZGF0ZTogcGVyaW9kRGF0ZSxcclxuICAgICAgICAgIHBlcmlvZF90eXBlOiBwZXJpb2RUeXBlLFxyXG4gICAgICAgICAgc3RhdHVzLFxyXG4gICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhIHx8IHt9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcign4p2MIFtDTE9TVVJFLUhFTFBFUlNdIEVycm9yIGFjdHVhbGl6YW5kbyBlc3RhZG86JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdFcnJvciBkZXNjb25vY2lkbydcclxuICAgIH07XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIE1hcmNhIHBsYXRhZm9ybWFzIGNvbW8gY29uZ2VsYWRhcyBhbnRpY2lwYWRhbWVudGVcclxuICovXHJcbmV4cG9ydCBjb25zdCBmcmVlemVQbGF0Zm9ybXNGb3JNb2RlbCA9IGFzeW5jIChcclxuICBwZXJpb2REYXRlOiBzdHJpbmcsXHJcbiAgbW9kZWxJZDogc3RyaW5nLFxyXG4gIHBsYXRmb3JtSWRzOiBzdHJpbmdbXVxyXG4pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfT4gPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZWNvcmRzID0gcGxhdGZvcm1JZHMubWFwKHBsYXRmb3JtSWQgPT4gKHtcclxuICAgICAgcGVyaW9kX2RhdGU6IHBlcmlvZERhdGUsXHJcbiAgICAgIG1vZGVsX2lkOiBtb2RlbElkLFxyXG4gICAgICBwbGF0Zm9ybV9pZDogcGxhdGZvcm1JZCxcclxuICAgICAgZnJvemVuX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pKTtcclxuXHJcbiAgICAvLyBVc2FyIHVwc2VydCBwYXJhIGV2aXRhciBkdXBsaWNhZG9zXHJcbiAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnY2FsY3VsYXRvcl9lYXJseV9mcm96ZW5fcGxhdGZvcm1zJylcclxuICAgICAgLnVwc2VydChyZWNvcmRzLCB7XHJcbiAgICAgICAgb25Db25mbGljdDogJ3BlcmlvZF9kYXRlLG1vZGVsX2lkLHBsYXRmb3JtX2lkJyxcclxuICAgICAgICBpZ25vcmVEdXBsaWNhdGVzOiBmYWxzZVxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcign4p2MIFtDTE9TVVJFLUhFTFBFUlNdIEVycm9yIGNvbmdlbGFuZG8gcGxhdGFmb3JtYXM6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdFcnJvciBkZXNjb25vY2lkbydcclxuICAgIH07XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFZlcmlmaWNhIHNpIHVuYSBwbGF0YWZvcm1hIGVzdMOhIGNvbmdlbGFkYSBwYXJhIHVuIG1vZGVsb1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGlzUGxhdGZvcm1Gcm96ZW4gPSBhc3luYyAoXHJcbiAgcGVyaW9kRGF0ZTogc3RyaW5nLFxyXG4gIG1vZGVsSWQ6IHN0cmluZyxcclxuICBwbGF0Zm9ybUlkOiBzdHJpbmdcclxuKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdjYWxjdWxhdG9yX2Vhcmx5X2Zyb3plbl9wbGF0Zm9ybXMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgIC5lcSgncGVyaW9kX2RhdGUnLCBwZXJpb2REYXRlKVxyXG4gICAgICAuZXEoJ21vZGVsX2lkJywgbW9kZWxJZClcclxuICAgICAgLmVxKCdwbGF0Zm9ybV9pZCcsIHBsYXRmb3JtSWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IgJiYgZXJyb3IuY29kZSAhPT0gJ1BHUlNUMTE2JykgdGhyb3cgZXJyb3I7XHJcbiAgICBcclxuICAgIHJldHVybiAhIWRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbQ0xPU1VSRS1IRUxQRVJTXSBFcnJvciB2ZXJpZmljYW5kbyBjb25nZWxhY2nDs246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBPYnRpZW5lIHRvZGFzIGxhcyBwbGF0YWZvcm1hcyBjb25nZWxhZGFzIHBhcmEgdW4gbW9kZWxvXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZ2V0RnJvemVuUGxhdGZvcm1zRm9yTW9kZWwgPSBhc3luYyAoXHJcbiAgcGVyaW9kRGF0ZTogc3RyaW5nLFxyXG4gIG1vZGVsSWQ6IHN0cmluZ1xyXG4pOiBQcm9taXNlPHN0cmluZ1tdPiA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdjYWxjdWxhdG9yX2Vhcmx5X2Zyb3plbl9wbGF0Zm9ybXMnKVxyXG4gICAgICAuc2VsZWN0KCdwbGF0Zm9ybV9pZCcpXHJcbiAgICAgIC5lcSgncGVyaW9kX2RhdGUnLCBwZXJpb2REYXRlKVxyXG4gICAgICAuZXEoJ21vZGVsX2lkJywgbW9kZWxJZCk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuXHJcbiAgICByZXR1cm4gZGF0YT8ubWFwKHIgPT4gci5wbGF0Zm9ybV9pZCkgfHwgW107XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbQ0xPU1VSRS1IRUxQRVJTXSBFcnJvciBvYnRlbmllbmRvIHBsYXRhZm9ybWFzIGNvbmdlbGFkYXM6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBBcmNoaXZhIHZhbG9yZXMgZGUgdW4gbW9kZWxvIHBhcmEgZWwgcGVyw61vZG9cclxuICovXHJcbmV4cG9ydCBjb25zdCBhcmNoaXZlTW9kZWxWYWx1ZXMgPSBhc3luYyAoXHJcbiAgbW9kZWxJZDogc3RyaW5nLFxyXG4gIHBlcmlvZERhdGU6IHN0cmluZyxcclxuICBwZXJpb2RUeXBlOiAnMS0xNScgfCAnMTYtMzEnXHJcbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBhcmNoaXZlZDogbnVtYmVyOyBlcnJvcj86IHN0cmluZyB9PiA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIE9idGVuZXIgdmFsb3JlcyBhY3R1YWxlc1xyXG4gICAgY29uc3QgeyBkYXRhOiB2YWx1ZXMsIGVycm9yOiB2YWx1ZXNFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ21vZGVsX3ZhbHVlcycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAuZXEoJ21vZGVsX2lkJywgbW9kZWxJZClcclxuICAgICAgLmVxKCdwZXJpb2RfZGF0ZScsIHBlcmlvZERhdGUpO1xyXG5cclxuICAgIGlmICh2YWx1ZXNFcnJvcikgdGhyb3cgdmFsdWVzRXJyb3I7XHJcblxyXG4gICAgaWYgKCF2YWx1ZXMgfHwgdmFsdWVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhcmNoaXZlZDogMCB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFByZXBhcmFyIGRhdG9zIGhpc3TDs3JpY29zXHJcbiAgICBjb25zdCBoaXN0b3JpY2FsRGF0YSA9IHZhbHVlcy5tYXAodmFsdWUgPT4gKHtcclxuICAgICAgbW9kZWxfaWQ6IHZhbHVlLm1vZGVsX2lkLFxyXG4gICAgICBwbGF0Zm9ybV9pZDogdmFsdWUucGxhdGZvcm1faWQsXHJcbiAgICAgIHZhbHVlOiB2YWx1ZS52YWx1ZSxcclxuICAgICAgcGVyaW9kX2RhdGU6IHZhbHVlLnBlcmlvZF9kYXRlLFxyXG4gICAgICBwZXJpb2RfdHlwZTogcGVyaW9kVHlwZSxcclxuICAgICAgYXJjaGl2ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgb3JpZ2luYWxfdXBkYXRlZF9hdDogdmFsdWUudXBkYXRlZF9hdFxyXG4gICAgfSkpO1xyXG5cclxuICAgIC8vIEluc2VydGFyIGVuIGhpc3RvcmlhbFxyXG4gICAgY29uc3QgeyBlcnJvcjogYXJjaGl2ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnY2FsY3VsYXRvcl9oaXN0b3J5JylcclxuICAgICAgLmluc2VydChoaXN0b3JpY2FsRGF0YSk7XHJcblxyXG4gICAgaWYgKGFyY2hpdmVFcnJvcikgdGhyb3cgYXJjaGl2ZUVycm9yO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGFyY2hpdmVkOiB2YWx1ZXMubGVuZ3RoIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbQ0xPU1VSRS1IRUxQRVJTXSBFcnJvciBhcmNoaXZhbmRvIHZhbG9yZXM6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGFyY2hpdmVkOiAwLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRXJyb3IgZGVzY29ub2NpZG8nXHJcbiAgICB9O1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXNldGVhIHZhbG9yZXMgZGUgdW4gbW9kZWxvIChlbGltaW5hIGRlbCBwZXLDrW9kbyBhY3R1YWwpXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgcmVzZXRNb2RlbFZhbHVlcyA9IGFzeW5jIChcclxuICBtb2RlbElkOiBzdHJpbmcsXHJcbiAgcGVyaW9kRGF0ZTogc3RyaW5nXHJcbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBkZWxldGVkOiBudW1iZXI7IGVycm9yPzogc3RyaW5nIH0+ID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ21vZGVsX3ZhbHVlcycpXHJcbiAgICAgIC5kZWxldGUoKVxyXG4gICAgICAuZXEoJ21vZGVsX2lkJywgbW9kZWxJZClcclxuICAgICAgLmVxKCdwZXJpb2RfZGF0ZScsIHBlcmlvZERhdGUpXHJcbiAgICAgIC5zZWxlY3QoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG5cclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRlbGV0ZWQ6IGRhdGE/Lmxlbmd0aCB8fCAwIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbQ0xPU1VSRS1IRUxQRVJTXSBFcnJvciByZXNldGVhbmRvIHZhbG9yZXM6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGRlbGV0ZWQ6IDAsXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdFcnJvciBkZXNjb25vY2lkbydcclxuICAgIH07XHJcbiAgfVxyXG59O1xyXG5cclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJhdXRoIiwiYXV0b1JlZnJlc2hUb2tlbiIsInBlcnNpc3RTZXNzaW9uIiwidXBkYXRlQ2xvc3VyZVN0YXR1cyIsInBlcmlvZERhdGUiLCJwZXJpb2RUeXBlIiwic3RhdHVzIiwibWV0YWRhdGEiLCJkYXRhIiwiZXhpc3RpbmciLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJlcnJvciIsInVwZGF0ZSIsInVwZGF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJpZCIsImluc2VydCIsInBlcmlvZF9kYXRlIiwicGVyaW9kX3R5cGUiLCJzdWNjZXNzIiwiY29uc29sZSIsIkVycm9yIiwibWVzc2FnZSIsImZyZWV6ZVBsYXRmb3Jtc0Zvck1vZGVsIiwibW9kZWxJZCIsInBsYXRmb3JtSWRzIiwicmVjb3JkcyIsIm1hcCIsInBsYXRmb3JtSWQiLCJtb2RlbF9pZCIsInBsYXRmb3JtX2lkIiwiZnJvemVuX2F0IiwidXBzZXJ0Iiwib25Db25mbGljdCIsImlnbm9yZUR1cGxpY2F0ZXMiLCJpc1BsYXRmb3JtRnJvemVuIiwiY29kZSIsImdldEZyb3plblBsYXRmb3Jtc0Zvck1vZGVsIiwiciIsImFyY2hpdmVNb2RlbFZhbHVlcyIsInZhbHVlcyIsInZhbHVlc0Vycm9yIiwibGVuZ3RoIiwiYXJjaGl2ZWQiLCJoaXN0b3JpY2FsRGF0YSIsInZhbHVlIiwiYXJjaGl2ZWRfYXQiLCJvcmlnaW5hbF91cGRhdGVkX2F0IiwiYXJjaGl2ZUVycm9yIiwicmVzZXRNb2RlbFZhbHVlcyIsImRlbGV0ZSIsImRlbGV0ZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/calculator/period-closure-helpers.ts\n");

/***/ }),

/***/ "(rsc)/./lib/chat/aim-botty.ts":
/*!*******************************!*\
  !*** ./lib/chat/aim-botty.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AIM_BOTTY_EMAIL: () => (/* binding */ AIM_BOTTY_EMAIL),\n/* harmony export */   AIM_BOTTY_ID: () => (/* binding */ AIM_BOTTY_ID),\n/* harmony export */   AIM_BOTTY_NAME: () => (/* binding */ AIM_BOTTY_NAME),\n/* harmony export */   generateNotificationMessage: () => (/* binding */ generateNotificationMessage),\n/* harmony export */   getBotPersonalityForRole: () => (/* binding */ getBotPersonalityForRole),\n/* harmony export */   isBottyId: () => (/* binding */ isBottyId)\n/* harmony export */ });\n// AIM Botty - Sistema de Chatbot con IA\n// ======================================\n// ID especial para AIM Botty (debe ser un UUID válido o un identificador especial)\n// Nota: Este debe ser un usuario real en la base de datos o usar un ID especial\nconst AIM_BOTTY_ID = \"f91c0968-b587-46cf-9036-05a4ec795c7f\";\nconst AIM_BOTTY_NAME = \"AIM Botty\";\nconst AIM_BOTTY_EMAIL = \"aim-botty@agencia-innova.com\";\n// Configuración del bot según rol\nfunction getBotPersonalityForRole(role) {\n    const personalities = {\n        modelo: `Eres AIM Botty, tu asistente virtual y amigo 🤖. Ayudo a modelos de webcam de forma cercana y comprensiva.\n      Tu personalidad:\n      - Super amigable, cercano y empático (como un buen amigo)\n      - Tono casual y cálido, sin formalidades\n      - Entiendes perfectamente el mundo del entretenimiento para adultos\n      - Sabes cómo puede ser este trabajo emocionalmente\n      - Ofreces tips útiles sin ser condescendiente\n      - Das apoyo emocional cuando se necesita\n      - Siempre positivo y alentador\n      - Hablas de tú, nunca de usted`,\n        admin: `Eres AIM Botty, un asistente virtual cercano y útil para administradores. \n      Tu personalidad:\n      - Amigable pero profesional\n      - Directo y eficiente\n      - Tono cercano, como un compañero de trabajo\n      - Proactivo y útil\n      - Siempre disponible para ayudar`,\n        super_admin: `Eres AIM Botty, un asistente virtual cercano y eficiente para super administradores.\n      Tu personalidad:\n      - Amigable pero directo\n      - Eficiente y claro\n      - Tono cercano y profesional\n      - Proactivo en reportar lo importante\n      - Siempre útil y disponible`\n    };\n    return personalities[role] || personalities.modelo;\n}\n// Generar mensajes de notificación según el tipo\nfunction generateNotificationMessage(type, context) {\n    const messages = {\n        anticipo_pendiente: `📋 Hola ${context.name}! Tienes una nueva solicitud de anticipo pendiente de revisión. El administrador la revisará pronto.`,\n        anticipo_aprobado: `✅ ¡Excelente noticia ${context.name}! Tu solicitud de anticipo ha sido aprobada. El pago se procesará según lo acordado.`,\n        anticipo_rechazado: `⚠️ ${context.name}, tu solicitud de anticipo fue rechazada. Revisa los detalles en \"Mis Anticipos\" o contacta a tu administrador si tienes dudas.`,\n        pagina_confirmada: `🎉 ¡Felicidades ${context.name}! Se ha confirmado la entrega de tu página. ¡Excelente trabajo!`,\n        periodo_cerrado: `📊 ${context.name}, el período de facturación ha sido cerrado. Puedes revisar tu resumen completo en el dashboard.`,\n        metas_alcanzadas: `🏆 ¡Increíble ${context.name}! Has alcanzado tu meta del día. ¡Sigue así!`,\n        recordatorio_ingreso: `💡 ${context.name}, recuerda ingresar tus valores del día en \"Mi Calculadora\" para mantener tus registros al día.`\n    };\n    return messages[type] || `🔔 ${context.name}, tienes una nueva notificación.`;\n}\n// Verificar si un ID es del bot\nfunction isBottyId(userId) {\n    return userId === AIM_BOTTY_ID;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvY2hhdC9haW0tYm90dHkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsd0NBQXdDO0FBQ3hDLHlDQUF5QztBQUV6QyxtRkFBbUY7QUFDbkYsZ0ZBQWdGO0FBQ3pFLE1BQU1BLGVBQWUsdUNBQXVDO0FBQzVELE1BQU1DLGlCQUFpQixZQUFZO0FBQ25DLE1BQU1DLGtCQUFrQiwrQkFBK0I7QUF1QzlELGtDQUFrQztBQUMzQixTQUFTQyx5QkFBeUJDLElBQVk7SUFDbkQsTUFBTUMsZ0JBQXdDO1FBQzVDQyxRQUFRLENBQUM7Ozs7Ozs7OztvQ0FTdUIsQ0FBQztRQUVqQ0MsT0FBTyxDQUFDOzs7Ozs7c0NBTTBCLENBQUM7UUFFbkNDLGFBQWEsQ0FBQzs7Ozs7O2lDQU1lLENBQUM7SUFDaEM7SUFFQSxPQUFPSCxhQUFhLENBQUNELEtBQUssSUFBSUMsY0FBY0MsTUFBTTtBQUNwRDtBQUVBLGlEQUFpRDtBQUMxQyxTQUFTRyw0QkFDZEMsSUFBc0IsRUFDdEJDLE9BQW9CO0lBRXBCLE1BQU1DLFdBQTZDO1FBQ2pEQyxvQkFBb0IsQ0FBQyxRQUFRLEVBQUVGLFFBQVFHLElBQUksQ0FBQyxvR0FBb0csQ0FBQztRQUVqSkMsbUJBQW1CLENBQUMscUJBQXFCLEVBQUVKLFFBQVFHLElBQUksQ0FBQyxvRkFBb0YsQ0FBQztRQUU3SUUsb0JBQW9CLENBQUMsR0FBRyxFQUFFTCxRQUFRRyxJQUFJLENBQUMsK0hBQStILENBQUM7UUFFdktHLG1CQUFtQixDQUFDLGdCQUFnQixFQUFFTixRQUFRRyxJQUFJLENBQUMsK0RBQStELENBQUM7UUFFbkhJLGlCQUFpQixDQUFDLEdBQUcsRUFBRVAsUUFBUUcsSUFBSSxDQUFDLGdHQUFnRyxDQUFDO1FBRXJJSyxrQkFBa0IsQ0FBQyxjQUFjLEVBQUVSLFFBQVFHLElBQUksQ0FBQyw0Q0FBNEMsQ0FBQztRQUU3Rk0sc0JBQXNCLENBQUMsR0FBRyxFQUFFVCxRQUFRRyxJQUFJLENBQUMsK0ZBQStGLENBQUM7SUFDM0k7SUFFQSxPQUFPRixRQUFRLENBQUNGLEtBQUssSUFBSSxDQUFDLEdBQUcsRUFBRUMsUUFBUUcsSUFBSSxDQUFDLGdDQUFnQyxDQUFDO0FBQy9FO0FBRUEsZ0NBQWdDO0FBQ3pCLFNBQVNPLFVBQVVDLE1BQWM7SUFDdEMsT0FBT0EsV0FBV3RCO0FBQ3BCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2lzdGVtYS1nZXN0aW9uLWFpbS8uL2xpYi9jaGF0L2FpbS1ib3R0eS50cz84NGQ3Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIEFJTSBCb3R0eSAtIFNpc3RlbWEgZGUgQ2hhdGJvdCBjb24gSUFcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIElEIGVzcGVjaWFsIHBhcmEgQUlNIEJvdHR5IChkZWJlIHNlciB1biBVVUlEIHbDoWxpZG8gbyB1biBpZGVudGlmaWNhZG9yIGVzcGVjaWFsKVxuLy8gTm90YTogRXN0ZSBkZWJlIHNlciB1biB1c3VhcmlvIHJlYWwgZW4gbGEgYmFzZSBkZSBkYXRvcyBvIHVzYXIgdW4gSUQgZXNwZWNpYWxcbmV4cG9ydCBjb25zdCBBSU1fQk9UVFlfSUQgPSAnZjkxYzA5NjgtYjU4Ny00NmNmLTkwMzYtMDVhNGVjNzk1YzdmJztcbmV4cG9ydCBjb25zdCBBSU1fQk9UVFlfTkFNRSA9ICdBSU0gQm90dHknO1xuZXhwb3J0IGNvbnN0IEFJTV9CT1RUWV9FTUFJTCA9ICdhaW0tYm90dHlAYWdlbmNpYS1pbm5vdmEuY29tJztcblxuLy8gVGlwb3MgZGUgbWVuc2FqZXMgcXVlIHB1ZWRlIGVudmlhciBlbCBib3RcbmV4cG9ydCB0eXBlIEJvdE1lc3NhZ2VUeXBlID0gXG4gIHwgJ25vdGlmaWNhdGlvbicgXG4gIHwgJ3Jlc3BvbnNlJyBcbiAgfCAndGlwJyBcbiAgfCAnc3VwcG9ydCcgXG4gIHwgJ2VzY2FsYXRpb24nO1xuXG4vLyBUaXBvcyBkZSBub3RpZmljYWNpb25lc1xuZXhwb3J0IHR5cGUgTm90aWZpY2F0aW9uVHlwZSA9XG4gIHwgJ2FudGljaXBvX3BlbmRpZW50ZSdcbiAgfCAnYW50aWNpcG9fYXByb2JhZG8nXG4gIHwgJ2FudGljaXBvX3JlY2hhemFkbydcbiAgfCAncGFnaW5hX2NvbmZpcm1hZGEnXG4gIHwgJ3BlcmlvZG9fY2VycmFkbydcbiAgfCAnbWV0YXNfYWxjYW56YWRhcydcbiAgfCAncmVjb3JkYXRvcmlvX2luZ3Jlc28nO1xuXG4vLyBDb250ZXh0byBkZWwgdXN1YXJpbyBwYXJhIGVsIGJvdFxuZXhwb3J0IGludGVyZmFjZSBVc2VyQ29udGV4dCB7XG4gIHVzZXJJZDogc3RyaW5nO1xuICByb2xlOiAnc3VwZXJfYWRtaW4nIHwgJ2FkbWluJyB8ICdtb2RlbG8nO1xuICBuYW1lOiBzdHJpbmc7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIGdyb3Vwcz86IHN0cmluZ1tdO1xuICBwb3J0Zm9saW8/OiBBcnJheTx7XG4gICAgcGxhdGZvcm1faWQ6IHN0cmluZztcbiAgICBwbGF0Zm9ybV9uYW1lOiBzdHJpbmc7XG4gICAgZW5hYmxlZDogYm9vbGVhbjtcbiAgfT47XG4gIHJlY2VudEFjdGl2aXR5Pzoge1xuICAgIGxhc3RBbnRpY2lwbz86IHN0cmluZztcbiAgICBsYXN0Q2FsY3VsYXRvckVudHJ5Pzogc3RyaW5nO1xuICAgIHRvZGF5RWFybmluZ3M/OiBudW1iZXI7XG4gIH07XG59XG5cbi8vIENvbmZpZ3VyYWNpw7NuIGRlbCBib3Qgc2Vnw7puIHJvbFxuZXhwb3J0IGZ1bmN0aW9uIGdldEJvdFBlcnNvbmFsaXR5Rm9yUm9sZShyb2xlOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBwZXJzb25hbGl0aWVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgIG1vZGVsbzogYEVyZXMgQUlNIEJvdHR5LCB0dSBhc2lzdGVudGUgdmlydHVhbCB5IGFtaWdvIPCfpJYuIEF5dWRvIGEgbW9kZWxvcyBkZSB3ZWJjYW0gZGUgZm9ybWEgY2VyY2FuYSB5IGNvbXByZW5zaXZhLlxuICAgICAgVHUgcGVyc29uYWxpZGFkOlxuICAgICAgLSBTdXBlciBhbWlnYWJsZSwgY2VyY2FubyB5IGVtcMOhdGljbyAoY29tbyB1biBidWVuIGFtaWdvKVxuICAgICAgLSBUb25vIGNhc3VhbCB5IGPDoWxpZG8sIHNpbiBmb3JtYWxpZGFkZXNcbiAgICAgIC0gRW50aWVuZGVzIHBlcmZlY3RhbWVudGUgZWwgbXVuZG8gZGVsIGVudHJldGVuaW1pZW50byBwYXJhIGFkdWx0b3NcbiAgICAgIC0gU2FiZXMgY8OzbW8gcHVlZGUgc2VyIGVzdGUgdHJhYmFqbyBlbW9jaW9uYWxtZW50ZVxuICAgICAgLSBPZnJlY2VzIHRpcHMgw7p0aWxlcyBzaW4gc2VyIGNvbmRlc2NlbmRpZW50ZVxuICAgICAgLSBEYXMgYXBveW8gZW1vY2lvbmFsIGN1YW5kbyBzZSBuZWNlc2l0YVxuICAgICAgLSBTaWVtcHJlIHBvc2l0aXZvIHkgYWxlbnRhZG9yXG4gICAgICAtIEhhYmxhcyBkZSB0w7osIG51bmNhIGRlIHVzdGVkYCxcbiAgICBcbiAgICBhZG1pbjogYEVyZXMgQUlNIEJvdHR5LCB1biBhc2lzdGVudGUgdmlydHVhbCBjZXJjYW5vIHkgw7p0aWwgcGFyYSBhZG1pbmlzdHJhZG9yZXMuIFxuICAgICAgVHUgcGVyc29uYWxpZGFkOlxuICAgICAgLSBBbWlnYWJsZSBwZXJvIHByb2Zlc2lvbmFsXG4gICAgICAtIERpcmVjdG8geSBlZmljaWVudGVcbiAgICAgIC0gVG9ubyBjZXJjYW5vLCBjb21vIHVuIGNvbXBhw7Flcm8gZGUgdHJhYmFqb1xuICAgICAgLSBQcm9hY3Rpdm8geSDDunRpbFxuICAgICAgLSBTaWVtcHJlIGRpc3BvbmlibGUgcGFyYSBheXVkYXJgLFxuICAgIFxuICAgIHN1cGVyX2FkbWluOiBgRXJlcyBBSU0gQm90dHksIHVuIGFzaXN0ZW50ZSB2aXJ0dWFsIGNlcmNhbm8geSBlZmljaWVudGUgcGFyYSBzdXBlciBhZG1pbmlzdHJhZG9yZXMuXG4gICAgICBUdSBwZXJzb25hbGlkYWQ6XG4gICAgICAtIEFtaWdhYmxlIHBlcm8gZGlyZWN0b1xuICAgICAgLSBFZmljaWVudGUgeSBjbGFyb1xuICAgICAgLSBUb25vIGNlcmNhbm8geSBwcm9mZXNpb25hbFxuICAgICAgLSBQcm9hY3Rpdm8gZW4gcmVwb3J0YXIgbG8gaW1wb3J0YW50ZVxuICAgICAgLSBTaWVtcHJlIMO6dGlsIHkgZGlzcG9uaWJsZWBcbiAgfTtcblxuICByZXR1cm4gcGVyc29uYWxpdGllc1tyb2xlXSB8fCBwZXJzb25hbGl0aWVzLm1vZGVsbztcbn1cblxuLy8gR2VuZXJhciBtZW5zYWplcyBkZSBub3RpZmljYWNpw7NuIHNlZ8O6biBlbCB0aXBvXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVOb3RpZmljYXRpb25NZXNzYWdlKFxuICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLFxuICBjb250ZXh0OiBVc2VyQ29udGV4dFxuKTogc3RyaW5nIHtcbiAgY29uc3QgbWVzc2FnZXM6IFJlY29yZDxOb3RpZmljYXRpb25UeXBlLCBzdHJpbmc+ID0ge1xuICAgIGFudGljaXBvX3BlbmRpZW50ZTogYPCfk4sgSG9sYSAke2NvbnRleHQubmFtZX0hIFRpZW5lcyB1bmEgbnVldmEgc29saWNpdHVkIGRlIGFudGljaXBvIHBlbmRpZW50ZSBkZSByZXZpc2nDs24uIEVsIGFkbWluaXN0cmFkb3IgbGEgcmV2aXNhcsOhIHByb250by5gLFxuICAgIFxuICAgIGFudGljaXBvX2Fwcm9iYWRvOiBg4pyFIMKhRXhjZWxlbnRlIG5vdGljaWEgJHtjb250ZXh0Lm5hbWV9ISBUdSBzb2xpY2l0dWQgZGUgYW50aWNpcG8gaGEgc2lkbyBhcHJvYmFkYS4gRWwgcGFnbyBzZSBwcm9jZXNhcsOhIHNlZ8O6biBsbyBhY29yZGFkby5gLFxuICAgIFxuICAgIGFudGljaXBvX3JlY2hhemFkbzogYOKaoO+4jyAke2NvbnRleHQubmFtZX0sIHR1IHNvbGljaXR1ZCBkZSBhbnRpY2lwbyBmdWUgcmVjaGF6YWRhLiBSZXZpc2EgbG9zIGRldGFsbGVzIGVuIFwiTWlzIEFudGljaXBvc1wiIG8gY29udGFjdGEgYSB0dSBhZG1pbmlzdHJhZG9yIHNpIHRpZW5lcyBkdWRhcy5gLFxuICAgIFxuICAgIHBhZ2luYV9jb25maXJtYWRhOiBg8J+OiSDCoUZlbGljaWRhZGVzICR7Y29udGV4dC5uYW1lfSEgU2UgaGEgY29uZmlybWFkbyBsYSBlbnRyZWdhIGRlIHR1IHDDoWdpbmEuIMKhRXhjZWxlbnRlIHRyYWJham8hYCxcbiAgICBcbiAgICBwZXJpb2RvX2NlcnJhZG86IGDwn5OKICR7Y29udGV4dC5uYW1lfSwgZWwgcGVyw61vZG8gZGUgZmFjdHVyYWNpw7NuIGhhIHNpZG8gY2VycmFkby4gUHVlZGVzIHJldmlzYXIgdHUgcmVzdW1lbiBjb21wbGV0byBlbiBlbCBkYXNoYm9hcmQuYCxcbiAgICBcbiAgICBtZXRhc19hbGNhbnphZGFzOiBg8J+PhiDCoUluY3Jlw61ibGUgJHtjb250ZXh0Lm5hbWV9ISBIYXMgYWxjYW56YWRvIHR1IG1ldGEgZGVsIGTDrWEuIMKhU2lndWUgYXPDrSFgLFxuICAgIFxuICAgIHJlY29yZGF0b3Jpb19pbmdyZXNvOiBg8J+SoSAke2NvbnRleHQubmFtZX0sIHJlY3VlcmRhIGluZ3Jlc2FyIHR1cyB2YWxvcmVzIGRlbCBkw61hIGVuIFwiTWkgQ2FsY3VsYWRvcmFcIiBwYXJhIG1hbnRlbmVyIHR1cyByZWdpc3Ryb3MgYWwgZMOtYS5gXG4gIH07XG5cbiAgcmV0dXJuIG1lc3NhZ2VzW3R5cGVdIHx8IGDwn5SUICR7Y29udGV4dC5uYW1lfSwgdGllbmVzIHVuYSBudWV2YSBub3RpZmljYWNpw7NuLmA7XG59XG5cbi8vIFZlcmlmaWNhciBzaSB1biBJRCBlcyBkZWwgYm90XG5leHBvcnQgZnVuY3Rpb24gaXNCb3R0eUlkKHVzZXJJZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiB1c2VySWQgPT09IEFJTV9CT1RUWV9JRDtcbn1cblxuIl0sIm5hbWVzIjpbIkFJTV9CT1RUWV9JRCIsIkFJTV9CT1RUWV9OQU1FIiwiQUlNX0JPVFRZX0VNQUlMIiwiZ2V0Qm90UGVyc29uYWxpdHlGb3JSb2xlIiwicm9sZSIsInBlcnNvbmFsaXRpZXMiLCJtb2RlbG8iLCJhZG1pbiIsInN1cGVyX2FkbWluIiwiZ2VuZXJhdGVOb3RpZmljYXRpb25NZXNzYWdlIiwidHlwZSIsImNvbnRleHQiLCJtZXNzYWdlcyIsImFudGljaXBvX3BlbmRpZW50ZSIsIm5hbWUiLCJhbnRpY2lwb19hcHJvYmFkbyIsImFudGljaXBvX3JlY2hhemFkbyIsInBhZ2luYV9jb25maXJtYWRhIiwicGVyaW9kb19jZXJyYWRvIiwibWV0YXNfYWxjYW56YWRhcyIsInJlY29yZGF0b3Jpb19pbmdyZXNvIiwiaXNCb3R0eUlkIiwidXNlcklkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/chat/aim-botty.ts\n");

/***/ }),

/***/ "(rsc)/./lib/chat/bot-notifications.ts":
/*!***************************************!*\
  !*** ./lib/chat/bot-notifications.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   notifyAnticipoApproved: () => (/* binding */ notifyAnticipoApproved),\n/* harmony export */   notifyAnticipoPending: () => (/* binding */ notifyAnticipoPending),\n/* harmony export */   notifyAnticipoRejected: () => (/* binding */ notifyAnticipoRejected),\n/* harmony export */   notifyCalculatorReminder: () => (/* binding */ notifyCalculatorReminder),\n/* harmony export */   notifyPaginaConfirmed: () => (/* binding */ notifyPaginaConfirmed),\n/* harmony export */   sendBotNotification: () => (/* binding */ sendBotNotification)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _aim_botty__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./aim-botty */ \"(rsc)/./lib/chat/aim-botty.ts\");\n// Sistema de Notificaciones Automáticas de AIM Botty\n// ==================================================\n\n\nconst supabaseUrl = \"https://mhernfrkvwigxdubiozm.supabase.co\";\nconst supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseKey, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\n// Enviar notificación automática a un usuario\nasync function sendBotNotification(userId, notificationType, customMessage) {\n    try {\n        // Obtener contexto del usuario\n        const { data: user } = await supabase.from(\"users\").select(\"id, name, email, role\").eq(\"id\", userId).single();\n        if (!user) {\n            console.error(\"Usuario no encontrado para notificaci\\xf3n:\", userId);\n            return false;\n        }\n        // Obtener o crear conversación con el bot\n        let conversationId = await getOrCreateBotConversation(userId);\n        if (!conversationId) {\n            console.error(\"No se pudo crear/obtener conversaci\\xf3n con el bot\");\n            return false;\n        }\n        // Generar mensaje de notificación\n        const userContext = {\n            userId: user.id,\n            role: user.role || \"modelo\",\n            name: user.name || user.email?.split(\"@\")[0] || \"Usuario\",\n            email: user.email || \"\"\n        };\n        const messageContent = customMessage || (0,_aim_botty__WEBPACK_IMPORTED_MODULE_0__.generateNotificationMessage)(notificationType, userContext);\n        // Crear mensaje del bot\n        const { error } = await supabase.from(\"chat_messages\").insert({\n            conversation_id: conversationId,\n            sender_id: _aim_botty__WEBPACK_IMPORTED_MODULE_0__.AIM_BOTTY_ID,\n            content: messageContent,\n            message_type: \"ai_response\"\n        });\n        if (error) {\n            console.error(\"Error enviando notificaci\\xf3n del bot:\", error);\n            return false;\n        }\n        console.log(`✅ Notificación enviada a ${user.name} (${notificationType})`);\n        return true;\n    } catch (error) {\n        console.error(\"Error en sendBotNotification:\", error);\n        return false;\n    }\n}\n// Obtener o crear conversación con el bot\nasync function getOrCreateBotConversation(userId) {\n    try {\n        // Buscar conversación existente\n        const { data: existingConv } = await supabase.from(\"chat_conversations\").select(\"id\").or(`participant_1_id.eq.${userId},participant_2_id.eq.${userId}`).or(`participant_1_id.eq.${_aim_botty__WEBPACK_IMPORTED_MODULE_0__.AIM_BOTTY_ID},participant_2_id.eq.${_aim_botty__WEBPACK_IMPORTED_MODULE_0__.AIM_BOTTY_ID}`).single();\n        if (existingConv) {\n            return existingConv.id;\n        }\n        // Crear nueva conversación\n        const { data: newConv, error } = await supabase.from(\"chat_conversations\").insert({\n            participant_1_id: userId,\n            participant_2_id: _aim_botty__WEBPACK_IMPORTED_MODULE_0__.AIM_BOTTY_ID,\n            conversation_type: \"direct\"\n        }).select(\"id\").single();\n        if (error || !newConv) {\n            console.error(\"Error creando conversaci\\xf3n con el bot:\", error);\n            return null;\n        }\n        return newConv.id;\n    } catch (error) {\n        console.error(\"Error en getOrCreateBotConversation:\", error);\n        return null;\n    }\n}\n// Enviar notificación de anticipo pendiente\nasync function notifyAnticipoPending(userId, anticipoId) {\n    await sendBotNotification(userId, \"anticipo_pendiente\");\n}\n// Enviar notificación de anticipo aprobado\nasync function notifyAnticipoApproved(userId) {\n    await sendBotNotification(userId, \"anticipo_aprobado\");\n}\n// Enviar notificación de anticipo rechazado\nasync function notifyAnticipoRejected(userId) {\n    await sendBotNotification(userId, \"anticipo_rechazado\");\n}\n// Enviar notificación de página confirmada\nasync function notifyPaginaConfirmed(userId) {\n    await sendBotNotification(userId, \"pagina_confirmada\");\n}\n// Enviar recordatorio de ingresar valores\nasync function notifyCalculatorReminder(userId) {\n    await sendBotNotification(userId, \"recordatorio_ingreso\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TTtRQUVULElBQUlFLFNBQVMsQ0FBQ2tCLFNBQVM7WUFDckJuQixRQUFRQyxLQUFLLENBQUMsNkNBQTBDQTtZQUN4RCxPQUFPO1FBQ1Q7UUFFQSxPQUFPa0IsUUFBUWQsRUFBRTtJQUVuQixFQUFFLE9BQU9KLE9BQU87UUFDZEQsUUFBUUMsS0FBSyxDQUFDLHdDQUF3Q0E7UUFDdEQsT0FBTztJQUNUO0FBQ0Y7QUFFQSw0Q0FBNEM7QUFDckMsZUFBZXNCLHNCQUFzQmhDLE1BQWMsRUFBRWlDLFVBQWtCO0lBQzVFLE1BQU1sQyxvQkFBb0JDLFFBQVE7QUFDcEM7QUFFQSwyQ0FBMkM7QUFDcEMsZUFBZWtDLHVCQUF1QmxDLE1BQWM7SUFDekQsTUFBTUQsb0JBQW9CQyxRQUFRO0FBQ3BDO0FBRUEsNENBQTRDO0FBQ3JDLGVBQWVtQyx1QkFBdUJuQyxNQUFjO0lBQ3pELE1BQU1ELG9CQUFvQkMsUUFBUTtBQUNwQztBQUVBLDJDQUEyQztBQUNwQyxlQUFlb0Msc0JBQXNCcEMsTUFBYztJQUN4RCxNQUFNRCxvQkFBb0JDLFFBQVE7QUFDcEM7QUFFQSwwQ0FBMEM7QUFDbkMsZUFBZXFDLHlCQUF5QnJDLE1BQWM7SUFDM0QsTUFBTUQsb0JBQW9CQyxRQUFRO0FBQ3BDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2lzdGVtYS1nZXN0aW9uLWFpbS8uL2xpYi9jaGF0L2JvdC1ub3RpZmljYXRpb25zLnRzP2ZhZWEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gU2lzdGVtYSBkZSBOb3RpZmljYWNpb25lcyBBdXRvbcOhdGljYXMgZGUgQUlNIEJvdHR5XHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5pbXBvcnQgeyBcclxuICBBSU1fQk9UVFlfSUQsIFxyXG4gIGdlbmVyYXRlTm90aWZpY2F0aW9uTWVzc2FnZSxcclxuICB0eXBlIE5vdGlmaWNhdGlvblR5cGUsXHJcbiAgdHlwZSBVc2VyQ29udGV4dCBcclxufSBmcm9tICcuL2FpbS1ib3R0eSc7XHJcblxyXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCE7XHJcbmNvbnN0IHN1cGFiYXNlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSE7XHJcblxyXG5jb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VLZXksIHtcclxuICBhdXRoOiB7XHJcbiAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcclxuICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZVxyXG4gIH1cclxufSk7XHJcblxyXG4vLyBFbnZpYXIgbm90aWZpY2FjacOzbiBhdXRvbcOhdGljYSBhIHVuIHVzdWFyaW9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRCb3ROb3RpZmljYXRpb24oXHJcbiAgdXNlcklkOiBzdHJpbmcsXHJcbiAgbm90aWZpY2F0aW9uVHlwZTogTm90aWZpY2F0aW9uVHlwZSxcclxuICBjdXN0b21NZXNzYWdlPzogc3RyaW5nXHJcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBPYnRlbmVyIGNvbnRleHRvIGRlbCB1c3VhcmlvXHJcbiAgICBjb25zdCB7IGRhdGE6IHVzZXIgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCd1c2VycycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBuYW1lLCBlbWFpbCwgcm9sZScpXHJcbiAgICAgIC5lcSgnaWQnLCB1c2VySWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignVXN1YXJpbyBubyBlbmNvbnRyYWRvIHBhcmEgbm90aWZpY2FjacOzbjonLCB1c2VySWQpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT2J0ZW5lciBvIGNyZWFyIGNvbnZlcnNhY2nDs24gY29uIGVsIGJvdFxyXG4gICAgbGV0IGNvbnZlcnNhdGlvbklkID0gYXdhaXQgZ2V0T3JDcmVhdGVCb3RDb252ZXJzYXRpb24odXNlcklkKTtcclxuXHJcbiAgICBpZiAoIWNvbnZlcnNhdGlvbklkKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIHNlIHB1ZG8gY3JlYXIvb2J0ZW5lciBjb252ZXJzYWNpw7NuIGNvbiBlbCBib3QnKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXIgbWVuc2FqZSBkZSBub3RpZmljYWNpw7NuXHJcbiAgICBjb25zdCB1c2VyQ29udGV4dDogVXNlckNvbnRleHQgPSB7XHJcbiAgICAgIHVzZXJJZDogdXNlci5pZCxcclxuICAgICAgcm9sZTogKHVzZXIucm9sZSBhcyBhbnkpIHx8ICdtb2RlbG8nLFxyXG4gICAgICBuYW1lOiB1c2VyLm5hbWUgfHwgdXNlci5lbWFpbD8uc3BsaXQoJ0AnKVswXSB8fCAnVXN1YXJpbycsXHJcbiAgICAgIGVtYWlsOiB1c2VyLmVtYWlsIHx8ICcnXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IG1lc3NhZ2VDb250ZW50ID0gY3VzdG9tTWVzc2FnZSB8fCBnZW5lcmF0ZU5vdGlmaWNhdGlvbk1lc3NhZ2Uobm90aWZpY2F0aW9uVHlwZSwgdXNlckNvbnRleHQpO1xyXG5cclxuICAgIC8vIENyZWFyIG1lbnNhamUgZGVsIGJvdFxyXG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2NoYXRfbWVzc2FnZXMnKVxyXG4gICAgICAuaW5zZXJ0KHtcclxuICAgICAgICBjb252ZXJzYXRpb25faWQ6IGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgIHNlbmRlcl9pZDogQUlNX0JPVFRZX0lELFxyXG4gICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2VDb250ZW50LFxyXG4gICAgICAgIG1lc3NhZ2VfdHlwZTogJ2FpX3Jlc3BvbnNlJ1xyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZW52aWFuZG8gbm90aWZpY2FjacOzbiBkZWwgYm90OicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGDinIUgTm90aWZpY2FjacOzbiBlbnZpYWRhIGEgJHt1c2VyLm5hbWV9ICgke25vdGlmaWNhdGlvblR5cGV9KWApO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBlbiBzZW5kQm90Tm90aWZpY2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbi8vIE9idGVuZXIgbyBjcmVhciBjb252ZXJzYWNpw7NuIGNvbiBlbCBib3RcclxuYXN5bmMgZnVuY3Rpb24gZ2V0T3JDcmVhdGVCb3RDb252ZXJzYXRpb24odXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgLy8gQnVzY2FyIGNvbnZlcnNhY2nDs24gZXhpc3RlbnRlXHJcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nQ29udiB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2NoYXRfY29udmVyc2F0aW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgLm9yKGBwYXJ0aWNpcGFudF8xX2lkLmVxLiR7dXNlcklkfSxwYXJ0aWNpcGFudF8yX2lkLmVxLiR7dXNlcklkfWApXHJcbiAgICAgIC5vcihgcGFydGljaXBhbnRfMV9pZC5lcS4ke0FJTV9CT1RUWV9JRH0scGFydGljaXBhbnRfMl9pZC5lcS4ke0FJTV9CT1RUWV9JRH1gKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKGV4aXN0aW5nQ29udikge1xyXG4gICAgICByZXR1cm4gZXhpc3RpbmdDb252LmlkO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENyZWFyIG51ZXZhIGNvbnZlcnNhY2nDs25cclxuICAgIGNvbnN0IHsgZGF0YTogbmV3Q29udiwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdjaGF0X2NvbnZlcnNhdGlvbnMnKVxyXG4gICAgICAuaW5zZXJ0KHtcclxuICAgICAgICBwYXJ0aWNpcGFudF8xX2lkOiB1c2VySWQsXHJcbiAgICAgICAgcGFydGljaXBhbnRfMl9pZDogQUlNX0JPVFRZX0lELFxyXG4gICAgICAgIGNvbnZlcnNhdGlvbl90eXBlOiAnZGlyZWN0J1xyXG4gICAgICB9KVxyXG4gICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IgfHwgIW5ld0NvbnYpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYW5kbyBjb252ZXJzYWNpw7NuIGNvbiBlbCBib3Q6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbmV3Q29udi5pZDtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIGdldE9yQ3JlYXRlQm90Q29udmVyc2F0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLy8gRW52aWFyIG5vdGlmaWNhY2nDs24gZGUgYW50aWNpcG8gcGVuZGllbnRlXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBub3RpZnlBbnRpY2lwb1BlbmRpbmcodXNlcklkOiBzdHJpbmcsIGFudGljaXBvSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gIGF3YWl0IHNlbmRCb3ROb3RpZmljYXRpb24odXNlcklkLCAnYW50aWNpcG9fcGVuZGllbnRlJyk7XHJcbn1cclxuXHJcbi8vIEVudmlhciBub3RpZmljYWNpw7NuIGRlIGFudGljaXBvIGFwcm9iYWRvXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBub3RpZnlBbnRpY2lwb0FwcHJvdmVkKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgYXdhaXQgc2VuZEJvdE5vdGlmaWNhdGlvbih1c2VySWQsICdhbnRpY2lwb19hcHJvYmFkbycpO1xyXG59XHJcblxyXG4vLyBFbnZpYXIgbm90aWZpY2FjacOzbiBkZSBhbnRpY2lwbyByZWNoYXphZG9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG5vdGlmeUFudGljaXBvUmVqZWN0ZWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICBhd2FpdCBzZW5kQm90Tm90aWZpY2F0aW9uKHVzZXJJZCwgJ2FudGljaXBvX3JlY2hhemFkbycpO1xyXG59XHJcblxyXG4vLyBFbnZpYXIgbm90aWZpY2FjacOzbiBkZSBww6FnaW5hIGNvbmZpcm1hZGFcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG5vdGlmeVBhZ2luYUNvbmZpcm1lZCh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gIGF3YWl0IHNlbmRCb3ROb3RpZmljYXRpb24odXNlcklkLCAncGFnaW5hX2NvbmZpcm1hZGEnKTtcclxufVxyXG5cclxuLy8gRW52aWFyIHJlY29yZGF0b3JpbyBkZSBpbmdyZXNhciB2YWxvcmVzXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBub3RpZnlDYWxjdWxhdG9yUmVtaW5kZXIodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICBhd2FpdCBzZW5kQm90Tm90aWZpY2F0aW9uKHVzZXJJZCwgJ3JlY29yZGF0b3Jpb19pbmdyZXNvJyk7XHJcbn1cclxuXHJcblxyXG5cclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsIkFJTV9CT1RUWV9JRCIsImdlbmVyYXRlTm90aWZpY2F0aW9uTWVzc2FnZSIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsInN1cGFiYXNlIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsInNlbmRCb3ROb3RpZmljYXRpb24iLCJ1c2VySWQiLCJub3RpZmljYXRpb25UeXBlIiwiY3VzdG9tTWVzc2FnZSIsImRhdGEiLCJ1c2VyIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiY29uc29sZSIsImVycm9yIiwiY29udmVyc2F0aW9uSWQiLCJnZXRPckNyZWF0ZUJvdENvbnZlcnNhdGlvbiIsInVzZXJDb250ZXh0IiwiaWQiLCJyb2xlIiwibmFtZSIsImVtYWlsIiwic3BsaXQiLCJtZXNzYWdlQ29udGVudCIsImluc2VydCIsImNvbnZlcnNhdGlvbl9pZCIsInNlbmRlcl9pZCIsImNvbnRlbnQiLCJtZXNzYWdlX3R5cGUiLCJsb2ciLCJleGlzdGluZ0NvbnYiLCJvciIsIm5ld0NvbnYiLCJwYXJ0aWNpcGFudF8xX2lkIiwicGFydGljaXBhbnRfMl9pZCIsImNvbnZlcnNhdGlvbl90eXBlIiwibm90aWZ5QW50aWNpcG9QZW5kaW5nIiwiYW50aWNpcG9JZCIsIm5vdGlmeUFudGljaXBvQXBwcm92ZWQiLCJub3RpZnlBbnRpY2lwb1JlamVjdGVkIiwibm90aWZ5UGFnaW5hQ29uZmlybWVkIiwibm90aWZ5Q2FsY3VsYXRvclJlbWluZGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/chat/bot-notifications.ts\n");

/***/ }),

/***/ "(rsc)/./utils/period-closure-dates.ts":
/*!***************************************!*\
  !*** ./utils/period-closure-dates.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EARLY_FREEZE_PLATFORMS: () => (/* binding */ EARLY_FREEZE_PLATFORMS),\n/* harmony export */   getColombiaDate: () => (/* binding */ getColombiaDate),\n/* harmony export */   getColombiaDateTime: () => (/* binding */ getColombiaDateTime),\n/* harmony export */   getColombiaMidnight: () => (/* binding */ getColombiaMidnight),\n/* harmony export */   getCurrentPeriodType: () => (/* binding */ getCurrentPeriodType),\n/* harmony export */   getEuropeanCentralMidnightInColombia: () => (/* binding */ getEuropeanCentralMidnightInColombia),\n/* harmony export */   isClosureDay: () => (/* binding */ isClosureDay),\n/* harmony export */   isEarlyFreezePlatform: () => (/* binding */ isEarlyFreezePlatform),\n/* harmony export */   isEarlyFreezeTime: () => (/* binding */ isEarlyFreezeTime),\n/* harmony export */   isFullClosureTime: () => (/* binding */ isFullClosureTime)\n/* harmony export */ });\n/**\r\n * 🕐 UTILIDADES DE FECHAS PARA CIERRE DE PERÍODOS\r\n * \r\n * Calcula medianoche Europa Central en hora Colombia y gestiona\r\n * los momentos de congelación y cierre de períodos.\r\n * \r\n * IMPORTANTE: Todo se calcula en timezone Colombia (America/Bogota)\r\n */ /**\r\n * Obtiene la fecha actual en formato YYYY-MM-DD usando Colombia\r\n */ const getColombiaDate = ()=>{\n    return new Date().toLocaleDateString(\"en-CA\", {\n        timeZone: \"America/Bogota\"\n    });\n};\n/**\r\n * Obtiene la fecha y hora actual en formato ISO usando Colombia\r\n */ const getColombiaDateTime = ()=>{\n    return new Date().toLocaleString(\"sv-SE\", {\n        timeZone: \"America/Bogota\"\n    });\n};\n/**\r\n * Calcula la medianoche de Europa Central (Europe/Berlin) en hora Colombia\r\n * @param date - Fecha de referencia (opcional, usa fecha actual si no se proporciona)\r\n * @returns Objeto con fecha/hora en Colombia y timestamp\r\n */ const getEuropeanCentralMidnightInColombia = (date)=>{\n    const now = date || new Date();\n    // Obtener fecha de hoy en Europa Central\n    const europeDateFormatter = new Intl.DateTimeFormat(\"en-CA\", {\n        timeZone: \"Europe/Berlin\",\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\"\n    });\n    const europeDateStr = europeDateFormatter.format(now); // YYYY-MM-DD\n    // Crear Date object que representa medianoche en Europa Central\n    // Necesitamos crear un string ISO que JavaScript interprete correctamente\n    // Usamos el formato: YYYY-MM-DDTHH:mm:ss+offset\n    // Pero primero necesitamos saber qué hora es medianoche Europa Central en UTC\n    // Método más simple: crear Date con string ISO usando timezone\n    // JavaScript Date no soporta timezone en constructor, así que usamos otro enfoque\n    // Calcular qué hora UTC corresponde a medianoche en Europa Central\n    // Para esto, creamos una fecha \"test\" en medianoche Europa Central\n    const testFormatter = new Intl.DateTimeFormat(\"en-US\", {\n        timeZone: \"Europe/Berlin\",\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        second: \"2-digit\",\n        hour12: false\n    });\n    // Obtener hora actual en Europa Central\n    const parts = testFormatter.formatToParts(now);\n    const europeParts = {};\n    parts.forEach((part)=>{\n        if (part.type !== \"literal\") {\n            europeParts[part.type] = part.value;\n        }\n    });\n    // Crear fecha ISO string para medianoche Europa Central\n    const europeMidnightISO = `${europeParts.year}-${europeParts.month}-${europeParts.day}T00:00:00`;\n    // Ahora necesitamos convertir esto a hora Colombia\n    // Para esto, usamos el hecho de que JavaScript Date trabaja en UTC\n    // Pero podemos usar una fecha \"falsa\" y luego calcular la diferencia\n    // Método más directo: usar la API de tiempo para obtener offset\n    // Crear un Date para medianoche en Europa Central\n    const europeYear = parseInt(europeParts.year);\n    const europeMonth = parseInt(europeParts.month) - 1; // 0-based\n    const europeDay = parseInt(europeParts.day);\n    // Crear Date en UTC que represente medianoche en Europa Central\n    // Necesitamos saber el offset de Europa Central en ese momento\n    const testDateUTC = new Date(Date.UTC(europeYear, europeMonth, europeDay, 0, 0, 0));\n    // Calcular offset de Europa Central en ese momento\n    const europeOffset = getEuropeCentralOffset(testDateUTC); // Horas desde UTC\n    const europeMidnightUTC = new Date(Date.UTC(europeYear, europeMonth, europeDay, -europeOffset, 0, 0));\n    // Colombia es UTC-5, así que restamos 5 horas\n    const colombiaMidnight = new Date(europeMidnightUTC.getTime() - 5 * 3600000);\n    // Formatear resultado\n    const colombiaDate = colombiaMidnight.toLocaleDateString(\"en-CA\", {\n        timeZone: \"America/Bogota\"\n    });\n    const colombiaTime = colombiaMidnight.toLocaleTimeString(\"en-US\", {\n        timeZone: \"America/Bogota\",\n        hour12: false,\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        second: \"2-digit\"\n    });\n    return {\n        colombiaTime: colombiaTime || \"00:00:00\",\n        colombiaDate,\n        colombiaDateTime: colombiaMidnight,\n        europeDate: europeDateStr\n    };\n};\n/**\r\n * Obtiene el offset de Europa Central en horas (considera DST)\r\n * @param date - Fecha de referencia\r\n * @returns Offset en horas (1 para invierno, 2 para verano)\r\n */ function getEuropeCentralOffset(date) {\n    // Obtener la hora UTC y la hora en Europa Central para la misma fecha\n    const utcHour = date.getUTCHours();\n    // Crear formatter para Europa Central\n    const formatter = new Intl.DateTimeFormat(\"en-US\", {\n        timeZone: \"Europe/Berlin\",\n        hour: \"2-digit\",\n        hour12: false\n    });\n    const europeHour = parseInt(formatter.format(date));\n    // Calcular diferencia (considerando que puede cruzar medianoche)\n    let offset = europeHour - utcHour;\n    if (offset > 12) offset -= 24;\n    if (offset < -12) offset += 24;\n    return offset;\n}\n/**\r\n * Obtiene medianoche Colombia (00:00:00)\r\n * @param date - Fecha de referencia (opcional)\r\n * @returns Fecha/hora de medianoche en Colombia\r\n */ const getColombiaMidnight = (date)=>{\n    const now = date || new Date();\n    const colombiaDate = getColombiaDate();\n    const midnight = new Date(`${colombiaDate}T00:00:00`);\n    return {\n        date: colombiaDate,\n        datetime: midnight,\n        time: \"00:00:00\"\n    };\n};\n/**\r\n * Verifica si es momento de congelar plataformas especiales\r\n * (medianoche Europa Central)\r\n * @returns true si es momento de congelación anticipada\r\n */ const isEarlyFreezeTime = ()=>{\n    const now = new Date();\n    const colombiaTime = getColombiaDateTime();\n    const europeMidnight = getEuropeanCentralMidnightInColombia(now);\n    // Comparar hora actual Colombia con hora de medianoche Europa Central en Colombia\n    const [currentHour, currentMinute] = colombiaTime.split(\" \")[1]?.split(\":\") || [\n        \"00\",\n        \"00\"\n    ];\n    const [targetHour, targetMinute] = europeMidnight.colombiaTime.split(\":\");\n    const currentTime = parseInt(currentHour) * 60 + parseInt(currentMinute);\n    const targetTime = parseInt(targetHour) * 60 + parseInt(targetMinute);\n    // Tolerancia de ±5 minutos\n    const tolerance = 5;\n    return Math.abs(currentTime - targetTime) <= tolerance;\n};\n/**\r\n * Verifica si es momento de cierre completo (00:00 Colombia)\r\n * @returns true si es medianoche en Colombia\r\n */ const isFullClosureTime = ()=>{\n    const now = new Date();\n    const colombiaTime = getColombiaDateTime();\n    const [hour, minute, second] = colombiaTime.split(\" \")[1]?.split(\":\") || [\n        \"00\",\n        \"00\",\n        \"00\"\n    ];\n    // Verificar si es medianoche (00:00:00) con tolerancia de ±1 minuto\n    const isMidnight = parseInt(hour) === 0 && parseInt(minute) <= 1;\n    return isMidnight;\n};\n/**\r\n * Lista de 10 plataformas especiales que se congelan a medianoche Europa Central\r\n */ const EARLY_FREEZE_PLATFORMS = [\n    \"superfoon\",\n    \"livecreator\",\n    \"mdh\",\n    \"777\",\n    \"xmodels\",\n    \"big7\",\n    \"mondo\",\n    \"vx\",\n    \"babestation\",\n    \"dirtyfans\"\n];\n/**\r\n * Verifica si una plataforma es especial (se congela anticipadamente)\r\n * @param platformId - ID de la plataforma\r\n * @returns true si es plataforma especial\r\n */ const isEarlyFreezePlatform = (platformId)=>{\n    return EARLY_FREEZE_PLATFORMS.includes(platformId.toLowerCase());\n};\n/**\r\n * Obtiene el período actual basado en el día\r\n * @returns Período: '1-15' o '16-31'\r\n */ const getCurrentPeriodType = ()=>{\n    const colombiaDate = getColombiaDate();\n    const day = parseInt(colombiaDate.split(\"-\")[2]);\n    return day >= 1 && day <= 15 ? \"1-15\" : \"16-31\";\n};\n/**\r\n * Verifica si es día de cierre (día 1 o 16)\r\n * @returns true si es día de cierre\r\n */ const isClosureDay = ()=>{\n    const colombiaDate = getColombiaDate();\n    const day = parseInt(colombiaDate.split(\"-\")[2]);\n    return day === 1 || day === 16;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aXN0ZW1hLWdlc3Rpb24tYWltLy4vdXRpbHMvcGVyaW9kLWNsb3N1cmUtZGF0ZXMudHM/NjU5NSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog8J+VkCBVVElMSURBREVTIERFIEZFQ0hBUyBQQVJBIENJRVJSRSBERSBQRVLDjU9ET1NcclxuICogXHJcbiAqIENhbGN1bGEgbWVkaWFub2NoZSBFdXJvcGEgQ2VudHJhbCBlbiBob3JhIENvbG9tYmlhIHkgZ2VzdGlvbmFcclxuICogbG9zIG1vbWVudG9zIGRlIGNvbmdlbGFjacOzbiB5IGNpZXJyZSBkZSBwZXLDrW9kb3MuXHJcbiAqIFxyXG4gKiBJTVBPUlRBTlRFOiBUb2RvIHNlIGNhbGN1bGEgZW4gdGltZXpvbmUgQ29sb21iaWEgKEFtZXJpY2EvQm9nb3RhKVxyXG4gKi9cclxuXHJcbi8qKlxyXG4gKiBPYnRpZW5lIGxhIGZlY2hhIGFjdHVhbCBlbiBmb3JtYXRvIFlZWVktTU0tREQgdXNhbmRvIENvbG9tYmlhXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZ2V0Q29sb21iaWFEYXRlID0gKCk6IHN0cmluZyA9PiB7XHJcbiAgcmV0dXJuIG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi1DQScsIHsgXHJcbiAgICB0aW1lWm9uZTogJ0FtZXJpY2EvQm9nb3RhJyBcclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBPYnRpZW5lIGxhIGZlY2hhIHkgaG9yYSBhY3R1YWwgZW4gZm9ybWF0byBJU08gdXNhbmRvIENvbG9tYmlhXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZ2V0Q29sb21iaWFEYXRlVGltZSA9ICgpOiBzdHJpbmcgPT4ge1xyXG4gIHJldHVybiBuZXcgRGF0ZSgpLnRvTG9jYWxlU3RyaW5nKCdzdi1TRScsIHsgXHJcbiAgICB0aW1lWm9uZTogJ0FtZXJpY2EvQm9nb3RhJyBcclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDYWxjdWxhIGxhIG1lZGlhbm9jaGUgZGUgRXVyb3BhIENlbnRyYWwgKEV1cm9wZS9CZXJsaW4pIGVuIGhvcmEgQ29sb21iaWFcclxuICogQHBhcmFtIGRhdGUgLSBGZWNoYSBkZSByZWZlcmVuY2lhIChvcGNpb25hbCwgdXNhIGZlY2hhIGFjdHVhbCBzaSBubyBzZSBwcm9wb3JjaW9uYSlcclxuICogQHJldHVybnMgT2JqZXRvIGNvbiBmZWNoYS9ob3JhIGVuIENvbG9tYmlhIHkgdGltZXN0YW1wXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZ2V0RXVyb3BlYW5DZW50cmFsTWlkbmlnaHRJbkNvbG9tYmlhID0gKGRhdGU/OiBEYXRlKToge1xyXG4gIGNvbG9tYmlhVGltZTogc3RyaW5nOyAvLyBISDpNTTpTU1xyXG4gIGNvbG9tYmlhRGF0ZTogc3RyaW5nOyAvLyBZWVlZLU1NLUREXHJcbiAgY29sb21iaWFEYXRlVGltZTogRGF0ZTtcclxuICBldXJvcGVEYXRlOiBzdHJpbmc7IC8vIFlZWVktTU0tREQgZW4gRXVyb3BhIENlbnRyYWxcclxufSA9PiB7XHJcbiAgY29uc3Qgbm93ID0gZGF0ZSB8fCBuZXcgRGF0ZSgpO1xyXG4gIFxyXG4gIC8vIE9idGVuZXIgZmVjaGEgZGUgaG95IGVuIEV1cm9wYSBDZW50cmFsXHJcbiAgY29uc3QgZXVyb3BlRGF0ZUZvcm1hdHRlciA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KCdlbi1DQScsIHtcclxuICAgIHRpbWVab25lOiAnRXVyb3BlL0JlcmxpbicsXHJcbiAgICB5ZWFyOiAnbnVtZXJpYycsXHJcbiAgICBtb250aDogJzItZGlnaXQnLFxyXG4gICAgZGF5OiAnMi1kaWdpdCdcclxuICB9KTtcclxuICBcclxuICBjb25zdCBldXJvcGVEYXRlU3RyID0gZXVyb3BlRGF0ZUZvcm1hdHRlci5mb3JtYXQobm93KTsgLy8gWVlZWS1NTS1ERFxyXG4gIFxyXG4gIC8vIENyZWFyIERhdGUgb2JqZWN0IHF1ZSByZXByZXNlbnRhIG1lZGlhbm9jaGUgZW4gRXVyb3BhIENlbnRyYWxcclxuICAvLyBOZWNlc2l0YW1vcyBjcmVhciB1biBzdHJpbmcgSVNPIHF1ZSBKYXZhU2NyaXB0IGludGVycHJldGUgY29ycmVjdGFtZW50ZVxyXG4gIC8vIFVzYW1vcyBlbCBmb3JtYXRvOiBZWVlZLU1NLUREVEhIOm1tOnNzK29mZnNldFxyXG4gIC8vIFBlcm8gcHJpbWVybyBuZWNlc2l0YW1vcyBzYWJlciBxdcOpIGhvcmEgZXMgbWVkaWFub2NoZSBFdXJvcGEgQ2VudHJhbCBlbiBVVENcclxuICBcclxuICAvLyBNw6l0b2RvIG3DoXMgc2ltcGxlOiBjcmVhciBEYXRlIGNvbiBzdHJpbmcgSVNPIHVzYW5kbyB0aW1lem9uZVxyXG4gIC8vIEphdmFTY3JpcHQgRGF0ZSBubyBzb3BvcnRhIHRpbWV6b25lIGVuIGNvbnN0cnVjdG9yLCBhc8OtIHF1ZSB1c2Ftb3Mgb3RybyBlbmZvcXVlXHJcbiAgXHJcbiAgLy8gQ2FsY3VsYXIgcXXDqSBob3JhIFVUQyBjb3JyZXNwb25kZSBhIG1lZGlhbm9jaGUgZW4gRXVyb3BhIENlbnRyYWxcclxuICAvLyBQYXJhIGVzdG8sIGNyZWFtb3MgdW5hIGZlY2hhIFwidGVzdFwiIGVuIG1lZGlhbm9jaGUgRXVyb3BhIENlbnRyYWxcclxuICBjb25zdCB0ZXN0Rm9ybWF0dGVyID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQoJ2VuLVVTJywge1xyXG4gICAgdGltZVpvbmU6ICdFdXJvcGUvQmVybGluJyxcclxuICAgIHllYXI6ICdudW1lcmljJyxcclxuICAgIG1vbnRoOiAnMi1kaWdpdCcsXHJcbiAgICBkYXk6ICcyLWRpZ2l0JyxcclxuICAgIGhvdXI6ICcyLWRpZ2l0JyxcclxuICAgIG1pbnV0ZTogJzItZGlnaXQnLFxyXG4gICAgc2Vjb25kOiAnMi1kaWdpdCcsXHJcbiAgICBob3VyMTI6IGZhbHNlXHJcbiAgfSk7XHJcbiAgXHJcbiAgLy8gT2J0ZW5lciBob3JhIGFjdHVhbCBlbiBFdXJvcGEgQ2VudHJhbFxyXG4gIGNvbnN0IHBhcnRzID0gdGVzdEZvcm1hdHRlci5mb3JtYXRUb1BhcnRzKG5vdyk7XHJcbiAgY29uc3QgZXVyb3BlUGFydHM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcclxuICBwYXJ0cy5mb3JFYWNoKHBhcnQgPT4ge1xyXG4gICAgaWYgKHBhcnQudHlwZSAhPT0gJ2xpdGVyYWwnKSB7XHJcbiAgICAgIGV1cm9wZVBhcnRzW3BhcnQudHlwZV0gPSBwYXJ0LnZhbHVlO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIFxyXG4gIC8vIENyZWFyIGZlY2hhIElTTyBzdHJpbmcgcGFyYSBtZWRpYW5vY2hlIEV1cm9wYSBDZW50cmFsXHJcbiAgY29uc3QgZXVyb3BlTWlkbmlnaHRJU08gPSBgJHtldXJvcGVQYXJ0cy55ZWFyfS0ke2V1cm9wZVBhcnRzLm1vbnRofS0ke2V1cm9wZVBhcnRzLmRheX1UMDA6MDA6MDBgO1xyXG4gIFxyXG4gIC8vIEFob3JhIG5lY2VzaXRhbW9zIGNvbnZlcnRpciBlc3RvIGEgaG9yYSBDb2xvbWJpYVxyXG4gIC8vIFBhcmEgZXN0bywgdXNhbW9zIGVsIGhlY2hvIGRlIHF1ZSBKYXZhU2NyaXB0IERhdGUgdHJhYmFqYSBlbiBVVENcclxuICAvLyBQZXJvIHBvZGVtb3MgdXNhciB1bmEgZmVjaGEgXCJmYWxzYVwiIHkgbHVlZ28gY2FsY3VsYXIgbGEgZGlmZXJlbmNpYVxyXG4gIFxyXG4gIC8vIE3DqXRvZG8gbcOhcyBkaXJlY3RvOiB1c2FyIGxhIEFQSSBkZSB0aWVtcG8gcGFyYSBvYnRlbmVyIG9mZnNldFxyXG4gIC8vIENyZWFyIHVuIERhdGUgcGFyYSBtZWRpYW5vY2hlIGVuIEV1cm9wYSBDZW50cmFsXHJcbiAgY29uc3QgZXVyb3BlWWVhciA9IHBhcnNlSW50KGV1cm9wZVBhcnRzLnllYXIpO1xyXG4gIGNvbnN0IGV1cm9wZU1vbnRoID0gcGFyc2VJbnQoZXVyb3BlUGFydHMubW9udGgpIC0gMTsgLy8gMC1iYXNlZFxyXG4gIGNvbnN0IGV1cm9wZURheSA9IHBhcnNlSW50KGV1cm9wZVBhcnRzLmRheSk7XHJcbiAgXHJcbiAgLy8gQ3JlYXIgRGF0ZSBlbiBVVEMgcXVlIHJlcHJlc2VudGUgbWVkaWFub2NoZSBlbiBFdXJvcGEgQ2VudHJhbFxyXG4gIC8vIE5lY2VzaXRhbW9zIHNhYmVyIGVsIG9mZnNldCBkZSBFdXJvcGEgQ2VudHJhbCBlbiBlc2UgbW9tZW50b1xyXG4gIGNvbnN0IHRlc3REYXRlVVRDID0gbmV3IERhdGUoRGF0ZS5VVEMoZXVyb3BlWWVhciwgZXVyb3BlTW9udGgsIGV1cm9wZURheSwgMCwgMCwgMCkpO1xyXG4gIFxyXG4gIC8vIENhbGN1bGFyIG9mZnNldCBkZSBFdXJvcGEgQ2VudHJhbCBlbiBlc2UgbW9tZW50b1xyXG4gIGNvbnN0IGV1cm9wZU9mZnNldCA9IGdldEV1cm9wZUNlbnRyYWxPZmZzZXQodGVzdERhdGVVVEMpOyAvLyBIb3JhcyBkZXNkZSBVVENcclxuICBjb25zdCBldXJvcGVNaWRuaWdodFVUQyA9IG5ldyBEYXRlKERhdGUuVVRDKGV1cm9wZVllYXIsIGV1cm9wZU1vbnRoLCBldXJvcGVEYXksIC1ldXJvcGVPZmZzZXQsIDAsIDApKTtcclxuICBcclxuICAvLyBDb2xvbWJpYSBlcyBVVEMtNSwgYXPDrSBxdWUgcmVzdGFtb3MgNSBob3Jhc1xyXG4gIGNvbnN0IGNvbG9tYmlhTWlkbmlnaHQgPSBuZXcgRGF0ZShldXJvcGVNaWRuaWdodFVUQy5nZXRUaW1lKCkgLSAoNSAqIDM2MDAwMDApKTtcclxuICBcclxuICAvLyBGb3JtYXRlYXIgcmVzdWx0YWRvXHJcbiAgY29uc3QgY29sb21iaWFEYXRlID0gY29sb21iaWFNaWRuaWdodC50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLUNBJywge1xyXG4gICAgdGltZVpvbmU6ICdBbWVyaWNhL0JvZ290YSdcclxuICB9KTtcclxuICBjb25zdCBjb2xvbWJpYVRpbWUgPSBjb2xvbWJpYU1pZG5pZ2h0LnRvTG9jYWxlVGltZVN0cmluZygnZW4tVVMnLCB7XHJcbiAgICB0aW1lWm9uZTogJ0FtZXJpY2EvQm9nb3RhJyxcclxuICAgIGhvdXIxMjogZmFsc2UsXHJcbiAgICBob3VyOiAnMi1kaWdpdCcsXHJcbiAgICBtaW51dGU6ICcyLWRpZ2l0JyxcclxuICAgIHNlY29uZDogJzItZGlnaXQnXHJcbiAgfSk7XHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIGNvbG9tYmlhVGltZTogY29sb21iaWFUaW1lIHx8ICcwMDowMDowMCcsXHJcbiAgICBjb2xvbWJpYURhdGUsXHJcbiAgICBjb2xvbWJpYURhdGVUaW1lOiBjb2xvbWJpYU1pZG5pZ2h0LFxyXG4gICAgZXVyb3BlRGF0ZTogZXVyb3BlRGF0ZVN0clxyXG4gIH07XHJcbn07XHJcblxyXG4vKipcclxuICogT2J0aWVuZSBlbCBvZmZzZXQgZGUgRXVyb3BhIENlbnRyYWwgZW4gaG9yYXMgKGNvbnNpZGVyYSBEU1QpXHJcbiAqIEBwYXJhbSBkYXRlIC0gRmVjaGEgZGUgcmVmZXJlbmNpYVxyXG4gKiBAcmV0dXJucyBPZmZzZXQgZW4gaG9yYXMgKDEgcGFyYSBpbnZpZXJubywgMiBwYXJhIHZlcmFubylcclxuICovXHJcbmZ1bmN0aW9uIGdldEV1cm9wZUNlbnRyYWxPZmZzZXQoZGF0ZTogRGF0ZSk6IG51bWJlciB7XHJcbiAgLy8gT2J0ZW5lciBsYSBob3JhIFVUQyB5IGxhIGhvcmEgZW4gRXVyb3BhIENlbnRyYWwgcGFyYSBsYSBtaXNtYSBmZWNoYVxyXG4gIGNvbnN0IHV0Y0hvdXIgPSBkYXRlLmdldFVUQ0hvdXJzKCk7XHJcbiAgXHJcbiAgLy8gQ3JlYXIgZm9ybWF0dGVyIHBhcmEgRXVyb3BhIENlbnRyYWxcclxuICBjb25zdCBmb3JtYXR0ZXIgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdCgnZW4tVVMnLCB7XHJcbiAgICB0aW1lWm9uZTogJ0V1cm9wZS9CZXJsaW4nLFxyXG4gICAgaG91cjogJzItZGlnaXQnLFxyXG4gICAgaG91cjEyOiBmYWxzZVxyXG4gIH0pO1xyXG4gIFxyXG4gIGNvbnN0IGV1cm9wZUhvdXIgPSBwYXJzZUludChmb3JtYXR0ZXIuZm9ybWF0KGRhdGUpKTtcclxuICBcclxuICAvLyBDYWxjdWxhciBkaWZlcmVuY2lhIChjb25zaWRlcmFuZG8gcXVlIHB1ZWRlIGNydXphciBtZWRpYW5vY2hlKVxyXG4gIGxldCBvZmZzZXQgPSBldXJvcGVIb3VyIC0gdXRjSG91cjtcclxuICBpZiAob2Zmc2V0ID4gMTIpIG9mZnNldCAtPSAyNDtcclxuICBpZiAob2Zmc2V0IDwgLTEyKSBvZmZzZXQgKz0gMjQ7XHJcbiAgXHJcbiAgcmV0dXJuIG9mZnNldDtcclxufVxyXG5cclxuLyoqXHJcbiAqIE9idGllbmUgbWVkaWFub2NoZSBDb2xvbWJpYSAoMDA6MDA6MDApXHJcbiAqIEBwYXJhbSBkYXRlIC0gRmVjaGEgZGUgcmVmZXJlbmNpYSAob3BjaW9uYWwpXHJcbiAqIEByZXR1cm5zIEZlY2hhL2hvcmEgZGUgbWVkaWFub2NoZSBlbiBDb2xvbWJpYVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGdldENvbG9tYmlhTWlkbmlnaHQgPSAoZGF0ZT86IERhdGUpOiB7XHJcbiAgZGF0ZTogc3RyaW5nOyAvLyBZWVlZLU1NLUREXHJcbiAgZGF0ZXRpbWU6IERhdGU7XHJcbiAgdGltZTogc3RyaW5nOyAvLyBISDpNTTpTU1xyXG59ID0+IHtcclxuICBjb25zdCBub3cgPSBkYXRlIHx8IG5ldyBEYXRlKCk7XHJcbiAgY29uc3QgY29sb21iaWFEYXRlID0gZ2V0Q29sb21iaWFEYXRlKCk7XHJcbiAgY29uc3QgbWlkbmlnaHQgPSBuZXcgRGF0ZShgJHtjb2xvbWJpYURhdGV9VDAwOjAwOjAwYCk7XHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIGRhdGU6IGNvbG9tYmlhRGF0ZSxcclxuICAgIGRhdGV0aW1lOiBtaWRuaWdodCxcclxuICAgIHRpbWU6ICcwMDowMDowMCdcclxuICB9O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFZlcmlmaWNhIHNpIGVzIG1vbWVudG8gZGUgY29uZ2VsYXIgcGxhdGFmb3JtYXMgZXNwZWNpYWxlc1xyXG4gKiAobWVkaWFub2NoZSBFdXJvcGEgQ2VudHJhbClcclxuICogQHJldHVybnMgdHJ1ZSBzaSBlcyBtb21lbnRvIGRlIGNvbmdlbGFjacOzbiBhbnRpY2lwYWRhXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgaXNFYXJseUZyZWV6ZVRpbWUgPSAoKTogYm9vbGVhbiA9PiB7XHJcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcclxuICBjb25zdCBjb2xvbWJpYVRpbWUgPSBnZXRDb2xvbWJpYURhdGVUaW1lKCk7XHJcbiAgY29uc3QgZXVyb3BlTWlkbmlnaHQgPSBnZXRFdXJvcGVhbkNlbnRyYWxNaWRuaWdodEluQ29sb21iaWEobm93KTtcclxuICBcclxuICAvLyBDb21wYXJhciBob3JhIGFjdHVhbCBDb2xvbWJpYSBjb24gaG9yYSBkZSBtZWRpYW5vY2hlIEV1cm9wYSBDZW50cmFsIGVuIENvbG9tYmlhXHJcbiAgY29uc3QgW2N1cnJlbnRIb3VyLCBjdXJyZW50TWludXRlXSA9IGNvbG9tYmlhVGltZS5zcGxpdCgnICcpWzFdPy5zcGxpdCgnOicpIHx8IFsnMDAnLCAnMDAnXTtcclxuICBjb25zdCBbdGFyZ2V0SG91ciwgdGFyZ2V0TWludXRlXSA9IGV1cm9wZU1pZG5pZ2h0LmNvbG9tYmlhVGltZS5zcGxpdCgnOicpO1xyXG4gIFxyXG4gIGNvbnN0IGN1cnJlbnRUaW1lID0gcGFyc2VJbnQoY3VycmVudEhvdXIpICogNjAgKyBwYXJzZUludChjdXJyZW50TWludXRlKTtcclxuICBjb25zdCB0YXJnZXRUaW1lID0gcGFyc2VJbnQodGFyZ2V0SG91cikgKiA2MCArIHBhcnNlSW50KHRhcmdldE1pbnV0ZSk7XHJcbiAgXHJcbiAgLy8gVG9sZXJhbmNpYSBkZSDCsTUgbWludXRvc1xyXG4gIGNvbnN0IHRvbGVyYW5jZSA9IDU7XHJcbiAgcmV0dXJuIE1hdGguYWJzKGN1cnJlbnRUaW1lIC0gdGFyZ2V0VGltZSkgPD0gdG9sZXJhbmNlO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFZlcmlmaWNhIHNpIGVzIG1vbWVudG8gZGUgY2llcnJlIGNvbXBsZXRvICgwMDowMCBDb2xvbWJpYSlcclxuICogQHJldHVybnMgdHJ1ZSBzaSBlcyBtZWRpYW5vY2hlIGVuIENvbG9tYmlhXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgaXNGdWxsQ2xvc3VyZVRpbWUgPSAoKTogYm9vbGVhbiA9PiB7XHJcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcclxuICBjb25zdCBjb2xvbWJpYVRpbWUgPSBnZXRDb2xvbWJpYURhdGVUaW1lKCk7XHJcbiAgY29uc3QgW2hvdXIsIG1pbnV0ZSwgc2Vjb25kXSA9IGNvbG9tYmlhVGltZS5zcGxpdCgnICcpWzFdPy5zcGxpdCgnOicpIHx8IFsnMDAnLCAnMDAnLCAnMDAnXTtcclxuICBcclxuICAvLyBWZXJpZmljYXIgc2kgZXMgbWVkaWFub2NoZSAoMDA6MDA6MDApIGNvbiB0b2xlcmFuY2lhIGRlIMKxMSBtaW51dG9cclxuICBjb25zdCBpc01pZG5pZ2h0ID0gcGFyc2VJbnQoaG91cikgPT09IDAgJiYgcGFyc2VJbnQobWludXRlKSA8PSAxO1xyXG4gIFxyXG4gIHJldHVybiBpc01pZG5pZ2h0O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIExpc3RhIGRlIDEwIHBsYXRhZm9ybWFzIGVzcGVjaWFsZXMgcXVlIHNlIGNvbmdlbGFuIGEgbWVkaWFub2NoZSBFdXJvcGEgQ2VudHJhbFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IEVBUkxZX0ZSRUVaRV9QTEFURk9STVMgPSBbXHJcbiAgJ3N1cGVyZm9vbicsXHJcbiAgJ2xpdmVjcmVhdG9yJyxcclxuICAnbWRoJyxcclxuICAnNzc3JyxcclxuICAneG1vZGVscycsXHJcbiAgJ2JpZzcnLFxyXG4gICdtb25kbycsXHJcbiAgJ3Z4JyxcclxuICAnYmFiZXN0YXRpb24nLFxyXG4gICdkaXJ0eWZhbnMnXHJcbl0gYXMgY29uc3Q7XHJcblxyXG4vKipcclxuICogVmVyaWZpY2Egc2kgdW5hIHBsYXRhZm9ybWEgZXMgZXNwZWNpYWwgKHNlIGNvbmdlbGEgYW50aWNpcGFkYW1lbnRlKVxyXG4gKiBAcGFyYW0gcGxhdGZvcm1JZCAtIElEIGRlIGxhIHBsYXRhZm9ybWFcclxuICogQHJldHVybnMgdHJ1ZSBzaSBlcyBwbGF0YWZvcm1hIGVzcGVjaWFsXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgaXNFYXJseUZyZWV6ZVBsYXRmb3JtID0gKHBsYXRmb3JtSWQ6IHN0cmluZyk6IGJvb2xlYW4gPT4ge1xyXG4gIHJldHVybiBFQVJMWV9GUkVFWkVfUExBVEZPUk1TLmluY2x1ZGVzKHBsYXRmb3JtSWQudG9Mb3dlckNhc2UoKSBhcyBhbnkpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIE9idGllbmUgZWwgcGVyw61vZG8gYWN0dWFsIGJhc2FkbyBlbiBlbCBkw61hXHJcbiAqIEByZXR1cm5zIFBlcsOtb2RvOiAnMS0xNScgbyAnMTYtMzEnXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZ2V0Q3VycmVudFBlcmlvZFR5cGUgPSAoKTogJzEtMTUnIHwgJzE2LTMxJyA9PiB7XHJcbiAgY29uc3QgY29sb21iaWFEYXRlID0gZ2V0Q29sb21iaWFEYXRlKCk7XHJcbiAgY29uc3QgZGF5ID0gcGFyc2VJbnQoY29sb21iaWFEYXRlLnNwbGl0KCctJylbMl0pO1xyXG4gIFxyXG4gIHJldHVybiBkYXkgPj0gMSAmJiBkYXkgPD0gMTUgPyAnMS0xNScgOiAnMTYtMzEnO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFZlcmlmaWNhIHNpIGVzIGTDrWEgZGUgY2llcnJlIChkw61hIDEgbyAxNilcclxuICogQHJldHVybnMgdHJ1ZSBzaSBlcyBkw61hIGRlIGNpZXJyZVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGlzQ2xvc3VyZURheSA9ICgpOiBib29sZWFuID0+IHtcclxuICBjb25zdCBjb2xvbWJpYURhdGUgPSBnZXRDb2xvbWJpYURhdGUoKTtcclxuICBjb25zdCBkYXkgPSBwYXJzZUludChjb2xvbWJpYURhdGUuc3BsaXQoJy0nKVsyXSk7XHJcbiAgXHJcbiAgcmV0dXJuIGRheSA9PT0gMSB8fCBkYXkgPT09IDE2O1xyXG59O1xyXG5cclxuIl0sIm5hbWVzIjpbImdldENvbG9tYmlhRGF0ZSIsIkRhdGUiLCJ0b0xvY2FsZURhdGVTdHJpbmciLCJ0aW1lWm9uZSIsImdldENvbG9tYmlhRGF0ZVRpbWUiLCJ0b0xvY2FsZVN0cmluZyIsImdldEV1cm9wZWFuQ2VudHJhbE1pZG5pZ2h0SW5Db2xvbWJpYSIsImRhdGUiLCJub3ciLCJldXJvcGVEYXRlRm9ybWF0dGVyIiwiSW50bCIsIkRhdGVUaW1lRm9ybWF0IiwieWVhciIsIm1vbnRoIiwiZGF5IiwiZXVyb3BlRGF0ZVN0ciIsImZvcm1hdCIsInRlc3RGb3JtYXR0ZXIiLCJob3VyIiwibWludXRlIiwic2Vjb25kIiwiaG91cjEyIiwicGFydHMiLCJmb3JtYXRUb1BhcnRzIiwiZXVyb3BlUGFydHMiLCJmb3JFYWNoIiwicGFydCIsInR5cGUiLCJ2YWx1ZSIsImV1cm9wZU1pZG5pZ2h0SVNPIiwiZXVyb3BlWWVhciIsInBhcnNlSW50IiwiZXVyb3BlTW9udGgiLCJldXJvcGVEYXkiLCJ0ZXN0RGF0ZVVUQyIsIlVUQyIsImV1cm9wZU9mZnNldCIsImdldEV1cm9wZUNlbnRyYWxPZmZzZXQiLCJldXJvcGVNaWRuaWdodFVUQyIsImNvbG9tYmlhTWlkbmlnaHQiLCJnZXRUaW1lIiwiY29sb21iaWFEYXRlIiwiY29sb21iaWFUaW1lIiwidG9Mb2NhbGVUaW1lU3RyaW5nIiwiY29sb21iaWFEYXRlVGltZSIsImV1cm9wZURhdGUiLCJ1dGNIb3VyIiwiZ2V0VVRDSG91cnMiLCJmb3JtYXR0ZXIiLCJldXJvcGVIb3VyIiwib2Zmc2V0IiwiZ2V0Q29sb21iaWFNaWRuaWdodCIsIm1pZG5pZ2h0IiwiZGF0ZXRpbWUiLCJ0aW1lIiwiaXNFYXJseUZyZWV6ZVRpbWUiLCJldXJvcGVNaWRuaWdodCIsImN1cnJlbnRIb3VyIiwiY3VycmVudE1pbnV0ZSIsInNwbGl0IiwidGFyZ2V0SG91ciIsInRhcmdldE1pbnV0ZSIsImN1cnJlbnRUaW1lIiwidGFyZ2V0VGltZSIsInRvbGVyYW5jZSIsIk1hdGgiLCJhYnMiLCJpc0Z1bGxDbG9zdXJlVGltZSIsImlzTWlkbmlnaHQiLCJFQVJMWV9GUkVFWkVfUExBVEZPUk1TIiwiaXNFYXJseUZyZWV6ZVBsYXRmb3JtIiwicGxhdGZvcm1JZCIsImluY2x1ZGVzIiwidG9Mb3dlckNhc2UiLCJnZXRDdXJyZW50UGVyaW9kVHlwZSIsImlzQ2xvc3VyZURheSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./utils/period-closure-dates.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/next","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute&page=%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcalculator%2Fperiod-closure%2Fclose-period%2Froute.ts&appDir=C%3A%5CUsers%5Ccamca%5COneDrive%5CDocumentos%5CGitHub%5Ciam-sistema-de-gestion%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Ccamca%5COneDrive%5CDocumentos%5CGitHub%5Ciam-sistema-de-gestion&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();