"use strict";(()=>{var e={};e.id=5698,e.ids=[5698],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},88422:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>f,originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>h});var t={};o.r(t),o.d(t,{POST:()=>d});var a=o(95419),s=o(69108),n=o(99678),i=o(78070);let c=(0,o(72964).createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function d(e){try{let{platformId:r,modelId:o}=await e.json();if(!r||!o)return i.Z.json({success:!1,error:"platformId y modelId son requeridos"},{status:400});let{data:t,error:a}=await c.from("modelo_plataformas").select("*").eq("model_id",o).eq("platform_id",r).single();if(a||!t)return i.Z.json({success:!1,error:"Plataforma no encontrada"},{status:404});if("entregada"!==t.status)return i.Z.json({success:!1,error:"Solo se pueden confirmar plataformas en estado entregada"},{status:400});let{data:s,error:n}=await c.from("modelo_plataformas").update({status:"confirmada",confirmed_at:new Date().toISOString(),confirmed_by:o,updated_at:new Date().toISOString()}).eq("model_id",o).eq("platform_id",r).select().single();if(n)return console.error("Error actualizando plataforma:",n),i.Z.json({success:!1,error:"Error al confirmar la plataforma"},{status:500});try{await fetch("/api/chat/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"platform_confirmed",modelId:o,platformId:r,message:`Modelo confirm\xf3 recepci\xf3n de plataforma ${t.platform_name}`})})}catch(e){console.warn("Error enviando notificaci\xf3n:",e)}return i.Z.json({success:!0,data:s,message:"Plataforma confirmada correctamente"})}catch(e){return console.error("Error en confirmaci\xf3n de plataforma:",e),i.Z.json({success:!1,error:e.message||"Error interno del servidor"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/modelo-portafolio/confirm/route",pathname:"/api/modelo-portafolio/confirm",filename:"route",bundlePath:"app/api/modelo-portafolio/confirm/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\modelo-portafolio\\confirm\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:m,staticGenerationAsyncStorage:u,serverHooks:p,headerHooks:f,staticGenerationBailout:h}=l,g="/api/modelo-portafolio/confirm/route";function x(){return(0,n.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:u})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[1638,6206,2964],()=>o(88422));module.exports=t})();