"use strict";(()=>{var e={};e.id=3186,e.ids=[3186],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},52227:(e,r,a)=>{a.r(r),a.d(r,{headerHooks:()=>E,originalPathname:()=>x,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>v});var t={};a.r(t),a.d(t,{POST:()=>l,maxDuration:()=>d,runtime:()=>p});var o=a(95419),s=a(69108),n=a(99678),i=a(78070),u=a(72964);let m=process.env.SUPABASE_SERVICE_ROLE_KEY,p="nodejs",d=30;async function l(e){try{let r=e.headers.get("authorization");if(!r)return i.Z.json({error:"No autorizado"},{status:401});let a=(0,u.createClient)("https://mhernfrkvwigxdubiozm.supabase.co",m),t=r.replace("Bearer ",""),{data:{user:o},error:s}=await a.auth.getUser(t);if(s||!o)return i.Z.json({error:"Usuario no autenticado"},{status:401});let{data:n}=await a.from("users").select("role").eq("id",o.id).single();if(!n||!["super_admin","admin"].includes(n.role))return i.Z.json({error:"No tienes permisos para subir im\xe1genes"},{status:403});let p=(await e.formData()).get("file");if(!p)return i.Z.json({error:"No se proporcion\xf3 ning\xfan archivo"},{status:400});if(!["image/jpeg","image/png","image/gif","image/webp"].includes(p.type))return i.Z.json({error:"Tipo de archivo no permitido"},{status:400});if(p.size>4194304)return i.Z.json({error:"El archivo es demasiado grande. El l\xedmite m\xe1ximo es 4MB. Por favor, comprime la imagen o usa una imagen m\xe1s peque\xf1a."},{status:400});let d=p.name.split(".").pop(),l=`${o.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${d}`,c=await p.arrayBuffer(),g=Buffer.from(c),{data:f,error:h}=await a.storage.from("announcement-images").upload(l,g,{contentType:p.type,upsert:!1});if(h)return console.error("❌ [ANNOUNCEMENTS-UPLOAD] Error subiendo imagen:",h),i.Z.json({error:h.message},{status:500});let{data:{publicUrl:E}}=a.storage.from("announcement-images").getPublicUrl(l);return i.Z.json({success:!0,url:E,fileName:l})}catch(e){if(console.error("❌ [ANNOUNCEMENTS-UPLOAD] Error en POST:",e),e.message?.includes("413")||e.message?.includes("Request Entity Too Large"))return i.Z.json({error:"El archivo es demasiado grande. El l\xedmite m\xe1ximo es 4MB. Por favor, comprime la imagen o usa una imagen m\xe1s peque\xf1a."},{status:413});return i.Z.json({error:e.message||"Error interno"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/announcements/upload-image/route",pathname:"/api/announcements/upload-image",filename:"route",bundlePath:"app/api/announcements/upload-image/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\announcements\\upload-image\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:h,headerHooks:E,staticGenerationBailout:v}=c,x="/api/announcements/upload-image/route";function j(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[1638,6206,2964],()=>a(52227));module.exports=t})();