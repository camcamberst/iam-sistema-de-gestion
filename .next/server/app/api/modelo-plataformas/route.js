"use strict";(()=>{var e={};e.id=6311,e.ids=[6311],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},4015:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>g,originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>f,routeModule:()=>c,serverHooks:()=>E,staticGenerationAsyncStorage:()=>_,staticGenerationBailout:()=>j});var t={};o.r(t),o.d(t,{DELETE:()=>p,GET:()=>l,POST:()=>u,PUT:()=>m});var a=o(95419),s=o(69108),n=o(99678),i=o(78070);let d=(0,o(72964).createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"");async function l(e){try{if(!process.env.SUPABASE_SERVICE_ROLE_KEY)return i.Z.json({error:"Configuraci\xf3n de base de datos no disponible"},{status:503});let{searchParams:r}=new URL(e.url),o=r.get("model_id"),t=r.get("group_id"),a=r.get("room_id"),s=r.get("jornada"),n=r.get("platform_id"),l=r.get("status"),u=d.from("modelo_plataformas_detailed").select("*");if(o&&(u=u.eq("model_id",o)),t&&(u=u.eq("group_id",t)),n&&(u=u.eq("platform_id",n)),l&&(u=u.eq("status",l)),a||s){let{data:e}=await d.from("room_assignments_detailed").select("model_id").eq(a?"room_id":"id",a||"").eq(s?"jornada":"id",s||"");if(e&&e.length>0){let r=e.map(e=>e.model_id);u=u.in("model_id",r)}}if(!o){let{data:e}=await d.from("users").select("id").eq("role","modelo"),r=(e||[]).map(e=>e.id);if(!(r.length>0))return i.Z.json([]);u=u.in("model_id",r)}let{data:m,error:p}=await u.order("model_name",{ascending:!0});if(p)return console.error("Error fetching modelo plataformas:",p),i.Z.json({error:p.message},{status:500});return i.Z.json(m||[])}catch(e){return console.error("Error in GET /api/modelo-plataformas:",e),i.Z.json({error:"Error interno del servidor"},{status:500})}}async function u(e){try{if(!process.env.SUPABASE_SERVICE_ROLE_KEY)return i.Z.json({error:"Configuraci\xf3n de base de datos no disponible"},{status:503});let{model_id:r,platform_id:o,new_status:t,changed_by:a,reason:s,notes:n}=await e.json();if(!r||!o||!t||!a)return i.Z.json({error:"Faltan campos requeridos: model_id, platform_id, new_status, changed_by"},{status:400});if(!["disponible","solicitada","pendiente","entregada","desactivada","inviable"].includes(t))return i.Z.json({error:"Estado inv\xe1lido"},{status:400});let{data:l,error:u}=await d.rpc("change_platform_status",{p_model_id:r,p_platform_id:o,p_new_status:t,p_changed_by:a,p_reason:s||n||null});if(u)return console.error("Error changing platform status:",u),i.Z.json({error:u.message},{status:500});return i.Z.json({success:!0,message:`Estado cambiado a ${t}`})}catch(e){return console.error("Error in POST /api/modelo-plataformas:",e),i.Z.json({error:"Error interno del servidor"},{status:500})}}async function m(e){try{if(!process.env.SUPABASE_SERVICE_ROLE_KEY)return i.Z.json({error:"Configuraci\xf3n de base de datos no disponible"},{status:503});let{id:r,notes:o,revert_reason:t}=await e.json();if(!r)return i.Z.json({error:"ID de plataforma requerido"},{status:400});let a={};void 0!==o&&(a.notes=o),void 0!==t&&(a.revert_reason=t);let{data:s,error:n}=await d.from("modelo_plataformas").update(a).eq("id",r).select();if(n)return console.error("Error updating modelo plataforma:",n),i.Z.json({error:n.message},{status:500});return i.Z.json({success:!0,data:s?.[0]})}catch(e){return console.error("Error in PUT /api/modelo-plataformas:",e),i.Z.json({error:"Error interno del servidor"},{status:500})}}async function p(e){try{if(!process.env.SUPABASE_SERVICE_ROLE_KEY)return i.Z.json({error:"Configuraci\xf3n de base de datos no disponible"},{status:503});let{searchParams:r}=new URL(e.url),o=r.get("id");if(!o)return i.Z.json({error:"ID de plataforma requerido"},{status:400});let{error:t}=await d.from("modelo_plataformas").delete().eq("id",o);if(t)return console.error("Error deleting modelo plataforma:",t),i.Z.json({error:t.message},{status:500});return i.Z.json({success:!0,message:"Plataforma eliminada"})}catch(e){return console.error("Error in DELETE /api/modelo-plataformas:",e),i.Z.json({error:"Error interno del servidor"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/modelo-plataformas/route",pathname:"/api/modelo-plataformas",filename:"route",bundlePath:"app/api/modelo-plataformas/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\modelo-plataformas\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:f,staticGenerationAsyncStorage:_,serverHooks:E,headerHooks:g,staticGenerationBailout:j}=c,v="/api/modelo-plataformas/route";function h(){return(0,n.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:_})}}};var r=require("../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[1638,6206,2964],()=>o(4015));module.exports=t})();