"use strict";(()=>{var e={};e.id=8036,e.ids=[8036],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},67237:(e,r,a)=>{a.r(r),a.d(r,{headerHooks:()=>f,originalPathname:()=>h,patchFetch:()=>E,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>_,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>g});var t={};a.r(t),a.d(t,{GET:()=>d,PUT:()=>u});var o=a(95419),s=a(69108),n=a(99678),l=a(78070);let i=(0,a(72964).createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"");async function d(e,{params:r}){try{if(!process.env.SUPABASE_SERVICE_ROLE_KEY)return l.Z.json({error:"Configuraci\xf3n de base de datos no disponible"},{status:503});let{modelId:e}=r;if(!e)return l.Z.json({error:"ID de modelo requerido"},{status:400});let{data:a,error:t}=await i.from("users").select("role").eq("id",e).single();if(t||!a||"modelo"!==a.role)return l.Z.json([]);let{data:o,error:s}=await i.from("modelo_plataformas_detailed").select("*").eq("model_id",e).order("platform_name",{ascending:!0});if(s)return console.error("Error fetching existing platforms:",s),l.Z.json({error:s.message},{status:500});let{data:n,error:d}=await i.from("calculator_platforms").select("id, name").order("name",{ascending:!0});if(d)return console.error("Error fetching catalog platforms:",d),l.Z.json({error:d.message},{status:500});let u=new Map(o?.map(e=>[e.platform_id,e])||[]),m=n?.map(r=>u.get(r.id)||{id:null,model_id:e,platform_id:r.id,platform_name:r.name,platform_code:r.id,status:"disponible",requested_at:null,delivered_at:null,confirmed_at:null,deactivated_at:null,reverted_at:null,requested_by_name:null,delivered_by_name:null,confirmed_by_name:null,deactivated_by_name:null,reverted_by_name:null,notes:null,revert_reason:null,is_initial_config:!1,calculator_sync:!1,calculator_activated_at:null,created_at:null,updated_at:null})||[];return l.Z.json(m)}catch(e){return console.error("Error in GET /api/modelo-plataformas/[modelId]:",e),l.Z.json({error:"Error interno del servidor"},{status:500})}}async function u(e,{params:r}){try{if(!process.env.SUPABASE_SERVICE_ROLE_KEY)return l.Z.json({error:"Configuraci\xf3n de base de datos no disponible"},{status:503});let{modelId:a}=r,{platforms:t,changed_by:o}=await e.json();if(!a||!t||!Array.isArray(t)||!o)return l.Z.json({error:"Faltan campos requeridos: modelId, platforms (array), changed_by"},{status:400});let s=[],n=[];for(let e of t){let{platform_id:r,new_status:t,reason:l}=e;if(!r||!t){n.push(`Plataforma ${r}: faltan campos requeridos`);continue}try{let{data:e,error:d}=await i.rpc("change_platform_status",{p_model_id:a,p_platform_id:r,p_new_status:t,p_changed_by:o,p_reason:l||null});d?n.push(`Plataforma ${r}: ${d.message}`):s.push({platform_id:r,status:t,success:!0})}catch(e){n.push(`Plataforma ${r}: Error inesperado`)}}return l.Z.json({success:0===n.length,results:s,errors:n,message:`Procesadas ${s.length} plataformas${n.length>0?` con ${n.length} errores`:""}`})}catch(e){return console.error("Error in PUT /api/modelo-plataformas/[modelId]:",e),l.Z.json({error:"Error interno del servidor"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/modelo-plataformas/[modelId]/route",pathname:"/api/modelo-plataformas/[modelId]",filename:"route",bundlePath:"app/api/modelo-plataformas/[modelId]/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\modelo-plataformas\\[modelId]\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:_,headerHooks:f,staticGenerationBailout:g}=m,h="/api/modelo-plataformas/[modelId]/route";function E(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:c})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[1638,6206,2964],()=>a(67237));module.exports=t})();