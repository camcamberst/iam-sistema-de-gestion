"use strict";(()=>{var e={};e.id=8424,e.ids=[8424],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},83796:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>_,originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>u,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>c});var i={};t.r(i),t.d(i,{POST:()=>d});var a=t(95419),o=t(69108),s=t(99678),n=t(78070);let l=(0,t(72964).createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function d(e){try{if(!process.env.SUPABASE_SERVICE_ROLE_KEY)return n.Z.json({error:"Configuraci\xf3n de base de datos no disponible"},{status:500});let{userRole:r,userGroups:t,userId:i}=await e.json(),a=null;if(i){let{data:e,error:r}=await l.from("users").select("id, role, affiliate_studio_id").eq("id",i).single();!r&&e&&(a={id:e.id,role:e.role,affiliate_studio_id:e.affiliate_studio_id||null})}let o=null;if(a&&("superadmin_aff"===a.role||"admin"===a.role&&a.affiliate_studio_id)){if(!a.affiliate_studio_id)return n.Z.json({requests:[]});{let{data:e,error:r}=await l.from("users").select("id").eq("affiliate_studio_id",a.affiliate_studio_id).eq("role","modelo");if(r)return console.error("Error al obtener IDs de modelos:",r),n.Z.json({error:"Error al filtrar modelos"},{status:500});if(o=e?.map(e=>e.id)||[],0===o.length)return n.Z.json({requests:[]})}}if("admin"===r&&t&&t.length>0&&a&&"admin"===a.role&&!a.affiliate_studio_id){let{data:e,error:r}=await l.from("groups").select("id").in("name",t);if(!r&&e){let r=e.map(e=>e.id);if(r.length>0){let{data:e,error:t}=await l.from("user_groups").select("user_id").in("group_id",r);if(!t&&e&&(o=e.map(e=>e.user_id),0===o.length))return n.Z.json({requests:[]})}}}let s=l.from("modelo_plataformas_detailed").select(`
        id,
        model_id,
        model_email,
        platform_name,
        status,
        requested_at,
        delivered_at,
        confirmed_at,
        deactivated_at,
        reverted_at,
        updated_at,
        notes,
        group_name
      `).in("status",["solicitada","pendiente","entregada","inviable"]).is("closed_at",null).not("is_initial_config","eq",!0).not("requested_at","is",null).order("requested_at",{ascending:!1});o&&o.length>0&&(s=s.in("model_id",o));let{data:d,error:u}=await s;if(u)return console.error("Error fetching timeline data:",u),n.Z.json({error:"Error al obtener datos del timeline"},{status:500});return n.Z.json({requests:d||[]})}catch(e){return console.error("Timeline API error:",e),n.Z.json({error:"Error interno del servidor"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/modelo-plataformas/timeline/route",pathname:"/api/modelo-plataformas/timeline",filename:"route",bundlePath:"app/api/modelo-plataformas/timeline/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\modelo-plataformas\\timeline\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:f,headerHooks:_,staticGenerationBailout:c}=u,g="/api/modelo-plataformas/timeline/route";function h(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:p})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[1638,6206,2964],()=>t(83796));module.exports=i})();