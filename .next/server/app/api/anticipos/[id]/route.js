"use strict";(()=>{var e={};e.id=8832,e.ids=[8832],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},17452:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>g,originalPathname:()=>A,patchFetch:()=>S,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>I,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>_});var o={};t.r(o),t.d(o,{GET:()=>d,PUT:()=>u});var a=t(95419),s=t(69108),i=t(99678),n=t(78070);let c=(0,t(72964).createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function d(e,{params:r}){try{let{id:e}=r;console.log("\uD83D\uDD0D [API ANTICIPOS] GET anticipo:",e);let{data:t,error:o}=await c.from("anticipos").select(`
        *,
        model:users!anticipos_model_id_fkey(id, name, email, role),
        period:periods(id, name, start_date, end_date)
      `).eq("id",e).single();if(o)return console.error("❌ [API ANTICIPOS] Error:",o),n.Z.json({success:!1,error:o.message},{status:500});if(!t)return n.Z.json({success:!1,error:"Anticipo no encontrado"},{status:404});return n.Z.json({success:!0,data:t})}catch(e){return console.error("❌ [API ANTICIPOS] Error general:",e),n.Z.json({success:!1,error:e.message},{status:500})}}async function u(e,{params:r}){try{let{id:t}=r,o=await e.json();console.log("\uD83D\uDD0D [API ANTICIPOS] PUT anticipo:",t,o);let{estado:a,comentarios_admin:s,comentarios_rechazo:i,admin_id:d,model_id:u}=o;if(!a)return n.Z.json({success:!1,error:"Estado es requerido"},{status:400});if(!["pendiente","aprobado","rechazado","realizado","confirmado","cancelado"].includes(a))return n.Z.json({success:!1,error:"Estado inv\xe1lido"},{status:400});let{data:p,error:l}=await c.from("anticipos").select("*").eq("id",t).single();if(l||!p)return n.Z.json({success:!1,error:"Anticipo no encontrado"},{status:404});let m={estado:a,updated_at:new Date().toISOString()};"aprobado"===a?(m.comentarios_admin=s,m.approved_at=new Date().toISOString(),m.approved_by=d):"rechazado"===a?(m.comentarios_rechazo=i,m.rejected_at=new Date().toISOString(),m.rejected_by=d):"realizado"===a?(m.realized_at=new Date().toISOString(),m.realized_by=d):"confirmado"===a?(m.confirmed_at=new Date().toISOString(),m.confirmed_by=u||d):"cancelado"===a&&(m.cancelled_at=new Date().toISOString(),m.cancelled_by=d);let{data:I,error:g}=await c.from("anticipos").update(m).eq("id",t).select(`
        *,
        model:users!anticipos_model_id_fkey(id, name, email, role),
        period:periods(id, name, start_date, end_date)
      `).single();if(g)return console.error("❌ [API ANTICIPOS] Error actualizando:",g),n.Z.json({success:!1,error:g.message},{status:500});return console.log("✅ [API ANTICIPOS] Anticipo actualizado:",t,a),n.Z.json({success:!0,data:I,message:`Anticipo ${a} correctamente`})}catch(e){return console.error("❌ [API ANTICIPOS] Error general:",e),n.Z.json({success:!1,error:e.message},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/anticipos/[id]/route",pathname:"/api/anticipos/[id]",filename:"route",bundlePath:"app/api/anticipos/[id]/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\anticipos\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:I,headerHooks:g,staticGenerationBailout:_}=p,A="/api/anticipos/[id]/route";function S(){return(0,i.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:m})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1638,6206,2964],()=>t(17452));module.exports=o})();