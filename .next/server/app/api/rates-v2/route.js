"use strict";(()=>{var e={};e.id=6017,e.ids=[6017],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},3:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>E,originalPathname:()=>f,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>D,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>h});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>p,dynamic:()=>c});var o=t(95419),a=t(69108),n=t(99678),i=t(78070),u=t(72964);let c="force-dynamic",l=(0,u.createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function d(e){try{let{searchParams:r}=new URL(e.url),t=r.get("scope")||"global",s="true"===r.get("activeOnly");console.log("\uD83D\uDD0D [RATES-V2] Loading rates:",{scope:t,activeOnly:s});let o=l.from("rates").select("*").eq("active",!0).order("valid_from",{ascending:!1});"global"!==t&&(o=o.eq("scope",t)),s&&(o=o.is("valid_to",null));let{data:a,error:n}=await o;if(n)return console.error("Error al obtener tasas:",n),i.Z.json({success:!1,error:n.message},{status:500});return console.log("\uD83D\uDD0D [RATES-V2] Found rates:",a),i.Z.json({success:!0,data:a||[],meta:{total:a?.length||0,scope:t,activeOnly:s}})}catch(e){return console.error("❌ [RATES-V2] Error:",e),i.Z.json({success:!1,error:e.message||"Error interno del servidor"},{status:500})}}async function p(e){try{let{kind:r,value:t,scope:s,scopeId:o,authorId:a}=await e.json();if(!r||!t||!a)return i.Z.json({success:!1,error:"kind, value y authorId son requeridos"},{status:400});console.log("\uD83D\uDD0D [RATES-V2] Creating rate:",{kind:r,value:t,scope:s,scopeId:o,authorId:a}),await l.from("rates").update({valid_to:new Date().toISOString()}).eq("kind",r).eq("scope",s).eq("scope_id",o).is("valid_to",null);let{data:n,error:u}=await l.from("rates").insert({kind:r,value:parseFloat(t),scope:s||"global",scope_id:o||null,author_id:a,valid_from:new Date().toISOString()}).select().single();if(u)return console.error("Error al crear tasa:",u),i.Z.json({success:!1,error:u.message},{status:500});return console.log("\uD83D\uDD0D [RATES-V2] Created rate:",n),i.Z.json({success:!0,data:n})}catch(e){return console.error("❌ [RATES-V2] Error:",e),i.Z.json({success:!1,error:e.message||"Error interno del servidor"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/rates-v2/route",pathname:"/api/rates-v2",filename:"route",bundlePath:"app/api/rates-v2/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\rates-v2\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:D,headerHooks:E,staticGenerationBailout:h}=g,f="/api/rates-v2/route";function S(){return(0,n.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:v})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,2964],()=>t(3));module.exports=s})();