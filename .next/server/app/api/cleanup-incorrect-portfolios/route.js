"use strict";(()=>{var e={};e.id=9685,e.ids=[9685],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},70520:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>f,originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>g});var t={};o.r(t),o.d(t,{POST:()=>l});var s=o(95419),i=o(69108),a=o(99678),n=o(78070);let c=(0,o(72964).createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function l(e){try{console.log("\uD83E\uDDF9 Limpiando portafolios creados incorrectamente...");let{data:e,error:r}=await c.from("modelo_plataformas").select(`
        id,
        model_id,
        platform_id,
        status,
        notes
      `).eq("notes","Sincronizaci\xf3n autom\xe1tica de configuraci\xf3n existente");if(r)return console.error("Error obteniendo portafolios incorrectos:",r),n.Z.json({success:!1,error:r.message},{status:500});if(!e||0===e.length)return n.Z.json({success:!0,message:"No se encontraron portafolios creados por sincronizaci\xf3n incorrecta",deleted:0});console.log(`ðŸ“‹ Portafolios encontrados para eliminar: ${e.length}`);let o=Array.from(new Set(e.map(e=>e.model_id))),{data:t,error:s}=await c.from("users").select("id, email").in("id",o);if(s)return console.error("Error obteniendo usuarios:",s),n.Z.json({success:!1,error:s.message},{status:500});let i=t?.reduce((e,r)=>(e[r.id]=r.email,e),{})||{},a=e.reduce((e,r)=>{let o=i[r.model_id];return o&&(e[o]||(e[o]=[]),e[o].push(r)),e},{}),{error:l}=await c.from("modelo_plataformas").delete().eq("notes","Sincronizaci\xf3n autom\xe1tica de configuraci\xf3n existente");if(l)return console.error("Error eliminando portafolios incorrectos:",l),n.Z.json({success:!1,error:l.message},{status:500});let u=Object.entries(a).map(([e,r])=>({email:e,platforms_deleted:r.length}));return console.log("âœ… Portafolios incorrectos eliminados exitosamente"),n.Z.json({success:!0,message:`Limpieza completada. ${e.length} portafolios eliminados`,deleted:e.length,results:u})}catch(e){return console.error("âŒ Error en limpieza:",e),n.Z.json({success:!1,error:e.message||"Error interno del servidor"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/cleanup-incorrect-portfolios/route",pathname:"/api/cleanup-incorrect-portfolios",filename:"route",bundlePath:"app/api/cleanup-incorrect-portfolios/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\cleanup-incorrect-portfolios\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m,headerHooks:f,staticGenerationBailout:g}=u,h="/api/cleanup-incorrect-portfolios/route";function x(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}}};var r=require("../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[1638,6206,2964],()=>o(70520));module.exports=t})();