"use strict";(()=>{var e={};e.id=9402,e.ids=[9402],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},95550:(e,a,t)=>{t.r(a),t.d(a,{headerHooks:()=>N,originalPathname:()=>S,patchFetch:()=>D,requestAsyncStorage:()=>I,routeModule:()=>O,serverHooks:()=>R,staticGenerationAsyncStorage:()=>b,staticGenerationBailout:()=>A});var o={};t.r(o),t.d(o,{GET:()=>v,POST:()=>x,dynamic:()=>E});var r=t(95419),s=t(69108),n=t(99678),i=t(78070),c=t(72964),d=t(43178),l=t(70973),u=t(43186),m=t(91539);let p=process.env.SUPABASE_SERVICE_ROLE_KEY,f=null;async function g(e,a,t,o=[]){try{console.log("\uD83E\uDD16 [BOTTY-DIRECT] Procesando respuesta del bot...");let r=(0,c.createClient)("https://mhernfrkvwigxdubiozm.supabase.co",p,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:s,error:n}=await r.from("chat_conversations").select("id, participant_1_id, participant_2_id").eq("id",a).single();if(n||!s)return console.error("âŒ [BOTTY-DIRECT] Conversaci\xf3n no encontrada:",n),!1;let i=s.participant_1_id===d.mo,l=s.participant_2_id===d.mo;if(!i&&!l)return console.error("âŒ [BOTTY-DIRECT] Esta conversaci\xf3n no es con el bot"),!1;let f=await _(e,r);await (0,m.Ot)(e,a,t,f);let g="",E=t.match(/^\/(?:boost|boostpage)\s+(.+)/i),T=t.match(/(?:boost page|subir fotos?|cargar fotos?|boost)(?:\s+(?:a|para|de))?\s+([a-zA-Z0-9Ã¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘\s@._-]+)/i),y=E||T;if(y&&("admin"===f.role||"super_admin"===f.role)){let e=y[1].trim().replace(/^(a|la|el|para)\s+/i,"");console.log(`ðŸ” [BOTTY-INTENT] Detectado intento de Boost Page para: "${e}"`);let{data:t,error:o}=await r.from("users").select("id, name, email").in("role",["modelo","model","user"]).or(`name.ilike.%${e}%,email.ilike.%${e}%`).limit(1);if(o&&console.error("âŒ [BOTTY-INTENT] Error buscando modelo:",o),t&&t.length>0){let e=t[0];console.log(`âœ… [BOTTY-INTENT] Modelo encontrada: ${e.name} (${e.email})`);let o=`\xa1Entendido! Abriendo herramienta Boost Page para **${e.name}**...`;g=`

<<ACTION:OPEN_BOOST_MODAL|${e.id}|${e.name}|${e.email}>>`;let{error:s}=await r.from("chat_messages").insert({conversation_id:a,sender_id:d.mo,content:o+g,message_type:"ai_response"});if(s)return console.error("âŒ [BOTTY-DIRECT] Error guardando respuesta directa:",s),!1;return console.log("âœ… [BOTTY-DIRECT] Respuesta DIRECTA (intenci\xf3n detectada) enviada exitosamente"),!0}if(console.log(`âš ï¸ [BOTTY-INTENT] No se encontr\xf3 modelo con nombre/email: "${e}"`),E){let t=`No pude encontrar a ninguna modelo con el nombre o email "${e}". Por favor verifica que est\xe9 bien escrito.`;return await r.from("chat_messages").insert({conversation_id:a,sender_id:d.mo,content:t,message_type:"ai_response"}),!0}}let v=await (0,u.k)(()=>h(t,f,o,a)),{error:x}=await r.from("chat_messages").insert({conversation_id:a,sender_id:d.mo,content:v,message_type:"ai_response"});if(x)return console.error("âŒ [BOTTY-DIRECT] Error creando mensaje:",x),!1;return console.log("âœ… [BOTTY-DIRECT] Respuesta del bot generada exitosamente"),!0}catch(e){return console.error("âŒ [BOTTY-DIRECT] Error procesando respuesta:",e),!1}}async function _(e,a){let{data:t}=await a.from("users").select("id, name, email, role").eq("id",e).single(),o=[];if(t?.role!=="super_admin"){let{data:t}=await a.from("user_groups").select("groups(name)").eq("user_id",e);o=(t||[]).map(e=>e.groups?.name).filter(Boolean)}let r=[];if(t?.role==="modelo"){let{data:t}=await a.from("calculator_config").select("platforms").eq("user_id",e).single();t?.platforms&&(r=t.platforms.filter(e=>e.enabled))}let{data:s}=await a.from("anticipos").select("created_at").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single();return{userId:t?.id||e,role:t?.role||"modelo",name:t?.name||t?.email?.split("@")[0]||"Usuario",email:t?.email||"",groups:o,portfolio:r,recentActivity:{lastAnticipo:s?.created_at}}}async function h(e,a,o,r){try{console.log("\uD83E\uDD16 [BOTTY-GEN] Iniciando generaci\xf3n de respuesta...");let r=process.env.GOOGLE_GEMINI_API_KEY;if(!r)return console.error("âŒ [BOTTY-GEN] GOOGLE_GEMINI_API_KEY no est\xe1 configurada"),console.error("âŒ [BOTTY-GEN] Variables de entorno disponibles:",{hasSupabaseUrl:!0,hasSupabaseKey:!!process.env.SUPABASE_SERVICE_ROLE_KEY,hasGeminiKey:!1}),"Lo siento, el servicio de IA no est\xe1 configurado. Por favor, contacta a tu administrador.";console.log("âœ… [BOTTY-GEN] API Key encontrada, longitud:",r.length),console.log("\uD83E\uDD16 [BOTTY-GEN] Obteniendo personalidad...");let s=(0,d.Pj)(a.role);console.log("\uD83E\uDD16 [BOTTY-GEN] Construyendo historial...");let n=o.slice(-10).map(e=>{let t=e.sender_id===d.mo;return`${t?"AIM Botty":a.name}: ${e.content}`}).join("\n"),i=0===o.length||!o.some(e=>e.sender_id===d.mo),c=await (0,m.YC)(a.userId),{formatSystemKnowledgeForPrompt:u}=await t.e(1190).then(t.bind(t,31190)),p=u(a.role),{getRelevantResources:g,formatResourcesForPrompt:_}=await t.e(7042).then(t.bind(t,27042)),h=await g(e,a),E=_(h);console.log("\uD83E\uDD16 [BOTTY-GEN] Construyendo contexto...");let T="";T="modelo"===a.role?`
INFORMACI\xd3N DEL MODELO:
- Nombre: ${a.name}
- Plataformas activas: ${a.portfolio?.length||0}
- \xdaltimo anticipo: ${a.recentActivity?.lastAnticipo?new Date(a.recentActivity.lastAnticipo).toLocaleDateString():"N/A"}

PLATAFORMAS EN PORTAFOLIO:
${a.portfolio?.map(e=>`- ${e.platform_name||e.platform_id}`).join("\n")||"Ninguna configurada"}

CAPACIDADES DISPONIBLES:
- Informaci\xf3n sobre plataformas del portafolio
- Tips de transmisi\xf3n (make up, \xe1ngulos, iluminaci\xf3n)
- Consejer\xeda emocional y apoyo
- Tips para potenciar transmisiones
- Soporte t\xe9cnico con b\xfasqueda web
- Escalamiento a admin cuando sea necesario
`:"admin"===a.role?`
INFORMACI\xd3N DEL ADMIN:
- Nombre: ${a.name}
- Grupos gestionados: ${a.groups?.length||0}
`:`
INFORMACI\xd3N DEL SUPER ADMIN:
- Nombre: ${a.name}
- Acceso completo al sistema
`;let y=`
${s}

${p}

${T}

${c?`
${c}
`:""}

${E}

${n?`
HISTORIAL DE CONVERSACI\xd3N (\xfaltimos 10 mensajes):
${n}
`:""}

MENSAJE DEL USUARIO: ${e}

INSTRUCCIONES:
1. Responde de manera SUPER CERCANA y amigable (como un buen amigo que te ayuda)
2. S\xe9 CONCISO: m\xe1ximo 2-3 oraciones (las respuestas deben ser cortas y directas), EXCEPTO cuando preguntan sobre el sistema - en ese caso puedes ser m\xe1s detallado
3. Tono casual y c\xe1lido, habla de t\xfa
4. ${i?'SOLO en este primer mensaje puedes saludar brevemente (ej: "\xa1Hola!").':"NO saludes, NUNCA. Responde directamente al mensaje sin saludos."}
5. Si pregunta sobre plataformas, da tips breves y pr\xe1cticos (1-2 oraciones m\xe1ximo)
6. Para soporte t\xe9cnico, soluciones r\xe1pidas y directas
7. Si no puedes resolver algo, menciona brevemente que puedes escalarlo
8. Consejer\xeda emocional: s\xe9 emp\xe1tico pero breve
9. Usa emojis con moderaci\xf3n (1-2 m\xe1ximo por respuesta)
10. NUNCA escribas p\xe1rrafos largos, siempre respuestas cortas y al punto, EXCEPTO cuando preguntan espec\xedficamente sobre el sistema - en ese caso puedes explicar en detalle
11. Mant\xe9n el tono cercano, amigable y positivo
${i?"":'12. IMPORTANTE: NO uses saludos como "\xa1Hola!", "Hola!", "\xa1Buen d\xeda!", etc. Responde directamente.'}
13. IMPORTANTE: Si el usuario pregunta sobre CUALQUIER aspecto del sistema (funcionalidades, c\xf3mo funciona algo, arquitectura, m\xf3dulos, flujos de trabajo, APIs, estructura de datos, permisos, etc.), usa el CONOCIMIENTO DEL SISTEMA proporcionado arriba para dar una respuesta completa y precisa.
14. Para preguntas sobre el sistema, puedes ser m\xe1s detallado y t\xe9cnico si es necesario, pero mant\xe9n un tono conversacional.
15. Si preguntan "\xbfc\xf3mo funciona X?" o "\xbfqu\xe9 es Y?", explica el flujo completo usando el conocimiento del sistema.
16. ${E?"IMPORTANTE: Si hay RECURSOS \xdaTILES disponibles arriba y el usuario pregunta sobre algo relacionado, menci\xf3nalos y sugiere que los visite. Puedes mencionar el t\xedtulo y la URL del recurso relevante. Si hay m\xfaltiples recursos relevantes, puedes mencionar varios.":""}
17. ${E?'Cuando menciones un recurso, s\xe9 espec\xedfico: "Te recomiendo revisar este art\xedculo: [T\xedtulo] - [URL]" o "Para m\xe1s informaci\xf3n sobre esto, puedes consultar: [T\xedtulo] ([URL])"':""}

RESPUESTA:
`;console.log("\uD83E\uDD16 [BOTTY-GEN] Generando contenido con Gemini..."),console.log("\uD83E\uDD16 [BOTTY-GEN] Prompt length:",y.length);let v=null,x=function(){if(!f){let e=process.env.GOOGLE_GEMINI_API_KEY;if(!e)throw Error("GOOGLE_GEMINI_API_KEY no est\xe1 configurada en las variables de entorno");f=new l.$D(e)}return f}();for(let e of["gemini-3.0-pro","gemini-3-pro-preview","gemini-3.0-flash","gemini-3-flash-preview","gemini-2.5-flash","gemini-2.5-pro","gemini-2.5-flash-lite","gemini-1.5-flash","gemini-1.5-pro","gemini-pro"])try{console.log(`ðŸ¤– [BOTTY-GEN] Intentando con modelo: ${e}`);let a=x.getGenerativeModel({model:e}),t=await a.generateContent(y),o=(await t.response).text().trim();return o=o.replace(/```[\s\S]*?```/g,"").trim(),console.log(`âœ… [BOTTY-GEN] Respuesta generada exitosamente con ${e}, longitud:`,o.length),o}catch(a){if(console.error(`âŒ [BOTTY-GEN] Error con ${e}:`,{message:a?.message,status:a?.status,statusText:a?.statusText}),v=a,a?.message?.includes("404")||a?.message?.includes("not found")||a?.status===404){console.log(`âš ï¸ [BOTTY-GEN] ${e} no disponible, intentando siguiente modelo...`);continue}if(a?.message?.includes("API key")||a?.message?.includes("authentication")||a?.message?.includes("PERMISSION_DENIED"))throw console.error("âŒ [BOTTY-GEN] Error de autenticaci\xf3n, no intentando m\xe1s modelos"),a;if(a?.status===429||a?.message?.includes("rate limit")){console.log(`âš ï¸ [BOTTY-GEN] Rate limit en ${e}, intentando siguiente modelo...`);continue}if(a?.message?.includes("model")||a?.message?.includes("Model"))continue;throw a}throw console.error("âŒ [BOTTY-GEN] Todos los modelos fallaron. \xdaltimo error:",v),v||Error("Todos los modelos fallaron")}catch(e){if(console.error("âŒ [BOTTY-GEN] Error generando respuesta del bot:",e),console.error("âŒ [BOTTY-GEN] Error details:",{message:e?.message,stack:e?.stack,name:e?.name,status:e?.status,statusText:e?.statusText,code:e?.code,response:e?.response?{status:e.response.status,statusText:e.response.statusText,data:e.response.data}:null}),e?.response&&console.error("âŒ [BOTTY-GEN] Error response completo:",JSON.stringify(e.response,null,2)),e?.message?.includes("API key")||e?.message?.includes("authentication")||e?.message?.includes("PERMISSION_DENIED")||e?.message?.includes("no est\xe1 configurada"))return"Lo siento, hay un problema con la configuraci\xf3n del servicio de IA. Por favor, contacta a tu administrador.";if(e?.message?.includes("404")||e?.message?.includes("not found")||e?.message?.includes("Todos los modelos fallaron")||e?.status===404||e?.response?.status===404)return console.error("âŒ [BOTTY-GEN] Todos los modelos fallaron con 404 - verificando API key..."),console.error("âŒ [BOTTY-GEN] API Key presente:",!!process.env.GOOGLE_GEMINI_API_KEY),"Lo siento, el modelo de IA no est\xe1 disponible en este momento. Por favor, intenta m\xe1s tarde o contacta a tu administrador.";if(e?.status===429||e?.message?.includes("rate limit"))return"Lo siento, el servicio est\xe1 experimentando alta demanda. Por favor, intenta en unos momentos.";return console.error("âŒ [BOTTY-GEN] Error desconocido, mostrando mensaje gen\xe9rico"),"Lo siento, hubo un error al procesar tu mensaje. Por favor, intenta de nuevo o contacta a tu administrador."}}let E="force-dynamic",T="https://mhernfrkvwigxdubiozm.supabase.co",y=process.env.SUPABASE_SERVICE_ROLE_KEY;async function v(e){try{let a=(0,c.createClient)(T,y,{auth:{autoRefreshToken:!1,persistSession:!1}}),t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return i.Z.json({error:"Token de autorizaci\xf3n requerido"},{status:401});let o=t.split(" ")[1],{data:{user:r},error:s}=await a.auth.getUser(o);if(s||!r)return i.Z.json({error:"Token inv\xe1lido"},{status:401});let{searchParams:n}=new URL(e.url),d=n.get("conversation_id"),l=parseInt(n.get("limit")||"50"),u=parseInt(n.get("offset")||"0");if(!d)return i.Z.json({error:"ID de conversaci\xf3n requerido"},{status:400});let{data:m,error:p}=await a.from("chat_conversations").select("id, participant_1_id, participant_2_id").eq("id",d).single();if(p||!m)return i.Z.json({error:"Conversaci\xf3n no encontrada"},{status:404});if(m.participant_1_id!==r.id&&m.participant_2_id!==r.id)return i.Z.json({error:"No tienes acceso a esta conversaci\xf3n"},{status:403});let{data:f,error:g}=await a.from("chat_messages").select(`
        id,
        content,
        message_type,
        created_at,
        sender_id,
        reply_to_message_id,
        sender:sender_id(id, name, email, role),
        reply_to_message:reply_to_message_id(
          id,
          content,
          sender:sender_id(name)
        )
      `).eq("conversation_id",d).order("created_at",{ascending:!1}).range(u,u+l-1);if(g)return console.error("Error obteniendo mensajes:",g),i.Z.json({error:"Error obteniendo mensajes"},{status:500});let _=m.participant_1_id===r.id?m.participant_2_id:m.participant_1_id,h=f.map(e=>e.id),{data:E}=await a.from("chat_message_reads").select("message_id").eq("user_id",_).in("message_id",h),{data:v}=await a.from("chat_message_reads").select("message_id").eq("user_id",r.id).in("message_id",h),x=new Set(E?.map(e=>e.message_id)||[]),O=new Set(v?.map(e=>e.message_id)||[]),I=f.map(e=>{let a=e.sender_id===r.id;return{...e,is_read_by_other:!!a&&x.has(e.id),is_read_by_me:!a&&O.has(e.id)}});return i.Z.json({success:!0,messages:I.reverse(),has_more:f.length===l})}catch(e){return console.error("Error en GET /api/chat/messages:",e),i.Z.json({error:"Error interno del servidor"},{status:500})}}async function x(e){try{let a=(0,c.createClient)(T,y,{auth:{autoRefreshToken:!1,persistSession:!1}}),t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return i.Z.json({error:"Token de autorizaci\xf3n requerido"},{status:401});let o=t.split(" ")[1],{data:{user:r},error:s}=await a.auth.getUser(o);if(s||!r)return i.Z.json({error:"Token inv\xe1lido"},{status:401});let{conversation_id:n,content:l,message_type:u="text",reply_to_message_id:m}=await e.json();if(!n||!l?.trim())return i.Z.json({error:"ID de conversaci\xf3n y contenido requeridos"},{status:400});let{data:p,error:f}=await a.from("chat_conversations").select("id, participant_1_id, participant_2_id, is_active").eq("id",n).single();if(f||!p)return i.Z.json({error:"Conversaci\xf3n no encontrada"},{status:404});if(!p.is_active)return i.Z.json({error:"Conversaci\xf3n inactiva"},{status:400});if(p.participant_1_id!==r.id&&p.participant_2_id!==r.id)return i.Z.json({error:"No tienes acceso a esta conversaci\xf3n"},{status:403});try{let{data:e}=await a.from("chat_messages").select("id, sender_id, is_broadcast, no_reply, created_at").eq("conversation_id",n).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(e&&e.is_broadcast&&e.no_reply&&e.sender_id===d.mo)return i.Z.json({error:"Este mensaje es informativo y no admite respuestas."},{status:400})}catch{}console.log("\uD83D\uDCE4 [API] Creando mensaje:",{conversation_id:n,sender_id:r.id,content:l.trim(),message_type:u});let{data:_,error:h}=await a.from("chat_messages").insert({conversation_id:n,sender_id:r.id,content:l.trim(),message_type:u,reply_to_message_id:m||null}).select(`
        id,
        content,
        message_type,
        created_at,
        sender_id,
        reply_to_message_id,
        sender:sender_id(id, name, email, role),
        reply_to_message:reply_to_message_id(
          id,
          content,
          sender:sender_id(name)
        )
      `).single();if(h)return console.error("âŒ [API] Error creando mensaje:",h),i.Z.json({error:"Error enviando mensaje"},{status:500});console.log("âœ… [API] Mensaje creado exitosamente:",_);let E=(0,d.Bm)(p.participant_1_id)||(0,d.Bm)(p.participant_2_id);if(console.log("\uD83E\uDD16 [BOTTY] Verificando si mensaje es para el bot:",{isToBotty:E,participant_1:p.participant_1_id,participant_2:p.participant_2_id,botId:d.mo}),E){console.log("\uD83E\uDD16 [BOTTY] Mensaje detectado para el bot, generando respuesta...");let{data:e,error:t}=await a.from("chat_messages").select("id, sender_id, content, created_at").eq("conversation_id",n).order("created_at",{ascending:!1}).limit(10);t&&console.error("âŒ [BOTTY] Error obteniendo historial:",t),g(r.id,n,l.trim(),(e||[]).reverse()).then(e=>{e?console.log("âœ… [BOTTY] Respuesta del bot generada exitosamente"):console.error("âŒ [BOTTY] Error generando respuesta del bot")}).catch(e=>{console.error("âŒ [BOTTY] Error en processBotResponse:",e)})}return await a.from("chat_user_status").upsert({user_id:r.id,is_online:!0,last_seen:new Date().toISOString()}),i.Z.json({success:!0,message:_})}catch(e){return console.error("Error en POST /api/chat/messages:",e),i.Z.json({error:"Error interno del servidor"},{status:500})}}let O=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/chat/messages/route",pathname:"/api/chat/messages",filename:"route",bundlePath:"app/api/chat/messages/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\chat\\messages\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:I,staticGenerationAsyncStorage:b,serverHooks:R,headerHooks:N,staticGenerationBailout:A}=O,S="/api/chat/messages/route";function D(){return(0,n.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:b})}},43178:(e,a,t)=>{t.d(a,{Bm:()=>c,Pj:()=>n,jO:()=>r,mo:()=>o,n6:()=>i,y6:()=>s});let o="f91c0968-b587-46cf-9036-05a4ec795c7f",r="AIM Botty",s="aim-botty@agencia-innova.com";function n(e){let a={modelo:`Eres AIM Botty, tu asistente virtual y amigo ðŸ¤–. Ayudo a modelos de webcam de forma cercana y comprensiva.
      Tu personalidad:
      - Super amigable, cercano y emp\xe1tico (como un buen amigo)
      - Tono casual y c\xe1lido, sin formalidades
      - Entiendes perfectamente el mundo del entretenimiento para adultos
      - Sabes c\xf3mo puede ser este trabajo emocionalmente
      - Ofreces tips \xfatiles sin ser condescendiente
      - Das apoyo emocional cuando se necesita
      - Siempre positivo y alentador
      - Hablas de t\xfa, nunca de usted`,admin:`Eres AIM Botty, un asistente virtual cercano y \xfatil para administradores. 
      Tu personalidad:
      - Amigable pero profesional
      - Directo y eficiente
      - Tono cercano, como un compa\xf1ero de trabajo
      - Proactivo y \xfatil
      - Siempre disponible para ayudar`,super_admin:`Eres AIM Botty, un asistente virtual cercano y eficiente para super administradores.
      Tu personalidad:
      - Amigable pero directo
      - Eficiente y claro
      - Tono cercano y profesional
      - Proactivo en reportar lo importante
      - Siempre \xfatil y disponible`};return a[e]||a.modelo}function i(e,a){return({anticipo_pendiente:`ðŸ“‹ Hola ${a.name}! Tienes una nueva solicitud de anticipo pendiente de revisi\xf3n. El administrador la revisar\xe1 pronto.`,anticipo_aprobado:`âœ… \xa1Excelente noticia ${a.name}! Tu solicitud de anticipo ha sido aprobada. El pago se procesar\xe1 seg\xfan lo acordado.`,anticipo_rechazado:`âš ï¸ ${a.name}, tu solicitud de anticipo fue rechazada. Revisa los detalles en [LINK:Mis Anticipos|/admin/model/anticipos/solicitudes] o contacta a tu administrador si tienes dudas.`,anticipo_realizado:`ðŸ’° ${a.name}, tu anticipo ha sido pagado. Por favor [LINK:confirma la recepci\xf3n|/admin/model/anticipos/solicitudes].`,anticipo_confirmado:`âœ… ${a.name}, has confirmado la recepci\xf3n de tu anticipo. \xa1Gracias!`,anticipo_confirmar_recordatorio:`â° ${a.name}, recuerda [LINK:confirmar la recepci\xf3n de tu anticipo pagado|/admin/model/anticipos/solicitudes].`,pagina_confirmada:`ðŸŽ‰ \xa1Felicidades ${a.name}! Se ha confirmado la entrega de tu p\xe1gina. \xa1Excelente trabajo!`,plataforma_entregada:`ðŸ“¦ ${a.name}, tu plataforma ha sido entregada. [LINK:Confirma la recepci\xf3n|/admin/model/portafolio] para activarla en tu calculadora.`,plataforma_confirmada:`âœ… ${a.name}, plataforma confirmada y activada exitosamente en tu calculadora.`,plataforma_agregada:`âž• ${a.name}, se agreg\xf3 una nueva plataforma a tu portafolio. [LINK:Ver portafolio|/admin/model/portafolio]`,plataforma_pendiente_confirmacion:`â³ ${a.name}, hay plataformas entregadas esperando tu confirmaci\xf3n. [LINK:Revisar portafolio|/admin/model/portafolio]`,periodo_cerrado:`ðŸ“Š ${a.name}, el per\xedodo de facturaci\xf3n ha sido cerrado. Puedes [LINK:revisar tu resumen completo|/admin/model/dashboard] en el dashboard.`,metas_alcanzadas:`ðŸ† \xa1Incre\xedble ${a.name}! Has alcanzado tu meta del d\xeda. \xa1Sigue as\xed!`,meta_periodo_alcanzada:`ðŸŽ¯ \xa1Excelente ${a.name}! Has alcanzado tu meta del per\xedodo. \xa1Felicitaciones!`,meta_dia_alcanzada:`â­ ${a.name}, \xa1alcanzaste tu meta del d\xeda!`,recordatorio_ingreso:`ðŸ’¡ ${a.name}, recuerda [LINK:ingresar tus valores del d\xeda|/admin/model/calculator] en Mi Calculadora para mantener tus registros al d\xeda.`,valores_no_ingresados:`âš ï¸ ${a.name}, no has ingresado valores desde hace varios d\xedas. [LINK:Actualiza tus registros|/admin/model/calculator] ahora.`,cuota_minima_riesgo:`ðŸ“‰ ${a.name}, est\xe1s cerca de no alcanzar tu cuota m\xednima. \xa1Sigue as\xed, puedes lograrlo!`,mensaje_importante_admin:`ðŸ“© ${a.name}, tienes un mensaje importante de tu administrador. [LINK:Revisa tu chat|#]`,escalamiento_admin:`ðŸ†˜ ${a.name}, tu consulta ha sido escalada a un administrador. Te responder\xe1n pronto.`,respuesta_escalamiento:`ðŸ’¬ ${a.name}, un administrador respondi\xf3 a tu consulta. [LINK:Revisa tu chat|#]`,nuevo_mensaje_modelo:`ðŸ’¬ ${a.name}, tienes un nuevo mensaje de una modelo. [LINK:Abrir chat|#]`,consulta_escalada:`ðŸš¨ ${a.name}, una modelo necesita asistencia urgente. [LINK:Revisar chat|#]`,modelo_solicita_ayuda:`ðŸ†˜ ${a.name}, una modelo solicit\xf3 ayuda en el chat. [LINK:Abrir chat|#]`,nueva_publicacion:`ðŸ“Œ \xa1Hola ${a.name}! Hay una nueva publicaci\xf3n en el corcho informativo. [LINK:Revisa tu dashboard|/admin/model/dashboard] para ver los detalles.`,cambio_configuracion:`âš™ï¸ ${a.name}, se actualiz\xf3 la configuraci\xf3n del sistema.`,mantenimiento_programado:`ðŸ”§ ${a.name}, el sistema estar\xe1 en mantenimiento. Revisa los detalles.`,nueva_funcionalidad:`âœ¨ ${a.name}, hay una nueva funcionalidad disponible. \xa1\xc9chale un vistazo!`,error_critico:`ðŸš¨ ${a.name}, se detect\xf3 un error cr\xedtico en el sistema. Revisa los logs.`,backup_completado:`ðŸ’¾ ${a.name}, el backup del sistema se complet\xf3 exitosamente.`,actualizacion_sistema:`ðŸ”„ ${a.name}, el sistema ha sido actualizado.`})[e]||`ðŸ”” ${a.name}, tienes una nueva notificaci\xf3n.`}function c(e){return e===o}},91539:(e,a,t)=>{t.d(a,{Ot:()=>d,YC:()=>l,Z7:()=>n,lo:()=>c,ye:()=>i});var o=t(72964);let r=process.env.SUPABASE_SERVICE_ROLE_KEY;function s(){return(0,o.createClient)("https://mhernfrkvwigxdubiozm.supabase.co",r,{auth:{autoRefreshToken:!1,persistSession:!1}})}async function n(e){try{let a=s(),{data:t}=await a.from("bot_memory").select("id").eq("user_id",e.user_id).eq("key",e.key).single();if(t){let{error:o}=await a.from("bot_memory").update({value:e.value,metadata:e.metadata,updated_at:new Date().toISOString()}).eq("id",t.id);if(o)return console.error("âŒ [BOT-MEMORY] Error actualizando memoria:",o),!1}else{let{error:t}=await a.from("bot_memory").insert({user_id:e.user_id,type:e.type,key:e.key,value:e.value,metadata:e.metadata});if(t)return console.error("âŒ [BOT-MEMORY] Error guardando memoria:",t),!1}return!0}catch(e){return console.error("âŒ [BOT-MEMORY] Error en saveMemory:",e),!1}}async function i(e,a){try{let t=s().from("bot_memory").select("*").eq("user_id",e);a&&(t=t.eq("type",a)),t=t.or("metadata->expires_at.is.null,metadata->expires_at.gt."+new Date().toISOString());let{data:o,error:r}=await t.order("updated_at",{ascending:!1});if(r)return console.error("âŒ [BOT-MEMORY] Error obteniendo memorias:",r),[];return(o||[]).map(e=>({...e,value:"string"==typeof e.value?function(e){try{return JSON.parse(e)}catch{return e}}(e.value):e.value}))}catch(e){return console.error("âŒ [BOT-MEMORY] Error en getUserMemories:",e),[]}}async function c(e,a){try{let t=s(),{error:o}=await t.from("bot_memory").delete().eq("user_id",e).eq("key",a);return!o}catch(e){return console.error("âŒ [BOT-MEMORY] Error eliminando memoria:",e),!1}}async function d(e,a,t,o){try{for(let o of function(e){let a=e.toLowerCase(),t=[];if(a.match(/me gusta trabajar|prefiero trabajar|trabajo mejor|soy mÃ¡s productiv/)){let e=a.match(/(maÃ±ana|tarde|noche|madrugada|dÃ­a|evening|morning|afternoon)/);e&&t.push({type:"preference",key:"preferred_hours",value:e[1],confidence:.8})}if(a.match(/mi plataforma favorita|me gusta mÃ¡s|prefiero usar|trabajo mejor en/)){let e=a.match(/(chaturbate|streamate|myfreecams|cam4|camsoda|stripchat|livejasmin|flirt4free|camcontacts|big7|mondo|superfoon)/);e&&t.push({type:"preference",key:"favorite_platforms",value:e[1],confidence:.8})}if(a.match(/mi meta|mi objetivo|quiero ganar|mi objetivo es/)){let e=a.match(/(\d+)\s*(usd|dÃ³lar|dolar)/);e&&t.push({type:"goal",key:"personal_goal",value:parseInt(e[1]),confidence:.7})}return a.match(/tengo un problema|estoy teniendo|no puedo|no funciona|me estÃ¡ pasando/)&&t.push({type:"issue",key:"last_mentioned_issue",value:e.substring(0,200),confidence:.6}),t}(t))await n({user_id:e,type:o.type,key:o.key,value:o.value,metadata:{source_conversation_id:a,mentioned_at:new Date().toISOString(),confidence:o.confidence||.7}})}catch(e){console.error("âŒ [BOT-MEMORY] Error extrayendo memoria:",e)}}async function l(e){try{let a=await i(e);if(0===a.length)return"";let t=["MEMORIA DEL USUARIO (informaci\xf3n recordada de conversaciones anteriores):"],o=a.reduce((e,a)=>(e[a.type]||(e[a.type]=[]),e[a.type].push(a),e),{});if(o.preference?.length>0&&(t.push("\nPREFERENCIAS:"),o.preference.forEach(e=>{t.push(`- ${e.key}: ${u(e.value)}`)})),o.goal?.length>0&&(t.push("\nOBJETIVOS MENCIONADOS:"),o.goal.forEach(e=>{t.push(`- ${e.key}: ${u(e.value)}`)})),o.fact?.length>0&&(t.push("\nINFORMACI\xd3N RELEVANTE:"),o.fact.forEach(e=>{t.push(`- ${e.key}: ${u(e.value)}`)})),o.issue?.length>0){let e=o.issue[0];t.push(`
\xdaLTIMO PROBLEMA MENCIONADO: ${u(e.value)}`)}return t.join("\n")}catch(e){return console.error("âŒ [BOT-MEMORY] Error obteniendo contexto de memoria:",e),""}}function u(e){return"object"==typeof e?JSON.stringify(e):String(e)}},43186:(e,a,t)=>{t.d(a,{k:()=>s});class o{constructor(e){this.requestsPerMinute=15,this.requestsPerDay=1500,this.recentRequests=[],this.dailyRequests=[],this.queue=[],this.processing=!1,e&&(this.requestsPerMinute=e.requestsPerMinute,this.requestsPerDay=e.requestsPerDay),setInterval(()=>this.cleanOldLogs(),6e4)}cleanOldLogs(){let e=Date.now(),a=e-6e4,t=e-864e5;this.recentRequests=this.recentRequests.filter(e=>e.timestamp>a),this.dailyRequests=this.dailyRequests.filter(e=>e.timestamp>t)}canMakeRequest(){this.cleanOldLogs();let e=this.recentRequests.length,a=this.dailyRequests.length;return e<this.requestsPerMinute&&a<this.requestsPerDay}getWaitTime(){if(this.cleanOldLogs(),this.recentRequests.length>=this.requestsPerMinute){let e=this.recentRequests[0];return Math.max(0,6e4-(Date.now()-e.timestamp))}return 0}async waitForCapacity(){if(!this.canMakeRequest())return new Promise((e,a)=>{let t=this.getWaitTime();t>0?(console.log(`â³ [RATE-LIMITER] Esperando ${Math.ceil(t/1e3)}s por l\xedmite de tasa...`),setTimeout(()=>{this.waitForCapacity().then(e).catch(a)},t)):setTimeout(()=>{this.waitForCapacity().then(e).catch(a)},1e3)})}async recordRequest(e){let a={timestamp:Date.now(),tokens:e};this.recentRequests.push(a),this.dailyRequests.push(a),console.log(`ðŸ“Š [RATE-LIMITER] Request registrado. \xdaltimo minuto: ${this.recentRequests.length}/${this.requestsPerMinute}, Hoy: ${this.dailyRequests.length}/${this.requestsPerDay}`)}getStats(){return this.cleanOldLogs(),{requestsLastMinute:this.recentRequests.length,requestsPerMinuteLimit:this.requestsPerMinute,requestsToday:this.dailyRequests.length,requestsPerDayLimit:this.requestsPerDay,canMakeRequest:this.canMakeRequest(),waitTime:this.getWaitTime()}}}let r=new o({requestsPerMinute:15,requestsPerDay:1500});async function s(e,a){await r.waitForCapacity();let t=await e();return await r.recordRequest(a),t}}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),o=a.X(0,[1638,6206,2964,973],()=>t(95550));module.exports=o})();