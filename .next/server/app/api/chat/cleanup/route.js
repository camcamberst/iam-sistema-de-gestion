"use strict";(()=>{var e={};e.id=2534,e.ids=[2534],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},8808:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>_,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>E,serverHooks:()=>g,staticGenerationAsyncStorage:()=>S,staticGenerationBailout:()=>A});var a={};r.r(a),r.d(a,{GET:()=>m,POST:()=>p});var s=r(95419),o=r(69108),n=r(99678),i=r(78070),c=r(72964),u=r(37542);let l=process.env.SUPABASE_SERVICE_ROLE_KEY,d=(0,c.createClient)("https://mhernfrkvwigxdubiozm.supabase.co",l,{auth:{autoRefreshToken:!1,persistSession:!1}});async function p(e){try{console.log("\uD83E\uDDF9 [CLEANUP] Iniciando limpieza de usuarios inactivos..."),await (0,u.GZ)();let{data:e,error:t}=await d.from("chat_user_status").select("*").eq("is_online",!0);t&&console.error("❌ [CLEANUP] Error obteniendo estad\xedsticas:",t);let r={timestamp:new Date().toISOString(),usersOnline:e?.length||0,cleanupExecuted:!0};return console.log("✅ [CLEANUP] Limpieza completada:",r),i.Z.json({success:!0,message:"Limpieza de usuarios inactivos completada",stats:r})}catch(e){return console.error("❌ [CLEANUP] Error en limpieza:",e),i.Z.json({success:!1,error:"Error ejecutando limpieza de usuarios inactivos",details:e instanceof Error?e.message:"Error desconocido"},{status:500})}}async function m(e){try{let{data:e,error:t}=await d.from("chat_user_status").select("*").eq("is_online",!0),{data:r,error:a}=await d.from("chat_user_status").select("*");if(t||a)return console.error("❌ [CLEANUP] Error obteniendo estad\xedsticas:",t||a),i.Z.json({success:!1,error:"Error obteniendo estad\xedsticas"},{status:500});let s={timestamp:new Date().toISOString(),usersOnline:e?.length||0,totalUsers:r?.length||0,usersOffline:(r?.length||0)-(e?.length||0)};return i.Z.json({success:!0,stats:s})}catch(e){return console.error("❌ [CLEANUP] Error obteniendo estad\xedsticas:",e),i.Z.json({success:!1,error:"Error obteniendo estad\xedsticas",details:e instanceof Error?e.message:"Error desconocido"},{status:500})}}let E=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/chat/cleanup/route",pathname:"/api/chat/cleanup",filename:"route",bundlePath:"app/api/chat/cleanup/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\chat\\cleanup\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:S,serverHooks:g,headerHooks:f,staticGenerationBailout:A}=E,_="/api/chat/cleanup/route";function v(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:S})}},37542:(e,t,r)=>{r.d(t,{GZ:()=>i,MY:()=>o,lH:()=>n});var a=r(8234);async function s(e,t){try{console.log(`📊 [CHAT-STATUS] Actualizando estado de usuario ${e}: ${t?"EN L\xcdNEA":"OFFLINE"}`);let{error:r}=await a.O.from("chat_user_status").upsert({user_id:e,is_online:t,last_seen:new Date().toISOString(),updated_at:new Date().toISOString()});r?console.error("❌ [CHAT-STATUS] Error actualizando estado:",r):console.log(`✅ [CHAT-STATUS] Estado actualizado exitosamente: ${t?"EN L\xcdNEA":"OFFLINE"}`)}catch(e){console.error("❌ [CHAT-STATUS] Error general:",e)}}async function o(e){await s(e,!0)}async function n(e){await s(e,!1)}async function i(){try{let e=new Date(Date.now()-6e4).toISOString(),{count:t}=await a.O.from("chat_user_status").select("*",{count:"exact",head:!0}).lt("updated_at",e).eq("is_online",!0),{error:r}=await a.O.from("chat_user_status").update({is_online:!1}).lt("updated_at",e).eq("is_online",!0);r?console.error("❌ [CHAT-STATUS] Error limpiando usuarios inactivos:",r):t&&t>0&&console.log(`✅ [CHAT-STATUS] ${t} usuarios inactivos marcados como offline`)}catch(e){console.error("❌ [CHAT-STATUS] Error en limpieza:",e)}}},8234:(e,t,r)=>{r.d(t,{O:()=>i});var a=r(86843);let s=(0,a.createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\lib\supabase.ts`),{__esModule:o,$$typeof:n}=s;s.default;let i=(0,a.createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\lib\supabase.ts#supabase`)},86843:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createProxy",{enumerable:!0,get:function(){return a}});let a=r(18195).createClientModuleProxy},50482:(e,t,r)=>{e.exports=r(20399)},18195:(e,t,r)=>{e.exports=r(50482).vendored["react-rsc"].ReactServerDOMWebpackServerEdge}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,2964],()=>r(8808));module.exports=a})();