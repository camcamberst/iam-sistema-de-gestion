"use strict";(()=>{var e={};e.id=3986,e.ids=[3986],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35633:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>E,originalPathname:()=>f,patchFetch:()=>R,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>S,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>h});var t={};s.r(t),s.d(t,{GET:()=>p});var o=s(95419),a=s(69108),n=s(99678),u=s(78070);let i=[{name:"Datos Abiertos Colombia",priority:1,url:"https://www.datos.gov.co/api/views/dit9-nnvp/rows.json?$limit=1&$order=:id",parser:e=>{try{let r=e?.data?.[0];if(r&&r.length>=2)return{usd_cop:parseFloat(r[1])}}catch(e){console.warn("⚠️ [RATE-SOURCES] Error parsing Datos Abiertos Colombia:",e)}return{}},timeout:1e4},{name:"ExchangeRate-API",priority:2,url:"https://api.exchangerate-api.com/v4/latest/USD",parser:e=>{try{return{usd_cop:e?.rates?.COP,eur_usd:1/(e?.rates?.EUR||1),gbp_usd:1/(e?.rates?.GBP||1)}}catch(e){console.warn("⚠️ [RATE-SOURCES] Error parsing ExchangeRate-API:",e)}return{}},timeout:8e3},{name:"Fixer.io",priority:3,url:"https://api.fixer.io/latest?base=USD",parser:e=>{try{return{usd_cop:e?.rates?.COP,eur_usd:1/(e?.rates?.EUR||1),gbp_usd:1/(e?.rates?.GBP||1)}}catch(e){console.warn("⚠️ [RATE-SOURCES] Error parsing Fixer.io:",e)}return{}},timeout:8e3}];async function c(e){let r=new AbortController,s=setTimeout(()=>r.abort(),e.timeout||1e4);try{console.log(`🔍 [RATE-SOURCES] Fetching from ${e.name}...`);let t=await fetch(e.url,{signal:r.signal,headers:{"User-Agent":"IAM-Sistema-Gestion/1.0",Accept:"application/json"}});if(clearTimeout(s),!t.ok)throw Error(`HTTP ${t.status}: ${t.statusText}`);let o=await t.json(),a=e.parser(o);return console.log(`✅ [RATE-SOURCES] ${e.name} success:`,a),{...a,source:e.name,timestamp:new Date().toISOString(),success:!0}}catch(r){return clearTimeout(s),console.error(`❌ [RATE-SOURCES] ${e.name} failed:`,r.message),{source:e.name,timestamp:new Date().toISOString(),success:!1,error:r.message}}}async function l(){console.log("\uD83C\uDF10 [RATE-SOURCES] Starting external rates fetch...");let e=[];for(let r of[...i].sort((e,r)=>e.priority-r.priority))try{let s=await c(r);e.push(s),s.success&&s.usd_cop&&console.log(`✅ [RATE-SOURCES] Got USD→COP from ${r.name}: ${s.usd_cop}`)}catch(s){console.error(`❌ [RATE-SOURCES] Source ${r.name} failed:`,s.message),e.push({source:r.name,timestamp:new Date().toISOString(),success:!1,error:s.message})}return console.log(`🔍 [RATE-SOURCES] Completed. ${e.filter(e=>e.success).length}/${e.length} sources successful`),e}async function p(){try{console.log("\uD83C\uDF10 [RATES-REFERENCE] Starting external rates fetch with multiple sources...");let e=await l(),r=function(e){let r={usd_cop:void 0,eur_usd:void 0,gbp_usd:void 0,sources:[],errors:[]};for(let s of e.filter(e=>e.success))s.usd_cop&&!r.usd_cop&&(r.usd_cop=s.usd_cop,r.sources.push(`${s.source} (USD→COP)`)),s.eur_usd&&!r.eur_usd&&(r.eur_usd=s.eur_usd,r.sources.push(`${s.source} (EUR→USD)`)),s.gbp_usd&&!r.gbp_usd&&(r.gbp_usd=s.gbp_usd,r.sources.push(`${s.source} (GBP→USD)`));return e.forEach(e=>{!e.success&&e.error&&r.errors.push(`${e.source}: ${e.error}`)}),r}(e),s=[];return r.usd_cop&&s.push({kind:"USD_COP",source:"M\xfaltiples fuentes",value:r.usd_cop,url:"https://www.datos.gov.co/api/views/dit9-nnvp/rows.json",lastUpdated:new Date().toISOString(),description:"Tasa USD→COP desde fuentes oficiales colombianas e internacionales"}),r.eur_usd&&s.push({kind:"EUR_USD",source:"M\xfaltiples fuentes",value:r.eur_usd,url:"https://api.exchangerate-api.com/v4/latest/EUR",lastUpdated:new Date().toISOString(),description:"Tasa EUR→USD desde fuentes internacionales"}),r.gbp_usd&&s.push({kind:"GBP_USD",source:"M\xfaltiples fuentes",value:r.gbp_usd,url:"https://api.exchangerate-api.com/v4/latest/GBP",lastUpdated:new Date().toISOString(),description:"Tasa GBP→USD desde fuentes internacionales"}),console.log("\uD83D\uDD0D [RATES-REFERENCE] Final results:",{totalRates:s.length,sources:r.sources,errors:r.errors.length}),u.Z.json({success:!0,data:s,message:"Tasas de referencia obtenidas correctamente",timestamp:new Date().toISOString(),sources:r.sources,errors:r.errors})}catch(e){return console.error("❌ [RATES-REFERENCE] Error fetching reference rates:",e),u.Z.json({success:!1,error:"Error al obtener tasas de referencia",data:[],sources:[],errors:[e.message]},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/rates/reference/route",pathname:"/api/rates/reference",filename:"route",bundlePath:"app/api/rates/reference/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\rates\\reference\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:S,headerHooks:E,staticGenerationBailout:h}=d,f="/api/rates/reference/route";function R(){return(0,n.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:m})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[1638,6206],()=>s(35633));module.exports=t})();