"use strict";(()=>{var e={};e.id=1919,e.ids=[1919],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},58327:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>j,originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>E});var s={};t.r(s),t.d(s,{DELETE:()=>m,POST:()=>d,PUT:()=>p,dynamic:()=>c});var o=t(95419),a=t(69108),i=t(99678),u=t(78070);let n=(0,t(72964).createClient)("https://mhernfrkvwigxdubiozm.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),c="force-dynamic";async function l(e){let r=e.headers.get("authorization");if(!r)return null;let t=r.replace("Bearer ",""),{data:{user:s},error:o}=await n.auth.getUser(t);if(o||!s)return null;let{data:a}=await n.from("users").select("role").eq("id",s.id).single();return a&&("admin"===a.role||"super_admin"===a.role)?s:null}async function d(e){try{let r=await l(e);if(!r)return u.Z.json({success:!1,error:"No autorizado"},{status:403});let{model_id:t,period_date:s,period_type:o,concept:a,amount:i}=await e.json();if(!t||!s||!o||!a||void 0===i)return u.Z.json({success:!1,error:"Datos incompletos"},{status:400});let{data:c,error:d}=await n.from("calculator_deductions").insert({model_id:t,period_date:s,period_type:o,concept:a,amount:Number(i),created_by:r.id}).select().single();if(d)throw d;return u.Z.json({success:!0,deduction:c})}catch(e){return console.error("❌ [DEDUCTIONS] Error creating:",e),u.Z.json({success:!1,error:e.message},{status:500})}}async function p(e){try{if(!await l(e))return u.Z.json({success:!1,error:"No autorizado"},{status:403});let{id:r,concept:t,amount:s}=await e.json();if(!r||!t||void 0===s)return u.Z.json({success:!1,error:"Datos incompletos"},{status:400});let{data:o,error:a}=await n.from("calculator_deductions").update({concept:t,amount:Number(s),updated_at:new Date().toISOString()}).eq("id",r).select().single();if(a)throw a;return u.Z.json({success:!0,deduction:o})}catch(e){return console.error("❌ [DEDUCTIONS] Error updating:",e),u.Z.json({success:!1,error:e.message},{status:500})}}async function m(e){try{if(!await l(e))return u.Z.json({success:!1,error:"No autorizado"},{status:403});let{searchParams:r}=new URL(e.url),t=r.get("id");if(!t)return u.Z.json({success:!1,error:"ID requerido"},{status:400});let{error:s}=await n.from("calculator_deductions").delete().eq("id",t);if(s)throw s;return u.Z.json({success:!0})}catch(e){return console.error("❌ [DEDUCTIONS] Error deleting:",e),u.Z.json({success:!1,error:e.message},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/model/calculator/historial/deductions/route",pathname:"/api/model/calculator/historial/deductions",filename:"route",bundlePath:"app/api/model/calculator/historial/deductions/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\model\\calculator\\historial\\deductions\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:w,headerHooks:j,staticGenerationBailout:E}=h,q="/api/model/calculator/historial/deductions/route";function v(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:g})}}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,2964],()=>t(58327));module.exports=s})();