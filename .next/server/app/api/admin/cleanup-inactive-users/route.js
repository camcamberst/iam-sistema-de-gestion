"use strict";(()=>{var e={};e.id=9507,e.ids=[9507],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},45886:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>D,patchFetch:()=>E,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>_,staticGenerationBailout:()=>v});var s={};r.r(s),r.d(s,{GET:()=>p,POST:()=>d});var a=r(95419),o=r(69108),n=r(99678),i=r(78070),u=r(72964);let c=process.env.SUPABASE_SERVICE_ROLE_KEY,l=(0,u.createClient)("https://mhernfrkvwigxdubiozm.supabase.co",c,{auth:{autoRefreshToken:!1,persistSession:!1}});async function d(e){try{console.log("\uD83E\uDDF9 [ADMIN] Iniciando limpieza manual de usuarios inactivos...");let e=new Date(Date.now()-6e4).toISOString(),{count:t}=await l.from("chat_user_status").select("*",{count:"exact",head:!0}).lt("updated_at",e).eq("is_online",!0),{error:r}=await l.from("chat_user_status").update({is_online:!1}).lt("updated_at",e).eq("is_online",!0);if(r)return console.error("❌ [ADMIN] Error limpiando usuarios inactivos:",r),i.Z.json({success:!1,error:"Error limpiando usuarios inactivos"},{status:500});let{data:s,error:a}=await l.from("chat_user_status").select("*").eq("is_online",!0);a&&console.error("❌ [ADMIN] Error obteniendo estad\xedsticas:",a);let o={timestamp:new Date().toISOString(),usersCleaned:t||0,usersOnline:s?.length||0,cleanupExecuted:!0};return console.log("✅ [ADMIN] Limpieza manual completada:",o),i.Z.json({success:!0,message:`Limpieza manual completada. ${t||0} usuarios marcados como offline.`,stats:o})}catch(e){return console.error("❌ [ADMIN] Error en limpieza manual:",e),i.Z.json({success:!1,error:"Error ejecutando limpieza manual",details:e instanceof Error?e.message:"Error desconocido"},{status:500})}}async function p(e){try{let{data:e,error:t}=await l.from("chat_user_status").select("*").eq("is_online",!0),{data:r,error:s}=await l.from("chat_user_status").select("*");if(t||s)return console.error("❌ [ADMIN] Error obteniendo estad\xedsticas:",t||s),i.Z.json({success:!1,error:"Error obteniendo estad\xedsticas"},{status:500});let a=new Date(Date.now()-6e4).toISOString(),o=r?.filter(e=>e.is_online&&new Date(e.updated_at)<new Date(a))||[],n={timestamp:new Date().toISOString(),usersOnline:e?.length||0,totalUsers:r?.length||0,usersOffline:(r?.length||0)-(e?.length||0),inactiveUsers:o.length,inactiveUsersList:o.map(e=>({user_id:e.user_id,last_seen:e.updated_at,minutes_inactive:Math.floor((new Date().getTime()-new Date(e.updated_at).getTime())/6e4)}))};return i.Z.json({success:!0,stats:n})}catch(e){return console.error("❌ [ADMIN] Error obteniendo estad\xedsticas:",e),i.Z.json({success:!1,error:"Error obteniendo estad\xedsticas",details:e instanceof Error?e.message:"Error desconocido"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/cleanup-inactive-users/route",pathname:"/api/admin/cleanup-inactive-users",filename:"route",bundlePath:"app/api/admin/cleanup-inactive-users/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\admin\\cleanup-inactive-users\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:_,serverHooks:g,headerHooks:f,staticGenerationBailout:v}=m,D="/api/admin/cleanup-inactive-users/route";function E(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:_})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,6206,2964],()=>r(45886));module.exports=s})();