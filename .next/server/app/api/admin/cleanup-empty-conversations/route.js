"use strict";(()=>{var e={};e.id=3183,e.ids=[3183],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},59545:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>E,originalPathname:()=>D,patchFetch:()=>j,requestAsyncStorage:()=>v,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>f});var o={};s.r(o),s.d(o,{GET:()=>p,POST:()=>l});var n=s(95419),t=s(69108),a=s(99678),i=s(78070),c=s(72964);let u=process.env.SUPABASE_SERVICE_ROLE_KEY,d=(0,c.createClient)("https://mhernfrkvwigxdubiozm.supabase.co",u,{auth:{autoRefreshToken:!1,persistSession:!1}});async function l(e){try{console.log("\uD83E\uDDF9 [ADMIN] Iniciando limpieza de conversaciones vac\xedas...");let{data:e,error:r}=await d.from("chat_conversations").select("id");if(r)return console.error("❌ [ADMIN] Error obteniendo conversaciones:",r),i.Z.json({success:!1,error:"Error obteniendo conversaciones"},{status:500});if(!e||0===e.length)return i.Z.json({success:!0,message:"No hay conversaciones para limpiar",stats:{conversationsDeleted:0}});let s=e.map(e=>e.id),{data:o,error:n}=await d.from("chat_messages").select("conversation_id").in("conversation_id",s);if(n)return console.error("❌ [ADMIN] Error obteniendo mensajes:",n),i.Z.json({success:!1,error:"Error obteniendo mensajes"},{status:500});let t=new Set(o?.map(e=>e.conversation_id)||[]),a=e.filter(e=>!t.has(e.id));if(0===a.length)return i.Z.json({success:!0,message:"No hay conversaciones vac\xedas para eliminar",stats:{conversationsDeleted:0}});let c=a.map(e=>e.id),{error:u}=await d.from("chat_conversations").delete().in("id",c);if(u)return console.error("❌ [ADMIN] Error eliminando conversaciones vac\xedas:",u),i.Z.json({success:!1,error:"Error eliminando conversaciones vac\xedas"},{status:500});let l={timestamp:new Date().toISOString(),totalConversations:e.length,conversationsWithMessages:t.size,conversationsDeleted:a.length};return console.log("✅ [ADMIN] Limpieza de conversaciones vac\xedas completada:",l),i.Z.json({success:!0,message:`${a.length} conversaciones vac\xedas eliminadas`,stats:l})}catch(e){return console.error("❌ [ADMIN] Error en limpieza de conversaciones vac\xedas:",e),i.Z.json({success:!1,error:"Error ejecutando limpieza de conversaciones vac\xedas",details:e instanceof Error?e.message:"Error desconocido"},{status:500})}}async function p(e){try{let{data:e,error:r}=await d.from("chat_conversations").select("id");if(r)return console.error("❌ [ADMIN] Error obteniendo conversaciones:",r),i.Z.json({success:!1,error:"Error obteniendo conversaciones"},{status:500});let s=e?.map(e=>e.id)||[],{data:o,error:n}=await d.from("chat_messages").select("conversation_id").in("conversation_id",s);if(n)return console.error("❌ [ADMIN] Error obteniendo mensajes:",n),i.Z.json({success:!1,error:"Error obteniendo mensajes"},{status:500});let t=new Set(o?.map(e=>e.conversation_id)||[]),a=e?.filter(e=>!t.has(e.id))||[],c={timestamp:new Date().toISOString(),totalConversations:e?.length||0,conversationsWithMessages:t.size,emptyConversations:a.length,emptyConversationIds:a.map(e=>e.id)};return i.Z.json({success:!0,stats:c})}catch(e){return console.error("❌ [ADMIN] Error obteniendo estad\xedsticas:",e),i.Z.json({success:!1,error:"Error obteniendo estad\xedsticas",details:e instanceof Error?e.message:"Error desconocido"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:t.x.APP_ROUTE,page:"/api/admin/cleanup-empty-conversations/route",pathname:"/api/admin/cleanup-empty-conversations",filename:"route",bundlePath:"app/api/admin/cleanup-empty-conversations/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\admin\\cleanup-empty-conversations\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:v,staticGenerationAsyncStorage:h,serverHooks:g,headerHooks:E,staticGenerationBailout:f}=m,D="/api/admin/cleanup-empty-conversations/route";function j(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),o=r.X(0,[1638,6206,2964],()=>s(59545));module.exports=o})();