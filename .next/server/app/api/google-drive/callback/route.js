"use strict";(()=>{var e={};e.id=2097,e.ids=[2097],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},85158:e=>{e.exports=require("http2")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},72254:e=>{e.exports=require("node:buffer")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},87503:e=>{e.exports=require("node:net")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},77282:e=>{e.exports=require("process")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},35345:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>_,originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>h,routeModule:()=>l,serverHooks:()=>q,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>g});var o={};t.r(o),t.d(o,{GET:()=>c,dynamic:()=>d});var s=t(95419),a=t(69108),i=t(99678),n=t(78070),u=t(73355),p=t(66569);let d="force-dynamic";async function c(e){try{let{searchParams:r}=new URL(e.url),t=r.get("code"),o=r.get("state"),s=r.get("error");if(s)return console.error("❌ [GOOGLE-DRIVE-CALLBACK] Error de OAuth:",s),n.Z.redirect(`http://localhost:3000/admin/sedes/portafolio?oauth_error=${encodeURIComponent(s)}`);if(!t||!o)return n.Z.redirect("http://localhost:3000/admin/sedes/portafolio?oauth_error=missing_code_or_state");let a=process.env.GOOGLE_CLIENT_ID,i=process.env.GOOGLE_CLIENT_SECRET,d=process.env.GOOGLE_REDIRECT_URI||"http://localhost:3000/api/google-drive/callback";if(!a||!i)return n.Z.redirect("http://localhost:3000/admin/sedes/portafolio?oauth_error=oauth_not_configured");let c=new u.lkr.auth.OAuth2(a,i,d),{tokens:l}=await c.getToken(t);if(!l.access_token)return n.Z.redirect("http://localhost:3000/admin/sedes/portafolio?oauth_error=no_access_token");let h=p.R,{error:x}=await h.from("users").update({metadata:{...(await h.from("users").select("metadata").eq("id",o).single()).data?.metadata||{},google_drive:{access_token:l.access_token,refresh_token:l.refresh_token,expiry_date:l.expiry_date,token_type:l.token_type,scope:l.scope}},updated_at:new Date().toISOString()}).eq("id",o);if(x)return console.error("❌ [GOOGLE-DRIVE-CALLBACK] Error guardando tokens:",x),n.Z.redirect("http://localhost:3000/admin/sedes/portafolio?oauth_error=save_tokens_failed");return console.log("✅ [GOOGLE-DRIVE-CALLBACK] Tokens guardados exitosamente para usuario:",o),n.Z.redirect("http://localhost:3000/admin/sedes/portafolio?oauth_success=true")}catch(e){return console.error("❌ [GOOGLE-DRIVE-CALLBACK] Error general:",e),n.Z.redirect(`http://localhost:3000/admin/sedes/portafolio?oauth_error=${encodeURIComponent(e.message||"unknown_error")}`)}}let l=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/google-drive/callback/route",pathname:"/api/google-drive/callback",filename:"route",bundlePath:"app/api/google-drive/callback/route"},resolvedPagePath:"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\api\\google-drive\\callback\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:q,headerHooks:_,staticGenerationBailout:g}=l,m="/api/google-drive/callback/route";function f(){return(0,i.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:x})}},66569:(e,r,t)=>{t.d(r,{A:()=>n,R:()=>i});var o=t(72964);let s="https://mhernfrkvwigxdubiozm.supabase.co",a=process.env.SUPABASE_SERVICE_ROLE_KEY||"",i=(0,o.createClient)(s,a,{auth:{autoRefreshToken:!1,persistSession:!1}}),n=(0,o.createClient)(s,a,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1638,6206,2964,3355],()=>t(35345));module.exports=o})();