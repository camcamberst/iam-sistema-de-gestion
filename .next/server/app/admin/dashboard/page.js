(()=>{var e={};e.id=8427,e.ids=[8427],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},21554:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>d.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>n});var a=t(50482),s=t(69108),i=t(62563),d=t.n(i),l=t(68300),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(r,o);let n=["",{children:["admin",{children:["dashboard",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,28751)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\dashboard\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,66294)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,41878)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\dashboard\\page.tsx"],m="/admin/dashboard/page",u={require:t,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/dashboard/page",pathname:"/admin/dashboard",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:n}})},88973:(e,r,t)=>{Promise.resolve().then(t.bind(t,30761))},30761:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c});var a=t(95344),s=t(3729),i=t(72829),d=t(15807),l=t(8421),o=t(8228),n=t(70577);function c(){let[e,r]=(0,s.useState)({total:0,super_admin:0,admin:0,modelo:0}),[t,c]=(0,s.useState)(!0),[m,u]=(0,s.useState)(null),[x,g]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{try{c(!0);let{data:e}=await i.O.auth.getUser(),t=e?.user?.id;if(!t){u(null),c(!1);return}let{data:a}=await i.O.from("users").select("id,name,email,role").eq("id",t).single(),s=[];if(a&&"super_admin"!==a.role){let{data:e}=await i.O.from("user_groups").select("groups(name)").eq("user_id",t);s=(e||[]).map(e=>e.groups?.name).filter(Boolean)}let d={id:a?.id||t,name:a?.name||e.user?.email?.split("@")[0]||"Usuario",email:a?.email||e.user?.email||"",role:a?.role||"modelo",groups:s};u(d);let{data:l}=await i.O.from("users").select("id,role");if(l){let e=l;if("admin"===d.role){if(0===d.groups.length){r({total:0,super_admin:0,admin:0,modelo:0});return}let{data:t}=await i.O.from("user_groups").select("user_id, groups(name)").in("groups.name",d.groups);if(!t||0===t.length){r({total:0,super_admin:0,admin:0,modelo:0});return}let a=new Set((t||[]).map(e=>e.user_id));e=l.filter(e=>a.has(e.id))}let t=e.length,a=e.filter(e=>"super_admin"===e.role).length,s=e.filter(e=>"admin"===e.role).length,o=e.filter(e=>"modelo"===e.role).length;r({total:t,super_admin:a,admin:s,modelo:o})}}finally{c(!1)}})()},[]),(0,s.useEffect)(()=>{(async()=>{if(m&&"modelo"===m.role)try{let e=await fetch("/api/rates-v2?activeOnly=true"),r=await e.json(),t={usd_cop:r?.data?.find(e=>"USD→COP"===e.kind)?.value||3900,eur_usd:r?.data?.find(e=>"EUR→USD"===e.kind)?.value||1.01,gbp_usd:r?.data?.find(e=>"GBP→USD"===e.kind)?.value||1.2},a=await fetch(`/api/calculator/config-v2?userId=${m.id}`),s=await a.json(),i=(s?.config?.platforms||[]).filter(e=>e.enabled),l=i[0]?.percentage_override||i[0]?.group_percentage||80,o=i[0]?.min_quota_override||i[0]?.group_min_quota||470,n=(0,d.iR)(),c=await fetch(`/api/calculator/model-values-v2?modelId=${m.id}&periodDate=${n}`),u=await c.json(),x=u?.data||[],p={};x.forEach(e=>{p[e.platform_id]=Number(e.value)||0});let h=0,v=0;for(let e of i){let r=p[e.id]||0;if(r<=0)continue;let a=0;a="EUR"===e.currency?"big7"===e.id?r*t.eur_usd*.84:"mondo"===e.id?r*t.eur_usd*.78:r*t.eur_usd:"GBP"===e.currency?"aw"===e.id?r*t.gbp_usd*.677:r*t.gbp_usd:"cmd"===e.id||"camlust"===e.id||"skypvt"===e.id?.75*r:"chaturbate"===e.id||"myfreecams"===e.id||"stripchat"===e.id?.05*r:"dxlive"===e.id?.6*r:"secretfriends"===e.id?.5*r:r,h+=a,v+=a*l/100}let b=v*t.usd_cop,f=Math.max(0,Math.min(100,h/o*100));g({usdBruto:h,usdModelo:v,copModelo:b,goalUsd:o,pct:f})}catch(e){console.warn("⚠️ resumen productividad:",e)}})()},[m]),a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,a.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:[a.jsx("div",{className:"mb-12",children:(0,a.jsxs)("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 to-indigo-600/10 rounded-xl blur-xl"}),a.jsx("div",{className:"relative bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md",children:a.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:"Dashboard"}),m&&(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-300",children:["Bienvenido, ",m.name," \xb7 Rol: ",String(m.role).replace("_"," "),"super_admin"!==m.role&&m.groups.length>0&&` \xb7 Grupos: ${m.groups.join(", ")}`]})]})]})})]})}),m?.role==="admin"&&0===m.groups.length&&a.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Sin grupos asignados"}),a.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:a.jsx("p",{children:"No tienes grupos asignados. Contacta al Super Admin para obtener acceso a los datos de gesti\xf3n."})})]})]})}),(m?.role==="super_admin"||m?.role==="admin")&&(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10",children:[a.jsx(l.Z,{compact:!0}),a.jsx(n.Z,{userRole:m.role,userId:m.id,userGroups:m.groups})]}),(m?.role==="super_admin"||m?.role==="admin")&&a.jsx("div",{className:"mb-10",children:a.jsx(o.Z,{userRole:m.role,userGroups:m.groups})}),m?.role==="modelo"&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-700/20 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[a.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:a.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),a.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Mi perfil"})]}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 mb-4",children:"Revisa tu informaci\xf3n"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:["Email: ",m.email]}),(0,a.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:["Grupo: ",m.groups[0]||"—"]})]})]}),(0,a.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-700/20 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[a.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:a.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),a.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Resumen de Productividad"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-blue-50 text-center",children:[a.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"USD Bruto (hoy)"}),(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:["$",x?x.usdBruto.toFixed(2):"—"]})]}),(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-green-50 text-center",children:[a.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"USD Modelo (hoy)"}),(0,a.jsxs)("div",{className:"text-lg font-bold text-green-600",children:["$",x?x.usdModelo.toFixed(2):"—"]})]}),(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-purple-50 text-center",children:[a.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"COP Modelo (hoy)"}),a.jsx("div",{className:"text-lg font-bold text-purple-600",children:x?x.copModelo.toLocaleString("es-CO",{maximumFractionDigits:0}):"—"})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100",children:"Objetivo B\xe1sico"}),(0,a.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["$",x?x.usdBruto.toFixed(0):"—"," / $",x?x.goalUsd.toFixed(0):"—"," USD"]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:a.jsx("div",{className:"h-2 bg-gradient-to-r from-green-500 to-emerald-500 transition-all",style:{width:`${x?Math.min(100,x.pct).toFixed(0):0}%`}})}),(0,a.jsxs)("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 mt-1",children:[x?Math.min(100,x.pct).toFixed(0):0,"%"]})]}),(0,a.jsxs)("div",{className:"mt-4 text-xs text-gray-600 dark:text-gray-300",children:["Para actualizar tus valores usa el men\xfa ",a.jsx("a",{href:"/model/calculator",className:"text-blue-600 hover:text-blue-800 underline font-medium",children:"Mi Calculadora"}),"."]})]})]})]})})}},28751:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>i,__esModule:()=>s,default:()=>d});let a=(0,t(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\app\admin\dashboard\page.tsx`),{__esModule:s,$$typeof:i}=a,d=a.default}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[1638,6611,5558,5094,9609,1110,2360],()=>t(21554));module.exports=a})();