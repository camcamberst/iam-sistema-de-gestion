(()=>{var e={};e.id=8427,e.ids=[8427],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},21554:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>d.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>n});var r=a(50482),t=a(69108),i=a(62563),d=a.n(i),l=a(68300),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);a.d(s,o);let n=["",{children:["admin",{children:["dashboard",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,28751)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\dashboard\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,66294)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,41878)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,69361,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\dashboard\\page.tsx"],m="/admin/dashboard/page",u={require:a,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:t.x.APP_PAGE,page:"/admin/dashboard/page",pathname:"/admin/dashboard",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:n}})},88973:(e,s,a)=>{Promise.resolve().then(a.bind(a,30761))},30761:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>x});var r=a(95344),t=a(3729),i=a(22254),d=a(72829),l=a(15807),o=a(8421),n=a(87502),c=a(70577),m=a(26678),u=a(77098);function x(){(0,i.useRouter)();let[e,s]=(0,t.useState)({total:0,super_admin:0,admin:0,modelo:0}),[a,x]=(0,t.useState)(!0),[g,p]=(0,t.useState)(null),[h,f]=(0,t.useState)([]),[b,v]=(0,t.useState)(null);return(0,t.useEffect)(()=>{(async()=>{try{x(!0);let{data:e}=await d.supabase.auth.getUser(),a=e?.user?.id;if(!a){p(null),x(!1);return}let{data:r}=await d.supabase.from("users").select("id,name,email,role,affiliate_studio_id").eq("id",a).single(),t=[],i=[];if(r&&"super_admin"!==r.role){let{data:e}=await d.supabase.from("user_groups").select("group_id, groups(name)").eq("user_id",a);t=(e||[]).map(e=>e.groups?.name).filter(Boolean),i=(e||[]).map(e=>e.group_id).filter(Boolean)}let l={id:r?.id||a,name:r?.name||e.user?.email?.split("@")[0]||"Usuario",email:r?.email||e.user?.email||"",role:r?.role||"modelo",groups:t};p(l),f(i);let o=d.supabase.from("users").select("id,role,affiliate_studio_id");"superadmin_aff"===l.role&&r?.affiliate_studio_id&&(o=o.eq("affiliate_studio_id",r.affiliate_studio_id));let{data:n}=await o;if(n){let e=n;if("admin"===l.role){if(0===l.groups.length){s({total:0,super_admin:0,admin:0,modelo:0});return}let{data:a}=await d.supabase.from("user_groups").select("user_id, groups(name)").in("groups.name",l.groups);if(!a||0===a.length){s({total:0,super_admin:0,admin:0,modelo:0});return}let r=new Set((a||[]).map(e=>e.user_id));e=n.filter(e=>r.has(e.id))}let a=e.length,r=e.filter(e=>"super_admin"===e.role).length,t=e.filter(e=>"admin"===e.role).length,i=e.filter(e=>"modelo"===e.role).length;s({total:a,super_admin:r,admin:t,modelo:i})}}finally{x(!1)}})()},[]),(0,t.useEffect)(()=>{(async()=>{if(g&&"modelo"===g.role)try{let e=await fetch("/api/rates-v2?activeOnly=true"),s=await e.json(),a={usd_cop:s?.data?.find(e=>"USD→COP"===e.kind)?.value||3900,eur_usd:s?.data?.find(e=>"EUR→USD"===e.kind)?.value||1.01,gbp_usd:s?.data?.find(e=>"GBP→USD"===e.kind)?.value||1.2},r=await fetch(`/api/calculator/config-v2?userId=${g.id}`),t=await r.json(),i=(t?.config?.platforms||[]).filter(e=>e.enabled),d=i[0]?.percentage_override||i[0]?.group_percentage||80,o=i[0]?.min_quota_override||i[0]?.group_min_quota||470,n=(0,l.iR)(),c=await fetch(`/api/calculator/model-values-v2?modelId=${g.id}&periodDate=${n}`),m=await c.json(),u=m?.data||[],x={};u.forEach(e=>{x[e.platform_id]=Number(e.value)||0});let p=0,h=0;for(let e of i){let s=x[e.id]||0;if(s<=0)continue;let r=0;r="EUR"===e.currency?"big7"===e.id?s*a.eur_usd*.84:"mondo"===e.id?s*a.eur_usd*.78:s*a.eur_usd:"GBP"===e.currency?"aw"===e.id?s*a.gbp_usd*.677:s*a.gbp_usd:"cmd"===e.id||"camlust"===e.id||"skypvt"===e.id?.75*s:"chaturbate"===e.id||"myfreecams"===e.id||"stripchat"===e.id?.05*s:"dxlive"===e.id?.6*s:"secretfriends"===e.id?.5*s:s,p+=r,h+=r*d/100}let f=h*a.usd_cop,b=Math.max(0,Math.min(100,p/o*100));v({usdBruto:p,usdModelo:h,copModelo:f,goalUsd:o,pct:b})}catch(e){console.warn("⚠️ resumen productividad:",e)}})()},[g]),r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,r.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:[r.jsx("div",{className:"mb-8 sm:mb-12",children:(0,r.jsxs)("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 to-indigo-600/10 rounded-xl blur-xl"}),r.jsx("div",{className:"relative bg-white/80 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:r.jsx("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 md:gap-3",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[r.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:r.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[r.jsx("h1",{className:"text-base sm:text-lg md:text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:"Dashboard"}),g&&(0,r.jsxs)("p",{className:"mt-1 text-xs sm:text-sm text-gray-600 dark:text-gray-300 hidden sm:block",children:["Bienvenido, ",g.name," \xb7 Rol: ",String(g.role).replace("_"," "),"super_admin"!==g.role&&g.groups.length>0&&` \xb7 Grupos: ${g.groups.join(", ")}`]})]})]})})})]})}),r.jsx(u.Z,{}),g?.role==="admin"&&0===g.groups.length&&r.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:r.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{className:"ml-3",children:[r.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Sin grupos asignados"}),r.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:r.jsx("p",{children:"No tienes grupos asignados. Contacta al Super Admin para obtener acceso a los datos de gesti\xf3n."})})]})]})}),(g?.role==="super_admin"||g?.role==="admin"||g?.role==="superadmin_aff")&&(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10",children:[r.jsx(o.Z,{compact:!0,userRole:g.role}),r.jsx(c.Z,{userRole:g.role,userId:g.id,userGroups:g.groups})]}),g&&("super_admin"===g.role||"admin"===g.role||"superadmin_aff"===g.role)&&r.jsx("div",{className:"mb-8",children:r.jsx(m.Z,{userId:g.id,userGroups:h,userRole:g.role})}),(g?.role==="super_admin"||g?.role==="admin"||g?.role==="superadmin_aff")&&r.jsx("div",{className:"mb-10",children:r.jsx(n.Z,{userRole:g.role,userGroups:g.groups,userId:g.id})}),g?.role==="modelo"&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-700/20 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[r.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:r.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),r.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Mi perfil"})]}),r.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 mb-4",children:"Revisa tu informaci\xf3n"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:["Email: ",g.email]}),(0,r.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:["Grupo: ",g.groups[0]||"—"]})]})]}),(0,r.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-700/20 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[r.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:r.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),r.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Resumen de Productividad"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-blue-50 text-center",children:[r.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"USD Bruto (hoy)"}),(0,r.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:["$",b?b.usdBruto.toFixed(2):"—"]})]}),(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-green-50 text-center",children:[r.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"USD Modelo (hoy)"}),(0,r.jsxs)("div",{className:"text-lg font-bold text-green-600",children:["$",b?b.usdModelo.toFixed(2):"—"]})]}),(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-purple-50 text-center",children:[r.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"COP Modelo (hoy)"}),r.jsx("div",{className:"text-lg font-bold text-purple-600",children:b?b.copModelo.toLocaleString("es-CO",{maximumFractionDigits:0}):"—"})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100",children:"Objetivo B\xe1sico"}),(0,r.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["$",b?b.usdBruto.toFixed(0):"—"," / $",b?b.goalUsd.toFixed(0):"—"," USD"]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:r.jsx("div",{className:"h-2 bg-gradient-to-r from-green-500 to-emerald-500 transition-all",style:{width:`${b?Math.min(100,b.pct).toFixed(0):0}%`}})}),(0,r.jsxs)("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 mt-1",children:[b?Math.min(100,b.pct).toFixed(0):0,"%"]})]}),(0,r.jsxs)("div",{className:"mt-4 text-xs text-gray-600 dark:text-gray-300",children:["Para actualizar tus valores usa el men\xfa ",r.jsx("a",{href:"/model/calculator",className:"text-blue-600 hover:text-blue-800 underline font-medium",children:"Mi Calculadora"}),"."]})]})]})]})})}},28751:(e,s,a)=>{"use strict";a.r(s),a.d(s,{$$typeof:()=>i,__esModule:()=>t,default:()=>d});let r=(0,a(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\app\admin\dashboard\page.tsx`),{__esModule:t,$$typeof:i}=r,d=r.default}};var s=require("../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),r=s.X(0,[1638,6611,6654,1586,478,1582,1110,9237,5169,6678],()=>a(21554));module.exports=r})();