(()=>{var e={};e.id=692,e.ids=[692],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},67511:(e,r,a)=>{"use strict";a.r(r),a.d(r,{GlobalError:()=>o.a,__next_app__:()=>g,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>i});var t=a(50482),s=a(69108),n=a(62563),o=a.n(n),l=a(68300),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);a.d(r,d);let i=["",{children:["admin",{children:["calculator",{children:["create-platform",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,74420)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\calculator\\create-platform\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,66294)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,41878)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,69361,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\calculator\\create-platform\\page.tsx"],u="/admin/calculator/create-platform/page",g={require:a,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/calculator/create-platform/page",pathname:"/admin/calculator/create-platform",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:i}})},16725:(e,r,a)=>{Promise.resolve().then(a.bind(a,88711))},88711:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>l});var t=a(95344),s=a(3729),n=a(22254);let o=(0,a(36654).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c");function l(){let e=(0,n.useRouter)(),[r,a]=(0,s.useState)(!1),[l,d]=(0,s.useState)(null),[i,c]=(0,s.useState)(!1),[u,g]=(0,s.useState)(null),[m,x]=(0,s.useState)(!0),[p,b]=(0,s.useState)({name:"",description:"",type:"tokens",currency:"USD",token_rate:"",discount_factor:"",tax_rate:"",direct_payout:!1,payment_frequency:"quincenal"}),y=e=>e?e.toLowerCase().trim().replace(/[^a-z0-9\s_-]/g,"").replace(/\s+/g,"_").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,""):"";(0,s.useEffect)(()=>{(async function(){try{let{data:{user:r}}=await o.auth.getUser();if(!r){e.push("/");return}let{data:a,error:t}=await o.from("users").select("id, role").eq("id",r.id).single();if(t||!a||"super_admin"!==a.role){e.push("/admin/dashboard");return}g(a),x(!1)}catch(r){console.error("Error checking auth:",r),e.push("/admin/dashboard")}})()},[e]);let h=async r=>{r.preventDefault(),a(!0),d(null),c(!1);try{if(!u)throw Error("Usuario no autenticado");let r=y(p.name);if(!r)throw Error("El nombre de la plataforma es requerido para generar el ID");let a={id:r,name:p.name.trim(),description:p.description.trim()||null,currency:p.currency,payment_frequency:p.payment_frequency,direct_payout:p.direct_payout,created_by:u.id};if("tokens"===p.type){if(!p.token_rate)throw Error("Tasa de conversi\xf3n de tokens es requerida");a.token_rate=parseFloat(p.token_rate),a.discount_factor=null,a.tax_rate=null}else if("credits"===p.type){if(!p.discount_factor)throw Error("Factor de descuento es requerido");a.discount_factor=parseFloat(p.discount_factor),a.token_rate=null,a.tax_rate=null}else"currency"===p.type?(p.discount_factor&&(a.discount_factor=parseFloat(p.discount_factor)),p.tax_rate&&(a.tax_rate=parseFloat(p.tax_rate)),a.token_rate=null):"direct"===p.type&&(a.direct_payout=!0,a.token_rate=null,a.discount_factor=null,a.tax_rate=null);let t=await fetch("/api/calculator/platforms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),s=await t.json();if(!s.success)throw Error(s.error||"Error al crear plataforma");c(!0),setTimeout(()=>{e.push("/admin/calculator/config")},2e3)}catch(e){d(e.message||"Error al crear plataforma")}finally{a(!1)}};return m?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),t.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Verificando permisos..."})]})}):t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,t.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:[t.jsx("div",{className:"mb-8 sm:mb-12",children:(0,t.jsxs)("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 to-indigo-600/10 rounded-xl blur-xl"}),t.jsx("div",{className:"relative bg-white/80 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:t.jsx("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 md:gap-3",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[t.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:t.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[t.jsx("h1",{className:"text-base sm:text-lg md:text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:"Crear Nueva Plataforma"}),t.jsx("p",{className:"mt-1 text-xs sm:text-sm text-gray-600 dark:text-gray-300 hidden sm:block",children:"Define los criterios y f\xf3rmulas de conversi\xf3n para la nueva plataforma"})]})]})})})]})}),t.jsx("form",{onSubmit:h,className:"space-y-4",children:(0,t.jsxs)("div",{className:"bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl p-4 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Nombre de la Plataforma *"}),t.jsx("input",{type:"text",value:p.name,onChange:e=>b({...p,name:e.target.value}),placeholder:"ej: Nueva Plataforma",className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),p.name&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:["ID generado: ",t.jsx("span",{className:"font-mono text-blue-600 dark:text-blue-400",children:y(p.name)})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Descripci\xf3n"}),t.jsx("input",{type:"text",value:p.description,onChange:e=>b({...p,description:e.target.value}),placeholder:"Descripci\xf3n opcional",className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Tipo de Plataforma *"}),(0,t.jsxs)("select",{value:p.type,onChange:e=>b({...p,type:e.target.value}),className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[t.jsx("option",{value:"tokens",children:"Tokens (ej: Chaturbate)"}),t.jsx("option",{value:"credits",children:"Cr\xe9ditos con Descuento (ej: CMD)"}),t.jsx("option",{value:"currency",children:"Divisa (EUR/GBP)"}),t.jsx("option",{value:"direct",children:"Pago Directo 100%"})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Moneda Base *"}),(0,t.jsxs)("select",{value:p.currency,onChange:e=>b({...p,currency:e.target.value}),className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[t.jsx("option",{value:"USD",children:"USD (D\xf3lar)"}),t.jsx("option",{value:"EUR",children:"EUR (Euro)"}),t.jsx("option",{value:"GBP",children:"GBP (Libra Esterlina)"})]})]})]}),"tokens"===p.type&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Tasa de Conversi\xf3n de Tokens *"}),t.jsx("input",{type:"number",step:"0.0001",min:"0",max:"1",value:p.token_rate,onChange:e=>b({...p,token_rate:e.target.value}),placeholder:"ej: 0.05",className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:"USD por 1 token (0.05 = 100 tokens = 5 USD)"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Frecuencia de Pago"}),(0,t.jsxs)("select",{value:p.payment_frequency,onChange:e=>b({...p,payment_frequency:e.target.value}),className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"quincenal",children:"Quincenal"}),t.jsx("option",{value:"mensual",children:"Mensual"})]})]})]}),"credits"===p.type&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Factor de Descuento *"}),t.jsx("input",{type:"number",step:"0.01",min:"0",max:"1",value:p.discount_factor,onChange:e=>b({...p,discount_factor:e.target.value}),placeholder:"ej: 0.75",className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:"0.75 = 75% del valor (25% descuento)"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Frecuencia de Pago"}),(0,t.jsxs)("select",{value:p.payment_frequency,onChange:e=>b({...p,payment_frequency:e.target.value}),className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"quincenal",children:"Quincenal"}),t.jsx("option",{value:"mensual",children:"Mensual"})]})]})]}),"currency"===p.type&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Factor de Descuento (Opcional)"}),t.jsx("input",{type:"number",step:"0.01",min:"0",max:"1",value:p.discount_factor,onChange:e=>b({...p,discount_factor:e.target.value}),placeholder:"ej: 0.78",className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Tasa de Impuesto (Opcional)"}),t.jsx("input",{type:"number",step:"0.01",min:"0",max:"1",value:p.tax_rate,onChange:e=>b({...p,tax_rate:e.target.value}),placeholder:"ej: 0.16",className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:"0.16 = 16% impuesto"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Frecuencia de Pago"}),(0,t.jsxs)("select",{value:p.payment_frequency,onChange:e=>b({...p,payment_frequency:e.target.value}),className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"quincenal",children:"Quincenal"}),t.jsx("option",{value:"mensual",children:"Mensual"})]})]})]}),"direct"===p.type&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Frecuencia de Pago"}),(0,t.jsxs)("select",{value:p.payment_frequency,onChange:e=>b({...p,payment_frequency:e.target.value}),className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"quincenal",children:"Quincenal"}),t.jsx("option",{value:"mensual",children:"Mensual"})]})]}),t.jsx("div",{className:"flex items-end",children:t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Pago directo 100% para la modelo"})})]}),(l||i)&&t.jsx("div",{className:`rounded-lg p-3 mb-4 ${l?"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800":"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800"}`,children:t.jsx("p",{className:`text-sm ${l?"text-red-800 dark:text-red-200":"text-green-800 dark:text-green-200"}`,children:l||"âœ… Plataforma creada exitosamente. Redirigiendo..."})}),(0,t.jsxs)("div",{className:"flex gap-3 justify-end pt-2 border-t border-gray-200 dark:border-gray-600",children:[t.jsx("button",{type:"button",onClick:()=>e.back(),className:"px-4 py-2 text-sm bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Cancelar"}),t.jsx("button",{type:"submit",disabled:r,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md",children:r?"Creando...":"Crear Plataforma"})]})]})})]})})}},97075:(e,r,a)=>{"use strict";a.d(r,{Z:()=>u});var t=a(3729);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,a)=>a?a.toUpperCase():r.toLowerCase()),o=e=>{let r=n(e);return r.charAt(0).toUpperCase()+r.slice(1)},l=(...e)=>e.filter((e,r,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===r).join(" ").trim(),d=e=>{for(let r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,t.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:s,className:n="",children:o,iconNode:c,...u},g)=>(0,t.createElement)("svg",{ref:g,...i,width:r,height:r,stroke:e,strokeWidth:s?24*Number(a)/Number(r):a,className:l("lucide",n),...!o&&!d(u)&&{"aria-hidden":"true"},...u},[...c.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(o)?o:[o]])),u=(e,r)=>{let a=(0,t.forwardRef)(({className:a,...n},d)=>(0,t.createElement)(c,{ref:d,iconNode:r,className:l(`lucide-${s(o(e))}`,`lucide-${e}`,a),...n}));return a.displayName=o(e),a}},25545:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(97075).Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},74420:(e,r,a)=>{"use strict";a.r(r),a.d(r,{$$typeof:()=>n,__esModule:()=>s,default:()=>o});let t=(0,a(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\app\admin\calculator\create-platform\page.tsx`),{__esModule:s,$$typeof:n}=t,o=t.default}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[1638,6611,6654,1586,1582,1110],()=>a(67511));module.exports=t})();