(()=>{var e={};e.id=2927,e.ids=[2927],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},98992:(e,r,a)=>{"use strict";a.r(r),a.d(r,{GlobalError:()=>l.a,__next_app__:()=>g,originalPathname:()=>c,pages:()=>u,routeModule:()=>x,tree:()=>i});var t=a(50482),s=a(69108),o=a(62563),l=a.n(o),d=a(68300),n={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);a.d(r,n);let i=["",{children:["admin",{children:["users",{children:["create",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,14049)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\users\\create\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,66294)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,41878)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,69361,23)),"next/dist/client/components/not-found-error"]}],u=["C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\users\\create\\page.tsx"],c="/admin/users/create/page",g={require:a,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/users/create/page",pathname:"/admin/users/create",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:i}})},57664:(e,r,a)=>{Promise.resolve().then(a.bind(a,49509))},49509:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>n});var t=a(95344),s=a(3729),o=a(22254),l=a(71145),d=a(72829);function n(){let e=(0,o.useRouter)(),[r,a]=(0,s.useState)({name:"",email:"",password:"",role:"modelo",groups:[],room_id:"",jornada:""}),[n,i]=(0,s.useState)(!1),[u,c]=(0,s.useState)(null),[g,x]=(0,s.useState)(null),[m,p]=(0,s.useState)([]),[b,h]=(0,s.useState)(!1),[y,f]=(0,s.useState)(!1),[v,k]=(0,s.useState)([]),[j,w]=(0,s.useState)(!1),[N,C]=(0,s.useState)(!1),[E,S]=(0,s.useState)(null),_=m.find(e=>e.id===r.groups[0])?.name||"";(0,s.useEffect)(()=>{(async()=>{try{h(!0);let{data:{user:e}}=await d.O.auth.getUser();if(e)try{let{data:r,error:a}=await d.O.from("users").select(`
                role,
                user_groups(
                  groups!inner(
                    id,
                    name
                  )
                )
              `).eq("id",e.id).single();if(a)console.error("Error obteniendo datos del usuario:",a),S({role:"admin",groups:[]});else if(r){let e=r.user_groups?.map(e=>e.groups.id)||[];S({role:r.role,groups:e})}}catch(e){console.error("Error en consulta de usuario:",e),S({role:"admin",groups:[]})}let r=await fetch("/api/groups"),a=await r.json();a.success&&p(a.groups)}finally{h(!1)}})()},[]);let P=async e=>{if(!e){k([]);return}w(!0);try{let r=await fetch(`/api/groups/rooms?groupId=${e}`),a=await r.json();a.success?k(a.rooms):(console.error("Error loading rooms:",a.error),k([]))}catch(e){console.error("Error loading rooms:",e),k([])}finally{w(!1)}};async function D(t){t.preventDefault(),i(!0),c(null),x(null);try{let t={...r,group_ids:r.groups,groups:void 0};delete t.groups,console.log("\uD83D\uDD0D [FRONTEND] Enviando datos a la API:",t);let s=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await s.json();console.log("\uD83D\uDD0D [FRONTEND] Respuesta de la API:",o),s.ok&&o.success?(x("Usuario creado exitosamente"),a({name:"",email:"",password:"",role:"modelo",groups:[],room_id:"",jornada:""}),setTimeout(()=>{e.push("/admin/users")},2e3)):c(o.error||"Error creando usuario")}catch(e){console.error("Error:",e),c("Error de conexi\xf3n. Por favor, intenta nuevamente.")}finally{i(!1)}}return(0,s.useEffect)(()=>{r.groups.length>0?P(r.groups[0]):k([])},[r.groups]),t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,t.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:[t.jsx("div",{className:"mb-8",children:t.jsx("div",{className:"bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md",children:t.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:"Crear Usuario"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:"Registra un nuevo usuario en el sistema"})]})]})})}),t.jsx("div",{className:"max-w-lg",children:(0,t.jsxs)("div",{className:"bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-2 dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15",children:[u&&t.jsx("div",{className:"mb-4 p-3 bg-red-50/80 dark:bg-red-900/20 backdrop-blur-sm border border-red-200/50 dark:border-red-700/50 rounded-lg shadow-sm",children:(0,t.jsxs)("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-sm flex items-center justify-center",children:t.jsx("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})})}),t.jsx("div",{className:"ml-3",children:t.jsx("p",{className:"text-sm text-red-800 dark:text-red-300",children:u})})]})}),g&&t.jsx("div",{className:"mb-4 p-3 bg-green-50/80 dark:bg-green-900/20 backdrop-blur-sm border border-green-200/50 dark:border-green-700/50 rounded-lg shadow-sm",children:(0,t.jsxs)("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-sm flex items-center justify-center",children:t.jsx("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})}),t.jsx("div",{className:"ml-3",children:t.jsx("p",{className:"text-sm text-green-800 dark:text-green-300",children:g})})]})}),(0,t.jsxs)("form",{onSubmit:D,className:"grid grid-cols-1 gap-2 items-start",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Nombre"}),t.jsx("div",{children:t.jsx("input",{placeholder:"Nombre",value:r.name,onChange:e=>a({...r,name:e.target.value}),required:!0,autoComplete:"name",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 backdrop-blur-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200"})}),t.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Correo electr\xf3nico"}),t.jsx("div",{children:t.jsx("input",{placeholder:"Correo electr\xf3nico",type:"email",value:r.email,onChange:e=>a({...r,email:e.target.value}),required:!0,autoComplete:"email",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 backdrop-blur-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200"})}),t.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Contrase\xf1a"}),t.jsx("div",{children:(0,t.jsxs)("div",{className:"relative",children:[t.jsx("input",{placeholder:"Contrase\xf1a",type:N?"text":"password",value:r.password,onChange:e=>a({...r,password:e.target.value}),required:!0,autoComplete:"new-password",className:"w-full px-3 py-2 pr-12 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 backdrop-blur-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200"}),t.jsx("button",{type:"button",onClick:()=>C(e=>!e),"aria-label":N?"Ocultar contrase\xf1a":"Ver contrase\xf1a",className:"absolute right-2 top-2 px-2 py-1 rounded-md text-xs text-white bg-gray-900 dark:bg-gray-700 hover:bg-gray-800 dark:hover:bg-gray-600",children:N?"Ocultar":"Ver"})]})}),t.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Rol"}),t.jsx("div",{children:t.jsx(l.Z,{options:(()=>{let e=[{value:"modelo",label:"Modelo"},{value:"admin",label:"Admin"},{value:"super_admin",label:"Super Admin"}];return E?.role==="admin"?e.filter(e=>"modelo"===e.value):e})(),value:r.role,onChange:e=>a({...r,role:e}),placeholder:"Selecciona un rol",className:"text-sm"})}),t.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Grupos"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>f(e=>!e),className:"w-full text-left border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 flex items-center justify-between text-sm hover:border-gray-400 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200",children:[t.jsx("span",{className:r.groups.length?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-400",children:r.groups.length?m.filter(e=>r.groups.includes(e.id)).map(e=>e.name).join(", "):"modelo"===r.role?"Selecciona un grupo":"Selecciona uno o varios grupos"}),t.jsx("svg",{className:"w-5 h-5 text-gray-400 dark:text-gray-500 transition-transform duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),y&&t.jsx("div",{className:"apple-scroll absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:b?t.jsx("div",{className:"p-3 text-sm text-gray-500 dark:text-gray-400",children:"Cargando grupos…"}):m.map((e,s)=>{let o=r.groups.includes(e.id),l="modelo"===r.role,d=l&&r.groups.length>0&&!o,n=E?.role==="super_admin"||E?.role==="admin"&&E?.groups.includes(e.id);return(0,t.jsxs)("button",{type:"button",disabled:d||!n,onClick:()=>{l?(a({...r,groups:o?[]:[e.id]}),f(!1)):a({...r,groups:o?r.groups.filter(r=>r!==e.id):[...r.groups,e.id]})},className:`w-full text-left px-3 py-2 text-sm transition-colors duration-150 ${s>0?"border-t border-gray-100 dark:border-gray-700":""} ${d||!n?"text-gray-400 dark:text-gray-500 cursor-not-allowed":"text-gray-900 dark:text-gray-100 hover:bg-gray-50 dark:hover:bg-gray-700"} ${o?"bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-100":""}`,children:[t.jsx("span",{children:e.name}),o&&t.jsx("span",{className:"text-blue-600 dark:text-blue-400 ml-auto",children:"✓"})]},e.id)})})]}),"modelo"===r.role&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:["Room ","Sede MP"===_&&t.jsx("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{children:[t.jsx(l.Z,{options:v.map(e=>({value:e.id,label:e.room_name})),value:r.room_id,onChange:e=>a({...r,room_id:e}),placeholder:j?"Cargando rooms...":"Selecciona un room",disabled:j||0===v.length,maxHeight:"max-h-40"}),0===r.groups.length&&t.jsx("p",{className:"mt-0.5 text-xs text-gray-500 dark:text-gray-400",children:"Primero selecciona un grupo"}),"Sede MP"!==_&&_&&(0,t.jsxs)("p",{className:"mt-0.5 text-xs text-gray-500 dark:text-gray-400",children:["Opcional para ",_]})]}),(0,t.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:["Jornada ","Sede MP"===_&&t.jsx("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{children:[t.jsx(l.Z,{options:[{value:"MA\xd1ANA",label:"Ma\xf1ana"},{value:"TARDE",label:"Tarde"},{value:"NOCHE",label:"Noche"}],value:r.jornada,onChange:e=>a({...r,jornada:e}),placeholder:"Selecciona una jornada"}),"Sede MP"!==_&&_&&(0,t.jsxs)("p",{className:"mt-0.5 text-xs text-gray-500 dark:text-gray-400",children:["Opcional para ",_]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-1",children:[t.jsx("button",{disabled:n,type:"submit",className:"flex-1 px-3 py-1.5 text-xs font-medium text-white bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg hover:from-blue-600 hover:to-indigo-700 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200 shadow-md",children:n?"Creando...":"Crear Usuario"}),t.jsx("button",{type:"button",onClick:()=>e.back(),className:"px-3 py-1.5 text-xs font-medium text-blue-600 dark:text-blue-400 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border border-blue-200/50 dark:border-blue-700/50 rounded-lg hover:bg-blue-50/80 dark:hover:bg-gray-700/80 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",children:"Volver"})]})]})]})})]})})}},71145:(e,r,a)=>{"use strict";a.d(r,{Z:()=>l});var t=a(95344),s=a(3729);let o={green:"bg-green-100 text-green-800",blue:"bg-blue-100 text-blue-800",red:"bg-red-100 text-red-800",yellow:"bg-yellow-100 text-yellow-800",gray:"bg-gray-100 text-gray-800"};function l({options:e,value:r,onChange:a,placeholder:l="Selecciona una opci\xf3n",className:d="",disabled:n=!1,maxHeight:i="max-h-60",autoOpen:u=!1}){let[c,g]=(0,s.useState)(!1),x=(0,s.useRef)(null);(0,s.useEffect)(()=>{u&&e.length>1?g(!0):u||g(!1)},[u,e.length]),(0,s.useEffect)(()=>{let e=e=>{x.current&&!x.current.contains(e.target)&&g(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&g(!1)};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[]),(0,s.useEffect)(()=>{c&&x.current&&setTimeout(()=>{x.current?.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)},[c]);let m=e.find(e=>e.value===r),p=e=>{a(e),g(!1)};return(0,t.jsxs)("div",{className:`relative ${d}`,ref:x,children:[t.jsx("button",{type:"button",className:`w-full px-3 py-2 text-sm text-left border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 cursor-pointer flex items-center justify-between hover:border-gray-400 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200 ${n?"opacity-50 cursor-not-allowed":""}`,onClick:()=>!n&&g(!c),disabled:n,"aria-haspopup":"listbox","aria-expanded":c,children:(0,t.jsxs)("div",{className:"flex items-center justify-between w-full",children:[t.jsx("span",{className:m?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-400",children:m?m.label:l}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[m?.badge&&t.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${o[m.badgeColor||"gray"]}`,children:m.badge}),t.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform duration-200 ${c?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}),c&&t.jsx("div",{className:`absolute z-[99998] w-full mt-1 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg dark:shadow-lg dark:shadow-cyan-900/10 dark:ring-0.5 dark:ring-cyan-500/15 ${i} overflow-auto apple-scroll`,children:0===e.length?t.jsx("div",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:"No hay opciones disponibles"}):e.map((e,a)=>(0,t.jsxs)("div",{children:[a>0&&t.jsx("div",{className:"w-full h-px bg-gray-100 dark:bg-gray-600/50 dark:shadow-sm dark:shadow-blue-900/10"}),(0,t.jsxs)("div",{className:`px-4 py-3 text-sm cursor-pointer transition-colors duration-150 flex items-center justify-between ${e.disabled?"text-gray-400 dark:text-gray-500 cursor-not-allowed":"hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-900 dark:text-gray-100"} ${e.value===r?"bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-100":""}`,onClick:()=>!e.disabled&&p(e.value),children:[t.jsx("span",{children:e.label}),e.badge&&t.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${o[e.badgeColor||"gray"]}`,children:e.badge})]})]},e.value))})]})}},14049:(e,r,a)=>{"use strict";a.r(r),a.d(r,{$$typeof:()=>o,__esModule:()=>s,default:()=>l});let t=(0,a(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\app\admin\users\create\page.tsx`),{__esModule:s,$$typeof:o}=t,l=t.default}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[1638,6611,6654,551,9609,1110],()=>a(98992));module.exports=t})();