(()=>{var e={};e.id=9674,e.ids=[9674],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},33904:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d});var a=t(50482),s=t(69108),o=t(62563),i=t.n(o),l=t(68300),n={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>l[e]);t.d(r,n);let d=["",{children:["admin",{children:["users",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,51985)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\users\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,66294)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,41878)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\users\\page.tsx"],u="/admin/users/page",m={require:t,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/users/page",pathname:"/admin/users",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},18073:(e,r,t)=>{Promise.resolve().then(t.bind(t,35644))},35644:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>b});var a=t(95344),s=t(3729),o=t(22254),i=t(72829);async function l(){try{let{data:{session:e}}=await i.supabase.auth.getSession();return e?.access_token||null}catch(e){return console.error("❌ [API CLIENT] Error obteniendo token:",e),null}}async function n(e,r={}){let t=await l();if(!t)throw Error("No hay sesi\xf3n activa");let a={"Content-Type":"application/json",Authorization:`Bearer ${t}`,...r.headers};return fetch(e,{...r,headers:a})}async function d(){return(await n("/api/users")).json()}async function c(){return(await n("/api/groups")).json()}function u(e,r){if("super_admin"===e.role)return!0;if("superadmin_aff"===e.role){if("super_admin"===r.role||"superadmin_aff"===r.role)return console.log("\uD83D\uDD0D [JERARQU\xcdA] Superadmin_aff no puede editar super_admin o superadmin_aff"),!1;let t=e.affiliate_studio_id,a=r.affiliate_studio_id;if(console.log("\uD83D\uDD0D [JERARQU\xcdA] Verificando permisos de edici\xf3n para superadmin_aff:",{currentUserRole:e.role,currentUserAffiliateId:t,targetUserRole:r.role,targetUserAffiliateId:a,canEdit:t&&t===a}),t){let e=t===a;return console.log("\uD83D\uDD0D [JERARQU\xcdA] Resultado de comparaci\xf3n:",e),e}return console.log("⚠️ [JERARQU\xcdA] Superadmin_aff sin affiliate_studio_id"),!1}if("admin"===e.role){let t=e.groups.map(e=>e.id),a=(r.groups||[]).map(e=>"string"==typeof e?e:e.id);return console.log("\uD83D\uDD0D [JERARQU\xcdA] Verificando permisos de edici\xf3n:",{currentUserRole:e.role,currentUserGroups:t,targetUserRole:r.role,targetUserGroups:a,targetUserIsActive:r.is_active,canEdit:"modelo"===r.role&&(0===a.length||a.some(e=>t.includes(e)))}),"modelo"===r.role&&(0===a.length||a.some(e=>t.includes(e)))}return("gestor"===e.role||"fotografia"===e.role)&&("admin"===r.role||"super_admin"===r.role)}function m(e,r){if("super_admin"===e.role)return!0;if("superadmin_aff"===e.role){if("super_admin"===r.role||"superadmin_aff"===r.role)return console.log("\uD83D\uDD0D [JERARQU\xcdA] Superadmin_aff no puede eliminar super_admin o superadmin_aff"),!1;let t=e.affiliate_studio_id,a=r.affiliate_studio_id;if(console.log("\uD83D\uDD0D [JERARQU\xcdA] Verificando permisos de eliminaci\xf3n para superadmin_aff:",{currentUserRole:e.role,currentUserAffiliateId:t,targetUserRole:r.role,targetUserAffiliateId:a,canDelete:t&&t===a}),t){let e=t===a;return console.log("\uD83D\uDD0D [JERARQU\xcdA] Resultado de comparaci\xf3n:",e),e}return console.log("⚠️ [JERARQU\xcdA] Superadmin_aff sin affiliate_studio_id"),!1}if("admin"===e.role){let t=e.groups.map(e=>e.id),a=(r.groups||[]).map(e=>"string"==typeof e?e:e.id);return console.log("\uD83D\uDD0D [JERARQU\xcdA] Verificando permisos de eliminaci\xf3n:",{currentUserRole:e.role,currentUserGroups:t,targetUserRole:r.role,targetUserGroups:a,targetUserIsActive:r.is_active,canDelete:"modelo"===r.role&&(0===a.length||a.some(e=>t.includes(e)))}),"modelo"===r.role&&(0===a.length||a.some(e=>t.includes(e)))}return("gestor"===e.role||"fotografia"===e.role)&&("admin"===r.role||"super_admin"===r.role)}var x=t(46985);function g({onSearch:e,placeholder:r="Buscar...",filters:t=[],className:o="",onDropdownStateChange:i,showResultsInfo:l=!1,totalUsers:n=0,filteredUsers:d=0,onClearSearch:c}){let[u,m]=(0,s.useState)(""),[g,p]=(0,s.useState)({}),[h,b]=(0,s.useState)(!1),[f,y]=(0,s.useState)(null),[v,w]=(0,s.useState)(null),k=(0,s.useRef)(null),j=(0,s.useRef)({}),[N,D]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=()=>{D(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let C=N?v:f,_=N?w:y,E=()=>{e(u,g)};(0,s.useEffect)(()=>{let r=setTimeout(()=>{e(u,g)},250);return()=>clearTimeout(r)},[u,g]),(0,s.useEffect)(()=>{function e(e){"Enter"===e.key&&(e.preventDefault(),E()),"Escape"===e.key&&b(!1)}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[u,g,h]);let L=(e,r)=>{p(t=>({...t,[e]:r})),_(null),y(null),w(null)},A=e=>{N?w(e):y(e)},S=e=>{C===e&&setTimeout(()=>{_(null),y(null),w(null)},200)};(0,s.useEffect)(()=>{function e(e){let r=e.target,t=Object.values(j.current).some(e=>e&&e.contains(r));k.current?.contains(r)||t||(y(null),w(null))}let r=setTimeout(()=>{document.addEventListener("click",e,!0)},100);return()=>{clearTimeout(r),document.removeEventListener("click",e,!0)}},[]),(0,s.useEffect)(()=>{i&&i(h||null!==f||null!==v)},[h,f,v,i]);let U=()=>{p({}),m(""),c?c():e("",{})},R=Object.values(g).some(e=>""!==e);return(0,a.jsxs)("div",{ref:k,className:`relative ${o}`,children:[a.jsx("div",{className:"relative bg-white dark:bg-gray-800 backdrop-blur-sm rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm hover:shadow-md transition-all duration-200",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),a.jsx("div",{className:"flex-1 relative",children:a.jsx("input",{type:"text",value:u,onChange:e=>m(e.target.value),onKeyPress:e=>"Enter"===e.key&&E(),placeholder:r,className:"w-full bg-transparent border-none outline-none text-sm text-gray-700 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 focus:ring-0"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[t.length>0&&(0,a.jsxs)("button",{onClick:()=>{b(!h),h&&(y(null),w(null))},className:`p-2 rounded-md text-xs transition-all duration-200 ${h?"bg-blue-500 text-white shadow-md":"text-gray-500 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 hover:bg-blue-50/50 dark:hover:bg-blue-900/20"}`,title:h?"Ocultar filtros":"Mostrar filtros",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),R&&a.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"})]}),(u||R)&&a.jsx("button",{onClick:U,className:"p-2 text-gray-400 dark:text-gray-500 hover:text-red-500 dark:hover:text-red-400 hover:bg-red-50/50 dark:hover:bg-red-900/20 rounded-md transition-all duration-200",title:"Limpiar b\xfasqueda y filtros",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}),t.length>0&&h&&(0,a.jsxs)("div",{className:"mt-3 relative bg-white dark:bg-gray-800 backdrop-blur-sm rounded-lg border border-gray-200 dark:border-gray-600 shadow-xl p-4 animate-in slide-in-from-top-2 duration-200 z-[100]",onClick:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()},style:{pointerEvents:"auto"},children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[a.jsx("div",{className:"w-4 h-4 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-sm flex items-center justify-center",children:a.jsx("svg",{className:"w-2 h-2 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})})}),a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Filtros Avanzados"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-4",children:t.map(e=>{let r;return"group"===e.id||"status"===e.id?r="150px":"role"===e.id&&(r="180px"),(0,a.jsxs)("div",{className:"space-y-2 min-w-0 relative z-0",ref:r=>{r?j.current[e.id]=r:delete j.current[e.id]},style:{zIndex:C===e.id?1e3:"auto"},children:[(0,a.jsxs)("label",{className:"flex items-center space-x-1 text-gray-600 dark:text-gray-400 text-xs font-medium",children:[a.jsx("div",{className:"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full"}),a.jsx("span",{children:e.label})]}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(x.Z,{value:g[e.id]||"",options:e.options,onChange:r=>L(e.id,r),className:"",onFocus:()=>A(e.id),onBlur:()=>S(e.id),maxHeightOverride:r}),g[e.id]&&a.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-blue-500 rounded-full"})]})]},e.id)})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-gray-200 dark:border-gray-600",children:[a.jsx("div",{className:"hidden sm:block text-xs text-gray-500 dark:text-gray-400",children:R?`${Object.values(g).filter(e=>e).length} filtro(s) activo(s)`:"Sin filtros aplicados"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[R&&a.jsx("button",{onClick:U,className:"px-3 py-1.5 text-xs text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50/50 dark:hover:bg-red-900/20 rounded-md transition-all duration-200",children:"Limpiar todo"}),a.jsx("button",{onClick:()=>b(!1),className:"px-3 py-1.5 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white text-xs rounded-md transition-all duration-200 shadow-sm hover:shadow-md",children:"Aplicar"})]})]})]})]})}var p=t(71145),h=t(43995);function b(){let[e,r]=(0,s.useState)([]),[t,l]=(0,s.useState)([]),[n,x]=(0,s.useState)([]),[p,h]=(0,s.useState)(!0),[b,y]=(0,s.useState)(""),[v,w]=(0,s.useState)(null),[k,j]=(0,s.useState)(!1),[N,D]=(0,s.useState)(null),[C,_]=(0,s.useState)(""),[E,L]=(0,s.useState)({}),[A,S]=(0,s.useState)(null),[U,R]=(0,s.useState)(!1),P=(0,o.useRouter)();(0,s.useEffect)(()=>{z()},[]);let z=async()=>{try{h(!0);let{data:{user:e}}=await i.supabase.auth.getUser();if(!e){y("Usuario no autenticado");return}try{let{data:r,error:t}=await i.supabase.from("users").select(`
            role,
            affiliate_studio_id,
            user_groups(
              groups!inner(
                id,
                name
              )
            )
          `).eq("id",e.id).single();if(t){console.error("Error obteniendo datos del usuario:",t),y("Error obteniendo datos del usuario: "+t.message);return}if(!r){y("Error obteniendo datos del usuario");return}let a=r.user_groups?.map(e=>e.groups)||[];console.log("\uD83D\uDD0D [USUARIOS] Datos del usuario actual:",{id:e.id,role:r.role,affiliate_studio_id:r.affiliate_studio_id,groups:a}),D({id:e.id,role:r.role,groups:a,affiliate_studio_id:r.affiliate_studio_id||null})}catch(e){console.error("Error en consulta de usuario:",e),y("Error obteniendo datos del usuario");return}let[t,a]=await Promise.all([d(),c()]);if(t.success){let e=t.users;if(console.log("\uD83D\uDD0D [USUARIOS] Usuarios obtenidos de API:",t.users.length),console.log("\uD83D\uDD0D [USUARIOS] Usuario actual para filtrado:",N),N?.role==="admin"){let r=N.groups||[],a=Array.isArray(r)?r.map(e=>"string"==typeof e?e:e.id):[];console.log("\uD83D\uDD0D [USUARIOS] Aplicando filtro de jerarqu\xeda para admin:",{userGroupIds:a,totalUsers:t.users.length}),e=t.users.filter(e=>"super_admin"!==e.role&&("admin"===e.role||"modelo"===e.role)&&!!e.groups&&e.groups.length>0&&(Array.isArray(e.groups)?e.groups.map(e=>"string"==typeof e?e:e.id):[]).some(e=>a.includes(e))),console.log("\uD83D\uDD0D [USUARIOS] Usuarios despu\xe9s del filtro:",e.length)}else(N?.role==="gestor"||N?.role==="fotografia")&&(console.log("\uD83D\uDD0D [USUARIOS] Aplicando filtro de jerarqu\xeda para gestor/fotografia:",{totalUsers:t.users.length}),e=t.users.filter(e=>"admin"===e.role||"super_admin"===e.role),console.log("\uD83D\uDD0D [USUARIOS] Usuarios despu\xe9s del filtro (solo admins):",e.length));r(e),l([])}else y("Error cargando usuarios: "+t.error);a.success&&x(a.groups)}catch(e){console.error("❌ Error cargando datos:",e),y("Error cargando datos")}finally{h(!1)}},M=[{id:"role",label:"Rol",value:E.role||"",options:(()=>{let e=[{label:"Super Admin",value:"super_admin"},{label:"Admin",value:"admin"},{label:"Gestor",value:"gestor"},{label:"Fotograf\xeda",value:"fotografia"},{label:"Modelo",value:"modelo"}];return N?.role==="admin"?e.filter(e=>"super_admin"!==e.value):N?.role==="superadmin_aff"?e.filter(e=>"admin"===e.value||"modelo"===e.value):e})()},{id:"group",label:"Grupo",value:E.group||"",options:(()=>{if(N?.role==="admin"){let e=Array.isArray(N.groups)?N.groups.map(e=>"string"==typeof e?e:e.id):[];return n.filter(r=>e.includes(r.id)).map(e=>({label:e.name,value:e.id}))}return n.map(e=>({label:e.name,value:e.id}))})()},{id:"status",label:"Estado",value:E.status||"",options:[{label:"Activo",value:"active"},{label:"Inactivo",value:"inactive"}]}],q=async e=>{if(!e||!e.id){console.error("❌ [FRONTEND] Usuario inv\xe1lido:",e),y("Usuario inv\xe1lido");return}if(!N){y("Debes estar autenticado para editar usuarios");return}if(!u(N,e)){let r="No tienes permisos para editar este usuario";if("superadmin_aff"===N.role)r="super_admin"===e.role||"superadmin_aff"===e.role?"No puedes editar super administradores u otros superadmin afiliados":e.affiliate_studio_id!==N.affiliate_studio_id?"Solo puedes editar usuarios de tu estudio afiliado":"No tienes permisos para editar este usuario";else if("admin"===N.role&&"modelo"!==e.role)r="Los administradores solo pueden editar modelos";else if("admin"===N.role&&"modelo"===e.role){let t=N.groups.map(e=>e.id);e.groups.map(e=>e.id).some(e=>t.includes(e))||(r="Solo puedes editar modelos de tus grupos asignados")}else"modelo"===N.role&&(r="Los modelos no pueden editar otros usuarios");y(r);return}console.log("\uD83D\uDD0D [FRONTEND] Abriendo modal para usuario:",e),w(e),j(!0)},B=async t=>{let a=e.find(e=>e.id===t);if(!a){y("Usuario no encontrado");return}if(!N){y("Debes estar autenticado para eliminar usuarios");return}if(!m(N,a)){let e="No tienes permisos para eliminar este usuario";if("superadmin_aff"===N.role)e="super_admin"===a.role||"superadmin_aff"===a.role?"No puedes eliminar super administradores u otros superadmin afiliados":a.affiliate_studio_id!==N.affiliate_studio_id?"Solo puedes eliminar usuarios de tu estudio afiliado":"No tienes permisos para eliminar este usuario";else if("admin"===N.role&&"modelo"!==a.role)e="Los administradores solo pueden eliminar modelos";else if("admin"===N.role&&"modelo"===a.role){let r=N.groups.map(e=>e.id);a.groups.map(e=>e.id).some(e=>r.includes(e))||(e="Solo puedes eliminar modelos de tus grupos asignados")}else"modelo"===N.role&&(e="Los modelos no pueden eliminar otros usuarios");y(e);return}if(confirm("\xbfEst\xe1s seguro de que quieres eliminar este usuario?"))try{let e=await fetch(`/api/users?id=${t}`,{method:"DELETE"}),a=await e.json();a.success?(r(e=>e.filter(e=>e.id!==t)),l(e=>e.filter(e=>e.id!==t)),console.log("✅ [FRONTEND] Usuario eliminado de la lista local")):y("Error eliminando usuario: "+a.error)}catch(e){console.error("❌ Error eliminando usuario:",e),y("Error eliminando usuario")}};return p?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center pt-16",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Cargando usuarios..."})]})}):a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,a.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:[a.jsx("div",{className:"mb-8 sm:mb-12",children:(0,a.jsxs)("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 to-indigo-600/10 rounded-xl blur-xl"}),a.jsx("div",{className:"relative bg-white/80 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 md:gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[a.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:a.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[a.jsx("h1",{className:"text-base sm:text-lg md:text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:"Gesti\xf3n de Usuarios"}),a.jsx("p",{className:"mt-1 text-xs sm:text-sm text-gray-600 dark:text-gray-300 hidden sm:block",children:"Administra usuarios del sistema"})]})]}),(0,a.jsxs)("button",{onClick:()=>P.push("/admin/users/create"),className:"w-full md:w-auto px-4 py-2.5 sm:px-5 sm:py-3 rounded-lg bg-gradient-to-r from-blue-500 to-indigo-600 text-white hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 flex items-center justify-center space-x-2 shadow-md hover:shadow-lg transform hover:scale-[1.02] md:hover:scale-105 font-medium text-sm sm:text-base",children:[a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),a.jsx("span",{children:"Nuevo Usuario"})]})]})})]})}),(0,a.jsxs)("div",{className:`mb-16 relative bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-6 z-10 dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15 ${k?"opacity-30 blur-sm pointer-events-none":""}`,"aria-hidden":k,onClick:e=>{e.stopPropagation()},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:a.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),a.jsx("span",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"B\xfasqueda y Filtros"})]}),t.length>0&&(0,a.jsxs)("div",{className:"hidden sm:flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300",children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,a.jsxs)("span",{children:[t.length," resultado(s) encontrado(s)"]})]})]}),a.jsx(g,{onSearch:(r,t)=>{if(_(r),L(t),!(r.trim()||t.role||t.group||t.status)){l([]);return}let a=e;if(N?.role==="admin"){let e=Array.isArray(N.groups)?N.groups.map(e=>"string"==typeof e?e:e.id):[];a=a.filter(r=>"super_admin"!==r.role&&("admin"===r.role||"modelo"===r.role)&&!!r.groups&&r.groups.length>0&&(Array.isArray(r.groups)?r.groups.map(e=>"string"==typeof e?e:e.id):[]).some(r=>e.includes(r)))}if(r.trim()&&(a=a.filter(e=>e.name.toLowerCase().includes(r.toLowerCase())||e.email.toLowerCase().includes(r.toLowerCase()))),t.role&&(a=a.filter(e=>e.role===t.role)),t.group&&(a=a.filter(e=>e.groups.some(e=>e.id===t.group))),t.status){let e="active"===t.status;a=a.filter(r=>r.is_active===e)}l(a)},placeholder:"Buscar por nombre, email o ID de usuario...",filters:M,onDropdownStateChange:e=>{R(e)},showResultsInfo:!0,totalUsers:e.length,filteredUsers:t.length,onClearSearch:()=>{_(""),L({}),l([])}})]}),b&&a.jsx("div",{className:"mb-6 relative bg-red-50/80 dark:bg-red-900/20 backdrop-blur-sm border border-red-200/50 dark:border-red-700/50 text-red-700 dark:text-red-300 px-4 py-3 rounded-xl shadow-md",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-sm flex items-center justify-center",children:a.jsx("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),a.jsx("span",{className:"text-sm",children:b})]})}),a.jsx("div",{className:`relative bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm border border-white/20 dark:border-gray-600/20 rounded-xl shadow-md transition-all duration-300 apple-scroll overflow-y-auto max-h-[70vh] p-0 z-10 dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15 ${U||k?"opacity-30 blur-sm pointer-events-none":"opacity-100 blur-none pointer-events-auto"}`,"aria-hidden":k,children:(0,a.jsxs)("div",{className:"pt-4 sm:pt-6 px-3 sm:px-6 pb-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[a.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:a.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),(0,a.jsxs)("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:["Usuarios del Sistema (",e.length,")"]})]}),0===e.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[a.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mx-auto mb-3",children:a.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),a.jsx("div",{className:"text-gray-400 dark:text-gray-500 text-base font-medium",children:"No hay usuarios registrados"}),a.jsx("button",{onClick:()=>P.push("/admin/users/create"),className:"mt-4 px-3 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white rounded-lg transition-all duration-300 text-sm shadow-md hover:shadow-lg transform hover:scale-105",children:"Crear Primer Usuario"})]}):0===t.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[a.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-gray-400 to-gray-600 rounded-lg flex items-center justify-center mx-auto mb-3",children:a.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),a.jsx("div",{className:"text-gray-400 dark:text-gray-500 text-base font-medium",children:"No hay resultados"}),a.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-xs mt-2",children:C.trim()||Object.values(E).some(e=>e)?"Intenta ajustar los filtros de b\xfasqueda":"Usa los filtros de b\xfasqueda para encontrar usuarios"})]}):a.jsx("div",{className:"overflow-x-auto -mx-3 sm:mx-0",children:a.jsx("div",{className:"inline-block min-w-full align-middle",children:a.jsx("div",{className:"overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full text-left text-xs md:table-fixed",children:[a.jsx("thead",{className:"border-b border-white/20 dark:border-gray-600/20 bg-gradient-to-r from-gray-50/80 to-blue-50/60 dark:from-gray-700/80 dark:to-gray-600/60 backdrop-blur-sm",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[120px] sm:w-[28%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Usuario"}),a.jsx("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[150px] sm:w-[28%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Email"}),a.jsx("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[80px] sm:w-[10%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Rol"}),a.jsx("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[100px] sm:w-[20%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Grupos"}),a.jsx("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[70px] sm:w-[8%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Estado"}),a.jsx("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[100px] sm:w-[6%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Acciones"})]})}),a.jsx("tbody",{className:"bg-white/30 backdrop-blur-sm divide-y divide-white/20",children:t.map(e=>(0,a.jsxs)("tr",{className:"border-b border-white/10 hover:bg-white/60 hover:shadow-sm transition-all duration-200 h-auto sm:h-12 group",children:[a.jsx("td",{className:"px-2 sm:px-4 py-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(()=>{let r;let t=e.role||"modelo",s="bg-gradient-to-br from-pink-500 via-rose-500 to-purple-500";return"super_admin"===t?(s="bg-gradient-to-br from-amber-500 via-yellow-500 to-amber-600",r=(0,a.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:[a.jsx("path",{d:"M5 16L3 10l5.5-2L12 10l3.5-2L21 10l-2 6H5zm14.5-7.5L18.5 8l-3.5 1.5L12 8l-2.5 1.5L6 8l-1 0.5L5 11l14 0.5z"}),a.jsx("circle",{cx:"8",cy:"16",r:"1.5",fill:"currentColor",opacity:"0.8"}),a.jsx("circle",{cx:"16",cy:"16",r:"1.5",fill:"currentColor",opacity:"0.8"}),a.jsx("circle",{cx:"12",cy:"14",r:"1.5",fill:"currentColor",opacity:"0.9"})]})):"admin"===t?(s="bg-gradient-to-br from-blue-500 to-indigo-600",r=a.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:a.jsx("path",{d:"M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5a3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.4-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1c0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"})})):"gestor"===t?(s="bg-gradient-to-br from-orange-500 to-amber-600",r=a.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:a.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})):"fotografia"===t?(s="bg-gradient-to-br from-purple-500 to-pink-600",r=a.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:a.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})})):r=(0,a.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:[a.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"}),a.jsx("circle",{cx:"12",cy:"8",r:"1.5",fill:"currentColor",opacity:"0.8"}),a.jsx("circle",{cx:"12",cy:"16",r:"1.5",fill:"currentColor",opacity:"0.8"}),a.jsx("circle",{cx:"8",cy:"12",r:"1.5",fill:"currentColor",opacity:"0.8"}),a.jsx("circle",{cx:"16",cy:"12",r:"1.5",fill:"currentColor",opacity:"0.8"}),a.jsx("circle",{cx:"10",cy:"10",r:"1.2",fill:"currentColor",opacity:"0.7"}),a.jsx("circle",{cx:"14",cy:"10",r:"1.2",fill:"currentColor",opacity:"0.7"}),a.jsx("circle",{cx:"10",cy:"14",r:"1.2",fill:"currentColor",opacity:"0.7"}),a.jsx("circle",{cx:"14",cy:"14",r:"1.2",fill:"currentColor",opacity:"0.7"})]}),a.jsx("div",{className:`w-6 h-6 ${s} rounded-full flex items-center justify-center text-xs shadow-sm border border-white/20 flex-shrink-0 relative overflow-hidden`,children:a.jsx("div",{className:"text-white flex items-center justify-center",children:r})})})(),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"text-gray-900 dark:text-gray-100 font-medium text-xs truncate",title:e.name,children:e.name}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 mt-0.5 group/id",children:[a.jsx("span",{className:"text-gray-400 dark:text-gray-500 text-xs font-mono select-all cursor-text hover:text-gray-600 dark:hover:text-gray-300 transition-colors",title:`ID: ${e.id} (click para seleccionar, bot\xf3n para copiar)`,children:e.id}),a.jsx("button",{onClick:async r=>{r.stopPropagation();try{await navigator.clipboard.writeText(e.id);let t=r.currentTarget,a=t.innerHTML;t.innerHTML='<svg class="w-3 h-3 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>',setTimeout(()=>{t.innerHTML=a},1500)}catch(e){console.error("Error copiando ID:",e)}},className:"opacity-0 group-hover:opacity-100 group-hover/id:opacity-100 transition-opacity p-0.5 hover:bg-gray-200 dark:hover:bg-gray-700 rounded flex-shrink-0",title:"Copiar ID al portapapeles",children:a.jsx("svg",{className:"w-3 h-3 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]})]})}),a.jsx("td",{className:"px-2 sm:px-4 py-2 text-gray-800 truncate max-w-[220px] text-xs text-center",title:e.email,children:e.email}),a.jsx("td",{className:"px-2 sm:px-4 py-2 text-center",children:a.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs font-semibold whitespace-nowrap border shadow-sm backdrop-blur-sm ${"super_admin"===e.role?"bg-gradient-to-r from-gray-800 to-gray-900 text-white border-gray-600/30":"admin"===e.role?"bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 border-blue-200/50":"bg-gradient-to-r from-green-50 to-emerald-50 text-green-700 border-green-200/50"}`,children:e.role.replace("_"," ").toUpperCase()})}),a.jsx("td",{className:"px-2 sm:px-4 py-2 text-center",children:e.groups.length>0?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1 overflow-hidden",children:[e.groups.slice(0,2).map(e=>a.jsx("span",{className:"bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-700 dark:to-gray-600 text-gray-700 dark:text-gray-200 px-2 py-1 rounded-md text-xs whitespace-nowrap border border-gray-200/30 dark:border-gray-600/30 shadow-sm backdrop-blur-sm",children:e.name},e.id)),e.groups.length>2&&(0,a.jsxs)("span",{className:"text-gray-500 text-xs whitespace-nowrap cursor-help",title:e.groups.map(e=>e.name).join(", "),children:["+",e.groups.length-2]})]}):a.jsx("span",{className:"text-gray-400 text-xs",children:"Sin grupos"})}),a.jsx("td",{className:"px-2 sm:px-4 py-2 text-center",children:a.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs font-semibold border shadow-sm backdrop-blur-sm ${e.is_active?"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 text-green-700 dark:text-green-300 border-green-200/50 dark:border-green-700/50":"bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-700 dark:to-gray-600 text-gray-600 dark:text-gray-300 border-gray-200/50 dark:border-gray-600/50"}`,children:e.is_active?"Activo":"Inactivo"})}),a.jsx("td",{className:"px-2 sm:px-4 py-2 text-center",children:(0,a.jsxs)("div",{className:"flex justify-center space-x-1 opacity-70 group-hover:opacity-100 transition-opacity duration-200",children:[a.jsx("button",{onClick:()=>q(e),disabled:!N||!u(N,e),className:`px-2.5 py-1.5 text-xs rounded-lg border transition-all duration-200 backdrop-blur-sm ${N&&u(N,e)?"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200/30 text-blue-700 hover:from-blue-100 hover:to-indigo-100 hover:shadow-sm":"bg-gray-100 dark:bg-gray-700 border-gray-200/30 text-gray-400 dark:text-gray-500 cursor-not-allowed"}`,title:N&&u(N,e)?"Editar usuario":"Solo puedes editar modelos de tus grupos",children:"Editar"}),a.jsx("button",{onClick:()=>B(e.id),disabled:!N||!m(N,e),className:`px-2.5 py-1.5 text-xs rounded-lg border transition-all duration-200 backdrop-blur-sm ${N&&m(N,e)?"bg-gradient-to-r from-red-50 to-rose-50 border-red-200/30 text-red-700 hover:from-red-100 hover:to-rose-100 hover:shadow-sm":"bg-gray-100 dark:bg-gray-700 border-gray-200/30 text-gray-400 dark:text-gray-500 cursor-not-allowed"}`,title:N&&m(N,e)?"Eliminar usuario":"Solo puedes eliminar modelos de tus grupos",children:"Eliminar"})]})})]},e.id))})]})})})})]})}),k&&v&&a.jsx(f,{user:v,groups:n,currentUser:N,modalError:A,setModalError:S,onClose:()=>{j(!1),w(null),S(null)},onSubmit:async e=>{try{console.log("\uD83D\uDD0D [PARENT] Recibiendo datos del formulario:",e);let t=await fetch("/api/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();console.log("\uD83D\uDD0D [PARENT] Respuesta de la API:",a),a.success?(console.log("✅ [PARENT] Usuario actualizado exitosamente"),j(!1),w(null),S(null),r(r=>r.map(r=>r.id===e.id?{...r,...a.user}:r)),l(r=>r.map(r=>r.id===e.id?{...r,...a.user}:r)),console.log("✅ [FRONTEND] Usuario actualizado en la lista local")):(console.error("❌ [PARENT] Error de la API:",a.error),S("Error actualizando usuario: "+a.error))}catch(e){console.error("❌ [PARENT] Error en la petici\xf3n:",e),S("Error actualizando usuario")}}})]})})}function f({user:e,groups:r,onClose:t,onSubmit:o,currentUser:i,modalError:l,setModalError:n}){let[d,c]=(0,s.useState)("profile"),[u,m]=(0,s.useState)({id:e?.id||"",name:e?.name||"",email:e?.email||"",role:e?.role||"modelo",is_active:e?.is_active??!0,group_ids:e?.groups?.map(e=>e.id)||[]}),[x,g]=(0,s.useState)({newPassword:"",confirmPassword:""}),[b,f]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),[w,k]=(0,s.useState)(!1),[j,N]=(0,s.useState)(null),[D,C]=(0,s.useState)(!1),[_,E]=(0,s.useState)(""),[L,A]=(0,s.useState)(!1);r.find(e=>e.id===u.group_ids[0])?.name,(0,s.useEffect)(()=>{e&&m({id:e.id,name:e.name,email:e.email,role:e.role,is_active:e.is_active,group_ids:e.groups?.map(e=>e.id)||[]})},[e]);let S=e=>e.trimStart().replace(/\s+/g," ").split(" ").map(e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():"").join(" "),U=e=>e.trim().replace(/\s{2,}/g," ").replace(/\s+([,.;:])/g,"$1"),R=async()=>{if(!x.newPassword.trim()){N("La contrase\xf1a no puede estar vac\xeda");return}if(x.newPassword.trim().length<6){N("La contrase\xf1a debe tener al menos 6 caracteres");return}if(x.newPassword!==x.confirmPassword){N("Las contrase\xf1as no coinciden");return}k(!0),N(null);try{let e=await fetch("/api/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:u.id,name:u.name,email:u.email,role:u.role,is_active:u.is_active,group_ids:u.group_ids,password:x.newPassword.trim()})}),r=await e.json();r.success?(N(null),C(!0),g({newPassword:"",confirmPassword:""}),setTimeout(()=>{C(!1)},3e3)):N(r.error||"Error actualizando contrase\xf1a")}catch(e){console.error("Error actualizando contrase\xf1a:",e),N("Error de conexi\xf3n. Por favor, intenta nuevamente.")}finally{k(!1)}},P=e=>{"gestor"===e||"fotografia"===e?m(r=>({...r,role:e,group_ids:[]})):m(r=>({...r,role:e})),"modelo"===e?E("\uD83D\uDCA1 Los modelos solo pueden estar en un grupo a la vez"):"admin"===e?E("\uD83D\uDCA1 Los administradores deben tener al menos un grupo asignado"):"gestor"===e?E("\uD83D\uDCA1 Los gestores interact\xfaan con todos los admins (no requieren grupos)"):"fotografia"===e?E("\uD83D\uDCA1 Los usuarios de fotograf\xeda interact\xfaan con todos los admins (no requieren grupos)"):"super_admin"===e&&E("\uD83D\uDCA1 Los super administradores tienen acceso a todos los grupos")};return(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t]),(0,s.useEffect)(()=>{let e=requestAnimationFrame(()=>A(!0));return()=>cancelAnimationFrame(e)},[]),(0,a.jsxs)(h.Z,{isOpen:!0,onClose:t,title:"Editar Usuario",maxWidthClass:"max-w-4xl",children:[(0,a.jsxs)("div",{className:"flex space-x-1 mb-6 bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[a.jsx("button",{type:"button",onClick:()=>c("profile"),className:`flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 ${"profile"===d?"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100"}`,children:"Perfil"}),a.jsx("button",{type:"button",onClick:()=>c("password"),className:`flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 ${"password"===d?"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100"}`,children:"Contrase\xf1a"})]}),l&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700/50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),a.jsx("div",{className:"ml-3",children:a.jsx("p",{className:"text-sm text-red-800 dark:text-red-300",children:l})})]})}),"profile"===d&&(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let r=S(U(u.name||""));o({...u,name:r})},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Nombre"}),a.jsx("input",{type:"text",value:u.name,onChange:e=>m({...u,name:S(e.target.value)}),className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 backdrop-blur-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200",autoComplete:"name",autoCapitalize:"words",spellCheck:!0,required:!0})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Email"}),a.jsx("input",{type:"email",value:u.email,onChange:e=>m({...u,email:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 backdrop-blur-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200",autoComplete:"email",required:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Rol"}),a.jsx(p.Z,{options:[{value:"modelo",label:"Modelo"},{value:"fotografia",label:"Fotograf\xeda"},{value:"gestor",label:"Gestor"},{value:"admin",label:"Admin"},{value:"super_admin",label:"Super Admin"}],value:u.role,onChange:e=>P(e),placeholder:"Selecciona un rol",className:"text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Usuario Activo"}),a.jsx("button",{type:"button",onClick:()=>m({...u,is_active:!u.is_active}),className:"relative w-10 h-6 rounded-full transition-colors",style:{background:u.is_active?"#111827":"#e5e7eb"},"aria-pressed":u.is_active,children:a.jsx("span",{className:"absolute top-[3px] rounded-full bg-white dark:bg-gray-200 shadow",style:{left:u.is_active?20:3,width:18,height:18}})})]})]})]}),"gestor"!==u.role&&"fotografia"!==u.role&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Grupos"}),a.jsx(p.Z,{options:r.map(e=>({value:e.id,label:e.name})),value:u.group_ids.length>0?u.group_ids[0]:"",onChange:e=>{m(r=>({...r,group_ids:e?[e]:[]}))},placeholder:(u.role,"Selecciona un grupo"),className:"text-sm"}),_&&a.jsx("div",{className:"mt-3 text-sm text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-700/50",children:_})]}),("gestor"===u.role||"fotografia"===u.role)&&_&&a.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-700/50",children:_}),(0,a.jsxs)("div",{className:"flex justify-center space-x-4 pt-4",children:[a.jsx("button",{type:"button",onClick:t,className:"px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",children:"Cancelar"}),a.jsx("button",{type:"submit",className:"px-6 py-2 text-sm font-medium text-white bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg hover:from-blue-600 hover:to-indigo-700 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200 shadow-md",children:"Actualizar Usuario"})]})]}),"password"===d&&(0,a.jsxs)("div",{className:"space-y-4",children:[D&&a.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700/50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),a.jsx("div",{className:"ml-3",children:a.jsx("p",{className:"text-sm text-green-800 dark:text-green-300",children:"Contrase\xf1a actualizada exitosamente"})})]})}),j&&a.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700/50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),a.jsx("div",{className:"ml-3",children:a.jsx("p",{className:"text-sm text-red-800 dark:text-red-300",children:j})})]})}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Nueva Contrase\xf1a"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx("input",{type:b?"text":"password",value:x.newPassword,onChange:e=>g({...x,newPassword:e.target.value}),placeholder:"Ingresa nueva contrase\xf1a",autoComplete:"new-password",className:"w-full px-3 py-2 pr-12 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 backdrop-blur-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200"}),a.jsx("button",{type:"button",onClick:()=>f(!b),className:"absolute right-2 top-2 px-2 py-1 rounded-md text-xs text-white bg-gray-900 dark:bg-gray-700 hover:bg-gray-800 dark:hover:bg-gray-600",children:b?"Ocultar":"Ver"})]}),x.newPassword&&x.newPassword.length<6&&a.jsx("p",{className:"text-red-500 dark:text-red-400 text-xs mt-1",children:"La contrase\xf1a debe tener al menos 6 caracteres"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Confirmar Contrase\xf1a"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx("input",{type:y?"text":"password",value:x.confirmPassword,onChange:e=>g({...x,confirmPassword:e.target.value}),placeholder:"Confirma la nueva contrase\xf1a",autoComplete:"new-password",className:"w-full px-3 py-2 pr-12 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 backdrop-blur-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200"}),a.jsx("button",{type:"button",onClick:()=>v(!y),className:"absolute right-2 top-2 px-2 py-1 rounded-md text-xs text-white bg-gray-900 dark:bg-gray-700 hover:bg-gray-800 dark:hover:bg-gray-600",children:y?"Ocultar":"Ver"})]}),x.confirmPassword&&x.newPassword!==x.confirmPassword&&a.jsx("p",{className:"text-red-500 dark:text-red-400 text-xs mt-1",children:"Las contrase\xf1as no coinciden"})]}),(0,a.jsxs)("div",{className:"flex justify-center space-x-4 pt-4",children:[a.jsx("button",{type:"button",onClick:t,className:"px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",children:"Cancelar"}),a.jsx("button",{type:"button",onClick:R,disabled:w||!x.newPassword||!x.confirmPassword||x.newPassword!==x.confirmPassword||x.newPassword.length<6,className:"px-6 py-2 text-sm font-medium text-white bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg hover:from-blue-600 hover:to-indigo-700 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200 shadow-md flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Cambiando..."]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Cambiar Contrase\xf1a"]})})]})]})]})}},71145:(e,r,t)=>{"use strict";t.d(r,{Z:()=>i});var a=t(95344),s=t(3729);let o={green:"bg-green-100 text-green-800",blue:"bg-blue-100 text-blue-800",red:"bg-red-100 text-red-800",yellow:"bg-yellow-100 text-yellow-800",gray:"bg-gray-100 text-gray-800"};function i({options:e,value:r,onChange:t,placeholder:i="Selecciona una opci\xf3n",className:l="",disabled:n=!1,maxHeight:d="max-h-60",autoOpen:c=!1}){let[u,m]=(0,s.useState)(!1),x=(0,s.useRef)(null);(0,s.useEffect)(()=>{c&&e.length>1?m(!0):c||m(!1)},[c,e.length]),(0,s.useEffect)(()=>{let e=e=>{x.current&&!x.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&m(!1)};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[]),(0,s.useEffect)(()=>{u&&x.current&&setTimeout(()=>{x.current?.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)},[u]);let g=e.find(e=>e.value===r),p=e=>{t(e),m(!1)};return(0,a.jsxs)("div",{className:`relative ${l}`,ref:x,children:[a.jsx("button",{type:"button",className:`w-full px-3 py-2 text-sm text-left border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 cursor-pointer flex items-center justify-between hover:border-gray-400 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200 ${n?"opacity-50 cursor-not-allowed":""}`,onClick:()=>!n&&m(!u),disabled:n,"aria-haspopup":"listbox","aria-expanded":u,children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[a.jsx("span",{className:g?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-400",children:g?g.label:i}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[g?.badge&&a.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${o[g.badgeColor||"gray"]}`,children:g.badge}),a.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform duration-200 ${u?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}),u&&a.jsx("div",{className:`absolute z-[99998] w-full mt-1 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg dark:shadow-lg dark:shadow-cyan-900/10 dark:ring-0.5 dark:ring-cyan-500/15 ${d} overflow-auto apple-scroll`,children:0===e.length?a.jsx("div",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:"No hay opciones disponibles"}):e.map((e,t)=>(0,a.jsxs)("div",{children:[t>0&&a.jsx("div",{className:"w-full h-px bg-gray-100 dark:bg-gray-600/50 dark:shadow-sm dark:shadow-blue-900/10"}),(0,a.jsxs)("div",{className:`px-4 py-3 text-sm cursor-pointer transition-colors duration-150 flex items-center justify-between ${e.disabled?"text-gray-400 dark:text-gray-500 cursor-not-allowed":"hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-900 dark:text-gray-100"} ${e.value===r?"bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-100":""}`,onClick:()=>!e.disabled&&p(e.value),children:[a.jsx("span",{children:e.label}),e.badge&&a.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${o[e.badgeColor||"gray"]}`,children:e.badge})]})]},e.value))})]})}},43995:(e,r,t)=>{"use strict";t.d(r,{Z:()=>i});var a=t(95344),s=t(3729),o=t(81202);function i({isOpen:e,onClose:r,children:t,title:i,maxWidthClass:l="max-w-lg",paddingClass:n="p-7",headerMarginClass:d="mb-5",formSpaceYClass:c="space-y-5",className:u="",showCloseButton:m=!0,closeOnBackdrop:x=!0}){let[g,p]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{if(!e)return;let r=document.body.style.overflow||"";return document.body.style.overflow="hidden",()=>{document.body.style.overflow=r}},[e]),(0,s.useEffect)(()=>{if(!e)return;let t=e=>{"Escape"===e.key&&r()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,r]),(0,s.useEffect)(()=>{p(!0)},[]),!e||!g||"undefined"==typeof document||!document.body)return null;e&&console.log("\uD83D\uDD35 StandardModal: Renderizando modal",{isOpen:e,mounted:g,hasBody:!!document.body});let h=a.jsx("div",{onClick:()=>{x&&r()},"aria-modal":"true",role:"dialog",className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-[99999] p-4",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999},children:(0,a.jsxs)("div",{className:`${n} w-full ${l} max-h-[calc(100vh-2rem)] overflow-y-auto bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-2xl shadow-xl ${u}`,onClick:e=>e.stopPropagation(),style:{position:"relative",display:"block",visibility:"visible",opacity:1},children:[(i||m)&&(0,a.jsxs)("div",{className:`flex items-center justify-between ${d}`,children:[i?a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:i}):a.jsx("div",{}),m&&a.jsx("button",{onClick:r,className:"text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Cerrar",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsx("div",{className:c,children:t})]})});return(0,o.createPortal)(h,document.body)}},51985:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>o,__esModule:()=>s,default:()=>i});let a=(0,t(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\app\admin\users\page.tsx`),{__esModule:s,$$typeof:o}=a,i=a.default}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[1638,6611,6654,1586,1582,1110,1881],()=>t(33904));module.exports=a})();