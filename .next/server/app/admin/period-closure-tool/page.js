(()=>{var e={};e.id=6036,e.ids=[6036],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},84362:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var s=t(50482),a=t(69108),o=t(62563),i=t.n(o),l=t(68300),n={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>l[e]);t.d(r,n);let d=["",{children:["admin",{children:["period-closure-tool",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,76356)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\period-closure-tool\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,66294)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,41878)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\period-closure-tool\\page.tsx"],u="/admin/period-closure-tool/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/period-closure-tool/page",pathname:"/admin/period-closure-tool",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},50614:(e,r,t)=>{Promise.resolve().then(t.bind(t,31754))},31754:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>n});var s=t(95344),a=t(3729),o=t(36654),i=t(22254);let l=(0,o.createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c");function n(){let[e,r]=(0,a.useState)(!1),[t,o]=(0,a.useState)(null),[n,d]=(0,a.useState)(null),[c,u]=(0,a.useState)("2024-11-16"),[m,p]=(0,a.useState)("16-31"),[x,h]=(0,a.useState)(!1),g=(0,i.useRouter)();(0,a.useEffect)(()=>{(async()=>{let{data:{user:e}}=await l.auth.getUser();if(!e){g.push("/login");return}let{data:r}=await l.from("users").select("role").eq("id",e.id).single();r?.role!=="super_admin"?d("Acceso denegado. Solo Super Admins pueden usar esta herramienta."):h(!0)})()},[]);let b=async()=>{if(confirm(`\xbfEST\xc1S SEGURO? Esto cerrar\xe1 forzosamente el periodo ${c} (${m}), archivar\xe1 los valores actuales y limpiar\xe1 las calculadoras. Esta acci\xf3n no se puede deshacer.`)){r(!0),d(null),o(null);try{let{data:{session:e}}=await l.auth.getSession(),r=await fetch("/api/calculator/period-closure/close-period",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e?.access_token}`,"x-force-period-date":c,"x-force-period-type":m}}),t=await r.json();if(!r.ok)throw Error(t.error||"Error desconocido al cerrar periodo");o(t)}catch(e){d(e.message)}finally{r(!1)}}};return x||n?n?s.jsx("div",{className:"p-8 text-red-600 font-bold",children:n}):(0,s.jsxs)("div",{className:"max-w-4xl mx-auto p-8",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6 text-red-600",children:"⚠️ Herramienta de Cierre Manual de Periodo"}),(0,s.jsxs)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8",children:[s.jsx("p",{className:"font-bold text-yellow-800",children:"\xa1ADVERTENCIA!"}),s.jsx("p",{className:"text-yellow-700",children:"Esta herramienta fuerza el cierre de un periodo, moviendo los datos de la calculadora al historial y borr\xe1ndolos de la vista actual. \xdasala SOLO cuando el cierre autom\xe1tico haya fallado."})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-8",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Configuraci\xf3n del Cierre"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Inicio del Periodo"}),s.jsx("input",{type:"date",value:c,onChange:e=>u(e.target.value),className:"w-full p-2 border border-gray-300 rounded focus:ring-red-500 focus:border-red-500"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ej: 2024-11-16 para la segunda quincena de Noviembre"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Periodo"}),(0,s.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"w-full p-2 border border-gray-300 rounded focus:ring-red-500 focus:border-red-500",children:[s.jsx("option",{value:"1-15",children:"Primera Quincena (1-15)"}),s.jsx("option",{value:"16-31",children:"Segunda Quincena (16-31)"})]})]})]}),s.jsx("button",{onClick:b,disabled:e,className:`w-full py-3 px-4 rounded-md text-white font-bold transition-colors ${e?"bg-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700 shadow-lg"}`,children:e?"Procesando Cierre...":"EJECUTAR CIERRE MANUAL"})]}),t&&(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-bold text-green-800 mb-2",children:"✅ Cierre Exitoso"}),s.jsx("pre",{className:"bg-gray-800 text-green-400 p-4 rounded overflow-auto text-sm",children:JSON.stringify(t,null,2)})]})]}):s.jsx("div",{className:"p-8",children:"Cargando..."})}},97075:(e,r,t)=>{"use strict";t.d(r,{Z:()=>u});var s=t(3729);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,t)=>t?t.toUpperCase():r.toLowerCase()),i=e=>{let r=o(e);return r.charAt(0).toUpperCase()+r.slice(1)},l=(...e)=>e.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim(),n=e=>{for(let r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,s.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:t=2,absoluteStrokeWidth:a,className:o="",children:i,iconNode:c,...u},m)=>(0,s.createElement)("svg",{ref:m,...d,width:r,height:r,stroke:e,strokeWidth:a?24*Number(t)/Number(r):t,className:l("lucide",o),...!i&&!n(u)&&{"aria-hidden":"true"},...u},[...c.map(([e,r])=>(0,s.createElement)(e,r)),...Array.isArray(i)?i:[i]])),u=(e,r)=>{let t=(0,s.forwardRef)(({className:t,...o},n)=>(0,s.createElement)(c,{ref:n,iconNode:r,className:l(`lucide-${a(i(e))}`,`lucide-${e}`,t),...o}));return t.displayName=i(e),t}},25545:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=(0,t(97075).Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},76356:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>o,__esModule:()=>a,default:()=>i});let s=(0,t(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\app\admin\period-closure-tool\page.tsx`),{__esModule:a,$$typeof:o}=s,i=s.default}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6611,6654,1586,1582,1110],()=>t(84362));module.exports=s})();