(()=>{var e={};e.id=6230,e.ids=[6230],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},21897:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var s=t(50482),a=t(69108),o=t(62563),i=t.n(o),n=t(68300),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);t.d(r,l);let d=["",{children:["admin",{children:["unfreeze-platforms",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,14212)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\unfreeze-platforms\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,66294)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,41878)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\admin\\unfreeze-platforms\\page.tsx"],u="/admin/unfreeze-platforms/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/unfreeze-platforms/page",pathname:"/admin/unfreeze-platforms",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},31048:(e,r,t)=>{Promise.resolve().then(t.bind(t,98612))},98612:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>i});var s=t(95344),a=t(3729),o=t(72829);function i(){let[e,r]=(0,a.useState)(!1),[t,i]=(0,a.useState)(!1),[n,l]=(0,a.useState)(null),[d,c]=(0,a.useState)(null),[u,m]=(0,a.useState)(null),p=async()=>{try{let{data:{session:e},error:r}=await o.supabase.auth.getSession();if(r||!e)return null;let t=e.expires_at;if(t&&t-Math.floor(Date.now()/1e3)<60){let{data:{session:r},error:t}=await o.supabase.auth.refreshSession();if(t||!r)return e.access_token;return r.access_token}return e.access_token}catch(e){return null}},x=async()=>{i(!0),c(null),l(null);try{let e=await p();if(!e)throw Error("No hay sesi\xf3n activa. Por favor, inicia sesi\xf3n.");let r=await fetch("/api/admin/unfreeze-platforms",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!r.ok){let e;let t=await r.text();try{e=JSON.parse(t)}catch{e={error:t||`Error ${r.status}`}}throw Error(e.error||`Error ${r.status}`)}let t=await r.json();l(t)}catch(e){c(e.message||"Error desconocido")}finally{i(!1)}},g=async()=>{if(confirm("⚠️ \xbfEst\xe1s seguro de que quieres descongelar TODAS las plataformas especiales de TODOS los modelos?\n\nEsto eliminar\xe1 todos los registros de congelamiento y forzar\xe1 el descongelamiento inmediato.")){r(!0),c(null),m(null);try{let e=await p();if(!e)throw Error("No hay sesi\xf3n activa. Por favor, inicia sesi\xf3n.");let r=await fetch("/api/admin/unfreeze-platforms?all=true",{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!r.ok){let e;let t=await r.text();try{e=JSON.parse(t)}catch{e={error:t||`Error ${r.status}`}}throw Error(e.error||`Error ${r.status}`)}let t=await r.json(),s=await fetch("/api/users?role=modelo&is_active=true",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok){let r=(await s.json()).users||[],a=0;for(let t of r.slice(0,50))try{await fetch(`/api/calculator/period-closure/platform-freeze-status?modelId=${t.id}&forceUnfreeze=true`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),a++}catch(e){console.error(`Error forzando descongelamiento para modelo ${t.id}:`,e)}m({...t,forced_unfreeze_count:a,message:`Se descongelaron ${t.deleted_count||0} registro(s) y se forz\xf3 el descongelamiento para ${a} modelo(s)`})}else m(t);setTimeout(()=>{x()},1e3)}catch(e){c(e.message||"Error desconocido")}finally{r(!1)}}};return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-4 sm:p-6 lg:p-8",children:s.jsx("div",{className:"max-w-4xl mx-auto",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 sm:p-8",children:[(0,s.jsxs)("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"\uD83D\uDD13 Descongelar Plataformas Especiales"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:'Descongela las plataformas especiales que est\xe1n bloqueadas en "Mi Calculadora"'})]}),(0,s.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:[s.jsx("h2",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"ℹ️ Informaci\xf3n:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[s.jsx("li",{children:"Las plataformas especiales se congelan autom\xe1ticamente en d\xedas de cierre de per\xedodo"}),s.jsx("li",{children:"Este proceso elimina los registros de congelamiento de la base de datos"}),s.jsx("li",{children:"Las plataformas quedar\xe1n disponibles inmediatamente despu\xe9s de descongelar"})]})]}),(0,s.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row gap-3",children:[s.jsx("button",{onClick:x,disabled:t||e,className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white font-semibold rounded-lg shadow-md transition-colors duration-200 disabled:cursor-not-allowed",children:t?"⏳ Verificando...":"\uD83D\uDD0D Verificar Estado"}),s.jsx("button",{onClick:g,disabled:e||t,className:"px-6 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-semibold rounded-lg shadow-md transition-colors duration-200 disabled:cursor-not-allowed",children:e?"⏳ Descongelando...":"\uD83D\uDD13 Descongelar Todas las Plataformas"})]}),n&&(0,s.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:[s.jsx("h3",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-3",children:"\uD83D\uDCCA Estado Actual:"}),(0,s.jsxs)("div",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-2",children:[(0,s.jsxs)("p",{children:[s.jsx("strong",{children:"Total de registros congelados:"})," ",n.total_records||0]}),(0,s.jsxs)("p",{children:[s.jsx("strong",{children:"Modelos afectados:"})," ",n.total_models||0]}),n.summary&&n.summary.length>0&&(0,s.jsxs)("div",{className:"mt-4",children:[s.jsx("p",{className:"font-semibold mb-2",children:"Modelos con plataformas congeladas:"}),s.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2",children:n.summary.map((e,r)=>(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-700 p-3 rounded border border-blue-200 dark:border-blue-700",children:[s.jsx("p",{className:"font-medium",children:e.email}),(0,s.jsxs)("p",{className:"text-xs opacity-75 mt-1",children:[e.frozen_count," plataforma(s) congelada(s): ",e.platforms.join(", ")]}),(0,s.jsxs)("p",{className:"text-xs opacity-60 mt-1",children:["Per\xedodos: ",e.periods.join(", ")]})]},r))})]}),0===n.total_records&&s.jsx("p",{className:"text-green-700 dark:text-green-300 font-semibold",children:"✅ No hay plataformas congeladas"})]})]}),d&&(0,s.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:[s.jsx("h3",{className:"font-semibold text-red-800 dark:text-red-200 mb-2",children:"❌ Error:"}),s.jsx("p",{className:"text-red-700 dark:text-red-300",children:d})]}),u&&(0,s.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[s.jsx("h3",{className:"font-semibold text-green-800 dark:text-green-200 mb-2",children:"✅ Resultado:"}),s.jsx("p",{className:"text-green-700 dark:text-green-300",children:u.message||`Se descongelaron ${u.deleted_count||0} plataforma(s)`})]})]})})})}},97075:(e,r,t)=>{"use strict";t.d(r,{Z:()=>u});var s=t(3729);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,t)=>t?t.toUpperCase():r.toLowerCase()),i=e=>{let r=o(e);return r.charAt(0).toUpperCase()+r.slice(1)},n=(...e)=>e.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim(),l=e=>{for(let r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,s.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:t=2,absoluteStrokeWidth:a,className:o="",children:i,iconNode:c,...u},m)=>(0,s.createElement)("svg",{ref:m,...d,width:r,height:r,stroke:e,strokeWidth:a?24*Number(t)/Number(r):t,className:n("lucide",o),...!i&&!l(u)&&{"aria-hidden":"true"},...u},[...c.map(([e,r])=>(0,s.createElement)(e,r)),...Array.isArray(i)?i:[i]])),u=(e,r)=>{let t=(0,s.forwardRef)(({className:t,...o},l)=>(0,s.createElement)(c,{ref:l,iconNode:r,className:n(`lucide-${a(i(e))}`,`lucide-${e}`,t),...o}));return t.displayName=i(e),t}},25545:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=(0,t(97075).Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},14212:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>o,__esModule:()=>a,default:()=>i});let s=(0,t(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\app\admin\unfreeze-platforms\page.tsx`),{__esModule:a,$$typeof:o}=s,i=s.default}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6611,6654,1586,1582,1110],()=>t(21897));module.exports=s})();