(()=>{var e={};e.id=7424,e.ids=[7424],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},67123:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>c,routeModule:()=>m,tree:()=>d});var r=s(50482),a=s(69108),l=s(62563),i=s.n(l),o=s(68300),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);s.d(t,n);let d=["",{children:["debug",{children:["partial-sync",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,58587)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\debug\\partial-sync\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,41878)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\debug\\partial-sync\\page.tsx"],x="/debug/partial-sync/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/debug/partial-sync/page",pathname:"/debug/partial-sync",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},16608:(e,t,s)=>{Promise.resolve().then(s.bind(s,53699))},41692:(e,t,s)=>{Promise.resolve().then(s.bind(s,37761))},14443:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2583,23)),Promise.resolve().then(s.t.bind(s,26840,23)),Promise.resolve().then(s.t.bind(s,38771,23)),Promise.resolve().then(s.t.bind(s,13225,23)),Promise.resolve().then(s.t.bind(s,9295,23)),Promise.resolve().then(s.t.bind(s,43982,23))},53699:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var r=s(95344),a=s(3729);let l=(0,s(36654).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c");function i(){let[e,t]=(0,a.useState)([]),[s,i]=(0,a.useState)(!1),[o,n]=(0,a.useState)(!1),d=async()=>{try{i(!0),n(!1),console.log("\uD83D\uDD0D [PARTIAL-SYNC] Iniciando an\xe1lisis de sincronizaci\xf3n parcial...");let e=new Date().toISOString().split("T")[0];console.log("\uD83D\uDCC5 [PARTIAL-SYNC] Fecha actual:",e);let{data:s,error:r}=await l.from("users").select("id, email, name, role, is_active").eq("role","modelo").eq("is_active",!0);if(r)throw Error(`Error obteniendo modelos: ${r.message}`);if(console.log(`✅ [PARTIAL-SYNC] Modelos encontrados: ${s?.length||0}`),!s||0===s.length){console.log("❌ [PARTIAL-SYNC] No se encontraron modelos");return}let a=[];for(let t of s){console.log(`🔍 [PARTIAL-SYNC] Analizando: ${t.name} (${t.id})`);try{let s;let{data:r,error:i}=await l.from("model_values").select("*").eq("model_id",t.id).eq("period_date",e),{data:o,error:n}=await l.from("calculator_totals").select("*").eq("model_id",t.id).eq("period_date",e),d=r&&r.length>0,c=o&&o.length>0,x=0,u=0,m="working";if(c&&o[0]&&(x=o[0].total_usd_bruto||0,u=o[0].total_usd_modelo||0),d||c){if(c){if(0===x&&0===u)m="zero-values",s="Totales en $0.00 (posible problema de c\xe1lculo)";else if(i||n){m="error";let e=i?.message||n?.message||"Error desconocido";s=`Error en consulta: ${e}`}}else m="no-data",s="Sin totales consolidados (calculator_totals)"}else m="no-data",s="Sin datos en ambas tablas";let g={id:t.id,name:t.name,email:t.email,modelValues:r||[],calculatorTotals:o||[],totalUsdBruto:x,totalUsdModelo:u,status:m,issue:s};a.push(g),console.log(`📊 [PARTIAL-SYNC] ${t.name}:`,{status:m,issue:s,modelValues:d?`${r.length} registros`:"Sin datos",calculatorTotals:c?`${o.length} registros`:"Sin datos",totalUsdBruto:x,totalUsdModelo:u,valuesError:i?.message,totalsError:n?.message})}catch(e){console.error(`❌ [PARTIAL-SYNC] Error analizando ${t.name}:`,e),a.push({id:t.id,name:t.name,email:t.email,modelValues:[],calculatorTotals:[],totalUsdBruto:0,totalUsdModelo:0,status:"error",issue:`Error: ${e?.message||"Error desconocido"}`})}}t(a),n(!0);let o=a.filter(e=>"working"===e.status).length,d=a.filter(e=>"no-data"===e.status).length,c=a.filter(e=>"zero-values"===e.status).length,x=a.filter(e=>"error"===e.status).length;console.log("\uD83D\uDCCB [PARTIAL-SYNC] Resumen final:",{total:a.length,working:o,noData:d,zeroValues:c,errors:x})}catch(e){console.error("❌ [PARTIAL-SYNC] Error general:",e)}finally{i(!1)}},c=async e=>{try{console.log(`🔧 [PARTIAL-SYNC] Intentando corregir modelo: ${e}`);let t=await fetch("/api/calculator/recalculate-totals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({modelId:e})}),s=await t.json();s.success?(console.log(`✅ [PARTIAL-SYNC] Modelo ${e} corregido`),await d()):console.error(`❌ [PARTIAL-SYNC] Error corrigiendo ${e}:`,s.error)}catch(e){console.error(`❌ [PARTIAL-SYNC] Error en correcci\xf3n:`,e)}},x=e=>{switch(e){case"working":return"text-green-600 bg-green-50";case"no-data":return"text-red-600 bg-red-50";case"zero-values":return"text-yellow-600 bg-yellow-50";default:return"text-gray-600 bg-gray-50"}},u=e=>{switch(e){case"working":return"✅";case"no-data":return"❌";case"zero-values":return"⚠️";case"error":return"\uD83D\uDD34";default:return"❓"}};return r.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"\uD83D\uDD0D Diagn\xf3stico de Sincronizaci\xf3n Parcial"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:'Analiza por qu\xe9 algunos modelos muestran valores en "Resumen de Facturaci\xf3n" y otros muestran $0.00'}),r.jsx("button",{onClick:d,disabled:s,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:s?"Analizando...":"Iniciar An\xe1lisis"})]}),o&&(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"\uD83D\uDCCA Resumen del An\xe1lisis"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[r.jsx("div",{className:"text-2xl font-bold text-green-600",children:"✅"}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Funcionando"}),r.jsx("div",{className:"text-lg font-semibold text-green-600",children:e.filter(e=>"working"===e.status).length})]}),(0,r.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg",children:[r.jsx("div",{className:"text-2xl font-bold text-red-600",children:"❌"}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Sin Datos"}),r.jsx("div",{className:"text-lg font-semibold text-red-600",children:e.filter(e=>"no-data"===e.status).length})]}),(0,r.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[r.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:"⚠️"}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Valores en $0"}),r.jsx("div",{className:"text-lg font-semibold text-yellow-600",children:e.filter(e=>"zero-values"===e.status).length})]}),(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/20 p-4 rounded-lg",children:[r.jsx("div",{className:"text-2xl font-bold text-gray-600",children:"\uD83D\uDD34"}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Errores"}),r.jsx("div",{className:"text-lg font-semibold text-gray-600",children:e.filter(e=>"error"===e.status).length})]})]})]}),e.length>0&&(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"\uD83D\uDCCB Detalles por Modelo"})}),r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Modelo"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Estado"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"USD Bruto"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"USD Modelo"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Model Values"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Calculator Totals"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Acci\xf3n"})]})}),r.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:e.map(e=>(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0 h-8 w-8",children:r.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:e.name.charAt(0).toUpperCase()})})}),(0,r.jsxs)("div",{className:"ml-4",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.name}),r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})]})}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,r.jsxs)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x(e.status)}`,children:[u(e.status)," ",e.status]}),e.issue&&r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e.issue})]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:["$",e.totalUsdBruto.toFixed(2)]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:["$",e.totalUsdModelo.toFixed(2)]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.modelValues.length," registros"]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.calculatorTotals.length," registros"]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:"working"!==e.status&&r.jsx("button",{onClick:()=>c(e.id),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",children:"\uD83D\uDD27 Corregir"})})]},e.id))})]})})]}),(0,r.jsxs)("div",{className:"mt-8 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"\uD83D\uDCA1 Interpretaci\xf3n de Resultados"}),(0,r.jsxs)("div",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"✅ Funcionando:"})," Modelo con datos correctos en ambas tablas"]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"❌ Sin Datos:"})," Modelo sin registros en model_values o calculator_totals"]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"⚠️ Valores en $0:"})," Modelo con datos pero totales calculados en $0.00"]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"\uD83D\uDD34 Errores:"})," Problemas t\xe9cnicos en la consulta de datos"]})]})]})]})})}},37761:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(95344),a=s(3729);let l=({children:e})=>{let[t,s]=(0,a.useState)(!1),[l,i]=(0,a.useState)("light");return(0,a.useEffect)(()=>{let e=new MutationObserver(e=>{e.forEach(e=>{if("attributes"===e.type&&"class"===e.attributeName){let e=document.documentElement.classList.contains("dark")?"dark":"light";e!==l&&(i(e),s(!0),setTimeout(()=>{s(!1)},600))}})});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[l]),(0,r.jsxs)("div",{className:`relative transition-all duration-500 ease-in-out ${t?"opacity-90 scale-[0.98] blur-[1px]":"opacity-100 scale-100 blur-0"}`,children:[t&&(0,r.jsxs)("div",{className:"fixed inset-0 z-[9999] pointer-events-none",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/10 via-purple-500/10 to-indigo-500/10 dark:from-gray-900/20 dark:via-gray-800/20 dark:to-gray-900/20 animate-pulse"}),r.jsx("div",{className:"absolute inset-0 bg-white/5 dark:bg-black/5 backdrop-blur-sm"}),r.jsx("div",{className:"absolute inset-0 bg-gradient-radial from-blue-400/20 via-transparent to-transparent animate-ping"})]}),e]})}},58587:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>a,default:()=>i});let r=(0,s(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\app\debug\partial-sync\page.tsx`),{__esModule:a,$$typeof:l}=r,i=r.default},41878:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d,metadata:()=>n});var r=s(25036);s(67272);let a=(0,s(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\components\ThemeTransition.tsx`),{__esModule:l,$$typeof:i}=a,o=a.default,n={title:"AIM Sistema de Gesti\xf3n",description:"Sistema de gesti\xf3n de usuarios con roles y grupos - Dise\xf1o Apple.com",icons:{icon:[{url:"/favicon.svg",type:"image/svg+xml"},{url:"/favicon.ico",type:"image/x-icon"}]}};function d({children:e}){return r.jsx("html",{lang:"es",children:r.jsx("body",{className:"min-h-screen bg-white text-gray-900 antialiased",children:r.jsx(o,{children:e})})})}},67272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[1638,6611,6654],()=>s(67123));module.exports=r})();