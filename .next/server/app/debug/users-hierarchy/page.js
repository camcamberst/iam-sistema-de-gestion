(()=>{var e={};e.id=2620,e.ids=[2620],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},52824:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>o.a,__next_app__:()=>g,originalPathname:()=>c,pages:()=>u,routeModule:()=>m,tree:()=>d});var t=r(50482),a=r(69108),i=r(62563),o=r.n(i),n=r(68300),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);r.d(s,l);let d=["",{children:["debug",{children:["users-hierarchy",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,86383)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\debug\\users-hierarchy\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,41878)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,69361,23)),"next/dist/client/components/not-found-error"]}],u=["C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\debug\\users-hierarchy\\page.tsx"],c="/debug/users-hierarchy/page",g={require:r,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/debug/users-hierarchy/page",pathname:"/debug/users-hierarchy",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},21950:(e,s,r)=>{Promise.resolve().then(r.bind(r,57862))},41692:(e,s,r)=>{Promise.resolve().then(r.bind(r,37761))},14443:(e,s,r)=>{Promise.resolve().then(r.t.bind(r,2583,23)),Promise.resolve().then(r.t.bind(r,26840,23)),Promise.resolve().then(r.t.bind(r,38771,23)),Promise.resolve().then(r.t.bind(r,13225,23)),Promise.resolve().then(r.t.bind(r,9295,23)),Promise.resolve().then(r.t.bind(r,43982,23))},57862:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>o});var t=r(95344),a=r(3729),i=r(72829);function o(){let[e,s]=(0,a.useState)(null),[r,o]=(0,a.useState)(!0),[n,l]=(0,a.useState)(null);return((0,a.useEffect)(()=>{(async()=>{try{console.log("\uD83D\uDD0D [DEBUG-USERS] Iniciando diagn\xf3stico de jerarqu\xeda de usuarios...");let{data:{user:e}}=await i.supabase.auth.getUser();if(!e){l("Usuario no autenticado");return}console.log("\uD83D\uDD0D [DEBUG-USERS] Usuario autenticado:",e.id);let{data:r,error:t}=await i.supabase.from("users").select(`
            role,
            user_groups(
              groups!inner(
                id,
                name
              )
            )
          `).eq("id",e.id).single();if(t){console.error("❌ [DEBUG-USERS] Error obteniendo datos del usuario:",t),l("Error obteniendo datos del usuario: "+t.message);return}if(!r){l("Error obteniendo datos del usuario");return}let a=r.user_groups?.map(e=>e.groups.id)||[];console.log("\uD83D\uDD0D [DEBUG-USERS] Datos del usuario actual:",{id:e.id,role:r.role,groups:a});let{data:o,error:n}=await i.supabase.from("users").select(`
            id,
            name,
            email,
            role,
            is_active,
            user_groups(
              groups!inner(
                id,
                name
              )
            )
          `).order("created_at",{ascending:!1});if(n){console.error("❌ [DEBUG-USERS] Error obteniendo usuarios:",n),l("Error obteniendo usuarios: "+n.message);return}console.log("\uD83D\uDD0D [DEBUG-USERS] Usuarios obtenidos de Supabase:",o?.length||0);let d=o||[];"admin"===r.role?(console.log("\uD83D\uDD0D [DEBUG-USERS] Aplicando filtro de jerarqu\xeda para admin:",{userGroupIds:a,totalUsers:d.length}),d=(o||[]).filter(e=>{if("super_admin"===e.role)return!1;if(("admin"===e.role||"modelo"===e.role)&&e.user_groups&&e.user_groups.length>0){let s=e.user_groups.map(e=>e.groups.id),r=s.some(e=>a.includes(e));return console.log("\uD83D\uDD0D [DEBUG-USERS] Usuario:",e.name,{role:e.role,targetGroups:s,hasCommonGroup:r,willShow:r}),r}return!1}),console.log("\uD83D\uDD0D [DEBUG-USERS] Usuarios despu\xe9s del filtro:",d.length)):"super_admin"===r.role&&console.log("\uD83D\uDD0D [DEBUG-USERS] Super admin - mostrando todos los usuarios"),s({id:e.id,role:r.role,groups:a,totalUsers:o?.length||0,filteredUsers:d.length})}catch(e){console.error("❌ [DEBUG-USERS] Error general:",e),l("Error general: "+e.message)}finally{o(!1)}})()},[]),r)?t.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"Diagnosticando jerarqu\xeda de usuarios..."})]})}):n?t.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[t.jsx("h2",{className:"text-xl font-bold text-red-600 dark:text-red-400 mb-4",children:"Error"}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:n})]})}):t.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 py-8",children:t.jsx("div",{className:"max-w-4xl mx-auto px-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"\uD83D\uDD0D Diagn\xf3stico de Jerarqu\xeda de Usuarios"}),e&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[t.jsx("h2",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-3",children:"Informaci\xf3n del Usuario Actual"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ID:"}),t.jsx("p",{className:"font-mono text-sm text-gray-900 dark:text-white",children:e.id})]}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Rol:"}),t.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:e.role})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Grupos Asignados:"}),t.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:e.groups.length>0?e.groups.map((e,s)=>t.jsx("span",{className:"bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 px-2 py-1 rounded text-sm",children:e},s)):t.jsx("span",{className:"text-gray-500 dark:text-gray-400 italic",children:"Sin grupos asignados"})})]})]})]}),(0,t.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[t.jsx("h2",{className:"text-lg font-semibold text-green-900 dark:text-green-100 mb-3",children:"Resultados del Filtrado"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total de Usuarios:"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.totalUsers})]}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Usuarios Visibles:"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.filteredUsers})]})]})]}),(0,t.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[t.jsx("h2",{className:"text-lg font-semibold text-yellow-900 dark:text-yellow-100 mb-3",children:"An\xe1lisis"}),(0,t.jsxs)("div",{className:"space-y-2",children:["admin"===e.role&&0===e.groups.length&&(0,t.jsxs)("p",{className:"text-yellow-800 dark:text-yellow-200",children:["⚠️ ",t.jsx("strong",{children:"Problema detectado:"})," El usuario admin no tiene grupos asignados. Esto causar\xe1 que vea todos los usuarios sin filtro de jerarqu\xeda."]}),"admin"===e.role&&e.groups.length>0&&e.filteredUsers===e.totalUsers&&(0,t.jsxs)("p",{className:"text-yellow-800 dark:text-yellow-200",children:["⚠️ ",t.jsx("strong",{children:"Posible problema:"})," El filtro de jerarqu\xeda no est\xe1 funcionando correctamente. Se est\xe1n mostrando todos los usuarios."]}),"admin"===e.role&&e.groups.length>0&&e.filteredUsers<e.totalUsers&&(0,t.jsxs)("p",{className:"text-green-800 dark:text-green-200",children:["✅ ",t.jsx("strong",{children:"Funcionando correctamente:"})," El filtro de jerarqu\xeda est\xe1 aplic\xe1ndose. Solo se muestran los usuarios de los grupos asignados."]}),"super_admin"===e.role&&(0,t.jsxs)("p",{className:"text-blue-800 dark:text-blue-200",children:["ℹ️ ",t.jsx("strong",{children:"Super Admin:"})," Puede ver todos los usuarios sin restricciones."]})]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Instrucciones"}),(0,t.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-2",children:[t.jsx("p",{children:"1. Revisa la consola del navegador para ver los logs detallados"}),t.jsx("p",{children:"2. Si hay problemas, verifica que el usuario tenga grupos asignados"}),t.jsx("p",{children:'3. Compara estos resultados con lo que ves en "Consultar Usuarios"'})]})]})]})]})})})}},37761:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>i});var t=r(95344),a=r(3729);let i=({children:e})=>{let[s,r]=(0,a.useState)(!1),[i,o]=(0,a.useState)("light");return(0,a.useEffect)(()=>{let e=new MutationObserver(e=>{e.forEach(e=>{if("attributes"===e.type&&"class"===e.attributeName){let e=document.documentElement.classList.contains("dark")?"dark":"light";e!==i&&(o(e),r(!0),setTimeout(()=>{r(!1)},600))}})});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[i]),(0,t.jsxs)("div",{className:`relative transition-all duration-500 ease-in-out ${s?"opacity-90 scale-[0.98] blur-[1px]":"opacity-100 scale-100 blur-0"}`,children:[s&&(0,t.jsxs)("div",{className:"fixed inset-0 z-[9999] pointer-events-none",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/10 via-purple-500/10 to-indigo-500/10 dark:from-gray-900/20 dark:via-gray-800/20 dark:to-gray-900/20 animate-pulse"}),t.jsx("div",{className:"absolute inset-0 bg-white/5 dark:bg-black/5 backdrop-blur-sm"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-radial from-blue-400/20 via-transparent to-transparent animate-ping"})]}),e]})}},72829:(e,s,r)=>{"use strict";r.r(s),r.d(s,{supabase:()=>t});let t=(0,r(36654).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")},86383:(e,s,r)=>{"use strict";r.r(s),r.d(s,{$$typeof:()=>i,__esModule:()=>a,default:()=>o});let t=(0,r(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\app\debug\users-hierarchy\page.tsx`),{__esModule:a,$$typeof:i}=t,o=t.default},41878:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>d,metadata:()=>l});var t=r(25036);r(67272);let a=(0,r(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\components\ThemeTransition.tsx`),{__esModule:i,$$typeof:o}=a,n=a.default,l={title:"AIM Sistema de Gesti\xf3n",description:"Sistema de gesti\xf3n de usuarios con roles y grupos - Dise\xf1o Apple.com",icons:{icon:[{url:"/favicon.png",type:"image/png",sizes:"512x512"},{url:"/favicon.png",type:"image/png",sizes:"192x192"},{url:"/favicon.png",type:"image/png",sizes:"64x64"},{url:"/favicon.png",type:"image/png",sizes:"32x32"},{url:"/favicon.ico",type:"image/x-icon",sizes:"any"}],apple:[{url:"/favicon.png",type:"image/png",sizes:"180x180"}]}};function d({children:e}){return t.jsx("html",{lang:"es",children:t.jsx("body",{className:"min-h-screen bg-white text-gray-900 antialiased",children:t.jsx(n,{children:e})})})}},67272:()=>{}};var s=require("../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[1638,6611,6654],()=>r(52824));module.exports=t})();