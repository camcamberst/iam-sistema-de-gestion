(()=>{var e={};e.id=6344,e.ids=[6344],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},66403:(e,r,a)=>{"use strict";a.r(r),a.d(r,{GlobalError:()=>d.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>n});var t=a(50482),s=a(69108),l=a(62563),d=a.n(l),i=a(68300),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);a.d(r,o);let n=["",{children:["superadmin",{children:["dashboard",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,93612)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\superadmin\\dashboard\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,46826)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\superadmin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,41878)),"C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,69361,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\superadmin\\dashboard\\page.tsx"],m="/superadmin/dashboard/page",u={require:a,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/superadmin/dashboard/page",pathname:"/superadmin/dashboard",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:n}})},48224:(e,r,a)=>{Promise.resolve().then(a.bind(a,52817))},48258:(e,r,a)=>{Promise.resolve().then(a.bind(a,15006))},52817:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>u});var t=a(95344),s=a(3729),l=a(72829),d=a(8421),i=a(15807);function o({modelId:e,adminView:r=!1,adminId:a,onSave:l}){let[d,o]=(0,s.useState)(null),[n,c]=(0,s.useState)([]),[m,u]=(0,s.useState)(null),[x,g]=(0,s.useState)((0,i.dB)()),[h,p]=(0,s.useState)({}),[b,f]=(0,s.useState)(!0),[y,v]=(0,s.useState)(null),[j,k]=(0,s.useState)(null),[w,N]=(0,s.useState)(!1),[C,D]=(0,s.useState)(!1),[L,S]=(0,s.useState)([]);console.log("\uD83D\uDD0D [MODEL-CALCULATOR] System configuration:",{ENABLE_AUTOSAVE:!1,SYSTEM_VERSION:"V2_ONLY",modelId:e,adminView:r,adminId:a}),(0,s.useEffect)(()=>{(async()=>{try{if(f(!0),r&&a){let r={id:e,name:"Modelo",email:"modelo@ejemplo.com",role:"modelo",groups:[],organization_id:"",is_active:!0,last_login:new Date().toISOString()};o(r)}await M(e)}finally{f(!1)}})()},[e,r,a]);let M=async e=>{try{console.log("\uD83D\uDD0D [MODEL-CALCULATOR] Loading config for userId:",e);let r=await fetch("/api/rates-v2?activeOnly=true"),a=await r.json();if(console.log("\uD83D\uDD0D [MODEL-CALCULATOR] Rates data:",a),a.success&&a.data){let e={usd_cop:a.data.find(e=>"USD→COP"===e.kind)?.value||3900,eur_usd:a.data.find(e=>"EUR→USD"===e.kind)?.value||1.01,gbp_usd:a.data.find(e=>"GBP→USD"===e.kind)?.value||1.2};u(e)}let t=await fetch(`/api/calculator/config-v2?modelId=${e}`);if(!t.ok)throw Error("Error al cargar configuraci\xf3n");let s=await t.json();if(console.log("\uD83D\uDD0D [MODEL-CALCULATOR] Config data:",s),console.log("\uD83D\uDD0D [MODEL-CALCULATOR] Platforms received:",s.config?.platforms),!s.success)throw Error(s.error||"Error al cargar configuraci\xf3n");let l=s.config.platforms.filter(e=>e.enabled).map(e=>({id:e.id,name:e.name,enabled:!0,value:0,percentage:e.percentage_override||e.group_percentage||80,minQuota:470,currency:e.currency||"USD",percentage_override:e.percentage_override,group_percentage:e.group_percentage}));console.log("\uD83D\uDD0D [MODEL-CALCULATOR] Enabled platforms:",l),c(l);try{console.log("\uD83D\uDD0D [MODEL-CALCULATOR] Loading saved values - V2 system only");let r=await fetch(`/api/calculator/model-values-v2?modelId=${e}&periodDate=${x}`),a=await r.json();if(console.log("\uD83D\uDD0D [MODEL-CALCULATOR] Saved values (v2):",a),a.success&&Array.isArray(a.frozenPlatforms)?(S(a.frozenPlatforms),console.log("\uD83D\uDD12 [MODEL-CALCULATOR] Plataformas congeladas:",a.frozenPlatforms)):S([]),a.success&&Array.isArray(a.data)&&a.data.length>0){let e={};a.data.forEach(r=>{e[r.platform_id]=r.value.toString()}),p(e),c(r=>r.map(r=>({...r,value:parseFloat(e[r.id])||0})))}}catch(e){console.warn("⚠️ [MODEL-CALCULATOR] Error loading saved values:",e)}}catch(e){console.error("❌ [MODEL-CALCULATOR] Error loading calculator config:",e),v("Error al cargar configuraci\xf3n de la calculadora")}},E=(e,r)=>{p(a=>({...a,[e]:r})),c(a=>a.map(a=>a.id===e?{...a,value:parseFloat(r)||0}:a))},_=()=>{if(!m)return;let e=n.filter(e=>e.enabled&&e.value>0);if(0===e.length){k(null);return}let r=e.map(e=>{let r=0,a=0;"EUR"===e.currency?a="big7"===e.id?.84*(r=e.value*m.eur_usd):"mondo"===e.id?.78*(r=e.value*m.eur_usd):r=e.value*m.eur_usd:"GBP"===e.currency?a="aw"===e.id?.677*(r=e.value*m.gbp_usd):r=e.value*m.gbp_usd:"USD"===e.currency&&("cmd"===e.id||"camlust"===e.id||"skypvt"===e.id?(r=e.value,a=.75*e.value):"chaturbate"===e.id||"myfreecams"===e.id||"stripchat"===e.id?(r=e.value,a=.05*e.value):"dxlive"===e.id?(r=e.value,a=.6*e.value):"secretfriends"===e.id?(r=e.value,a=.5*e.value):(e.id,r=e.value,a=e.value));let t=(a=e.percentage/100*a)*m.usd_cop;return{platformId:e.id,usdBruto:r,usdModelo:a,copModelo:t}}),a=r.reduce((e,r)=>e+r.usdBruto,0),t=r.reduce((e,r)=>e+r.usdModelo,0),s=r.reduce((e,r)=>e+r.copModelo,0);k({perPlatform:r,totalUsdBruto:a,totalUsdModelo:t,totalCopModelo:s,cuotaMinimaAlert:{below:t<470,percentToReach:t<470?(470-t)/470*100:0},anticipoMaxCop:.9*s})},A=async()=>{if(d)try{D(!0);let e=n.filter(e=>e.enabled&&e.value>0).reduce((e,r)=>(e[r.id]=r.value,e),{}),r=await fetch("/api/calculator/model-values-v2",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({modelId:d.id,values:e,periodDate:x})}),a=await r.json();if(!a.success)throw Error(a.error||"Error al guardar valores");if(console.log("✅ [MODEL-CALCULATOR] Values saved successfully"),j){let e=await fetch("/api/calculator/totals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({modelId:d.id,periodDate:x,totalUsdBruto:j.totalUsdBruto,totalUsdModelo:j.totalUsdModelo,totalCopModelo:j.totalCopModelo})}),r=await e.json();r.success?console.log("✅ [MODEL-CALCULATOR] Totals saved successfully"):console.error("❌ [MODEL-CALCULATOR] Error saving totals:",r.error)}l&&l(n)}catch(e){console.error("❌ [MODEL-CALCULATOR] Error saving values:",e),v("Error al guardar valores")}finally{D(!1)}};return((0,s.useEffect)(()=>{_()},[n,m]),b)?t.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Cargando calculadora..."})]})}):y?t.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center p-6 bg-red-50 rounded-xl border border-red-200",children:[t.jsx("h1",{className:"text-2xl font-semibold text-red-800 mb-4",children:"Error"}),t.jsx("p",{className:"text-red-700",children:y})]})}):t.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[t.jsx("div",{className:"mb-6 flex items-center justify-between",children:(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-1",children:"Mi Calculadora"}),(0,t.jsxs)("p",{className:"text-gray-500 dark:text-gray-300 text-sm",children:["Bienvenida, ",d?.name||"Usuario"," \xb7 Ingresa tus valores por plataforma"]})]})}),m&&(0,t.jsxs)("div",{className:"mb-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Tasas Actualizadas"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,t.jsxs)("div",{className:"text-2xl font-bold text-blue-900",children:["$",m.usd_cop.toLocaleString()," USD→COP"]})}),t.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,t.jsxs)("div",{className:"text-2xl font-bold text-green-900",children:[m.eur_usd," EUR→USD"]})}),t.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:(0,t.jsxs)("div",{className:"text-2xl font-bold text-purple-900",children:[m.gbp_usd," GBP→USD"]})})]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-300 mt-2",children:"Configuradas por tu administrador"})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-700 rounded-xl shadow-sm dark:shadow-lg dark:shadow-indigo-900/10 dark:ring-0.5 dark:ring-indigo-500/15 border border-gray-200 dark:border-gray-600 p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Calculadora de Ingresos"}),0===n.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No hay plataformas habilitadas"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-300",children:"Tu administrador a\xfan no ha configurado las plataformas para tu calculadora."})]}):t.jsx("div",{className:"space-y-4",children:n.map(e=>{let r=L.includes(e.id);return(0,t.jsxs)("div",{className:`flex items-center space-x-4 p-4 rounded-lg ${r?"bg-gray-100 dark:bg-gray-800":"bg-gray-50 dark:bg-gray-700/50"}`,children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",checked:e.enabled,disabled:r,onChange:r=>{c(a=>a.map(a=>a.id===e.id?{...a,enabled:r.target.checked}:a))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 disabled:opacity-50"}),(0,t.jsxs)("span",{className:`font-medium ${r?"text-gray-500":"text-gray-900 dark:text-gray-100"}`,children:[e.name,r&&t.jsx("span",{title:"Plataforma congelada por horario europeo",className:"ml-2 text-xs text-amber-600 bg-amber-100 px-1.5 py-0.5 rounded border border-amber-200 cursor-help",children:"\uD83D\uDD12 Cerrado"})]})]}),e.enabled&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"text",value:h[e.id]||"",onChange:r=>E(e.id,r.target.value),disabled:r,className:`w-24 px-2 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 
                          ${r?"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed":"bg-white border-gray-300 dark:bg-gray-800 dark:border-gray-600 dark:text-white"}`,placeholder:"0"}),t.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-300",children:e.currency}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 dark:text-gray-300",children:["(",e.percentage,"%)"]})]})]},e.id)})}),j&&t.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-100",children:"Total USD:"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-blue-900",children:["$",j.totalUsdModelo.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-100",children:"Total COP:"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-green-900",children:["$",j.totalCopModelo.toLocaleString("es-CO")]})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-100",children:"Anticipo M\xe1ximo:"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-purple-900",children:["$",j.anticipoMaxCop.toLocaleString("es-CO")]})]})]})}),n.length>0&&t.jsx("div",{className:"mt-6 flex justify-end",children:t.jsx("button",{onClick:A,disabled:C,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:C?"Guardando...":"Guardar Valores"})})]})]})})}var n=a(87502),c=a(70577),m=a(77098);function u(){let[e,r]=(0,s.useState)({total:0,super_admin:0,admin:0,modelo:0}),[a,i]=(0,s.useState)(!0),[u,x]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{try{i(!0);let{data:e}=await l.supabase.auth.getUser(),a=e?.user?.id;if(!a){x(null),i(!1);return}let{data:t}=await l.supabase.from("users").select("id,name,email,role").eq("id",a).single(),s=[];if(t&&"super_admin"!==t.role){let{data:e}=await l.supabase.from("user_groups").select("groups(name)").eq("user_id",a);s=(e||[]).map(e=>e.groups?.name).filter(Boolean)}let d={id:t?.id||a,name:t?.name||e.user?.email?.split("@")[0]||"Usuario",email:t?.email||e.user?.email||"",role:t?.role||"modelo",groups:s};x(d);let{data:o}=await l.supabase.from("users").select("id,role");if(o){let e=o.length,a=o.filter(e=>"super_admin"===e.role).length,t=o.filter(e=>"admin"===e.role).length,s=o.filter(e=>"modelo"===e.role).length;r({total:e,super_admin:a,admin:t,modelo:s})}}finally{i(!1)}})()},[]),t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,t.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:[t.jsx("div",{className:"mb-8 sm:mb-12",children:(0,t.jsxs)("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 to-indigo-600/10 rounded-xl blur-xl"}),t.jsx("div",{className:"relative bg-white/80 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:t.jsx("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 md:gap-3",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[t.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:t.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[t.jsx("h1",{className:"text-base sm:text-lg md:text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:"Dashboard"}),u&&(0,t.jsxs)("p",{className:"mt-1 text-xs sm:text-sm text-gray-600 dark:text-gray-300 hidden sm:block",children:["Bienvenido, ",u.name," \xb7 Rol: ",String(u.role).replace("_"," "),"super_admin"!==u.role&&u.groups.length>0&&` \xb7 Grupos: ${u.groups.join(", ")}`]})]})]})})})]})}),t.jsx(m.Z,{}),(u?.role==="super_admin"||u?.role==="admin")&&(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10",children:[t.jsx(d.Z,{compact:!0}),t.jsx(c.Z,{userRole:u.role,userId:u.id,userGroups:u.groups})]}),(u?.role==="super_admin"||u?.role==="admin")&&t.jsx("div",{className:"mb-10",children:t.jsx(n.Z,{userRole:u.role,userGroups:u.groups})}),u?.role==="modelo"&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-700/20 p-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:t.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),t.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Mi perfil"})]}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:"Revisa tu informaci\xf3n"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-200",children:["Email: ",u.email]}),(0,t.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-200",children:["Grupo: ",u.groups[0]||"—"]})]})]}),t.jsx(o,{modelId:u.id,adminView:!1})]})]})})}},15006:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>h});var t=a(95344),s=a(3729),l=a(20783),d=a.n(l),i=a(22254),o=a(72829),n=a(52769),c=a(53267),m=a.n(c),u=a(6158),x=a(13047);let g=m()(async()=>{},{loadableGenerated:{modules:["C:\\Users\\camca\\OneDrive\\Documentos\\GitHub\\iam-sistema-de-gestion\\app\\superadmin\\layout.tsx -> @/components/chat/ChatWidget"]},ssr:!1});function h({children:e}){let r=(0,i.usePathname)(),[a,l]=(0,s.useState)(null),[c,m]=(0,s.useState)(!1),[h,p]=(0,s.useState)(!1),[b,f]=(0,s.useState)(null),[y,v]=(0,s.useState)(null),j=(0,s.useRef)(null),[k,w]=(0,s.useState)(!1),[N,C]=(0,s.useState)(!1),[D,L]=(0,s.useState)(new Set),S=async()=>{try{p(!0);let{data:e}=await o.supabase.auth.getUser(),r=e?.user?.id;if(!r){f(null);return}let{data:a}=await o.supabase.from("users").select("id,name,email,role").eq("id",r).single(),t=[];if(a&&"super_admin"!==a.role){let{data:e}=await o.supabase.from("user_groups").select("groups(name)").eq("user_id",r);t=(e||[]).map(e=>e.groups?.name).filter(Boolean)}f({id:a?.id||r,name:a?.name||e.user?.email?.split("@")[0]||"Usuario",email:a?.email||e.user?.email||"",role:a?.role||"modelo",groups:t})}finally{p(!1)}};(0,s.useEffect)(()=>{w(!0)},[]),(0,s.useEffect)(()=>{C(!1)},[r]),(0,s.useEffect)(()=>(N?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[N]),(0,s.useEffect)(()=>{b||h||S()},[k]);let M=e=>{y&&(clearTimeout(y),v(null)),l(e)},E=()=>{v(setTimeout(()=>{l(null)},300))},_=()=>{y&&(clearTimeout(y),v(null))},A=()=>{v(setTimeout(()=>{l(null)},150))};(0,s.useEffect)(()=>()=>{y&&clearTimeout(y)},[y]),(0,s.useEffect)(()=>{let e=e=>{j.current&&!j.current.contains(e.target)&&m(!1)};return c&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[c]);let O=(0,s.useMemo)(()=>{let e="modelo";if(b?.role)e=b.role;else if(k){let r=localStorage.getItem("user");if(r)try{e=JSON.parse(r).role||"modelo"}catch(e){console.error("Error parsing user data:",e)}}let r=[{id:"calculator",label:"modelo"===e?"Mi Calculadora":"Gesti\xf3n Calculadora",href:"#",subItems:"modelo"===e?[{label:"Ingresar Valores",href:"/model/calculator"}]:[]}];if("super_admin"===e||"admin"===e){r.unshift({id:"users",label:"Gesti\xf3n Usuarios",href:"#",subItems:[{label:"Crear Usuario",href:"/admin/users/create"},{label:"Consultar Usuarios",href:"/admin/users"}]}),r.push({id:"anticipos",label:"Gesti\xf3n Anticipos",href:"#",subItems:[{label:"Solicitudes Pendientes",href:"/admin/anticipos/pending"},{label:"Historial Anticipos",href:"/admin/anticipos/history"}]}),r.push({id:"sedes",label:"Gesti\xf3n Agencia",href:"#",subItems:[{label:"Gestionar Sedes",href:"/admin/sedes/gestionar"},{label:"Portafolio Modelos",href:"/admin/sedes/portafolio"},{label:"Dashboard Sedes",href:"/admin/sedes/dashboard"},{label:"Gestionar Afiliados",href:"/admin/affiliates/gestionar"}]});let e=r.findIndex(e=>"calculator"===e.id);-1!==e&&(r[e].subItems=[{label:"Definir RATES",href:"/admin/rates"},{label:"Crear Plataforma",href:"/admin/calculator/create-platform"},{label:"Configurar Calculadora",href:"/admin/calculator/config"},{label:"Ver Calculadora Modelo",href:"/admin/calculator/view-model"}])}return r},[b,k]),U=e=>r===e,P=e=>e.subItems?.some(e=>r===e.href);return(0,t.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:[t.jsx("header",{className:"bg-white dark:bg-gray-900 backdrop-blur-md border border-white/20 dark:border-gray-700/30 sticky top-0 z-[99999] shadow-lg dark:shadow-lg dark:shadow-purple-900/15 dark:ring-0.5 dark:ring-purple-400/20",children:t.jsx("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 md:px-6 lg:px-8",children:(0,t.jsxs)("div",{className:"flex items-center justify-between h-14 md:h-16",children:[t.jsx("div",{className:"flex items-center flex-1 min-w-0 pr-1 sm:pr-0",children:(0,t.jsxs)(d(),{href:"/superadmin/dashboard",className:"flex items-center space-x-1 sm:space-x-1.5 md:space-x-3 group",children:[t.jsx("div",{className:"w-6 h-6 sm:w-7 md:w-9 sm:h-7 md:h-9 bg-gradient-to-br from-gray-900 to-black dark:from-gray-100 dark:to-gray-300 rounded-md sm:rounded-lg md:rounded-xl flex items-center justify-center shadow-md border border-white/20 dark:border-gray-700/30 group-hover:shadow-lg transition-all duration-300 flex-shrink-0",children:t.jsx("span",{className:"text-white dark:text-gray-900 font-bold text-[9px] sm:text-[10px] md:text-sm tracking-wider",children:"AIM"})}),(0,t.jsxs)("div",{className:"flex flex-col min-w-0 hidden sm:flex",children:[t.jsx("span",{className:"text-xs sm:text-sm md:text-lg font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent truncate leading-tight",children:"Sistema de Gesti\xf3n"}),t.jsx("span",{className:"hidden md:block text-xs text-gray-600 dark:text-gray-300 font-medium tracking-wide",children:"Agencia Innova"})]})]})}),t.jsx("nav",{className:"hidden md:flex items-center space-x-6",children:O.map(e=>(0,t.jsxs)("div",{className:"relative",onMouseEnter:()=>M(e.id),onMouseLeave:E,children:["#"===e.href?t.jsx("span",{className:`px-4 py-2 text-sm font-medium transition-all duration-300 cursor-default whitespace-nowrap rounded-lg hover:bg-white/60 dark:hover:bg-gray-800/60 hover:backdrop-blur-sm hover:shadow-sm ${P(e)?"text-gray-900 dark:text-white bg-white/50 dark:bg-gray-800/50 shadow-sm":"text-gray-600 dark:text-white hover:text-gray-900 dark:hover:text-gray-200"}`,children:e.label}):t.jsx(d(),{href:e.href,className:`px-4 py-2 text-sm font-medium transition-all duration-300 whitespace-nowrap rounded-lg hover:bg-white/60 dark:hover:bg-gray-800/60 hover:backdrop-blur-sm hover:shadow-sm ${U(e.href)||P(e)?"text-gray-900 dark:text-white bg-white/50 dark:bg-gray-800/50 shadow-sm":"text-gray-600 dark:text-white hover:text-gray-900 dark:hover:text-gray-200"}`,children:e.label}),a===e.id&&t.jsx("div",{className:"absolute top-full left-0 mt-2 w-72 sm:w-80 bg-white/95 backdrop-blur-md border border-white/30 rounded-xl shadow-xl z-[9999999] animate-in slide-in-from-top-2 duration-200",onMouseEnter:_,onMouseLeave:A,children:t.jsx("div",{className:"p-2",children:e.subItems.map(e=>t.jsx(d(),{href:e.href,className:`block px-4 py-3 text-sm transition-all duration-200 rounded-lg ${U(e.href)?"bg-blue-50/80 text-blue-900 font-medium shadow-sm border border-blue-200/30":"text-gray-600 hover:bg-white/60 hover:text-gray-900 hover:shadow-sm"}`,children:e.label},e.href))})})]},e.id))}),(0,t.jsxs)("div",{className:`flex items-center space-x-1 sm:space-x-1.5 md:space-x-3 ${N?"hidden":"flex"}`,children:[t.jsx("button",{className:"hidden md:flex p-2 md:p-2.5 text-gray-600 hover:text-gray-900 hover:bg-white/60 rounded-lg transition-all duration-200 hover:shadow-sm",children:t.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("div",{className:"scale-75 sm:scale-90 md:scale-100",children:t.jsx(x.Z,{})}),(0,t.jsxs)("div",{className:"relative",ref:j,children:[(0,t.jsxs)("button",{onClick:()=>{m(e=>!e),b||h||S()},className:"flex items-center justify-center text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 p-1 sm:p-1.5 md:px-3 md:py-2 rounded-lg border border-white/20 dark:border-gray-700/30 hover:bg-white/60 dark:hover:bg-gray-800/60 hover:shadow-sm transition-all duration-200 backdrop-blur-sm",children:[t.jsx("div",{className:"w-5 h-5 sm:w-6 md:w-7 sm:h-6 md:h-7 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 text-white flex items-center justify-center shadow-sm",children:t.jsx("svg",{className:"w-2.5 h-2.5 sm:w-3 md:w-4 sm:h-3 md:h-4",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{d:"M10 10a4 4 0 100-8 4 4 0 000 8zm-7 8a7 7 0 1114 0H3z"})})}),t.jsx("span",{className:"hidden md:block text-sm font-medium ml-2",children:"Cuenta"}),t.jsx("svg",{className:"hidden md:block w-4 h-4 text-gray-400 dark:text-gray-500 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&t.jsx("div",{className:"absolute right-0 mt-3 w-64 sm:w-72 bg-white/95 dark:bg-gray-800/95 backdrop-blur-md border border-white/30 dark:border-gray-700/30 rounded-lg shadow-xl p-3 sm:p-4 z-50 animate-in slide-in-from-top-2 duration-200",children:h?(0,t.jsxs)("div",{className:"text-center py-4",children:[t.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-gray-600 border-t-gray-400 rounded-full mx-auto mb-2"}),t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Cargando…"})]}):b?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-md bg-gray-700 text-white flex items-center justify-center shadow-sm",children:t.jsx("span",{className:"text-sm font-semibold",children:b.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:b.name}),(0,t.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-300 truncate",children:[String(b.role).replace("_"," ").charAt(0).toUpperCase()+String(b.role).replace("_"," ").slice(1)," \xb7 ",b.email]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:["super_admin"!==b.role&&b.groups?.length>0&&(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[t.jsx("span",{className:"text-gray-400 font-medium",children:"modelo"===b.role?"Grupo":"Grupos"}),t.jsx("div",{className:"flex flex-wrap gap-1 justify-end",children:b.groups.map((e,r)=>t.jsx("span",{className:"px-2 py-1 bg-gray-800 text-white rounded-md text-xs font-medium",children:e},r))})]}),t.jsx("div",{className:"space-y-1",children:(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[t.jsx("span",{className:"text-gray-400 font-medium",children:"ID"}),t.jsx("button",{onClick:()=>navigator.clipboard.writeText(b.id),className:"text-gray-200 font-mono text-xs hover:text-gray-400 transition-colors duration-200 cursor-pointer",title:"Hacer clic para copiar",children:b.id})]})})]}),t.jsx("div",{className:"pt-3 border-t border-gray-700",children:(0,t.jsxs)("button",{onClick:async()=>{await (0,n.P1)(),f(null),location.href="/"},className:"w-full px-3 py-2 text-xs rounded-md bg-gray-800 hover:bg-gray-700 border border-gray-600 text-gray-200 hover:text-gray-100 transition-all duration-200 font-medium flex items-center justify-center space-x-1.5",children:[t.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),t.jsx("span",{children:"Cerrar sesi\xf3n"})]})})]}):(0,t.jsxs)("div",{className:"text-center py-4",children:[t.jsx("svg",{className:"w-6 h-6 text-gray-400 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),t.jsx("div",{className:"text-xs text-gray-600",children:"No autenticado"})]})})]})]}),t.jsx("button",{onClick:()=>C(!N),className:"md:hidden text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 p-1.5 rounded-lg hover:bg-white/60 dark:hover:bg-gray-800/60 transition-all duration-200 flex-shrink-0","aria-label":"Toggle mobile menu",children:N?t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})})}),N&&(0,t.jsxs)(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9999998] md:hidden",onClick:()=>C(!1)}),t.jsx("div",{className:"fixed top-14 md:top-16 left-0 right-0 bottom-0 bg-white dark:bg-gray-900 z-[9999999] md:hidden overflow-y-auto animate-in slide-in-from-top-2 duration-300",children:(0,t.jsxs)("div",{className:"p-4 space-y-2",children:[O.length>0?O.map(e=>{let r=D.has(e.id);return t.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mb-2",children:"#"===e.href?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("button",{onClick:()=>{if(e.subItems&&e.subItems.length>0){let r=new Set(D);r.has(e.id)?r.delete(e.id):r.add(e.id),L(r)}},className:`w-full flex items-center justify-between px-4 py-3 text-left rounded-lg transition-all duration-200 ${P(e)?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[t.jsx("span",{className:"font-medium",children:e.label}),e.subItems&&e.subItems.length>0&&t.jsx("svg",{className:`w-5 h-5 transition-transform ${r?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),r&&e.subItems&&e.subItems.length>0&&t.jsx("div",{className:"mt-2 ml-4 space-y-1",children:e.subItems.map(e=>t.jsx(d(),{href:e.href,className:`block px-4 py-2 text-sm rounded-lg transition-all ${U(e.href)?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}`,onClick:()=>C(!1),children:e.label},e.href))})]}):t.jsx(d(),{href:e.href,className:`block px-4 py-3 rounded-lg transition-all duration-200 ${U(e.href)?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800"}`,onClick:()=>C(!1),children:e.label})},e.id)}):t.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm px-4 py-3",children:"Cargando men\xfa..."}),b&&t.jsx("div",{className:"pt-4 mt-4 border-t border-gray-200 dark:border-gray-700",children:(0,t.jsxs)("div",{className:"px-4 py-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-gray-800 to-gray-900 text-white flex items-center justify-center",children:t.jsx("span",{className:"text-sm font-semibold",children:b.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:b.name}),t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:b.email})]})]}),(0,t.jsxs)("button",{onClick:async()=>{await (0,n.P1)(),f(null),C(!1),location.href="/"},className:"w-full px-4 py-2 text-sm rounded-lg bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 hover:bg-red-100 dark:hover:bg-red-900/30 transition-all duration-200 font-medium flex items-center justify-center space-x-2",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),t.jsx("span",{children:"Cerrar sesi\xf3n"})]})]})})]})})]}),t.jsx("main",{className:"min-h-screen",children:t.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 md:py-8",children:e})}),b&&("super_admin"===b.role||"admin"===b.role||"modelo"===b.role)&&t.jsx(u.Z,{children:t.jsx(g,{userId:b.id,userRole:b.role})})]})}},6158:(e,r,a)=>{"use strict";a.d(r,{Z:()=>l});var t=a(95344),s=a(3729);function l({children:e}){let[r,a]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{a(!0)},[]),r)?t.jsx(t.Fragment,{children:e}):null}},13047:(e,r,a)=>{"use strict";a.d(r,{Z:()=>l});var t=a(95344),s=a(3729);let l=()=>{let[e,r]=(0,s.useState)("light"),[a,l]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{l(!0);let e=localStorage.getItem("theme");if(e)r(e),document.documentElement.classList.toggle("dark","dark"===e);else{let e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";r(e),document.documentElement.classList.toggle("dark","dark"===e)}},[]),a)?t.jsx("button",{"data-theme-toggle":!0,onClick:()=>{let a="light"===e?"dark":"light";document.documentElement.style.transition="all 0.6s cubic-bezier(0.4, 0, 0.2, 1)",document.body.style.transition="all 0.6s cubic-bezier(0.4, 0, 0.2, 1)",r(a),localStorage.setItem("theme",a),document.documentElement.classList.toggle("dark","dark"===a);let t=document.querySelector("[data-theme-toggle]");t&&(t.style.transform="scale(0.95)",setTimeout(()=>{t.style.transform="scale(1)"},150)),setTimeout(()=>{document.documentElement.style.transition="",document.body.style.transition=""},600)},className:"p-2.5 text-gray-600 hover:text-gray-900 hover:bg-white/60 rounded-lg transition-all duration-200 hover:shadow-sm   dark:text-gray-300 dark:hover:text-white dark:hover:bg-gray-700",title:"light"===e?"Cambiar a modo oscuro":"Cambiar a modo claro",children:"light"===e?t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9 9 0 008.354-5.646z"})}):t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h1M3 12H2m15.325 6.675l-.707.707M6.707 6.707l-.707-.707m10.626 0l.707-.707M6.707 17.293l-.707.707M12 18a6 6 0 100-12 6 6 0 000 12z"})})}):t.jsx("div",{className:"p-2.5 text-gray-600 rounded-lg",children:t.jsx("div",{className:"w-5 h-5"})})}},93612:(e,r,a)=>{"use strict";a.r(r),a.d(r,{$$typeof:()=>l,__esModule:()=>s,default:()=>d});let t=(0,a(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\app\superadmin\dashboard\page.tsx`),{__esModule:s,$$typeof:l}=t,d=t.default},46826:(e,r,a)=>{"use strict";a.r(r),a.d(r,{$$typeof:()=>l,__esModule:()=>s,default:()=>d});let t=(0,a(86843).createProxy)(String.raw`C:\Users\camca\OneDrive\Documentos\GitHub\iam-sistema-de-gestion\app\superadmin\layout.tsx`),{__esModule:s,$$typeof:l}=t,d=t.default}};var r=require("../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[1638,6611,6654,1586,478,1582,9237,5169],()=>a(66403));module.exports=t})();