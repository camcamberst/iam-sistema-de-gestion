(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4665],{2601:function(e,r,t){"use strict";var n,o;e.exports=(null==(n=t.g.process)?void 0:n.env)&&"object"==typeof(null==(o=t.g.process)?void 0:o.env)?t.g.process:t(8960)},3864:function(e,r,t){Promise.resolve().then(t.bind(t,5382))},5382:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return s}});var n=t(7437),o=t(2265),a=t(4033),i=t(9853);function s(){let[e,r]=(0,o.useState)(""),[t,s]=(0,o.useState)(""),[c,u]=(0,o.useState)(!1),[l,d]=(0,o.useState)(!1),[g,f]=(0,o.useState)(""),m=(0,a.useRouter)(),p=async r=>{r.preventDefault(),d(!0),f("");try{console.log("\uD83D\uDD10 [LOGIN] Iniciando autenticaci\xf3n moderna:",{email:e,password:"***"});let r=await (0,i.E4)({email:e,password:t});if(!r.success){f(r.error||"Error al iniciar sesi\xf3n");return}if(!r.user){f("Usuario no encontrado");return}let n=r.user;switch(console.log("✅ [LOGIN] Usuario autenticado exitosamente:",{id:n.id,email:n.email,name:n.name,role:n.role,groups:n.groups.length}),localStorage.setItem("user",JSON.stringify({id:n.id,email:n.email,name:n.name,role:n.role,organization_id:n.organization_id,groups:n.groups,is_active:n.is_active,last_login:n.last_login})),console.log("\uD83D\uDE80 [LOGIN] Redirigiendo seg\xfan rol:",n.role),n.role){case"super_admin":m.push("/superadmin/dashboard");break;case"admin":default:m.push("/admin/dashboard");break;case"modelo":m.push("/admin/model/dashboard")}}catch(e){console.error("❌ [LOGIN] Error general:",e),f("Error interno del servidor")}finally{d(!1)}};return(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"radial-gradient(1200px 800px at 10% -10%, rgba(255,255,255,0.08), transparent), linear-gradient(180deg, rgb(16 18 27), rgb(16 18 27))"},children:(0,n.jsxs)("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-xl p-8 w-full max-w-md",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center mb-6 space-x-3",children:[(0,n.jsx)("div",{className:"w-10 h-10 bg-black rounded-lg flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-white font-bold text-sm",children:"AIM"})}),(0,n.jsx)("span",{className:"text-xl font-semibold text-gray-900",children:"Sistema de Gesti\xf3n"})]}),(0,n.jsxs)("form",{onSubmit:p,className:"space-y-4",children:[(0,n.jsx)("div",{children:(0,n.jsx)("input",{type:"email",placeholder:"Correo electr\xf3nico",value:e,onChange:e=>r(e.target.value),required:!0,className:"w-full p-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:c?"text":"password",placeholder:"Contrase\xf1a",value:t,onChange:e=>s(e.target.value),required:!0,className:"w-full p-3 pr-12 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,n.jsx)("button",{type:"button",onClick:()=>u(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors",children:c?(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):(0,n.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),g&&(0,n.jsx)("p",{className:"text-red-600 text-center text-sm bg-red-50 border border-red-200 rounded-lg py-2",children:g}),(0,n.jsx)("button",{type:"submit",disabled:l,className:"w-full bg-gray-900 hover:bg-black text-white font-medium py-3 px-4 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Iniciando sesi\xf3n...":"Entrar"}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2",children:[(0,n.jsx)("button",{type:"button",onClick:()=>alert("Recuperaci\xf3n de contrase\xf1a pr\xf3ximamente"),className:"hover:underline",children:"\xbfOlvidaste tu contrase\xf1a?"}),(0,n.jsx)("span",{children:"Soporte: soporte@aim.com"})]}),(0,n.jsx)("div",{className:"text-center text-[11px] text-gray-400 mt-4",children:"Al continuar aceptas nuestras pol\xedticas de privacidad y seguridad de datos."})]})]})})}},9853:function(e,r,t){"use strict";t.d(r,{E4:function(){return a},P1:function(){return i}});var n=t(5922),o=t(8115);async function a(e){try{console.log("\uD83D\uDD10 [AUTH] Iniciando login moderno:",{email:e.email});let{data:r,error:t}=await n.O.auth.signInWithPassword({email:e.email,password:e.password});if(t)return console.error("❌ [AUTH] Error de autenticaci\xf3n:",t.message),{success:!1,error:"Credenciales inv\xe1lidas"};if(!r.user)return{success:!1,error:"Usuario no encontrado"};console.log("✅ [AUTH] Usuario autenticado en Supabase:",r.user.id);let{data:a,error:i}=await n.O.from("users").select("\n        id,\n        name,\n        email,\n        role,\n        is_active,\n        last_login,\n        organization_id,\n        user_groups!inner(\n          group_id,\n          is_manager,\n          groups!inner(\n            id,\n            name\n          )\n        )\n      ").eq("id",r.user.id).single();if(i)return console.error("❌ [AUTH] Error obteniendo perfil:",i.message),{success:!1,error:"Error obteniendo perfil de usuario"};if(!a)return{success:!1,error:"Perfil de usuario no encontrado"};if(!a.is_active)return{success:!1,error:"Usuario inactivo"};await n.O.from("users").update({last_login:new Date().toISOString()}).eq("id",r.user.id);let s={id:a.id,email:r.user.email,name:a.name,role:a.role,organization_id:a.organization_id,groups:a.user_groups.map(e=>({id:e.groups.id,name:e.groups.name,is_manager:e.is_manager})),is_active:a.is_active,last_login:a.last_login};console.log("✅ [AUTH] Login exitoso:",{id:s.id,email:s.email,role:s.role,groups:s.groups.length});try{await (0,o.MY)(s.id),console.log("\uD83D\uDCCA [AUTH] Usuario marcado como en l\xednea en el chat")}catch(e){console.error("❌ [AUTH] Error marcando usuario como en l\xednea:",e)}return{success:!0,user:s}}catch(e){return console.error("❌ [AUTH] Error general:",e),{success:!1,error:"Error interno del servidor"}}}async function i(){try{let{data:{user:e}}=await n.O.auth.getUser(),{error:r}=await n.O.auth.signOut();if(r&&console.error("❌ [AUTH] Error en logout:",r.message),e)try{await (0,o.lH)(e.id),console.log("\uD83D\uDCCA [AUTH] Usuario marcado como offline en el chat")}catch(e){console.error("❌ [AUTH] Error marcando usuario como offline:",e)}}catch(e){console.error("❌ [AUTH] Error general en logout:",e)}}},8115:function(e,r,t){"use strict";t.d(r,{MY:function(){return a},do:function(){return s},lH:function(){return i}});var n=t(5922);async function o(e,r){try{console.log("\uD83D\uDCCA [CHAT-STATUS] Actualizando estado de usuario ".concat(e,": ").concat(r?"EN L\xcdNEA":"OFFLINE"));let{error:t}=await n.O.from("chat_user_status").upsert({user_id:e,is_online:r,last_seen:new Date().toISOString(),updated_at:new Date().toISOString()});t?console.error("❌ [CHAT-STATUS] Error actualizando estado:",t):console.log("✅ [CHAT-STATUS] Estado actualizado exitosamente: ".concat(r?"EN L\xcdNEA":"OFFLINE"))}catch(e){console.error("❌ [CHAT-STATUS] Error general:",e)}}async function a(e){await o(e,!0)}async function i(e){await o(e,!1)}async function s(e){try{let{error:r}=await n.O.from("chat_user_status").upsert({user_id:e,is_online:!0,last_seen:new Date().toISOString(),updated_at:new Date().toISOString()});r&&console.error("❌ [CHAT-STATUS] Error actualizando heartbeat:",r)}catch(e){console.error("❌ [CHAT-STATUS] Error en heartbeat:",e)}}},5922:function(e,r,t){"use strict";t.d(r,{O:function(){return n}});let n=(0,t(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")},8960:function(e){!function(){var r={229:function(e){var r,t,n,o=e.exports={};function a(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{t="function"==typeof clearTimeout?clearTimeout:i}catch(e){t=i}}();var c=[],u=!1,l=-1;function d(){u&&n&&(u=!1,n.length?c=n.concat(c):l=-1,c.length&&g())}function g(){if(!u){var e=s(d);u=!0;for(var r=c.length;r;){for(n=c,c=[];++l<r;)n&&n[l].run();l=-1,r=c.length}n=null,u=!1,function(e){if(t===clearTimeout)return clearTimeout(e);if((t===i||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(e);try{t(e)}catch(r){try{return t.call(null,e)}catch(r){return t.call(this,e)}}}(e)}}function f(e,r){this.fun=e,this.array=r}function m(){}o.nextTick=function(e){var r=Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];c.push(new f(e,r)),1!==c.length||u||s(g)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},t={};function n(e){var o=t[e];if(void 0!==o)return o.exports;var a=t[e]={exports:{}},i=!0;try{r[e](a,a.exports,n),i=!1}finally{i&&delete t[e]}return a.exports}n.ab="//";var o=n(229);e.exports=o}()},622:function(e,r,t){"use strict";var n=t(2265),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,r,t){var n,a={},u=null,l=null;for(n in void 0!==t&&(u=""+t),void 0!==r.key&&(u=""+r.key),void 0!==r.ref&&(l=r.ref),r)i.call(r,n)&&!c.hasOwnProperty(n)&&(a[n]=r[n]);if(e&&e.defaultProps)for(n in r=e.defaultProps)void 0===a[n]&&(a[n]=r[n]);return{$$typeof:o,type:e,key:u,ref:l,props:a,_owner:s.current}}r.Fragment=a,r.jsx=u,r.jsxs=u},7437:function(e,r,t){"use strict";e.exports=t(622)},4033:function(e,r,t){e.exports=t(5313)}},function(e){e.O(0,[5257,2971,4938,1744],function(){return e(e.s=3864)}),_N_E=e.O()}]);