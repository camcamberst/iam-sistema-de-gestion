(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4665,5922],{3864:function(e,r,a){Promise.resolve().then(a.bind(a,5382))},5382:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return i}});var o=a(7437),t=a(2265),s=a(4033),n=a(9853);function i(){let[e,r]=(0,t.useState)(""),[a,i]=(0,t.useState)(""),[c,l]=(0,t.useState)(!1),[u,d]=(0,t.useState)(!1),[g,m]=(0,t.useState)(""),p=(0,s.useRouter)(),f=async r=>{r.preventDefault(),d(!0),m("");try{console.log("\uD83D\uDD10 [LOGIN] Iniciando autenticaci\xf3n moderna:",{email:e,password:"***"});let r=await (0,n.E4)({email:e,password:a});if(!r.success){m(r.error||"Error al iniciar sesi\xf3n");return}if(!r.user){m("Usuario no encontrado");return}let o=r.user;switch(console.log("✅ [LOGIN] Usuario autenticado exitosamente:",{id:o.id,email:o.email,name:o.name,role:o.role,groups:o.groups.length}),localStorage.setItem("user",JSON.stringify({id:o.id,email:o.email,name:o.name,role:o.role,organization_id:o.organization_id,groups:o.groups,is_active:o.is_active,last_login:o.last_login})),console.log("\uD83D\uDE80 [LOGIN] Redirigiendo seg\xfan rol:",o.role),o.role){case"super_admin":p.push("/superadmin/dashboard");break;case"admin":case"superadmin_aff":default:p.push("/admin/dashboard");break;case"gestor":p.push("/gestor/dashboard");break;case"fotografia":p.push("/fotografia/dashboard");break;case"modelo":p.push("/admin/model/dashboard")}}catch(e){console.error("❌ [LOGIN] Error general:",e),m("Error interno del servidor")}finally{d(!1)}};return(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",style:{background:"radial-gradient(1200px 800px at 10% -10%, rgba(255,255,255,0.08), transparent), linear-gradient(180deg, rgb(16 18 27), rgb(16 18 27))"},children:(0,o.jsxs)("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-xl p-8 w-full max-w-md",children:[(0,o.jsxs)("div",{className:"flex items-center justify-center mb-6 space-x-3",children:[(0,o.jsx)("div",{className:"w-10 h-10 bg-black rounded-lg flex items-center justify-center",children:(0,o.jsx)("span",{className:"text-white font-bold text-sm",children:"AIM"})}),(0,o.jsx)("span",{className:"text-xl font-semibold text-gray-900",children:"Sistema de Gesti\xf3n"})]}),(0,o.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,o.jsx)("div",{children:(0,o.jsx)("input",{type:"email",placeholder:"Correo electr\xf3nico",value:e,onChange:e=>r(e.target.value),required:!0,className:"w-full p-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{type:c?"text":"password",placeholder:"Contrase\xf1a",value:a,onChange:e=>i(e.target.value),required:!0,className:"w-full p-3 pr-12 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,o.jsx)("button",{type:"button",onClick:()=>l(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors",children:c?(0,o.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):(0,o.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),g&&(0,o.jsx)("p",{className:"text-red-600 text-center text-sm bg-red-50 border border-red-200 rounded-lg py-2",children:g}),(0,o.jsx)("button",{type:"submit",disabled:u,className:"w-full bg-gray-900 hover:bg-black text-white font-medium py-3 px-4 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Iniciando sesi\xf3n...":"Entrar"}),(0,o.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2",children:[(0,o.jsx)("button",{type:"button",onClick:()=>alert("Recuperaci\xf3n de contrase\xf1a pr\xf3ximamente"),className:"hover:underline",children:"\xbfOlvidaste tu contrase\xf1a?"}),(0,o.jsx)("span",{children:"Soporte: soporte@aim.com"})]}),(0,o.jsx)("div",{className:"text-center text-[11px] text-gray-400 mt-4",children:"Al continuar aceptas nuestras pol\xedticas de privacidad y seguridad de datos."})]})]})})}},9853:function(e,r,a){"use strict";a.d(r,{E4:function(){return s},P1:function(){return n}});var o=a(5922),t=a(8115);async function s(e){try{console.log("\uD83D\uDD10 [AUTH] Iniciando login moderno:",{email:e.email});let{data:r,error:a}=await o.supabase.auth.signInWithPassword({email:e.email,password:e.password});if(a)return console.error("❌ [AUTH] Error de autenticaci\xf3n:",a.message),{success:!1,error:"Credenciales inv\xe1lidas"};if(!r.user)return{success:!1,error:"Usuario no encontrado"};console.log("✅ [AUTH] Usuario autenticado en Supabase:",r.user.id);let{data:s,error:n}=await o.supabase.from("users").select("id, name, email, role, is_active, last_login, organization_id").eq("id",r.user.id).single();if(n)return console.error("❌ [AUTH] Error obteniendo perfil base:",n.message),{success:!1,error:"Error obteniendo perfil de usuario"};let{data:i,error:c}=await o.supabase.from("user_groups").select("is_manager, groups(id, name)").eq("user_id",r.user.id);if(!s)return{success:!1,error:"Perfil de usuario no encontrado"};if(!s.is_active)return{success:!1,error:"Usuario inactivo"};await o.supabase.from("users").update({last_login:new Date().toISOString()}).eq("id",r.user.id);let l={id:s.id,email:r.user.email,name:s.name,role:s.role,organization_id:s.organization_id,groups:(i||[]).map(e=>{var r,a;return{id:null===(r=e.groups)||void 0===r?void 0:r.id,name:null===(a=e.groups)||void 0===a?void 0:a.name,is_manager:e.is_manager}}),is_active:s.is_active,last_login:s.last_login};console.log("✅ [AUTH] Login exitoso:",{id:l.id,email:l.email,role:l.role,groups:l.groups.length});try{await (0,t.MY)(l.id),console.log("\uD83D\uDCCA [AUTH] Usuario marcado como en l\xednea en el chat")}catch(e){console.error("❌ [AUTH] Error marcando usuario como en l\xednea:",e)}return{success:!0,user:l}}catch(e){return console.error("❌ [AUTH] Error general:",e),{success:!1,error:"Error interno del servidor"}}}async function n(){try{let{data:{user:e}}=await o.supabase.auth.getUser(),{error:r}=await o.supabase.auth.signOut();if(r&&console.error("❌ [AUTH] Error en logout:",r.message),e)try{await (0,t.lH)(e.id),console.log("\uD83D\uDCCA [AUTH] Usuario marcado como offline en el chat")}catch(e){console.error("❌ [AUTH] Error marcando usuario como offline:",e)}}catch(e){console.error("❌ [AUTH] Error general en logout:",e)}}},8115:function(e,r,a){"use strict";a.d(r,{MY:function(){return n},do:function(){return c},lH:function(){return i}});var o=a(5257);function t(){return(0,o.createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")}async function s(e,r){try{console.log("\uD83D\uDCCA [CHAT-STATUS] Actualizando estado de usuario ".concat(e,": ").concat(r?"EN L\xcdNEA":"OFFLINE"));let a=t(),{error:o}=await a.from("chat_user_status").upsert({user_id:e,is_online:r,last_seen:new Date().toISOString(),updated_at:new Date().toISOString()});o?console.error("❌ [CHAT-STATUS] Error actualizando estado:",o):console.log("✅ [CHAT-STATUS] Estado actualizado exitosamente: ".concat(r?"EN L\xcdNEA":"OFFLINE"))}catch(e){console.error("❌ [CHAT-STATUS] Error general:",e)}}async function n(e){await s(e,!0)}async function i(e){await s(e,!1)}async function c(e){try{let r=t(),{error:a}=await r.from("chat_user_status").upsert({user_id:e,is_online:!0,last_seen:new Date().toISOString(),updated_at:new Date().toISOString()});a&&console.error("❌ [CHAT-STATUS] Error actualizando heartbeat:",a)}catch(e){console.error("❌ [CHAT-STATUS] Error en heartbeat:",e)}}},5922:function(e,r,a){"use strict";a.r(r),a.d(r,{supabase:function(){return o}});let o=(0,a(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")},622:function(e,r,a){"use strict";var o=a(2265),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,i=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,r,a){var o,s={},l=null,u=null;for(o in void 0!==a&&(l=""+a),void 0!==r.key&&(l=""+r.key),void 0!==r.ref&&(u=r.ref),r)n.call(r,o)&&!c.hasOwnProperty(o)&&(s[o]=r[o]);if(e&&e.defaultProps)for(o in r=e.defaultProps)void 0===s[o]&&(s[o]=r[o]);return{$$typeof:t,type:e,key:l,ref:u,props:s,_owner:i.current}}r.Fragment=s,r.jsx=l,r.jsxs=l},7437:function(e,r,a){"use strict";e.exports=a(622)},4033:function(e,r,a){e.exports=a(5313)}},function(e){e.O(0,[5257,2971,4938,1744],function(){return e(e.s=3864)}),_N_E=e.O()}]);