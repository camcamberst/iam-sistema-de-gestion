(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3487],{8254:function(e,a,r){Promise.resolve().then(r.bind(r,3979))},3979:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return i}});var t=r(7437),s=r(2265),n=r(4033);let l=(0,r(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c");function i(){let e=(0,n.useRouter)(),a=(0,n.useParams)(),r=null==a?void 0:a.id,[i,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!0),[u,m]=(0,s.useState)(null),[x,p]=(0,s.useState)(!1),[g,h]=(0,s.useState)(null),[y,f]=(0,s.useState)(!0),[b,v]=(0,s.useState)({name:"",description:"",type:"tokens",currency:"USD",token_rate:"",discount_factor:"",tax_rate:"",direct_payout:!1,payment_frequency:"quincenal",login_url:""});(0,s.useEffect)(()=>{(async function(){try{let{data:{user:a}}=await l.auth.getUser();if(!a){e.push("/");return}let{data:r,error:t}=await l.from("users").select("id, role").eq("id",a.id).single();if(t||!r||"super_admin"!==r.role){e.push("/admin/dashboard");return}h(r),f(!1)}catch(a){console.error("Error checking auth:",a),e.push("/admin/dashboard")}})()},[e]),(0,s.useEffect)(()=>{async function e(){if(r&&g)try{var e,a,t;c(!0);let s=await fetch("/api/calculator/platforms"),n=await s.json();if(!n.success)throw Error(n.error);let l=n.config.platforms.find(e=>e.id===r);if(!l)throw Error("Plataforma no encontrada");let i="tokens";l.token_rate?i="tokens":l.direct_payout?i="direct":"USD"===l.currency&&l.discount_factor?i="credits":["EUR","GBP"].includes(l.currency)&&(i="currency"),v({name:l.name,description:l.description||"",type:i,currency:l.currency,token_rate:(null===(e=l.token_rate)||void 0===e?void 0:e.toString())||"",discount_factor:(null===(a=l.discount_factor)||void 0===a?void 0:a.toString())||"",tax_rate:(null===(t=l.tax_rate)||void 0===t?void 0:t.toString())||"",direct_payout:l.direct_payout,payment_frequency:l.payment_frequency||"quincenal",login_url:l.login_url||""})}catch(e){m(e.message)}finally{c(!1)}}y||e()},[r,y,g]);let j=async a=>{a.preventDefault(),o(!0),m(null),p(!1);try{if(!g)throw Error("Usuario no autenticado");let a={id:r,name:b.name.trim(),description:b.description.trim()||null,currency:b.currency,payment_frequency:b.payment_frequency,direct_payout:b.direct_payout,login_url:b.login_url.trim()||null,updated_by:g.id};if("tokens"===b.type){if(!b.token_rate)throw Error("Tasa de conversi\xf3n de tokens es requerida");a.token_rate=parseFloat(b.token_rate),a.discount_factor=null,a.tax_rate=null,a.direct_payout=!1}else if("credits"===b.type){if(!b.discount_factor)throw Error("Factor de descuento es requerido");a.discount_factor=parseFloat(b.discount_factor),a.token_rate=null,a.tax_rate=null,a.direct_payout=!1}else"currency"===b.type?(b.discount_factor?a.discount_factor=parseFloat(b.discount_factor):a.discount_factor=null,b.tax_rate?a.tax_rate=parseFloat(b.tax_rate):a.tax_rate=null,a.token_rate=null,a.direct_payout=!1):"direct"===b.type&&(a.direct_payout=!0,a.token_rate=null,a.discount_factor=null,a.tax_rate=null);let t=await fetch("/api/calculator/platforms",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),s=await t.json();if(!s.success)throw Error(s.error||"Error al actualizar plataforma");p(!0),sessionStorage.setItem("platforms_updated",Date.now().toString()),setTimeout(()=>{e.push("/admin/calculator/platforms")},1500)}catch(e){m(e.message||"Error al actualizar plataforma")}finally{o(!1)}};return y||d?(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Cargando..."})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,t.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:[(0,t.jsx)("div",{className:"mb-8 sm:mb-12",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 to-indigo-600/10 rounded-xl blur-xl"}),(0,t.jsx)("div",{className:"relative bg-white/80 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:(0,t.jsx)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 md:gap-3",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:(0,t.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("h1",{className:"text-base sm:text-lg md:text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:["Editar Plataforma: ",b.name||"..."]}),(0,t.jsxs)("p",{className:"mt-1 text-xs sm:text-sm text-gray-600 dark:text-gray-300 hidden sm:block",children:["ID: ",(0,t.jsx)("span",{className:"font-mono",children:r})]})]})]})})})]})}),(0,t.jsx)("form",{onSubmit:j,className:"space-y-4",children:(0,t.jsxs)("div",{className:"bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Nombre de la Plataforma *"}),(0,t.jsx)("input",{type:"text",value:b.name,onChange:e=>v({...b,name:e.target.value}),placeholder:"ej: Nueva Plataforma",className:"apple-input",required:!0})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Descripci\xf3n"}),(0,t.jsx)("input",{type:"text",value:b.description,onChange:e=>v({...b,description:e.target.value}),placeholder:"Descripci\xf3n opcional",className:"apple-input"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Tipo de Plataforma *"}),(0,t.jsxs)("select",{value:b.type,onChange:e=>v({...b,type:e.target.value}),className:"apple-input",required:!0,children:[(0,t.jsx)("option",{value:"tokens",children:"Tokens (ej: Chaturbate)"}),(0,t.jsx)("option",{value:"credits",children:"Cr\xe9ditos con Descuento (ej: CMD)"}),(0,t.jsx)("option",{value:"currency",children:"Divisa (EUR/GBP)"}),(0,t.jsx)("option",{value:"direct",children:"Pago Directo 100%"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Moneda Base *"}),(0,t.jsxs)("select",{value:b.currency,onChange:e=>v({...b,currency:e.target.value}),className:"apple-input",required:!0,children:[(0,t.jsx)("option",{value:"USD",children:"USD (D\xf3lar)"}),(0,t.jsx)("option",{value:"EUR",children:"EUR (Euro)"}),(0,t.jsx)("option",{value:"GBP",children:"GBP (Libra Esterlina)"})]})]})]}),"tokens"===b.type&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Tasa de Conversi\xf3n de Tokens *"}),(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("input",{type:"number",step:"0.0001",min:"0",max:"1",value:b.token_rate,onChange:e=>v({...b,token_rate:e.target.value}),placeholder:"ej: 0.05",className:"apple-input",required:!0})}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"USD por 1 token (0.05 = 100 tokens = 5 USD)"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Frecuencia de Pago"}),(0,t.jsxs)("select",{value:b.payment_frequency,onChange:e=>v({...b,payment_frequency:e.target.value}),className:"apple-input",children:[(0,t.jsx)("option",{value:"quincenal",children:"Quincenal"}),(0,t.jsx)("option",{value:"mensual",children:"Mensual"})]})]})]}),"credits"===b.type&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Factor de Descuento *"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",max:"1",value:b.discount_factor,onChange:e=>v({...b,discount_factor:e.target.value}),placeholder:"ej: 0.75",className:"apple-input",required:!0}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"0.75 = 75% del valor (25% descuento)"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Frecuencia de Pago"}),(0,t.jsxs)("select",{value:b.payment_frequency,onChange:e=>v({...b,payment_frequency:e.target.value}),className:"apple-input",children:[(0,t.jsx)("option",{value:"quincenal",children:"Quincenal"}),(0,t.jsx)("option",{value:"mensual",children:"Mensual"})]})]})]}),"currency"===b.type&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Factor de Descuento (Opcional)"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",max:"1",value:b.discount_factor,onChange:e=>v({...b,discount_factor:e.target.value}),placeholder:"ej: 0.78",className:"apple-input"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Tasa de Impuesto (Opcional)"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",max:"1",value:b.tax_rate,onChange:e=>v({...b,tax_rate:e.target.value}),placeholder:"ej: 0.16",className:"apple-input"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"0.16 = 16% impuesto"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Frecuencia de Pago"}),(0,t.jsxs)("select",{value:b.payment_frequency,onChange:e=>v({...b,payment_frequency:e.target.value}),className:"apple-input",children:[(0,t.jsx)("option",{value:"quincenal",children:"Quincenal"}),(0,t.jsx)("option",{value:"mensual",children:"Mensual"})]})]})]}),"direct"===b.type&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"Frecuencia de Pago"}),(0,t.jsxs)("select",{value:b.payment_frequency,onChange:e=>v({...b,payment_frequency:e.target.value}),className:"apple-input",children:[(0,t.jsx)("option",{value:"quincenal",children:"Quincenal"}),(0,t.jsx)("option",{value:"mensual",children:"Mensual"})]})]}),(0,t.jsx)("div",{className:"flex items-end mb-1.5",children:(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"Pago directo 100% para la modelo (sin conversiones)"})})]}),(0,t.jsx)("div",{className:"mb-6 pt-6 border-t border-gray-200 dark:border-gray-600",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"URL de Login de la Plataforma"}),(0,t.jsx)("input",{type:"url",value:b.login_url,onChange:e=>v({...b,login_url:e.target.value}),placeholder:"https://ejemplo.com/login",className:"apple-input"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Este URL ser\xe1 usado por todas las modelos de esta plataforma"})]})}),(u||x)&&(0,t.jsxs)("div",{className:"rounded-lg p-4 mb-6 flex items-center gap-3 ".concat(u?"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800":"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800"),children:[u?(0,t.jsx)("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}):(0,t.jsx)("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,t.jsx)("p",{className:"text-sm font-medium ".concat(u?"text-red-800 dark:text-red-200":"text-green-800 dark:text-green-200"),children:u||"âœ… Plataforma actualizada exitosamente. Redirigiendo..."})]}),(0,t.jsxs)("div",{className:"flex gap-4 justify-end pt-4 border-t border-gray-200 dark:border-gray-600",children:[(0,t.jsx)("button",{type:"button",onClick:()=>e.back(),className:"px-4 py-2 text-sm font-medium bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-200",children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",disabled:i,className:"px-6 py-2 text-sm font-medium bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500/20",children:i?(0,t.jsxs)("span",{className:"flex items-center",children:[(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Guardando..."]}):"Guardar Cambios"})]})]})})]})})}},622:function(e,a,r){"use strict";var t=r(2265),s=Symbol.for("react.element"),n=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function d(e,a,r){var t,n={},d=null,c=null;for(t in void 0!==r&&(d=""+r),void 0!==a.key&&(d=""+a.key),void 0!==a.ref&&(c=a.ref),a)l.call(a,t)&&!o.hasOwnProperty(t)&&(n[t]=a[t]);if(e&&e.defaultProps)for(t in a=e.defaultProps)void 0===n[t]&&(n[t]=a[t]);return{$$typeof:s,type:e,key:d,ref:c,props:n,_owner:i.current}}a.Fragment=n,a.jsx=d,a.jsxs=d},7437:function(e,a,r){"use strict";e.exports=r(622)},4033:function(e,a,r){e.exports=r(5313)}},function(e){e.O(0,[5257,2971,4938,1744],function(){return e(e.s=8254)}),_N_E=e.O()}]);