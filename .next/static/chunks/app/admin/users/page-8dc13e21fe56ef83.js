(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9674,5922],{5262:function(e,r,a){Promise.resolve().then(a.bind(a,9998))},9998:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return f}});var t=a(7437),s=a(2265),o=a(4033),l=a(5922);async function i(){try{let{data:{session:e}}=await l.supabase.auth.getSession();return(null==e?void 0:e.access_token)||null}catch(e){return console.error("❌ [API CLIENT] Error obteniendo token:",e),null}}async function n(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=await i();if(!a)throw Error("No hay sesi\xf3n activa");let t={"Content-Type":"application/json",Authorization:"Bearer ".concat(a),...r.headers};return fetch(e,{...r,headers:t})}async function d(){return(await n("/api/users")).json()}async function c(){return(await n("/api/groups")).json()}function u(e,r){if("super_admin"===e.role)return!0;if("superadmin_aff"===e.role){if("super_admin"===r.role||"superadmin_aff"===r.role)return console.log("\uD83D\uDD0D [JERARQU\xcdA] Superadmin_aff no puede editar super_admin o superadmin_aff"),!1;let a=e.affiliate_studio_id,t=r.affiliate_studio_id;if(console.log("\uD83D\uDD0D [JERARQU\xcdA] Verificando permisos de edici\xf3n para superadmin_aff:",{currentUserRole:e.role,currentUserAffiliateId:a,targetUserRole:r.role,targetUserAffiliateId:t,canEdit:a&&a===t}),a){let e=a===t;return console.log("\uD83D\uDD0D [JERARQU\xcdA] Resultado de comparaci\xf3n:",e),e}return console.log("⚠️ [JERARQU\xcdA] Superadmin_aff sin affiliate_studio_id"),!1}if("admin"===e.role){let a=e.groups.map(e=>e.id),t=(r.groups||[]).map(e=>"string"==typeof e?e:e.id);return console.log("\uD83D\uDD0D [JERARQU\xcdA] Verificando permisos de edici\xf3n:",{currentUserRole:e.role,currentUserGroups:a,targetUserRole:r.role,targetUserGroups:t,targetUserIsActive:r.is_active,canEdit:"modelo"===r.role&&(0===t.length||t.some(e=>a.includes(e)))}),"modelo"===r.role&&(0===t.length||t.some(e=>a.includes(e)))}return("gestor"===e.role||"fotografia"===e.role)&&("admin"===r.role||"super_admin"===r.role)}function m(e,r){if("super_admin"===e.role)return!0;if("superadmin_aff"===e.role){if("super_admin"===r.role||"superadmin_aff"===r.role)return console.log("\uD83D\uDD0D [JERARQU\xcdA] Superadmin_aff no puede eliminar super_admin o superadmin_aff"),!1;let a=e.affiliate_studio_id,t=r.affiliate_studio_id;if(console.log("\uD83D\uDD0D [JERARQU\xcdA] Verificando permisos de eliminaci\xf3n para superadmin_aff:",{currentUserRole:e.role,currentUserAffiliateId:a,targetUserRole:r.role,targetUserAffiliateId:t,canDelete:a&&a===t}),a){let e=a===t;return console.log("\uD83D\uDD0D [JERARQU\xcdA] Resultado de comparaci\xf3n:",e),e}return console.log("⚠️ [JERARQU\xcdA] Superadmin_aff sin affiliate_studio_id"),!1}if("admin"===e.role){let a=e.groups.map(e=>e.id),t=(r.groups||[]).map(e=>"string"==typeof e?e:e.id);return console.log("\uD83D\uDD0D [JERARQU\xcdA] Verificando permisos de eliminaci\xf3n:",{currentUserRole:e.role,currentUserGroups:a,targetUserRole:r.role,targetUserGroups:t,targetUserIsActive:r.is_active,canDelete:"modelo"===r.role&&(0===t.length||t.some(e=>a.includes(e)))}),"modelo"===r.role&&(0===t.length||t.some(e=>a.includes(e)))}return("gestor"===e.role||"fotografia"===e.role)&&("admin"===r.role||"super_admin"===r.role)}var x=a(4848);function g(e){let{onSearch:r,placeholder:a="Buscar...",filters:o=[],className:l="",onDropdownStateChange:i,showResultsInfo:n=!1,totalUsers:d=0,filteredUsers:c=0,onClearSearch:u}=e,[m,g]=(0,s.useState)(""),[p,h]=(0,s.useState)({}),[f,b]=(0,s.useState)(!1),[y,v]=(0,s.useState)(null),[w,k]=(0,s.useState)(null),j=(0,s.useRef)(null),N=(0,s.useRef)({}),[D,C]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=()=>{C(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let _=D?w:y,E=D?k:v,L=()=>{r(m,p)};(0,s.useEffect)(()=>{let e=setTimeout(()=>{r(m,p)},250);return()=>clearTimeout(e)},[m,p]),(0,s.useEffect)(()=>{function e(e){"Enter"===e.key&&(e.preventDefault(),L()),"Escape"===e.key&&b(!1)}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[m,p,f]);let A=(e,r)=>{h(a=>({...a,[e]:r})),E(null),v(null),k(null)},S=e=>{D?k(e):v(e)},R=e=>{_===e&&setTimeout(()=>{E(null),v(null),k(null)},200)};(0,s.useEffect)(()=>{function e(e){var r;let a=e.target,t=Object.values(N.current).some(e=>e&&e.contains(a));(null===(r=j.current)||void 0===r?void 0:r.contains(a))||t||(v(null),k(null))}let r=setTimeout(()=>{document.addEventListener("click",e,!0)},100);return()=>{clearTimeout(r),document.removeEventListener("click",e,!0)}},[]),(0,s.useEffect)(()=>{i&&i(f||null!==y||null!==w)},[f,y,w,i]);let U=()=>{h({}),g(""),u?u():r("",{})},z=Object.values(p).some(e=>""!==e);return(0,t.jsxs)("div",{ref:j,className:"relative ".concat(l),children:[(0,t.jsx)("div",{className:"relative bg-white dark:bg-gray-800 backdrop-blur-sm rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm hover:shadow-md transition-all duration-200",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2 p-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,t.jsx)("div",{className:"flex-1 relative",children:(0,t.jsx)("input",{type:"text",value:m,onChange:e=>g(e.target.value),onKeyPress:e=>"Enter"===e.key&&L(),placeholder:a,className:"w-full bg-transparent border-none outline-none text-sm text-gray-700 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 focus:ring-0"})}),(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[o.length>0&&(0,t.jsxs)("button",{onClick:()=>{b(!f),f&&(v(null),k(null))},className:"p-2 rounded-md text-xs transition-all duration-200 ".concat(f?"bg-blue-500 text-white shadow-md":"text-gray-500 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 hover:bg-blue-50/50 dark:hover:bg-blue-900/20"),title:f?"Ocultar filtros":"Mostrar filtros",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),z&&(0,t.jsx)("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"})]}),(m||z)&&(0,t.jsx)("button",{onClick:U,className:"p-2 text-gray-400 dark:text-gray-500 hover:text-red-500 dark:hover:text-red-400 hover:bg-red-50/50 dark:hover:bg-red-900/20 rounded-md transition-all duration-200",title:"Limpiar b\xfasqueda y filtros",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}),o.length>0&&f&&(0,t.jsxs)("div",{className:"mt-3 relative bg-white dark:bg-gray-800 backdrop-blur-sm rounded-lg border border-gray-200 dark:border-gray-600 shadow-xl p-4 animate-in slide-in-from-top-2 duration-200 z-[100]",onClick:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()},style:{pointerEvents:"auto"},children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,t.jsx)("div",{className:"w-4 h-4 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-sm flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-2 h-2 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})})}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Filtros Avanzados"})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-4",children:o.map(e=>{let r;return"group"===e.id||"status"===e.id?r="150px":"role"===e.id&&(r="180px"),(0,t.jsxs)("div",{className:"space-y-2 min-w-0 relative z-0",ref:r=>{r?N.current[e.id]=r:delete N.current[e.id]},style:{zIndex:_===e.id?1e3:"auto"},children:[(0,t.jsxs)("label",{className:"flex items-center space-x-1 text-gray-600 dark:text-gray-400 text-xs font-medium",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full"}),(0,t.jsx)("span",{children:e.label})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.Z,{value:p[e.id]||"",options:e.options,onChange:r=>A(e.id,r),className:"",onFocus:()=>S(e.id),onBlur:()=>R(e.id),maxHeightOverride:r}),p[e.id]&&(0,t.jsx)("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-blue-500 rounded-full"})]})]},e.id)})}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-gray-200 dark:border-gray-600",children:[(0,t.jsx)("div",{className:"hidden sm:block text-xs text-gray-500 dark:text-gray-400",children:z?"".concat(Object.values(p).filter(e=>e).length," filtro(s) activo(s)"):"Sin filtros aplicados"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[z&&(0,t.jsx)("button",{onClick:U,className:"px-3 py-1.5 text-xs text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50/50 dark:hover:bg-red-900/20 rounded-md transition-all duration-200",children:"Limpiar todo"}),(0,t.jsx)("button",{onClick:()=>b(!1),className:"px-3 py-1.5 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white text-xs rounded-md transition-all duration-200 shadow-sm hover:shadow-md",children:"Aplicar"})]})]})]})]})}var p=a(883),h=a(5051);function f(){let[e,r]=(0,s.useState)([]),[a,i]=(0,s.useState)([]),[n,x]=(0,s.useState)([]),[p,h]=(0,s.useState)(!0),[f,y]=(0,s.useState)(""),[v,w]=(0,s.useState)(null),[k,j]=(0,s.useState)(!1),[N,D]=(0,s.useState)(null),[C,_]=(0,s.useState)(""),[E,L]=(0,s.useState)({}),[A,S]=(0,s.useState)(null),[R,U]=(0,s.useState)(!1),z=(0,o.useRouter)();(0,s.useEffect)(()=>{P()},[]);let P=async()=>{try{h(!0);let{data:{user:a}}=await l.supabase.auth.getUser();if(!a){y("Usuario no autenticado");return}try{var e;let{data:r,error:t}=await l.supabase.from("users").select("\n            role,\n            affiliate_studio_id,\n            user_groups(\n              groups!inner(\n                id,\n                name\n              )\n            )\n          ").eq("id",a.id).single();if(t){console.error("Error obteniendo datos del usuario:",t),y("Error obteniendo datos del usuario: "+t.message);return}if(!r){y("Error obteniendo datos del usuario");return}let s=(null===(e=r.user_groups)||void 0===e?void 0:e.map(e=>e.groups))||[];console.log("\uD83D\uDD0D [USUARIOS] Datos del usuario actual:",{id:a.id,role:r.role,affiliate_studio_id:r.affiliate_studio_id,groups:s}),D({id:a.id,role:r.role,groups:s,affiliate_studio_id:r.affiliate_studio_id||null})}catch(e){console.error("Error en consulta de usuario:",e),y("Error obteniendo datos del usuario");return}let[t,s]=await Promise.all([d(),c()]);if(t.success){let e=t.users;if(console.log("\uD83D\uDD0D [USUARIOS] Usuarios obtenidos de API:",t.users.length),console.log("\uD83D\uDD0D [USUARIOS] Usuario actual para filtrado:",N),(null==N?void 0:N.role)==="admin"){let r=N.groups||[],a=Array.isArray(r)?r.map(e=>"string"==typeof e?e:e.id):[];console.log("\uD83D\uDD0D [USUARIOS] Aplicando filtro de jerarqu\xeda para admin:",{userGroupIds:a,totalUsers:t.users.length}),e=t.users.filter(e=>"super_admin"!==e.role&&("admin"===e.role||"modelo"===e.role)&&!!e.groups&&e.groups.length>0&&(Array.isArray(e.groups)?e.groups.map(e=>"string"==typeof e?e:e.id):[]).some(e=>a.includes(e))),console.log("\uD83D\uDD0D [USUARIOS] Usuarios despu\xe9s del filtro:",e.length)}else((null==N?void 0:N.role)==="gestor"||(null==N?void 0:N.role)==="fotografia")&&(console.log("\uD83D\uDD0D [USUARIOS] Aplicando filtro de jerarqu\xeda para gestor/fotografia:",{totalUsers:t.users.length}),e=t.users.filter(e=>"admin"===e.role||"super_admin"===e.role),console.log("\uD83D\uDD0D [USUARIOS] Usuarios despu\xe9s del filtro (solo admins):",e.length));r(e),i([])}else y("Error cargando usuarios: "+t.error);s.success&&x(s.groups)}catch(e){console.error("❌ Error cargando datos:",e),y("Error cargando datos")}finally{h(!1)}},M=[{id:"role",label:"Rol",value:E.role||"",options:(()=>{let e=[{label:"Super Admin",value:"super_admin"},{label:"Admin",value:"admin"},{label:"Gestor",value:"gestor"},{label:"Fotograf\xeda",value:"fotografia"},{label:"Modelo",value:"modelo"}];return(null==N?void 0:N.role)==="admin"?e.filter(e=>"super_admin"!==e.value):(null==N?void 0:N.role)==="superadmin_aff"?e.filter(e=>"admin"===e.value||"modelo"===e.value):e})()},{id:"group",label:"Grupo",value:E.group||"",options:(()=>{if((null==N?void 0:N.role)==="admin"){let e=Array.isArray(N.groups)?N.groups.map(e=>"string"==typeof e?e:e.id):[];return n.filter(r=>e.includes(r.id)).map(e=>({label:e.name,value:e.id}))}return n.map(e=>({label:e.name,value:e.id}))})()},{id:"status",label:"Estado",value:E.status||"",options:[{label:"Activo",value:"active"},{label:"Inactivo",value:"inactive"}]}],I=async e=>{if(!e||!e.id){console.error("❌ [FRONTEND] Usuario inv\xe1lido:",e),y("Usuario inv\xe1lido");return}if(!N){y("Debes estar autenticado para editar usuarios");return}if(!u(N,e)){let r="No tienes permisos para editar este usuario";if("superadmin_aff"===N.role)r="super_admin"===e.role||"superadmin_aff"===e.role?"No puedes editar super administradores u otros superadmin afiliados":e.affiliate_studio_id!==N.affiliate_studio_id?"Solo puedes editar usuarios de tu estudio afiliado":"No tienes permisos para editar este usuario";else if("admin"===N.role&&"modelo"!==e.role)r="Los administradores solo pueden editar modelos";else if("admin"===N.role&&"modelo"===e.role){let a=N.groups.map(e=>e.id);e.groups.map(e=>e.id).some(e=>a.includes(e))||(r="Solo puedes editar modelos de tus grupos asignados")}else"modelo"===N.role&&(r="Los modelos no pueden editar otros usuarios");y(r);return}console.log("\uD83D\uDD0D [FRONTEND] Abriendo modal para usuario:",e),w(e),j(!0)},T=async a=>{let t=e.find(e=>e.id===a);if(!t){y("Usuario no encontrado");return}if(!N){y("Debes estar autenticado para eliminar usuarios");return}if(!m(N,t)){let e="No tienes permisos para eliminar este usuario";if("superadmin_aff"===N.role)e="super_admin"===t.role||"superadmin_aff"===t.role?"No puedes eliminar super administradores u otros superadmin afiliados":t.affiliate_studio_id!==N.affiliate_studio_id?"Solo puedes eliminar usuarios de tu estudio afiliado":"No tienes permisos para eliminar este usuario";else if("admin"===N.role&&"modelo"!==t.role)e="Los administradores solo pueden eliminar modelos";else if("admin"===N.role&&"modelo"===t.role){let r=N.groups.map(e=>e.id);t.groups.map(e=>e.id).some(e=>r.includes(e))||(e="Solo puedes eliminar modelos de tus grupos asignados")}else"modelo"===N.role&&(e="Los modelos no pueden eliminar otros usuarios");y(e);return}if(confirm("\xbfEst\xe1s seguro de que quieres eliminar este usuario?"))try{let e=await fetch("/api/users?id=".concat(a),{method:"DELETE"}),t=await e.json();t.success?(r(e=>e.filter(e=>e.id!==a)),i(e=>e.filter(e=>e.id!==a)),console.log("✅ [FRONTEND] Usuario eliminado de la lista local")):y("Error eliminando usuario: "+t.error)}catch(e){console.error("❌ Error eliminando usuario:",e),y("Error eliminando usuario")}};return p?(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center pt-16",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Cargando usuarios..."})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,t.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:[(0,t.jsx)("div",{className:"mb-8 sm:mb-12",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 to-indigo-600/10 rounded-xl blur-xl"}),(0,t.jsx)("div",{className:"relative bg-white/80 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 md:gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:(0,t.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("h1",{className:"text-base sm:text-lg md:text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:"Gesti\xf3n de Usuarios"}),(0,t.jsx)("p",{className:"mt-1 text-xs sm:text-sm text-gray-600 dark:text-gray-300 hidden sm:block",children:"Administra usuarios del sistema"})]})]}),(0,t.jsxs)("button",{onClick:()=>z.push("/admin/users/create"),className:"w-full md:w-auto px-4 py-2.5 sm:px-5 sm:py-3 rounded-lg bg-gradient-to-r from-blue-500 to-indigo-600 text-white hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 flex items-center justify-center space-x-2 shadow-md hover:shadow-lg transform hover:scale-[1.02] md:hover:scale-105 font-medium text-sm sm:text-base",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,t.jsx)("span",{children:"Nuevo Usuario"})]})]})})]})}),(0,t.jsxs)("div",{className:"mb-16 relative bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-6 z-10 dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15 ".concat(k?"opacity-30 blur-sm pointer-events-none":""),"aria-hidden":k,onClick:e=>{e.stopPropagation()},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"w-5 h-5 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,t.jsx)("span",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"B\xfasqueda y Filtros"})]}),a.length>0&&(0,t.jsxs)("div",{className:"hidden sm:flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,t.jsxs)("span",{children:[a.length," resultado(s) encontrado(s)"]})]})]}),(0,t.jsx)(g,{onSearch:(r,a)=>{if(_(r),L(a),!(r.trim()||a.role||a.group||a.status)){i([]);return}let t=e;if((null==N?void 0:N.role)==="admin"){let e=Array.isArray(N.groups)?N.groups.map(e=>"string"==typeof e?e:e.id):[];t=t.filter(r=>"super_admin"!==r.role&&("admin"===r.role||"modelo"===r.role)&&!!r.groups&&r.groups.length>0&&(Array.isArray(r.groups)?r.groups.map(e=>"string"==typeof e?e:e.id):[]).some(r=>e.includes(r)))}if(r.trim()&&(t=t.filter(e=>e.name.toLowerCase().includes(r.toLowerCase())||e.email.toLowerCase().includes(r.toLowerCase()))),a.role&&(t=t.filter(e=>e.role===a.role)),a.group&&(t=t.filter(e=>e.groups.some(e=>e.id===a.group))),a.status){let e="active"===a.status;t=t.filter(r=>r.is_active===e)}i(t)},placeholder:"Buscar por nombre, email o ID de usuario...",filters:M,onDropdownStateChange:e=>{U(e)},showResultsInfo:!0,totalUsers:e.length,filteredUsers:a.length,onClearSearch:()=>{_(""),L({}),i([])}})]}),f&&(0,t.jsx)("div",{className:"mb-6 relative bg-red-50/80 dark:bg-red-900/20 backdrop-blur-sm border border-red-200/50 dark:border-red-700/50 text-red-700 dark:text-red-300 px-4 py-3 rounded-xl shadow-md",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 bg-red-500 rounded-sm flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,t.jsx)("span",{className:"text-sm",children:f})]})}),(0,t.jsx)("div",{className:"relative bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm border border-white/20 dark:border-gray-600/20 rounded-xl shadow-md transition-all duration-300 apple-scroll overflow-y-auto max-h-[70vh] p-0 z-10 dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15 ".concat(R||k?"opacity-30 blur-sm pointer-events-none":"opacity-100 blur-none pointer-events-auto"),"aria-hidden":k,children:(0,t.jsxs)("div",{className:"pt-4 sm:pt-6 px-3 sm:px-6 pb-0",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,t.jsx)("div",{className:"w-5 h-5 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),(0,t.jsxs)("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:["Usuarios del Sistema (",e.length,")"]})]}),0===e.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mx-auto mb-3",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),(0,t.jsx)("div",{className:"text-gray-400 dark:text-gray-500 text-base font-medium",children:"No hay usuarios registrados"}),(0,t.jsx)("button",{onClick:()=>z.push("/admin/users/create"),className:"mt-4 px-3 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white rounded-lg transition-all duration-300 text-sm shadow-md hover:shadow-lg transform hover:scale-105",children:"Crear Primer Usuario"})]}):0===a.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-gray-400 to-gray-600 rounded-lg flex items-center justify-center mx-auto mb-3",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,t.jsx)("div",{className:"text-gray-400 dark:text-gray-500 text-base font-medium",children:"No hay resultados"}),(0,t.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-xs mt-2",children:C.trim()||Object.values(E).some(e=>e)?"Intenta ajustar los filtros de b\xfasqueda":"Usa los filtros de b\xfasqueda para encontrar usuarios"})]}):(0,t.jsx)("div",{className:"overflow-x-auto -mx-3 sm:mx-0",children:(0,t.jsx)("div",{className:"inline-block min-w-full align-middle",children:(0,t.jsx)("div",{className:"overflow-hidden",children:(0,t.jsxs)("table",{className:"min-w-full text-left text-xs md:table-fixed",children:[(0,t.jsx)("thead",{className:"border-b border-white/20 dark:border-gray-600/20 bg-gradient-to-r from-gray-50/80 to-blue-50/60 dark:from-gray-700/80 dark:to-gray-600/60 backdrop-blur-sm",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[120px] sm:w-[28%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Usuario"}),(0,t.jsx)("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[150px] sm:w-[28%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Email"}),(0,t.jsx)("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[80px] sm:w-[10%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Rol"}),(0,t.jsx)("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[100px] sm:w-[20%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Grupos"}),(0,t.jsx)("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[70px] sm:w-[8%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Estado"}),(0,t.jsx)("th",{className:"px-2 sm:px-4 py-3 sm:py-4 min-w-[100px] sm:w-[6%] text-gray-700 dark:text-white font-medium text-xs sm:text-sm uppercase tracking-wide text-center",children:"Acciones"})]})}),(0,t.jsx)("tbody",{className:"bg-white/30 backdrop-blur-sm divide-y divide-white/20",children:a.map(e=>(0,t.jsxs)("tr",{className:"border-b border-white/10 hover:bg-white/60 hover:shadow-sm transition-all duration-200 h-auto sm:h-12 group",children:[(0,t.jsx)("td",{className:"px-2 sm:px-4 py-2",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(()=>{let r;let a=e.role||"modelo",s="bg-gradient-to-br from-pink-500 via-rose-500 to-purple-500";return"super_admin"===a?(s="bg-gradient-to-br from-amber-500 via-yellow-500 to-amber-600",r=(0,t.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:[(0,t.jsx)("path",{d:"M5 16L3 10l5.5-2L12 10l3.5-2L21 10l-2 6H5zm14.5-7.5L18.5 8l-3.5 1.5L12 8l-2.5 1.5L6 8l-1 0.5L5 11l14 0.5z"}),(0,t.jsx)("circle",{cx:"8",cy:"16",r:"1.5",fill:"currentColor",opacity:"0.8"}),(0,t.jsx)("circle",{cx:"16",cy:"16",r:"1.5",fill:"currentColor",opacity:"0.8"}),(0,t.jsx)("circle",{cx:"12",cy:"14",r:"1.5",fill:"currentColor",opacity:"0.9"})]})):"admin"===a?(s="bg-gradient-to-br from-blue-500 to-indigo-600",r=(0,t.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:(0,t.jsx)("path",{d:"M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5a3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.4-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1c0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"})})):"gestor"===a?(s="bg-gradient-to-br from-orange-500 to-amber-600",r=(0,t.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:(0,t.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})):"fotografia"===a?(s="bg-gradient-to-br from-purple-500 to-pink-600",r=(0,t.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:(0,t.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})})):r=(0,t.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:[(0,t.jsx)("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"}),(0,t.jsx)("circle",{cx:"12",cy:"8",r:"1.5",fill:"currentColor",opacity:"0.8"}),(0,t.jsx)("circle",{cx:"12",cy:"16",r:"1.5",fill:"currentColor",opacity:"0.8"}),(0,t.jsx)("circle",{cx:"8",cy:"12",r:"1.5",fill:"currentColor",opacity:"0.8"}),(0,t.jsx)("circle",{cx:"16",cy:"12",r:"1.5",fill:"currentColor",opacity:"0.8"}),(0,t.jsx)("circle",{cx:"10",cy:"10",r:"1.2",fill:"currentColor",opacity:"0.7"}),(0,t.jsx)("circle",{cx:"14",cy:"10",r:"1.2",fill:"currentColor",opacity:"0.7"}),(0,t.jsx)("circle",{cx:"10",cy:"14",r:"1.2",fill:"currentColor",opacity:"0.7"}),(0,t.jsx)("circle",{cx:"14",cy:"14",r:"1.2",fill:"currentColor",opacity:"0.7"})]}),(0,t.jsx)("div",{className:"w-6 h-6 ".concat(s," rounded-full flex items-center justify-center text-xs shadow-sm border border-white/20 flex-shrink-0 relative overflow-hidden"),children:(0,t.jsx)("div",{className:"text-white flex items-center justify-center",children:r})})})(),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"text-gray-900 dark:text-gray-100 font-medium text-xs truncate",title:e.name,children:e.name}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 mt-0.5 group/id",children:[(0,t.jsx)("span",{className:"text-gray-400 dark:text-gray-500 text-xs font-mono select-all cursor-text hover:text-gray-600 dark:hover:text-gray-300 transition-colors",title:"ID: ".concat(e.id," (click para seleccionar, bot\xf3n para copiar)"),children:e.id}),(0,t.jsx)("button",{onClick:async r=>{r.stopPropagation();try{await navigator.clipboard.writeText(e.id);let a=r.currentTarget,t=a.innerHTML;a.innerHTML='<svg class="w-3 h-3 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>',setTimeout(()=>{a.innerHTML=t},1500)}catch(e){console.error("Error copiando ID:",e)}},className:"opacity-0 group-hover:opacity-100 group-hover/id:opacity-100 transition-opacity p-0.5 hover:bg-gray-200 dark:hover:bg-gray-700 rounded flex-shrink-0",title:"Copiar ID al portapapeles",children:(0,t.jsx)("svg",{className:"w-3 h-3 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]})]})}),(0,t.jsx)("td",{className:"px-2 sm:px-4 py-2 text-gray-800 truncate max-w-[220px] text-xs text-center",title:e.email,children:e.email}),(0,t.jsx)("td",{className:"px-2 sm:px-4 py-2 text-center",children:(0,t.jsx)("span",{className:"px-2.5 py-1 rounded-lg text-xs font-semibold whitespace-nowrap border shadow-sm backdrop-blur-sm ".concat("super_admin"===e.role?"bg-gradient-to-r from-gray-800 to-gray-900 text-white border-gray-600/30":"admin"===e.role?"bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 border-blue-200/50":"bg-gradient-to-r from-green-50 to-emerald-50 text-green-700 border-green-200/50"),children:e.role.replace("_"," ").toUpperCase()})}),(0,t.jsx)("td",{className:"px-2 sm:px-4 py-2 text-center",children:e.groups.length>0?(0,t.jsxs)("div",{className:"flex items-center justify-center gap-1 overflow-hidden",children:[e.groups.slice(0,2).map(e=>(0,t.jsx)("span",{className:"bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-700 dark:to-gray-600 text-gray-700 dark:text-gray-200 px-2 py-1 rounded-md text-xs whitespace-nowrap border border-gray-200/30 dark:border-gray-600/30 shadow-sm backdrop-blur-sm",children:e.name},e.id)),e.groups.length>2&&(0,t.jsxs)("span",{className:"text-gray-500 text-xs whitespace-nowrap cursor-help",title:e.groups.map(e=>e.name).join(", "),children:["+",e.groups.length-2]})]}):(0,t.jsx)("span",{className:"text-gray-400 text-xs",children:"Sin grupos"})}),(0,t.jsx)("td",{className:"px-2 sm:px-4 py-2 text-center",children:(0,t.jsx)("span",{className:"px-2.5 py-1 rounded-lg text-xs font-semibold border shadow-sm backdrop-blur-sm ".concat(e.is_active?"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 text-green-700 dark:text-green-300 border-green-200/50 dark:border-green-700/50":"bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-700 dark:to-gray-600 text-gray-600 dark:text-gray-300 border-gray-200/50 dark:border-gray-600/50"),children:e.is_active?"Activo":"Inactivo"})}),(0,t.jsx)("td",{className:"px-2 sm:px-4 py-2 text-center",children:(0,t.jsxs)("div",{className:"flex justify-center space-x-1 opacity-70 group-hover:opacity-100 transition-opacity duration-200",children:[(0,t.jsx)("button",{onClick:()=>I(e),disabled:!N||!u(N,e),className:"px-2.5 py-1.5 text-xs rounded-lg border transition-all duration-200 backdrop-blur-sm ".concat(N&&u(N,e)?"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200/30 text-blue-700 hover:from-blue-100 hover:to-indigo-100 hover:shadow-sm":"bg-gray-100 dark:bg-gray-700 border-gray-200/30 text-gray-400 dark:text-gray-500 cursor-not-allowed"),title:N&&u(N,e)?"Editar usuario":"Solo puedes editar modelos de tus grupos",children:"Editar"}),(0,t.jsx)("button",{onClick:()=>T(e.id),disabled:!N||!m(N,e),className:"px-2.5 py-1.5 text-xs rounded-lg border transition-all duration-200 backdrop-blur-sm ".concat(N&&m(N,e)?"bg-gradient-to-r from-red-50 to-rose-50 border-red-200/30 text-red-700 hover:from-red-100 hover:to-rose-100 hover:shadow-sm":"bg-gray-100 dark:bg-gray-700 border-gray-200/30 text-gray-400 dark:text-gray-500 cursor-not-allowed"),title:N&&m(N,e)?"Eliminar usuario":"Solo puedes eliminar modelos de tus grupos",children:"Eliminar"})]})})]},e.id))})]})})})})]})}),k&&v&&(0,t.jsx)(b,{user:v,groups:n,currentUser:N,modalError:A,setModalError:S,onClose:()=>{j(!1),w(null),S(null)},onSubmit:async e=>{try{console.log("\uD83D\uDD0D [PARENT] Recibiendo datos del formulario:",e);let a=await fetch("/api/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await a.json();console.log("\uD83D\uDD0D [PARENT] Respuesta de la API:",t),t.success?(console.log("✅ [PARENT] Usuario actualizado exitosamente"),j(!1),w(null),S(null),r(r=>r.map(r=>r.id===e.id?{...r,...t.user}:r)),i(r=>r.map(r=>r.id===e.id?{...r,...t.user}:r)),console.log("✅ [FRONTEND] Usuario actualizado en la lista local")):(console.error("❌ [PARENT] Error de la API:",t.error),S("Error actualizando usuario: "+t.error))}catch(e){console.error("❌ [PARENT] Error en la petici\xf3n:",e),S("Error actualizando usuario")}}})]})})}function b(e){var r,a,o;let{user:l,groups:i,onClose:n,onSubmit:d,currentUser:c,modalError:u,setModalError:m}=e,[x,g]=(0,s.useState)("profile"),[f,b]=(0,s.useState)({id:(null==l?void 0:l.id)||"",name:(null==l?void 0:l.name)||"",email:(null==l?void 0:l.email)||"",role:(null==l?void 0:l.role)||"modelo",is_active:null===(o=null==l?void 0:l.is_active)||void 0===o||o,group_ids:(null==l?void 0:null===(r=l.groups)||void 0===r?void 0:r.map(e=>e.id))||[]}),[y,v]=(0,s.useState)({newPassword:"",confirmPassword:""}),[w,k]=(0,s.useState)(!1),[j,N]=(0,s.useState)(!1),[D,C]=(0,s.useState)(!1),[_,E]=(0,s.useState)(null),[L,A]=(0,s.useState)(!1),[S,R]=(0,s.useState)(""),[U,z]=(0,s.useState)(!1);null===(a=i.find(e=>e.id===f.group_ids[0]))||void 0===a||a.name,(0,s.useEffect)(()=>{var e;l&&b({id:l.id,name:l.name,email:l.email,role:l.role,is_active:l.is_active,group_ids:(null===(e=l.groups)||void 0===e?void 0:e.map(e=>e.id))||[]})},[l]);let P=e=>e.trimStart().replace(/\s+/g," ").split(" ").map(e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():"").join(" "),M=e=>e.trim().replace(/\s{2,}/g," ").replace(/\s+([,.;:])/g,"$1"),I=async()=>{if(!y.newPassword.trim()){E("La contrase\xf1a no puede estar vac\xeda");return}if(y.newPassword.trim().length<6){E("La contrase\xf1a debe tener al menos 6 caracteres");return}if(y.newPassword!==y.confirmPassword){E("Las contrase\xf1as no coinciden");return}C(!0),E(null);try{let e=await fetch("/api/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:f.id,name:f.name,email:f.email,role:f.role,is_active:f.is_active,group_ids:f.group_ids,password:y.newPassword.trim()})}),r=await e.json();r.success?(E(null),A(!0),v({newPassword:"",confirmPassword:""}),setTimeout(()=>{A(!1)},3e3)):E(r.error||"Error actualizando contrase\xf1a")}catch(e){console.error("Error actualizando contrase\xf1a:",e),E("Error de conexi\xf3n. Por favor, intenta nuevamente.")}finally{C(!1)}},T=e=>{"gestor"===e||"fotografia"===e?b(r=>({...r,role:e,group_ids:[]})):b(r=>({...r,role:e})),"modelo"===e?R("\uD83D\uDCA1 Los modelos solo pueden estar en un grupo a la vez"):"admin"===e?R("\uD83D\uDCA1 Los administradores deben tener al menos un grupo asignado"):"gestor"===e?R("\uD83D\uDCA1 Los gestores interact\xfaan con todos los admins (no requieren grupos)"):"fotografia"===e?R("\uD83D\uDCA1 Los usuarios de fotograf\xeda interact\xfaan con todos los admins (no requieren grupos)"):"super_admin"===e&&R("\uD83D\uDCA1 Los super administradores tienen acceso a todos los grupos")};return(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[n]),(0,s.useEffect)(()=>{let e=requestAnimationFrame(()=>z(!0));return()=>cancelAnimationFrame(e)},[]),(0,t.jsxs)(h.Z,{isOpen:!0,onClose:n,title:"Editar Usuario",maxWidthClass:"max-w-4xl",children:[(0,t.jsxs)("div",{className:"flex space-x-1 mb-6 bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[(0,t.jsx)("button",{type:"button",onClick:()=>g("profile"),className:"flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 ".concat("profile"===x?"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100"),children:"Perfil"}),(0,t.jsx)("button",{type:"button",onClick:()=>g("password"),className:"flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 ".concat("password"===x?"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100"),children:"Contrase\xf1a"})]}),u&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700/50 rounded-lg",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,t.jsx)("div",{className:"ml-3",children:(0,t.jsx)("p",{className:"text-sm text-red-800 dark:text-red-300",children:u})})]})}),"profile"===x&&(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault();let r=P(M(f.name||""));d({...f,name:r})},className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Nombre"}),(0,t.jsx)("input",{type:"text",value:f.name,onChange:e=>b({...f,name:P(e.target.value)}),className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 backdrop-blur-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200",autoComplete:"name",autoCapitalize:"words",spellCheck:!0,required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Email"}),(0,t.jsx)("input",{type:"email",value:f.email,onChange:e=>b({...f,email:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 backdrop-blur-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200",autoComplete:"email",required:!0})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Rol"}),(0,t.jsx)(p.Z,{options:[{value:"modelo",label:"Modelo"},{value:"fotografia",label:"Fotograf\xeda"},{value:"gestor",label:"Gestor"},{value:"admin",label:"Admin"},{value:"super_admin",label:"Super Admin"}],value:f.role,onChange:e=>T(e),placeholder:"Selecciona un rol",className:"text-sm"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Usuario Activo"}),(0,t.jsx)("button",{type:"button",onClick:()=>b({...f,is_active:!f.is_active}),className:"relative w-10 h-6 rounded-full transition-colors",style:{background:f.is_active?"#111827":"#e5e7eb"},"aria-pressed":f.is_active,children:(0,t.jsx)("span",{className:"absolute top-[3px] rounded-full bg-white dark:bg-gray-200 shadow",style:{left:f.is_active?20:3,width:18,height:18}})})]})]})]}),"gestor"!==f.role&&"fotografia"!==f.role&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Grupos"}),(0,t.jsx)(p.Z,{options:i.map(e=>({value:e.id,label:e.name})),value:f.group_ids.length>0?f.group_ids[0]:"",onChange:e=>{b(r=>({...r,group_ids:e?[e]:[]}))},placeholder:(f.role,"Selecciona un grupo"),className:"text-sm"}),S&&(0,t.jsx)("div",{className:"mt-3 text-sm text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-700/50",children:S})]}),("gestor"===f.role||"fotografia"===f.role)&&S&&(0,t.jsx)("div",{className:"text-sm text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-700/50",children:S}),(0,t.jsxs)("div",{className:"flex justify-center space-x-4 pt-4",children:[(0,t.jsx)("button",{type:"button",onClick:n,className:"px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"px-6 py-2 text-sm font-medium text-white bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg hover:from-blue-600 hover:to-indigo-700 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200 shadow-md",children:"Actualizar Usuario"})]})]}),"password"===x&&(0,t.jsxs)("div",{className:"space-y-4",children:[L&&(0,t.jsx)("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700/50 rounded-lg",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,t.jsx)("div",{className:"ml-3",children:(0,t.jsx)("p",{className:"text-sm text-green-800 dark:text-green-300",children:"Contrase\xf1a actualizada exitosamente"})})]})}),_&&(0,t.jsx)("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700/50 rounded-lg",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,t.jsx)("div",{className:"ml-3",children:(0,t.jsx)("p",{className:"text-sm text-red-800 dark:text-red-300",children:_})})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Nueva Contrase\xf1a"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:w?"text":"password",value:y.newPassword,onChange:e=>v({...y,newPassword:e.target.value}),placeholder:"Ingresa nueva contrase\xf1a",autoComplete:"new-password",className:"w-full px-3 py-2 pr-12 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 backdrop-blur-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200"}),(0,t.jsx)("button",{type:"button",onClick:()=>k(!w),className:"absolute right-2 top-2 px-2 py-1 rounded-md text-xs text-white bg-gray-900 dark:bg-gray-700 hover:bg-gray-800 dark:hover:bg-gray-600",children:w?"Ocultar":"Ver"})]}),y.newPassword&&y.newPassword.length<6&&(0,t.jsx)("p",{className:"text-red-500 dark:text-red-400 text-xs mt-1",children:"La contrase\xf1a debe tener al menos 6 caracteres"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-gray-700 dark:text-gray-200 text-sm font-medium mb-1",children:"Confirmar Contrase\xf1a"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:j?"text":"password",value:y.confirmPassword,onChange:e=>v({...y,confirmPassword:e.target.value}),placeholder:"Confirma la nueva contrase\xf1a",autoComplete:"new-password",className:"w-full px-3 py-2 pr-12 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 backdrop-blur-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200"}),(0,t.jsx)("button",{type:"button",onClick:()=>N(!j),className:"absolute right-2 top-2 px-2 py-1 rounded-md text-xs text-white bg-gray-900 dark:bg-gray-700 hover:bg-gray-800 dark:hover:bg-gray-600",children:j?"Ocultar":"Ver"})]}),y.confirmPassword&&y.newPassword!==y.confirmPassword&&(0,t.jsx)("p",{className:"text-red-500 dark:text-red-400 text-xs mt-1",children:"Las contrase\xf1as no coinciden"})]}),(0,t.jsxs)("div",{className:"flex justify-center space-x-4 pt-4",children:[(0,t.jsx)("button",{type:"button",onClick:n,className:"px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",children:"Cancelar"}),(0,t.jsx)("button",{type:"button",onClick:I,disabled:D||!y.newPassword||!y.confirmPassword||y.newPassword!==y.confirmPassword||y.newPassword.length<6,className:"px-6 py-2 text-sm font-medium text-white bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg hover:from-blue-600 hover:to-indigo-700 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200 shadow-md flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:D?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Cambiando..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Cambiar Contrase\xf1a"]})})]})]})]})}},883:function(e,r,a){"use strict";a.d(r,{Z:function(){return l}});var t=a(7437),s=a(2265);let o={green:"bg-green-100 text-green-800",blue:"bg-blue-100 text-blue-800",red:"bg-red-100 text-red-800",yellow:"bg-yellow-100 text-yellow-800",gray:"bg-gray-100 text-gray-800"};function l(e){let{options:r,value:a,onChange:l,placeholder:i="Selecciona una opci\xf3n",className:n="",disabled:d=!1,maxHeight:c="max-h-60",autoOpen:u=!1}=e,[m,x]=(0,s.useState)(!1),g=(0,s.useRef)(null);(0,s.useEffect)(()=>{u&&r.length>1?x(!0):u||x(!1)},[u,r.length]),(0,s.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&x(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&x(!1)};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[]),(0,s.useEffect)(()=>{m&&g.current&&setTimeout(()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)},[m]);let p=r.find(e=>e.value===a),h=e=>{l(e),x(!1)};return(0,t.jsxs)("div",{className:"relative ".concat(n),ref:g,children:[(0,t.jsx)("button",{type:"button",className:"w-full px-3 py-2 text-sm text-left border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 cursor-pointer flex items-center justify-between hover:border-gray-400 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200 ".concat(d?"opacity-50 cursor-not-allowed":""),onClick:()=>!d&&x(!m),disabled:d,"aria-haspopup":"listbox","aria-expanded":m,children:(0,t.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,t.jsx)("span",{className:p?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-400",children:p?p.label:i}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(null==p?void 0:p.badge)&&(0,t.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat(o[p.badgeColor||"gray"]),children:p.badge}),(0,t.jsx)("svg",{className:"w-5 h-5 text-gray-400 transition-transform duration-200 ".concat(m?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}),m&&(0,t.jsx)("div",{className:"absolute z-[99998] w-full mt-1 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg dark:shadow-lg dark:shadow-cyan-900/10 dark:ring-0.5 dark:ring-cyan-500/15 ".concat(c," overflow-auto apple-scroll"),children:0===r.length?(0,t.jsx)("div",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:"No hay opciones disponibles"}):r.map((e,r)=>(0,t.jsxs)("div",{children:[r>0&&(0,t.jsx)("div",{className:"w-full h-px bg-gray-100 dark:bg-gray-600/50 dark:shadow-sm dark:shadow-blue-900/10"}),(0,t.jsxs)("div",{className:"px-4 py-3 text-sm cursor-pointer transition-colors duration-150 flex items-center justify-between ".concat(e.disabled?"text-gray-400 dark:text-gray-500 cursor-not-allowed":"hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-900 dark:text-gray-100"," ").concat(e.value===a?"bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-100":""),onClick:()=>!e.disabled&&h(e.value),children:[(0,t.jsx)("span",{children:e.label}),e.badge&&(0,t.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat(o[e.badgeColor||"gray"]),children:e.badge})]})]},e.value))})]})}},5051:function(e,r,a){"use strict";a.d(r,{Z:function(){return l}});var t=a(7437),s=a(2265),o=a(4887);function l(e){let{isOpen:r,onClose:a,children:l,title:i,maxWidthClass:n="max-w-lg",paddingClass:d="p-7",headerMarginClass:c="mb-5",formSpaceYClass:u="space-y-5",className:m="",showCloseButton:x=!0,closeOnBackdrop:g=!0}=e,[p,h]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{if(!r)return;let e=document.body.style.overflow||"";return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[r]),(0,s.useEffect)(()=>{if(!r)return;let e=e=>{"Escape"===e.key&&a()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,a]),(0,s.useEffect)(()=>{h(!0)},[]),!r||!p||"undefined"==typeof document||!document.body)return null;r&&console.log("\uD83D\uDD35 StandardModal: Renderizando modal",{isOpen:r,mounted:p,hasBody:!!document.body});let f=(0,t.jsx)("div",{onClick:()=>{g&&a()},"aria-modal":"true",role:"dialog",className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-[99999] p-4",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999},children:(0,t.jsxs)("div",{className:"".concat(d," w-full ").concat(n," max-h-[calc(100vh-2rem)] overflow-y-auto bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-2xl shadow-xl ").concat(m),onClick:e=>e.stopPropagation(),style:{position:"relative",display:"block",visibility:"visible",opacity:1},children:[(i||x)&&(0,t.jsxs)("div",{className:"flex items-center justify-between ".concat(c),children:[i?(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:i}):(0,t.jsx)("div",{}),x&&(0,t.jsx)("button",{onClick:a,className:"text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Cerrar",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:u,children:l})]})});return(0,o.createPortal)(f,document.body)}},5922:function(e,r,a){"use strict";a.r(r),a.d(r,{supabase:function(){return t}});let t=(0,a(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")},622:function(e,r,a){"use strict";var t=a(2265),s=Symbol.for("react.element"),o=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function d(e,r,a){var t,o={},d=null,c=null;for(t in void 0!==a&&(d=""+a),void 0!==r.key&&(d=""+r.key),void 0!==r.ref&&(c=r.ref),r)l.call(r,t)&&!n.hasOwnProperty(t)&&(o[t]=r[t]);if(e&&e.defaultProps)for(t in r=e.defaultProps)void 0===o[t]&&(o[t]=r[t]);return{$$typeof:s,type:e,key:d,ref:c,props:o,_owner:i.current}}r.Fragment=o,r.jsx=d,r.jsxs=d},7437:function(e,r,a){"use strict";e.exports=a(622)}},function(e){e.O(0,[5257,3470,2971,4938,1744],function(){return e(e.s=5262)}),_N_E=e.O()}]);