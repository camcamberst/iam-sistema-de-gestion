(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8427],{1783:function(e,a,r){Promise.resolve().then(r.bind(r,703))},703:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return c}});var l=r(7437),t=r(2265),d=r(5922),s=r(6727),i=r(1185),o=r(9728),n=r(4065);function c(){let[e,a]=(0,t.useState)({total:0,super_admin:0,admin:0,modelo:0}),[r,c]=(0,t.useState)(!0),[u,m]=(0,t.useState)(null),[x,g]=(0,t.useState)(null);return(0,t.useEffect)(()=>{(async()=>{try{var e,r,l,t;c(!0);let{data:s}=await d.O.auth.getUser(),i=null==s?void 0:null===(e=s.user)||void 0===e?void 0:e.id;if(!i){m(null),c(!1);return}let{data:o}=await d.O.from("users").select("id,name,email,role").eq("id",i).single(),n=[];if(o&&"super_admin"!==o.role){let{data:e}=await d.O.from("user_groups").select("groups(name)").eq("user_id",i);n=(e||[]).map(e=>{var a;return null===(a=e.groups)||void 0===a?void 0:a.name}).filter(Boolean)}let u={id:(null==o?void 0:o.id)||i,name:(null==o?void 0:o.name)||(null===(l=s.user)||void 0===l?void 0:null===(r=l.email)||void 0===r?void 0:r.split("@")[0])||"Usuario",email:(null==o?void 0:o.email)||(null===(t=s.user)||void 0===t?void 0:t.email)||"",role:(null==o?void 0:o.role)||"modelo",groups:n};m(u);let{data:x}=await d.O.from("users").select("id,role");if(x){let e=x;if("admin"===u.role){if(0===u.groups.length){a({total:0,super_admin:0,admin:0,modelo:0});return}let{data:r}=await d.O.from("user_groups").select("user_id, groups(name)").in("groups.name",u.groups);if(!r||0===r.length){a({total:0,super_admin:0,admin:0,modelo:0});return}let l=new Set((r||[]).map(e=>e.user_id));e=x.filter(e=>l.has(e.id))}let r=e.length,l=e.filter(e=>"super_admin"===e.role).length,t=e.filter(e=>"admin"===e.role).length,s=e.filter(e=>"modelo"===e.role).length;a({total:r,super_admin:l,admin:t,modelo:s})}}finally{c(!1)}})()},[]),(0,t.useEffect)(()=>{(async()=>{if(u&&"modelo"===u.role)try{var e,a,r,l,t,d,i,o,n,c,m;let x=await fetch("/api/rates-v2?activeOnly=true"),v=await x.json(),h={usd_cop:(null==v?void 0:null===(a=v.data)||void 0===a?void 0:null===(e=a.find(e=>"USD→COP"===e.kind))||void 0===e?void 0:e.value)||3900,eur_usd:(null==v?void 0:null===(l=v.data)||void 0===l?void 0:null===(r=l.find(e=>"EUR→USD"===e.kind))||void 0===r?void 0:r.value)||1.01,gbp_usd:(null==v?void 0:null===(d=v.data)||void 0===d?void 0:null===(t=d.find(e=>"GBP→USD"===e.kind))||void 0===t?void 0:t.value)||1.2},p=await fetch("/api/calculator/config-v2?userId=".concat(u.id)),f=await p.json(),b=((null==f?void 0:null===(i=f.config)||void 0===i?void 0:i.platforms)||[]).filter(e=>e.enabled),j=(null===(o=b[0])||void 0===o?void 0:o.percentage_override)||(null===(n=b[0])||void 0===n?void 0:n.group_percentage)||80,y=(null===(c=b[0])||void 0===c?void 0:c.min_quota_override)||(null===(m=b[0])||void 0===m?void 0:m.group_min_quota)||470,N=(0,s.iR)(),k=await fetch("/api/calculator/model-values-v2?modelId=".concat(u.id,"&periodDate=").concat(N)),w=await k.json(),_=(null==w?void 0:w.data)||[],M={};_.forEach(e=>{M[e.platform_id]=Number(e.value)||0});let S=0,B=0;for(let e of b){let a=M[e.id]||0;if(a<=0)continue;let r=0;r="EUR"===e.currency?"big7"===e.id?a*h.eur_usd*.84:"mondo"===e.id?a*h.eur_usd*.78:a*h.eur_usd:"GBP"===e.currency?"aw"===e.id?a*h.gbp_usd*.677:a*h.gbp_usd:"cmd"===e.id||"camlust"===e.id||"skypvt"===e.id?.75*a:"chaturbate"===e.id||"myfreecams"===e.id||"stripchat"===e.id?.05*a:"dxlive"===e.id?.6*a:"secretfriends"===e.id?.5*a:a,S+=r,B+=r*j/100}let O=B*h.usd_cop,C=Math.max(0,Math.min(100,S/y*100));g({usdBruto:S,usdModelo:B,copModelo:O,goalUsd:y,pct:C})}catch(e){console.warn("⚠️ resumen productividad:",e)}})()},[u]),(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,l.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:[(0,l.jsx)("div",{className:"mb-12",children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 to-indigo-600/10 rounded-xl blur-xl"}),(0,l.jsx)("div",{className:"relative bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md",children:(0,l.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:"Dashboard"}),u&&(0,l.jsxs)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-300",children:["Bienvenido, ",u.name," \xb7 Rol: ",String(u.role).replace("_"," "),"super_admin"!==u.role&&u.groups.length>0&&" \xb7 Grupos: ".concat(u.groups.join(", "))]})]})]})})]})}),(null==u?void 0:u.role)==="admin"&&0===u.groups.length&&(0,l.jsx)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Sin grupos asignados"}),(0,l.jsx)("div",{className:"mt-2 text-sm text-yellow-700",children:(0,l.jsx)("p",{children:"No tienes grupos asignados. Contacta al Super Admin para obtener acceso a los datos de gesti\xf3n."})})]})]})}),((null==u?void 0:u.role)==="super_admin"||(null==u?void 0:u.role)==="admin")&&(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10",children:[(0,l.jsx)(i.Z,{compact:!0}),(0,l.jsx)(n.Z,{userRole:u.role,userId:u.id,userGroups:u.groups})]}),((null==u?void 0:u.role)==="super_admin"||(null==u?void 0:u.role)==="admin")&&(0,l.jsx)("div",{className:"mb-10",children:(0,l.jsx)(o.Z,{userRole:u.role,userGroups:u.groups})}),(null==u?void 0:u.role)==="modelo"&&(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-700/20 p-6",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,l.jsx)("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:(0,l.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,l.jsx)("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Mi perfil"})]}),(0,l.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-300 mb-4",children:"Revisa tu informaci\xf3n"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:["Email: ",u.email]}),(0,l.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:["Grupo: ",u.groups[0]||"—"]})]})]}),(0,l.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-700/20 p-6",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,l.jsx)("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:(0,l.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,l.jsx)("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Resumen de Productividad"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[(0,l.jsxs)("div",{className:"p-3 rounded-lg bg-blue-50 text-center",children:[(0,l.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"USD Bruto (hoy)"}),(0,l.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:["$",x?x.usdBruto.toFixed(2):"—"]})]}),(0,l.jsxs)("div",{className:"p-3 rounded-lg bg-green-50 text-center",children:[(0,l.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"USD Modelo (hoy)"}),(0,l.jsxs)("div",{className:"text-lg font-bold text-green-600",children:["$",x?x.usdModelo.toFixed(2):"—"]})]}),(0,l.jsxs)("div",{className:"p-3 rounded-lg bg-purple-50 text-center",children:[(0,l.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"COP Modelo (hoy)"}),(0,l.jsx)("div",{className:"text-lg font-bold text-purple-600",children:x?x.copModelo.toLocaleString("es-CO",{maximumFractionDigits:0}):"—"})]})]}),(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100",children:"Objetivo B\xe1sico"}),(0,l.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["$",x?x.usdBruto.toFixed(0):"—"," / $",x?x.goalUsd.toFixed(0):"—"," USD"]})]}),(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:(0,l.jsx)("div",{className:"h-2 bg-gradient-to-r from-green-500 to-emerald-500 transition-all",style:{width:"".concat(x?Math.min(100,x.pct).toFixed(0):0,"%")}})}),(0,l.jsxs)("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 mt-1",children:[x?Math.min(100,x.pct).toFixed(0):0,"%"]})]}),(0,l.jsxs)("div",{className:"mt-4 text-xs text-gray-600 dark:text-gray-300",children:["Para actualizar tus valores usa el men\xfa ",(0,l.jsx)("a",{href:"/model/calculator",className:"text-blue-600 hover:text-blue-800 underline font-medium",children:"Mi Calculadora"}),"."]})]})]})]})})}}},function(e){e.O(0,[5257,9922,3792,2971,4938,1744],function(){return e(e.s=1783)}),_N_E=e.O()}]);