(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8427],{1783:function(e,a,s){Promise.resolve().then(s.bind(s,703))},703:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return x}});var r=s(7437),l=s(2265),i=s(4033),d=s(5922),t=s(6727),o=s(1185),n=s(1761),u=s(4065),c=s(4775),m=s(9482);function x(){(0,i.useRouter)();let[e,a]=(0,l.useState)({total:0,super_admin:0,admin:0,modelo:0}),[s,x]=(0,l.useState)(!0),[g,v]=(0,l.useState)(null),[h,p]=(0,l.useState)([]),[f,b]=(0,l.useState)(null);return(0,l.useEffect)(()=>{(async()=>{try{var e,s,r,l;x(!0);let{data:i}=await d.supabase.auth.getUser(),t=null==i?void 0:null===(e=i.user)||void 0===e?void 0:e.id;if(!t){v(null),x(!1);return}let{data:o}=await d.supabase.from("users").select("id,name,email,role,affiliate_studio_id").eq("id",t).single(),n=[],u=[];if(o&&"super_admin"!==o.role){let{data:e}=await d.supabase.from("user_groups").select("group_id, groups(name)").eq("user_id",t);n=(e||[]).map(e=>{var a;return null===(a=e.groups)||void 0===a?void 0:a.name}).filter(Boolean),u=(e||[]).map(e=>e.group_id).filter(Boolean)}let c={id:(null==o?void 0:o.id)||t,name:(null==o?void 0:o.name)||(null===(r=i.user)||void 0===r?void 0:null===(s=r.email)||void 0===s?void 0:s.split("@")[0])||"Usuario",email:(null==o?void 0:o.email)||(null===(l=i.user)||void 0===l?void 0:l.email)||"",role:(null==o?void 0:o.role)||"modelo",groups:n};v(c),p(u);let m=d.supabase.from("users").select("id,role,affiliate_studio_id");"superadmin_aff"===c.role&&(null==o?void 0:o.affiliate_studio_id)&&(m=m.eq("affiliate_studio_id",o.affiliate_studio_id));let{data:g}=await m;if(g){let e=g;if("admin"===c.role){if(0===c.groups.length){a({total:0,super_admin:0,admin:0,modelo:0});return}let{data:s}=await d.supabase.from("user_groups").select("user_id, groups(name)").in("groups.name",c.groups);if(!s||0===s.length){a({total:0,super_admin:0,admin:0,modelo:0});return}let r=new Set((s||[]).map(e=>e.user_id));e=g.filter(e=>r.has(e.id))}let s=e.length,r=e.filter(e=>"super_admin"===e.role).length,l=e.filter(e=>"admin"===e.role).length,i=e.filter(e=>"modelo"===e.role).length;a({total:s,super_admin:r,admin:l,modelo:i})}}finally{x(!1)}})()},[]),(0,l.useEffect)(()=>{(async()=>{if(g&&"modelo"===g.role)try{var e,a,s,r,l,i,d,o,n,u,c;let m=await fetch("/api/rates-v2?activeOnly=true"),x=await m.json(),v={usd_cop:(null==x?void 0:null===(a=x.data)||void 0===a?void 0:null===(e=a.find(e=>"USD→COP"===e.kind))||void 0===e?void 0:e.value)||3900,eur_usd:(null==x?void 0:null===(r=x.data)||void 0===r?void 0:null===(s=r.find(e=>"EUR→USD"===e.kind))||void 0===s?void 0:s.value)||1.01,gbp_usd:(null==x?void 0:null===(i=x.data)||void 0===i?void 0:null===(l=i.find(e=>"GBP→USD"===e.kind))||void 0===l?void 0:l.value)||1.2},h=await fetch("/api/calculator/config-v2?userId=".concat(g.id)),p=await h.json(),f=((null==p?void 0:null===(d=p.config)||void 0===d?void 0:d.platforms)||[]).filter(e=>e.enabled),j=(null===(o=f[0])||void 0===o?void 0:o.percentage_override)||(null===(n=f[0])||void 0===n?void 0:n.group_percentage)||80,y=(null===(u=f[0])||void 0===u?void 0:u.min_quota_override)||(null===(c=f[0])||void 0===c?void 0:c.group_min_quota)||470,N=(0,t.iR)(),w=await fetch("/api/calculator/model-values-v2?modelId=".concat(g.id,"&periodDate=").concat(N)),k=await w.json(),_=(null==k?void 0:k.data)||[],M={};_.forEach(e=>{M[e.platform_id]=Number(e.value)||0});let S=0,B=0;for(let e of f){let a=M[e.id]||0;if(a<=0)continue;let s=0;s="EUR"===e.currency?"big7"===e.id?a*v.eur_usd*.84:"mondo"===e.id?a*v.eur_usd*.78:a*v.eur_usd:"GBP"===e.currency?"aw"===e.id?a*v.gbp_usd*.677:a*v.gbp_usd:"cmd"===e.id||"camlust"===e.id||"skypvt"===e.id?.75*a:"chaturbate"===e.id||"myfreecams"===e.id||"stripchat"===e.id?.05*a:"dxlive"===e.id?.6*a:"secretfriends"===e.id?.5*a:a,S+=s,B+=s*j/100}let R=B*v.usd_cop,C=Math.max(0,Math.min(100,S/y*100));b({usdBruto:S,usdModelo:B,copModelo:R,goalUsd:y,pct:C})}catch(e){console.warn("⚠️ resumen productividad:",e)}})()},[g]),(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,r.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:[(0,r.jsx)("div",{className:"mb-8 sm:mb-12",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 to-indigo-600/10 rounded-xl blur-xl"}),(0,r.jsx)("div",{className:"relative bg-white/80 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:(0,r.jsx)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 md:gap-3",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[(0,r.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:(0,r.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("h1",{className:"text-base sm:text-lg md:text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:"Dashboard"}),g&&(0,r.jsxs)("p",{className:"mt-1 text-xs sm:text-sm text-gray-600 dark:text-gray-300 hidden sm:block",children:["Bienvenido, ",g.name," \xb7 Rol: ",String(g.role).replace("_"," "),"super_admin"!==g.role&&g.groups.length>0&&" \xb7 Grupos: ".concat(g.groups.join(", "))]})]})]})})})]})}),(0,r.jsx)(m.Z,{}),(null==g?void 0:g.role)==="admin"&&0===g.groups.length&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Sin grupos asignados"}),(0,r.jsx)("div",{className:"mt-2 text-sm text-yellow-700",children:(0,r.jsx)("p",{children:"No tienes grupos asignados. Contacta al Super Admin para obtener acceso a los datos de gesti\xf3n."})})]})]})}),((null==g?void 0:g.role)==="super_admin"||(null==g?void 0:g.role)==="admin"||(null==g?void 0:g.role)==="superadmin_aff")&&(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10",children:[(0,r.jsx)(o.Z,{compact:!0,userRole:g.role}),(0,r.jsx)(u.Z,{userRole:g.role,userId:g.id,userGroups:g.groups})]}),g&&("super_admin"===g.role||"admin"===g.role||"superadmin_aff"===g.role)&&(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsx)(c.Z,{userId:g.id,userGroups:h,userRole:g.role})}),((null==g?void 0:g.role)==="super_admin"||(null==g?void 0:g.role)==="admin"||(null==g?void 0:g.role)==="superadmin_aff")&&(0,r.jsx)("div",{className:"mb-10",children:(0,r.jsx)(n.Z,{userRole:g.role,userGroups:g.groups,userId:g.id})}),(null==g?void 0:g.role)==="modelo"&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-700/20 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,r.jsx)("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,r.jsx)("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Mi perfil"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-300 mb-4",children:"Revisa tu informaci\xf3n"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:["Email: ",g.email]}),(0,r.jsxs)("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:["Grupo: ",g.groups[0]||"—"]})]})]}),(0,r.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-700/20 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,r.jsx)("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,r.jsx)("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Resumen de Productividad"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-blue-50 text-center",children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"USD Bruto (hoy)"}),(0,r.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:["$",f?f.usdBruto.toFixed(2):"—"]})]}),(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-green-50 text-center",children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"USD Modelo (hoy)"}),(0,r.jsxs)("div",{className:"text-lg font-bold text-green-600",children:["$",f?f.usdModelo.toFixed(2):"—"]})]}),(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-purple-50 text-center",children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:"COP Modelo (hoy)"}),(0,r.jsx)("div",{className:"text-lg font-bold text-purple-600",children:f?f.copModelo.toLocaleString("es-CO",{maximumFractionDigits:0}):"—"})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100",children:"Objetivo B\xe1sico"}),(0,r.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:["$",f?f.usdBruto.toFixed(0):"—"," / $",f?f.goalUsd.toFixed(0):"—"," USD"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:(0,r.jsx)("div",{className:"h-2 bg-gradient-to-r from-green-500 to-emerald-500 transition-all",style:{width:"".concat(f?Math.min(100,f.pct).toFixed(0):0,"%")}})}),(0,r.jsxs)("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 mt-1",children:[f?Math.min(100,f.pct).toFixed(0):0,"%"]})]}),(0,r.jsxs)("div",{className:"mt-4 text-xs text-gray-600 dark:text-gray-300",children:["Para actualizar tus valores usa el men\xfa ",(0,r.jsx)("a",{href:"/model/calculator",className:"text-blue-600 hover:text-blue-800 underline font-medium",children:"Mi Calculadora"}),"."]})]})]})]})})}}},function(e){e.O(0,[5257,1585,1396,8153,590,9769,2971,4938,1744],function(){return e(e.s=1783)}),_N_E=e.O()}]);