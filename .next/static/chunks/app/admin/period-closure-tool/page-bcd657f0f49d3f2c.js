(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6036],{2410:function(e,r,a){Promise.resolve().then(a.bind(a,6208))},6208:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return i}});var o=a(7437),t=a(2265),s=a(5257),l=a(4033);let n=(0,s.createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c");function i(){let[e,r]=(0,t.useState)(!1),[a,s]=(0,t.useState)(null),[i,d]=(0,t.useState)(null),[c,u]=(0,t.useState)("2024-11-16"),[m,p]=(0,t.useState)("16-31"),[f,h]=(0,t.useState)(!1),x=(0,l.useRouter)();(0,t.useEffect)(()=>{(async()=>{let{data:{user:e}}=await n.auth.getUser();if(!e){x.push("/login");return}let{data:r}=await n.from("users").select("role").eq("id",e.id).single();(null==r?void 0:r.role)!=="super_admin"?d("Acceso denegado. Solo Super Admins pueden usar esta herramienta."):h(!0)})()},[]);let b=async()=>{if(confirm("\xbfEST\xc1S SEGURO? Esto cerrar\xe1 forzosamente el periodo ".concat(c," (").concat(m,"), archivar\xe1 los valores actuales y limpiar\xe1 las calculadoras. Esta acci\xf3n no se puede deshacer."))){r(!0),d(null),s(null);try{let{data:{session:e}}=await n.auth.getSession(),r=await fetch("/api/calculator/period-closure/close-period",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(null==e?void 0:e.access_token),"x-force-period-date":c,"x-force-period-type":m}}),a=await r.json();if(!r.ok)throw Error(a.error||"Error desconocido al cerrar periodo");s(a)}catch(e){d(e.message)}finally{r(!1)}}};return f||i?i?(0,o.jsx)("div",{className:"p-8 text-red-600 font-bold",children:i}):(0,o.jsxs)("div",{className:"max-w-4xl mx-auto p-8",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold mb-6 text-red-600",children:"⚠️ Herramienta de Cierre Manual de Periodo"}),(0,o.jsxs)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8",children:[(0,o.jsx)("p",{className:"font-bold text-yellow-800",children:"\xa1ADVERTENCIA!"}),(0,o.jsx)("p",{className:"text-yellow-700",children:"Esta herramienta fuerza el cierre de un periodo, moviendo los datos de la calculadora al historial y borr\xe1ndolos de la vista actual. \xdasala SOLO cuando el cierre autom\xe1tico haya fallado."})]}),(0,o.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-8",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Configuraci\xf3n del Cierre"}),(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Inicio del Periodo"}),(0,o.jsx)("input",{type:"date",value:c,onChange:e=>u(e.target.value),className:"w-full p-2 border border-gray-300 rounded focus:ring-red-500 focus:border-red-500"}),(0,o.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Ej: 2024-11-16 para la segunda quincena de Noviembre"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Periodo"}),(0,o.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"w-full p-2 border border-gray-300 rounded focus:ring-red-500 focus:border-red-500",children:[(0,o.jsx)("option",{value:"1-15",children:"Primera Quincena (1-15)"}),(0,o.jsx)("option",{value:"16-31",children:"Segunda Quincena (16-31)"})]})]})]}),(0,o.jsx)("button",{onClick:b,disabled:e,className:"w-full py-3 px-4 rounded-md text-white font-bold transition-colors ".concat(e?"bg-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700 shadow-lg"),children:e?"Procesando Cierre...":"EJECUTAR CIERRE MANUAL"})]}),a&&(0,o.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[(0,o.jsx)("h3",{className:"text-lg font-bold text-green-800 mb-2",children:"✅ Cierre Exitoso"}),(0,o.jsx)("pre",{className:"bg-gray-800 text-green-400 p-4 rounded overflow-auto text-sm",children:JSON.stringify(a,null,2)})]})]}):(0,o.jsx)("div",{className:"p-8",children:"Cargando..."})}},622:function(e,r,a){"use strict";var o=a(2265),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,n=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function d(e,r,a){var o,s={},d=null,c=null;for(o in void 0!==a&&(d=""+a),void 0!==r.key&&(d=""+r.key),void 0!==r.ref&&(c=r.ref),r)l.call(r,o)&&!i.hasOwnProperty(o)&&(s[o]=r[o]);if(e&&e.defaultProps)for(o in r=e.defaultProps)void 0===s[o]&&(s[o]=r[o]);return{$$typeof:t,type:e,key:d,ref:c,props:s,_owner:n.current}}r.Fragment=s,r.jsx=d,r.jsxs=d},7437:function(e,r,a){"use strict";e.exports=a(622)},4033:function(e,r,a){e.exports=a(5313)}},function(e){e.O(0,[5257,2971,4938,1744],function(){return e(e.s=2410)}),_N_E=e.O()}]);