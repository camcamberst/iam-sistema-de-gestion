(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9726],{8506:function(e,r,t){Promise.resolve().then(t.bind(t,5723))},5723:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return j}});var a=t(7437),s=t(2265),l=t(6727),d=t(6605);function i(e){let{userRole:r,userId:t,userGroups:i=[],selectedDate:o,selectedPeriod:n}=e;console.log("\uD83D\uDD0D [BILLING-SUMMARY] Componente renderizado:",{userRole:r,userId:t,propSelectedDate:o,propSelectedPeriod:n});let[c,x]=(0,s.useState)([]),[m,u]=(0,s.useState)([]),[g,h]=(0,s.useState)(null),[p,b]=(0,s.useState)(!0),[f,y]=(0,s.useState)(null),[v,j]=(0,s.useState)(null),[k,w]=(0,s.useState)(o||(0,l.iR)()),[N,_]=(0,s.useState)(""),[S,D]=(0,s.useState)(n||"current"),[C,L]=(0,s.useState)([]),[E,M]=(0,s.useState)(new Set),[A,B]=(0,s.useState)(new Set),[U,z]=(0,s.useState)(!1);(0,s.useEffect)(()=>{o&&w(o)},[o]),(0,s.useEffect)(()=>{n&&D(n)},[n]),(0,s.useEffect)(()=>{"super_admin"===r&&P()},[r]),(0,s.useEffect)(()=>{I()},[k,N,S,t]);let P=async()=>{try{let e=await fetch("/api/groups"),r=await e.json();r.success&&L(r.data||[])}catch(e){console.error("Error al cargar sedes:",e)}},I=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var a,s;console.log("\uD83D\uDD0D [BILLING-SUMMARY] Iniciando carga de datos:",{userId:t,userRole:r,selectedDate:k,selectedSede:N,selectedPeriod:S,userGroups:i,silent:e}),e||b(!0),y(null),e||(x([]),u([]),h(null));let l=k;if("period-1"===S){let e=new Date(k);l="".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-15")}else if("period-2"===S){let e=new Date(k),r=new Date(e.getFullYear(),e.getMonth()+1,0).getDate();l="".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(r).padStart(2,"0"))}let d=new URLSearchParams({adminId:t,periodDate:l});N&&d.append("sedeId",N),console.log("\uD83D\uDD0D [BILLING-SUMMARY] Par\xe1metros:",d.toString());let o="/api/admin/billing-summary?".concat(d,"&_t=").concat(Date.now());console.log("\uD83D\uDD0D [BILLING-SUMMARY] URL completa:",o);let n=await fetch(o,{method:"GET",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}}),c=await n.json();if(console.log("\uD83D\uDD0D [BILLING-SUMMARY] Respuesta API:",c),!c.success)throw Error(c.error||"Error al cargar datos");console.log("\uD83D\uDD0D [BILLING-SUMMARY] Estableciendo nuevos datos:",{billingDataLength:(null===(a=c.data)||void 0===a?void 0:a.length)||0,summary:c.summary,groupedDataLength:(null===(s=c.groupedData)||void 0===s?void 0:s.length)||0,groupedData:c.groupedData,userGroups:i,affiliateStudioName:c.affiliateStudioName}),c.affiliateStudioName&&j(c.affiliateStudioName);let m=c.data||[],g=c.groupedData||[],p=c.summary||null;x(m),u(g),h(p)}catch(e){console.error("Error al cargar resumen de facturaci\xf3n:",e),y(e.message||"Error al cargar datos")}finally{e||b(!1)}},{isPolling:R,isSilentUpdating:O,manualRefresh:T}=(0,d.t)(I,[k,N,t],{refreshInterval:15e3,enabled:!0,silentUpdate:!0,onRefresh:()=>{console.log("\uD83D\uDD04 [BILLING-SUMMARY] Datos actualizados autom\xe1ticamente")}}),W=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"USD";return"COP"===r?e.toLocaleString("es-CO",{minimumFractionDigits:0,maximumFractionDigits:0}):e.toLocaleString("es-CO",{minimumFractionDigits:2,maximumFractionDigits:2})},q=e=>{let r=new Set(E);r.has(e)?r.delete(e):r.add(e),M(r)},H=e=>{let r=new Set(A);r.has(e)?r.delete(e):r.add(e),B(r)};if(p)return(0,a.jsx)("div",{className:"mb-10",children:(0,a.jsx)("div",{className:"relative bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-6 dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15",children:(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600 dark:text-gray-600 dark:text-gray-500 dark:text-gray-300",children:"Cargando resumen de facturaci\xf3n..."})]})})});if(f)return(0,a.jsx)("div",{className:"mb-10",children:(0,a.jsx)("div",{className:"relative bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-6 dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-red-500 text-lg mb-2",children:"⚠️"}),(0,a.jsx)("div",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error al cargar datos"}),(0,a.jsx)("div",{className:"text-gray-600 dark:text-gray-600 dark:text-gray-500 dark:text-gray-600 dark:text-gray-500 text-sm mt-1",children:f}),(0,a.jsx)("button",{onClick:()=>I(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Reintentar"})]})})});let F=o&&n&&"current"!==n;return(0,a.jsx)("div",{className:"mb-4 sm:mb-6 ".concat(F?"px-3 sm:px-0":""),children:(0,a.jsxs)("div",{className:"bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl p-3 sm:p-4 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20 ".concat(F?"mb-3 sm:mb-6":"mb-4 sm:mb-8"),children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h1",{className:"text-sm sm:text-lg font-semibold text-gray-900 dark:text-white",children:"Resumen de Facturaci\xf3n"}),(0,a.jsx)("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-white hidden sm:block",children:"super_admin"===r?"Vista consolidada de todas las sedes":"superadmin_aff"===r?"Vista de las sedes de tu estudio":"Vista de tus sedes asignadas"})]})]}),(0,a.jsx)("div",{className:"flex items-center justify-between sm:justify-end space-x-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1.5 sm:space-x-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 rounded-full ".concat(R?"bg-green-500":"bg-gray-400"," ").concat(O?"animate-pulse":"")}),(0,a.jsx)("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-white hidden sm:inline",children:O?"Actualizando...":R?"Actualizaci\xf3n autom\xe1tica":"Manual"})]}),(0,a.jsx)("button",{onClick:T,disabled:p,className:"flex items-center justify-center w-7 h-7 sm:w-8 sm:h-8 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white rounded-lg transition-colors duration-200 active:scale-95 touch-manipulation",title:p?"Actualizando...":"Actualizar",children:(0,a.jsx)("svg",{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 ".concat(p?"animate-spin":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})})]}),(0,a.jsxs)("div",{className:"px-2 sm:px-4 pb-3 sm:pb-4 ".concat(F?"px-2 sm:px-4":""),children:[g&&(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 ".concat(F?"mb-3 sm:mb-5 mt-3 sm:mt-5":"mb-4 sm:mb-6 mt-4 sm:mt-6"),children:[(0,a.jsx)("div",{className:"bg-blue-50/80 dark:bg-blue-50/90 backdrop-blur-sm rounded-lg p-2 sm:p-4 hover:shadow-md transition-all duration-300 border border-blue-200/50 dark:border-blue-200/50",children:(0,a.jsxs)("div",{className:"text-center min-w-0",children:[(0,a.jsxs)("div",{className:"text-xs sm:text-xl font-bold text-blue-600 dark:text-blue-600 mb-1 sm:mb-2.5 leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:["$",W(g.totalUsdBruto)]}),(0,a.jsx)("div",{className:"inline-block bg-blue-100/80 dark:bg-blue-200/80 text-blue-700 dark:text-blue-700 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-medium whitespace-nowrap",children:"USD Bruto"})]})}),(0,a.jsx)("div",{className:"bg-green-50/80 dark:bg-green-50/90 backdrop-blur-sm rounded-lg p-2 sm:p-4 hover:shadow-md transition-all duration-300 border border-green-200/50 dark:border-green-200/50",children:(0,a.jsxs)("div",{className:"text-center min-w-0",children:[(0,a.jsxs)("div",{className:"text-xs sm:text-xl font-bold text-green-600 dark:text-green-600 mb-1 sm:mb-2.5 leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:["$",W(g.totalUsdModelo)]}),(0,a.jsx)("div",{className:"inline-block bg-green-100/80 dark:bg-green-200/80 text-green-700 dark:text-green-700 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs whitespace-nowrap",children:"USD Modelos"})]})}),(0,a.jsx)("div",{className:"bg-purple-50/80 dark:bg-purple-50/90 backdrop-blur-sm rounded-lg p-2 sm:p-4 hover:shadow-md transition-all duration-300 border border-purple-200/50 dark:border-purple-200/50",children:(0,a.jsxs)("div",{className:"text-center min-w-0",children:[(0,a.jsxs)("div",{className:"text-xs sm:text-xl font-bold text-purple-600 dark:text-purple-600 mb-1 sm:mb-2.5 leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:["$",W(g.totalUsdSede)]}),(0,a.jsx)("div",{className:"inline-block bg-purple-100/80 dark:bg-purple-200/80 text-purple-700 dark:text-purple-700 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-medium whitespace-nowrap",children:"superadmin_aff"===r&&v?"USD ".concat(v):"USD Agencia"})]})})]}),"super_admin"===r&&m&&m.length>0?(0,a.jsx)("div",{className:"space-y-3 sm:space-y-4 ".concat(F?"space-y-2 sm:space-y-3":""),children:m.map(e=>{var r,t,s,l;return(0,a.jsxs)("div",{className:"bg-white/70 dark:bg-white backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-200/50 overflow-hidden hover:shadow-lg transition-all duration-300",children:[(0,a.jsx)("div",{className:"px-4 py-3 cursor-pointer hover:bg-gray-50/50 dark:hover:bg-gray-600/50 transition-all duration-200",onClick:()=>q(e.sedeId),children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-600 dark:text-gray-600 dark:text-gray-500 transition-transform duration-200 ".concat(E.has(e.sedeId)?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-900",children:[e.sedeName,e.isAffiliate&&(0,a.jsx)("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",children:"Afiliado"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500",children:e.isAffiliate?"".concat(e.totalModels," modelos • ").concat(e.sedes_count||0," sedes • ").concat(e.commission_percentage||10,"% comisi\xf3n"):"".concat(e.totalModels," modelos • ").concat((null===(r=e.groups)||void 0===r?void 0:r.length)||0," grupos")})]})]})})}),E.has(e.sedeId)&&(0,a.jsx)("div",{className:"bg-gray-50/30 dark:bg-gray-600/30 border-t border-gray-200/50 dark:border-gray-500/50",children:e.isAffiliate?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200/50",children:(0,a.jsxs)("div",{className:"bg-white/70 rounded-xl shadow-sm border border-white/20 p-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-600",children:["$",W(e.totalUsdBruto)]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"USD Bruto Total"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-green-600 dark:text-green-600",children:["$",W(null!==(l=e.totalUsdAfiliado)&&void 0!==l?l:e.totalUsdModelo)]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"USD Afiliado"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-purple-600 dark:text-purple-600",children:["$",W(e.totalUsdSede)]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"USD Comisi\xf3n Innova"})]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-500 text-center pt-3 border-t border-gray-200/50",children:["Comisi\xf3n: ",e.commission_percentage||10,"% • Total COP: $",W(e.totalCopSede,"COP")]})]})}),null===(t=e.groups)||void 0===t?void 0:t.map(r=>(0,a.jsxs)("div",{className:"border-b border-gray-200/30 last:border-b-0",children:[(0,a.jsx)("div",{className:"px-3 sm:px-6 py-2.5 sm:py-4 cursor-pointer hover:bg-white/50 transition-all duration-200 active:scale-[0.98] touch-manipulation",onClick:()=>H(r.groupId),children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[(0,a.jsx)("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-gray-100 rounded-md flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-gray-600 dark:text-gray-600 dark:text-gray-500 transition-transform duration-200 ".concat(A.has(r.groupId)?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h4",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-gray-900 truncate",children:r.groupName}),(0,a.jsxs)("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-600 dark:text-gray-500",children:[r.totalModels," modelos"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between sm:justify-end space-x-3 sm:space-x-6 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-blue-600 dark:text-blue-600 text-xs sm:text-sm leading-tight",children:["$",W(r.totalUsdBruto)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Bruto"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-green-600 dark:text-green-600 text-xs sm:text-sm leading-tight",children:["$",W(r.totalUsdModelo)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Modelos"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-purple-600 dark:text-purple-600 text-xs sm:text-sm leading-tight",children:["$",W(r.totalUsdSede)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:e.isAffiliate?"USD ".concat(e.sedeName.replace(" - Afiliado","")):"USD Agencia"})]})]})]})}),A.has(r.groupId)&&(0,a.jsx)("div",{className:"bg-white/40 border-t border-gray-200/30",children:(0,a.jsx)("div",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"space-y-3",children:r.models.map(r=>(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0 p-3 sm:p-4 bg-white/70 rounded-xl shadow-sm border border-white/20 hover:shadow-md hover:bg-white/80 transition-all duration-300",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-600 dark:text-gray-500",children:r.email.charAt(0).toUpperCase()})}),(0,a.jsx)("div",{className:"min-w-0 flex-1",children:(0,a.jsx)("div",{className:"font-medium text-gray-800 dark:text-gray-800 text-xs sm:text-sm truncate",children:r.email})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between sm:justify-end space-x-3 sm:space-x-6 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-blue-600 dark:text-blue-600 text-xs sm:text-sm leading-tight",children:["$",W(r.usdBruto)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Bruto"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-green-600 dark:text-green-600 text-xs sm:text-sm leading-tight",children:["$",W(r.usdModelo)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Modelo"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-purple-600 dark:text-purple-600 text-xs sm:text-sm leading-tight",children:["$",W(r.usdSede)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:e.isAffiliate?"USD ".concat(e.sedeName.replace(" - Afiliado","")):"USD Agencia"})]})]})]},r.modelId))})})})]},r.groupId))]}):null===(s=e.groups)||void 0===s?void 0:s.map(r=>(0,a.jsxs)("div",{className:"border-b border-gray-200/30 last:border-b-0",children:[(0,a.jsx)("div",{className:"px-3 sm:px-6 py-2.5 sm:py-4 cursor-pointer hover:bg-white/50 transition-all duration-200 active:scale-[0.98] touch-manipulation",onClick:()=>H(r.groupId),children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[(0,a.jsx)("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-gray-100 rounded-md flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-gray-600 dark:text-gray-600 dark:text-gray-500 transition-transform duration-200 ".concat(A.has(r.groupId)?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h4",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-gray-900 truncate",children:r.groupName}),(0,a.jsxs)("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-600 dark:text-gray-500",children:[r.totalModels," modelos"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between sm:justify-end space-x-3 sm:space-x-6 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-blue-600 dark:text-blue-600 text-xs sm:text-sm leading-tight",children:["$",W(r.totalUsdBruto)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Bruto"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-green-600 dark:text-green-600 text-xs sm:text-sm leading-tight",children:["$",W(r.totalUsdModelo)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Modelos"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-purple-600 dark:text-purple-600 text-xs sm:text-sm leading-tight",children:["$",W(r.totalUsdSede)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:e.isAffiliate?"USD ".concat(e.sedeName.replace(" - Afiliado","")):"USD ".concat(r.groupName)})]})]})]})}),A.has(r.groupId)&&(0,a.jsx)("div",{className:"bg-white/40 border-t border-gray-200/30",children:(0,a.jsx)("div",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"space-y-3",children:r.models.map(r=>(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0 p-3 sm:p-4 bg-white/70 rounded-xl shadow-sm border border-white/20 hover:shadow-md hover:bg-white/80 transition-all duration-300",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-600 dark:text-gray-500",children:r.email.charAt(0).toUpperCase()})}),(0,a.jsx)("div",{className:"min-w-0 flex-1",children:(0,a.jsx)("div",{className:"font-medium text-gray-800 dark:text-gray-800 text-xs sm:text-sm truncate",children:r.email})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between sm:justify-end space-x-3 sm:space-x-6 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-blue-600 dark:text-blue-600 text-xs sm:text-sm leading-tight",children:["$",W(r.usdBruto)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Bruto"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-green-600 dark:text-green-600 text-xs sm:text-sm leading-tight",children:["$",W(r.usdModelo)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Modelo"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-purple-600 dark:text-purple-600 text-xs sm:text-sm leading-tight",children:["$",W(r.usdSede)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:e.isAffiliate?"USD ".concat(e.sedeName.replace(" - Afiliado","")):r.groupName?"USD ".concat(r.groupName):"USD Agencia"})]})]})]},r.modelId))})})})]},r.groupId))})]},e.sedeId)})}):c.length>0?(0,a.jsx)("div",{className:"space-y-2 sm:space-y-3 ".concat(F?"space-y-2":""),children:m&&m.length>0?(0,a.jsx)("div",{className:"space-y-3",children:m.map(e=>{var t;return(0,a.jsxs)("div",{className:"bg-white/70 dark:bg-white backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-200/50 overflow-hidden hover:shadow-lg transition-all duration-300",children:[(0,a.jsx)("div",{className:"px-3 sm:px-4 py-2 sm:py-3 cursor-pointer hover:bg-gray-50/50 dark:hover:bg-gray-600/50 transition-all duration-200 active:scale-[0.98] touch-manipulation",onClick:()=>q(e.sedeId),children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[(0,a.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-gray-600 dark:text-gray-600 dark:text-gray-500 transition-transform duration-200 ".concat(E.has(e.sedeId)?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h3",{className:"text-sm sm:text-lg font-semibold text-gray-900 dark:text-gray-900 truncate",children:e.sedeName}),(0,a.jsxs)("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-600 dark:text-gray-500",children:[e.totalModels," modelos • ",(null===(t=e.groups)||void 0===t?void 0:t.length)||0," grupos"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between sm:justify-end space-x-3 sm:space-x-6 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-blue-600 dark:text-blue-600 text-xs sm:text-sm leading-tight",children:["$",W(e.totalUsdBruto)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Bruto"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-green-600 dark:text-green-600 text-xs sm:text-sm leading-tight",children:["$",W(e.totalUsdModelo)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Modelos"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-purple-600 dark:text-purple-600 text-xs sm:text-sm leading-tight",children:["$",W(e.totalUsdSede)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:e.isAffiliate?"USD ".concat(e.sedeName.replace(" - Afiliado","")):"superadmin_aff"===r&&v?"USD ".concat(v):"USD ".concat(e.sedeName)})]})]})]})}),E.has(e.sedeId)&&(0,a.jsx)("div",{className:"bg-gray-50/30 dark:bg-gray-600/30 border-t border-gray-200/50 dark:border-gray-500/50",children:(0,a.jsx)("div",{className:"space-y-2 p-4",children:e.models.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white/60 rounded-lg border border-gray-200/40 hover:bg-white/80 transition-all duration-200",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500/10 to-indigo-500/10 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-semibold text-blue-600 dark:text-blue-600",children:e.email.charAt(0).toUpperCase()})}),(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"font-medium text-gray-800 dark:text-gray-800 text-sm",children:e.email})})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-xs",children:[(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-blue-600 dark:text-blue-600 leading-tight",children:["$",W(e.usdBruto)]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Bruto"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-green-600 dark:text-green-600 leading-tight",children:["$",W(e.usdModelo)]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"USD Modelo"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-purple-600 dark:text-purple-600 leading-tight",children:["$",W(e.usdSede)]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-600 dark:text-gray-500 leading-tight mt-0.5",children:"superadmin_aff"===r&&v?"USD ".concat(v):e.groupName?"USD ".concat(e.groupName):"USD Agencia"})]})]})]},e.modelId))})})]},e.sedeId)})}):(0,a.jsxs)("div",{className:"space-y-2 sm:space-y-3",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0 p-3 sm:p-4 bg-white/70 rounded-xl border border-gray-200/50",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[(0,a.jsx)("button",{onClick:()=>z(!U),className:"w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-br from-blue-500/10 to-indigo-500/10 rounded-lg flex items-center justify-center hover:bg-blue-500/20 transition-all duration-200 active:scale-95 touch-manipulation flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-blue-600 dark:text-blue-600 transition-transform duration-200 ".concat(U?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5l7 7-7 7"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-gray-800 dark:text-gray-800 text-sm sm:text-base",children:"admin"===r?"Mis Modelos (".concat(c.length,")"):"Todos los Modelos (".concat(c.length,")")}),(0,a.jsxs)("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-600 dark:text-gray-500",children:["Haz clic para ",U?"ocultar":"mostrar"," detalles"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between sm:justify-end space-x-3 sm:space-x-6 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-blue-600 dark:text-blue-600 text-xs sm:text-sm leading-tight",children:["$",W(c.reduce((e,r)=>e+r.usdBruto,0))]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 leading-tight mt-0.5",children:"USD Bruto"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-green-600 dark:text-green-600 text-xs sm:text-sm leading-tight",children:["$",W(c.reduce((e,r)=>e+r.usdModelo,0))]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 leading-tight mt-0.5",children:"USD Modelo"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-purple-600 dark:text-purple-600 text-xs sm:text-sm leading-tight",children:["$",W(c.reduce((e,r)=>e+r.usdSede,0))]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 leading-tight mt-0.5",children:(()=>{if(c.length>0){let e=c[0].groupName;if(c.every(r=>r.groupName===e)&&e)return"USD ".concat(e)}return"superadmin_aff"===r&&v?"USD ".concat(v):"USD Agencia"})()})]})]})]}),U&&(0,a.jsx)("div",{className:"space-y-2",children:c.map(e=>(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0 p-3 sm:p-4 bg-white/60 rounded-xl border border-gray-200/40 hover:bg-white/80 transition-all duration-200",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-br from-blue-500/10 to-indigo-500/10 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("span",{className:"text-xs font-semibold text-blue-600 dark:text-blue-600",children:e.email.charAt(0).toUpperCase()})}),(0,a.jsx)("div",{className:"min-w-0 flex-1",children:(0,a.jsx)("div",{className:"font-medium text-gray-800 dark:text-gray-800 text-xs sm:text-sm truncate",children:e.email})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between sm:justify-end space-x-3 sm:space-x-6 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-blue-600 dark:text-blue-600 text-xs sm:text-sm leading-tight",children:["$",W(e.usdBruto)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 leading-tight mt-0.5",children:"USD Bruto"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-green-600 dark:text-green-600 text-xs sm:text-sm leading-tight",children:["$",W(e.usdModelo)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 leading-tight mt-0.5",children:"USD Modelo"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end min-w-[80px]",children:[(0,a.jsxs)("div",{className:"font-semibold text-purple-600 dark:text-purple-600 text-xs sm:text-sm leading-tight",children:["$",W(e.usdSede)]}),(0,a.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 leading-tight mt-0.5",children:e.groupName?"USD ".concat(e.groupName):"superadmin_aff"===r&&v?"USD ".concat(v):"USD Sede"})]})]})]},e.modelId))})]})}):(0,a.jsxs)("div",{className:"text-center py-12 text-gray-400 dark:text-gray-500",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-100/60 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,a.jsx)("div",{className:"font-medium text-gray-600 dark:text-gray-600 dark:text-gray-500 mb-1",children:"No hay datos disponibles"}),(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-600 dark:text-gray-500",children:"No se encontraron modelos con datos para el per\xedodo seleccionado"})]})]})]})})}var o=t(4887),n=t(5922),c=t(9102),x=t.n(c),m=t(4930),u=t.n(m);t(1851);let g=u()(()=>Promise.all([t.e(9363),t.e(6233)]).then(t.t.bind(t,6233,23)),{loadableGenerated:{webpack:()=>[6233]},ssr:!1});function h(e){let{value:r,onChange:t,placeholder:l="Escribe el contenido aqu\xed...",className:d=""}=e,i=(0,s.useRef)(null),o=(0,s.useRef)(null),[c,m]=(0,s.useState)(!1),u=async e=>{if(e.size>4194304)return alert("El archivo es demasiado grande. El l\xedmite m\xe1ximo es 4MB. Por favor, comprime la imagen o usa una imagen m\xe1s peque\xf1a."),null;if(!["image/jpeg","image/png","image/gif","image/webp"].includes(e.type))return alert("Tipo de archivo no permitido. Use JPEG, PNG, GIF o WebP"),null;try{let r;m(!0);let{data:{session:t}}=await n.supabase.auth.getSession();if(!t)return alert("No hay sesi\xf3n activa"),null;let a=new FormData;a.append("file",e);let s=await fetch("/api/announcements/upload-image",{method:"POST",headers:{Authorization:"Bearer ".concat(t.access_token)},body:a});if(!s.ok){if(413===s.status)return alert("El archivo es demasiado grande. El l\xedmite m\xe1ximo es 4MB. Por favor, comprime la imagen o usa una imagen m\xe1s peque\xf1a."),null;let e="Error al subir la imagen";try{e=(await s.json()).error||e}catch(r){e="Error ".concat(s.status,": ").concat(s.statusText||"Error desconocido")}return alert(e),null}try{r=await s.json()}catch(e){return console.error("Error parseando respuesta JSON:",e),alert("Error al procesar la respuesta del servidor"),null}if(r.success&&r.url)return r.url;return alert("Error subiendo imagen: "+(r.error||"Error desconocido")),null}catch(e){return console.error("Error subiendo imagen:",e),alert("Error al subir la imagen. Por favor, verifica tu conexi\xf3n e intenta de nuevo."),null}finally{m(!1)}};return(0,s.useEffect)(()=>{if(!i.current)return;let e=()=>{var e;let r=null===(e=i.current)||void 0===e?void 0:e.querySelector(".ql-editor");return r&&r.__quill?r.__quill:null},r=setTimeout(()=>{let r=e();r&&!o.current&&(o.current=r,r.getModule("toolbar").addHandler("image",async()=>{let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{var r;let t=null===(r=e.files)||void 0===r?void 0:r[0];if(!t)return;let a=await u(t);if(a&&o.current){let e=o.current.getSelection(!0);o.current.insertEmbed(e.index,"image",a),o.current.setSelection(e.index+1)}}}))},100);return()=>clearTimeout(r)},[r]),(0,a.jsxs)("div",{ref:i,className:"jsx-fee70b83103a4bd6 "+"rich-text-editor relative ".concat(d),children:[c&&(0,a.jsx)("div",{style:{zIndex:9999},className:"jsx-fee70b83103a4bd6 absolute inset-0 bg-black/50 flex items-center justify-center z-50 rounded-lg",children:(0,a.jsx)("div",{className:"jsx-fee70b83103a4bd6 bg-white dark:bg-gray-800 px-4 py-2 rounded-lg shadow-lg",children:(0,a.jsxs)("div",{className:"jsx-fee70b83103a4bd6 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"jsx-fee70b83103a4bd6 animate-spin rounded-full h-4 w-4 border-b-2 border-purple-600"}),(0,a.jsx)("span",{className:"jsx-fee70b83103a4bd6 text-sm text-gray-700 dark:text-gray-300",children:"Subiendo imagen..."})]})})}),(0,a.jsx)(g,{theme:"snow",value:r,onChange:t,placeholder:l,modules:{toolbar:{container:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],[{align:[]}],["link","image","video"],["clean"]]},clipboard:{matchVisual:!1}},formats:["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","color","background","align","link","image","video"],className:"bg-white dark:bg-gray-800",style:{height:"400px"}}),(0,a.jsx)(x(),{id:"fee70b83103a4bd6",children:".rich-text-editor .ql-container{min-height:300px;font-size:14px;color:#1f2937}.dark .rich-text-editor .ql-container{color:#f3f4f6}.rich-text-editor .ql-editor{min-height:300px}.rich-text-editor .ql-stroke{stroke:#6b7280}.dark .rich-text-editor .ql-stroke{stroke:#9ca3af}.rich-text-editor .ql-fill{fill:#6b7280}.dark .rich-text-editor .ql-fill{fill:#9ca3af}.rich-text-editor .ql-picker-label{color:#6b7280}.dark .rich-text-editor .ql-picker-label{color:#9ca3af}.rich-text-editor .ql-toolbar{-webkit-border-top-left-radius:.5rem;-moz-border-radius-topleft:.5rem;border-top-left-radius:.5rem;-webkit-border-top-right-radius:.5rem;-moz-border-radius-topright:.5rem;border-top-right-radius:.5rem;border-bottom:1px solid#e5e7eb;background-color:#f9fafb}.dark .rich-text-editor .ql-toolbar{border-bottom-color:#4b5563;background-color:#374151}.rich-text-editor .ql-container{-webkit-border-bottom-left-radius:.5rem;-moz-border-radius-bottomleft:.5rem;border-bottom-left-radius:.5rem;-webkit-border-bottom-right-radius:.5rem;-moz-border-radius-bottomright:.5rem;border-bottom-right-radius:.5rem;border:1px solid#e5e7eb;background-color:#fff}.dark .rich-text-editor .ql-container{border-color:#4b5563;background-color:#1f2937}.rich-text-editor .ql-editor.ql-blank::before{color:#9ca3af;font-style:normal}.dark .rich-text-editor .ql-editor.ql-blank::before{color:#6b7280}.rich-text-editor .ql-editor img{max-width:100%;height:auto;-webkit-border-radius:.5rem;-moz-border-radius:.5rem;border-radius:.5rem;margin:1rem 0}"})]})}var p=t(883);function b(e){let{userId:r,userRole:t,userGroups:l}=e,[d,i]=(0,s.useState)([]),[o,c]=(0,s.useState)([]),[x,m]=(0,s.useState)([]),[u,g]=(0,s.useState)(!0),[h,b]=(0,s.useState)(!1),[y,v]=(0,s.useState)(null),[j,k]=(0,s.useState)("all"),[w,N]=(0,s.useState)("all");(0,s.useEffect)(()=>{_()},[r,t,l]);let _=async()=>{try{g(!0);let{data:{session:e}}=await n.supabase.auth.getSession();if(!e)return;let r=e.access_token,a=await fetch("/api/announcements?limit=100&userRole=".concat(t),{headers:{Authorization:"Bearer ".concat(r)}}),s=await a.json();s.success&&i(s.data||[]);let d=await fetch("/api/announcements/categories"),o=await d.json();o.success&&c(o.data||[]);let x=await fetch("/api/groups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userRole:t,userGroups:l})}),u=await x.json();u.success&&m(u.groups||[])}catch(e){console.error("Error cargando datos:",e)}finally{g(!1)}},S=async e=>{if(confirm("\xbfEst\xe1s seguro de eliminar esta publicaci\xf3n?"))try{let{data:{session:r}}=await n.supabase.auth.getSession();if(!r)return;let t=await fetch("/api/announcements/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r.access_token)}}),a=await t.json();a.success?await _():alert("Error: "+a.error)}catch(e){console.error("Error eliminando:",e),alert("Error al eliminar la publicaci\xf3n")}},D=async e=>{try{let{data:{session:r}}=await n.supabase.auth.getSession();if(!r)return;let t=await fetch("/api/announcements/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.access_token)},body:JSON.stringify({is_published:!e.is_published})}),a=await t.json();a.success?await _():alert("Error: "+a.error)}catch(e){console.error("Error actualizando:",e),alert("Error al actualizar la publicaci\xf3n")}},C=d.filter(e=>{var r;return("published"!==j||!!e.is_published)&&("draft"!==j||!e.is_published)&&("all"===w||(null===(r=e.category)||void 0===r?void 0:r.id)===w)});return(0,a.jsxs)("div",{className:"relative bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl p-3 sm:p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0 mb-4 sm:mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h2",{className:"text-sm sm:text-lg font-semibold text-gray-900 dark:text-white",children:"Corcho Informativo"}),(0,a.jsx)("p",{className:"text-[10px] sm:text-sm text-gray-600 dark:text-gray-300 hidden sm:block",children:"Gestiona publicaciones e informaci\xf3n para modelos"})]})]}),(0,a.jsxs)("button",{onClick:()=>{v(null),b(!0)},className:"w-full sm:w-auto px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg hover:from-purple-600 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 flex items-center justify-center gap-1.5 sm:gap-2 active:scale-95 touch-manipulation",children:[(0,a.jsx)("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Nueva Publicaci\xf3n"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Nueva"})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 sm:gap-3 mb-4 sm:mb-6",children:[(0,a.jsxs)("div",{className:"flex gap-1.5 sm:gap-2",children:[(0,a.jsx)("button",{onClick:()=>k("all"),className:"px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-medium rounded-lg transition-colors active:scale-95 touch-manipulation ".concat("all"===j?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300":"bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-500"),children:"Todas"}),(0,a.jsx)("button",{onClick:()=>k("published"),className:"px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-medium rounded-lg transition-colors active:scale-95 touch-manipulation ".concat("published"===j?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-500"),children:"Publicadas"}),(0,a.jsx)("button",{onClick:()=>k("draft"),className:"px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-medium rounded-lg transition-colors active:scale-95 touch-manipulation ".concat("draft"===j?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300":"bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-500"),children:"Borradores"})]}),(0,a.jsx)(p.Z,{options:[{value:"all",label:"Todas las categor\xedas"},...o.map(e=>({value:e.id,label:e.name}))],value:w,onChange:e=>N(e),placeholder:"Todas las categor\xedas",className:"text-xs"})]}),u?(0,a.jsx)("div",{className:"flex items-center justify-center py-8 sm:py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-purple-600"})}):0===C.length?(0,a.jsx)("div",{className:"text-center py-8 sm:py-12 text-gray-500 dark:text-gray-400",children:(0,a.jsxs)("p",{className:"text-xs sm:text-sm",children:["No hay publicaciones ","all"!==j?"(".concat("published"===j?"publicadas":"borradores",")"):""]})}):(0,a.jsx)("div",{className:"space-y-3 sm:space-y-4",children:C.map(e=>{var r;return(0,a.jsx)("div",{className:"bg-gray-50/50 dark:bg-gray-600/30 rounded-lg p-3 sm:p-4 border border-gray-200/50 dark:border-gray-500/30 hover:border-purple-300 dark:hover:border-purple-500/50 transition-all",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center flex-wrap gap-1.5 sm:gap-2 mb-1.5 sm:mb-2",children:[e.is_pinned&&(0,a.jsx)("span",{className:"text-[10px] sm:text-xs text-purple-600 dark:text-purple-400",children:"\uD83D\uDCCC"}),e.priority>0&&(0,a.jsx)("span",{className:"text-[10px] sm:text-xs px-1 sm:px-1.5 py-0.5 rounded ".concat(2===e.priority?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300"),children:2===e.priority?"Urgente":"Alta"}),e.category&&(0,a.jsx)("span",{className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 rounded font-medium",style:{backgroundColor:"".concat(e.category.color,"20"),color:e.category.color},children:e.category.name}),!e.is_published&&(0,a.jsx)("span",{className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 rounded bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300",children:"Borrador"})]}),(0,a.jsx)("h3",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-white mb-1",children:e.title}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mb-2",children:e.excerpt}),(0,a.jsxs)("div",{className:"flex items-center flex-wrap gap-2 sm:gap-4 text-[10px] sm:text-xs text-gray-500 dark:text-gray-400",children:[(0,a.jsxs)("span",{children:["Por: ",(null===(r=e.author)||void 0===r?void 0:r.name)||"Desconocido"]}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"•"}),(0,a.jsx)("span",{children:new Date(e.created_at).toLocaleDateString("es-CO")}),e.is_published&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"•"}),(0,a.jsxs)("span",{children:[e.views_count," vistas"]})]}),e.is_general?(0,a.jsx)("span",{className:"text-purple-600 dark:text-purple-400",children:"General"}):(0,a.jsxs)("span",{children:[e.group_targets.length," grupo(s)"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end sm:justify-start gap-1.5 sm:gap-2 flex-shrink-0",children:[(0,a.jsx)("button",{onClick:()=>{v(e),b(!0)},className:"p-1.5 sm:p-2 text-gray-600 dark:text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-colors active:scale-95 touch-manipulation",title:"Editar",children:(0,a.jsx)("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:()=>D(e),className:"p-1.5 sm:p-2 rounded-lg transition-colors active:scale-95 touch-manipulation ".concat(e.is_published?"text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-600"),title:e.is_published?"Despublicar":"Publicar",children:(0,a.jsx)("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.is_published?(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}):(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(0,a.jsx)("button",{onClick:()=>S(e.id),className:"p-1.5 sm:p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors active:scale-95 touch-manipulation",title:"Eliminar",children:(0,a.jsx)("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},e.id)})}),h&&(0,a.jsx)(f,{announcement:y,categories:o,groups:"super_admin"===t?x:x.filter(e=>l.includes(e.id)),userId:r,userRole:t,onClose:()=>{b(!1),v(null)},onSave:()=>{b(!1),v(null),_()}})]})}function f(e){var r;let{announcement:t,categories:l,groups:d,userId:i,userRole:c,onClose:x,onSave:m}=e,[u,g]=(0,s.useState)({title:(null==t?void 0:t.title)||"",content:(null==t?void 0:t.content)||"",excerpt:(null==t?void 0:t.excerpt)||"",category_id:(null==t?void 0:null===(r=t.category)||void 0===r?void 0:r.id)||"",featured_image_url:(null==t?void 0:t.featured_image_url)||"",is_general:(null==t?void 0:t.is_general)||!1,group_ids:(null==t?void 0:t.group_targets.map(e=>e.id))||[],target_roles:(null==t?void 0:t.target_roles)||[],is_published:(null==t?void 0:t.is_published)===void 0||t.is_published,is_pinned:(null==t?void 0:t.is_pinned)||!1,priority:(null==t?void 0:t.priority)||0,expires_at:(null==t?void 0:t.expires_at)?t.expires_at.split("T")[0]:"",share_with_affiliates:(null==t?void 0:t.share_with_affiliates)||!1}),[b,f]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),j=async e=>{var r;let t=null===(r=e.target.files)||void 0===r?void 0:r[0];if(t){if(t.size>4194304){alert("El archivo es demasiado grande. El l\xedmite m\xe1ximo es 4MB. Por favor, comprime la imagen o usa una imagen m\xe1s peque\xf1a.");return}try{let e;v(!0);let{data:{session:r}}=await n.supabase.auth.getSession();if(!r)return;let a=new FormData;a.append("file",t);let s=await fetch("/api/announcements/upload-image",{method:"POST",headers:{Authorization:"Bearer ".concat(r.access_token)},body:a});if(!s.ok){if(413===s.status){alert("El archivo es demasiado grande. El l\xedmite m\xe1ximo es 4MB. Por favor, comprime la imagen o usa una imagen m\xe1s peque\xf1a.");return}let e="Error al subir la imagen";try{e=(await s.json()).error||e}catch(r){e="Error ".concat(s.status,": ").concat(s.statusText||"Error desconocido")}alert(e);return}try{e=await s.json()}catch(e){console.error("Error parseando respuesta JSON:",e),alert("Error al procesar la respuesta del servidor");return}e.success?g(r=>({...r,featured_image_url:e.url})):alert("Error subiendo imagen: "+(e.error||"Error desconocido"))}catch(e){console.error("Error subiendo imagen:",e),alert("Error al subir la imagen. Por favor, verifica tu conexi\xf3n e intenta de nuevo.")}finally{v(!1)}}},k=async e=>{if(e.preventDefault(),!u.title||!u.content){alert("T\xedtulo y contenido son requeridos");return}try{f(!0);let{data:{session:e}}=await n.supabase.auth.getSession();if(!e)return;let r={title:u.title,content:u.content,excerpt:u.excerpt||u.title.substring(0,150),category_id:u.category_id||null,featured_image_url:u.featured_image_url||null,is_general:u.is_general,group_ids:u.is_general?[]:u.group_ids,target_roles:"super_admin"===c?u.target_roles:[],is_published:u.is_published,is_pinned:u.is_pinned,priority:u.priority,expires_at:u.expires_at||null};"super_admin"===c&&(r.share_with_affiliates=u.share_with_affiliates);let a=t?"/api/announcements/".concat(t.id):"/api/announcements",s=await fetch(a,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.access_token)},body:JSON.stringify(r)}),l=await s.json();l.success?m():alert("Error: "+l.error)}catch(e){console.error("Error guardando:",e),alert("Error al guardar la publicaci\xf3n")}finally{f(!1)}},[w,N]=(0,s.useState)(!1);if((0,s.useEffect)(()=>(N(!0),document.body.style.overflow="hidden",()=>{N(!1),document.body.style.overflow=""}),[]),!w)return null;let _=(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 transition-opacity duration-200 p-4",onClick:x,style:{position:"fixed",zIndex:99999999,top:0,left:0,right:0,bottom:0},children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-2xl shadow-xl w-full max-w-3xl max-h-[calc(100vh-2rem)] flex flex-col transform transition-all duration-200 ease-out",style:{zIndex:2,position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-600 px-7 py-5 flex items-center justify-between z-10 rounded-t-2xl",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t?"Editar Publicaci\xf3n":"Nueva Publicaci\xf3n"}),(0,a.jsx)("button",{onClick:x,className:"text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"Cerrar",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"overflow-y-auto flex-1",children:(0,a.jsxs)("form",{onSubmit:k,className:"p-7 space-y-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"T\xedtulo *"}),(0,a.jsx)("input",{type:"text",value:u.title,onChange:e=>g(r=>({...r,title:e.target.value})),className:"apple-input",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Contenido *"}),(0,a.jsx)(h,{value:u.content,onChange:e=>g(r=>({...r,content:e})),placeholder:"Escribe el contenido de la publicaci\xf3n aqu\xed. Puedes usar las herramientas de formato, insertar im\xe1genes, enlaces, etc."}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"\uD83D\uDCA1 Puedes insertar im\xe1genes directamente desde el editor usando el bot\xf3n de imagen"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Resumen (opcional)"}),(0,a.jsx)("textarea",{value:u.excerpt,onChange:e=>g(r=>({...r,excerpt:e.target.value})),rows:2,className:"apple-input",placeholder:"Se generar\xe1 autom\xe1ticamente si se deja vac\xedo"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Categor\xeda"}),(0,a.jsx)(p.Z,{options:[{value:"",label:"Sin categor\xeda"},...l.map(e=>({value:e.id,label:e.name}))],value:u.category_id||"",onChange:e=>g(r=>({...r,category_id:e||""})),placeholder:"Sin categor\xeda"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Prioridad"}),(0,a.jsx)(p.Z,{options:[{value:"0",label:"Normal"},{value:"1",label:"Alta"},{value:"2",label:"Urgente"}],value:u.priority.toString(),onChange:e=>g(r=>({...r,priority:parseInt(e)})),placeholder:"Normal"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Imagen destacada"}),u.featured_image_url&&(0,a.jsx)("img",{src:u.featured_image_url,alt:"Preview",className:"w-full h-48 object-cover rounded-lg mb-2"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:j,disabled:y,className:"apple-input file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100 dark:file:bg-purple-900/30 dark:file:text-purple-300 cursor-pointer"}),y&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Subiendo..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 mb-2 cursor-pointer group",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"checkbox",checked:u.is_general,onChange:e=>g(r=>({...r,is_general:e.target.checked,group_ids:e.target.checked?[]:r.group_ids})),className:"sr-only"}),(0,a.jsx)("div",{className:"w-7 h-4 rounded-full transition-all duration-200 ease-in-out ".concat(u.is_general?"bg-gradient-to-r from-blue-500 to-indigo-600 dark:from-blue-600 dark:to-indigo-700 shadow-inner":"bg-gray-300 dark:bg-gray-600"," group-hover:shadow-md"),children:(0,a.jsx)("div",{className:"w-3.5 h-3.5 bg-white rounded-full shadow-sm transform transition-all duration-200 ease-in-out ".concat(u.is_general?"translate-x-3":"translate-x-0.5"," ").concat(u.is_general?"shadow-blue-200/50":""),style:{marginTop:"2px"}})})]}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Publicaci\xf3n general (todos los grupos)"})]}),(!u.is_general||"super_admin"===c)&&(0,a.jsxs)("div",{className:"mt-1 grid grid-cols-1 md:grid-cols-2 gap-4 items-start",children:[!u.is_general&&(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 h-6 flex items-center",children:"Grupos objetivo"}),(0,a.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-lg p-2",children:d.map(e=>{let r=u.group_ids.includes(e.id);return(0,a.jsxs)("label",{className:"flex items-center space-x-2 py-1 cursor-pointer group",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"checkbox",checked:r,onChange:r=>{r.target.checked?g(r=>({...r,group_ids:[...r.group_ids,e.id]})):g(r=>({...r,group_ids:r.group_ids.filter(r=>r!==e.id)}))},className:"sr-only"}),(0,a.jsx)("div",{className:"w-7 h-4 rounded-full transition-all duration-200 ease-in-out ".concat(r?"bg-gradient-to-r from-blue-500 to-indigo-600 dark:from-blue-600 dark:to-indigo-700 shadow-inner":"bg-gray-300 dark:bg-gray-600"," group-hover:shadow-md"),children:(0,a.jsx)("div",{className:"w-3.5 h-3.5 bg-white rounded-full shadow-sm transform transition-all duration-200 ease-in-out ".concat(r?"translate-x-3":"translate-x-0.5"," ").concat(r?"shadow-blue-200/50":""),style:{marginTop:"2px"}})})]}),(0,a.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.name})]},e.id)})})]}),"super_admin"===c&&(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 h-6 flex items-center",children:"Roles objetivo (opcional)"}),(0,a.jsxs)("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg p-2",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 py-1 cursor-pointer group",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"checkbox",checked:u.target_roles.includes("admin"),onChange:e=>{e.target.checked?g(e=>({...e,target_roles:[...e.target_roles,"admin"]})):g(e=>({...e,target_roles:e.target_roles.filter(e=>"admin"!==e)}))},className:"sr-only"}),(0,a.jsx)("div",{className:"w-7 h-4 rounded-full transition-all duration-200 ease-in-out ".concat(u.target_roles.includes("admin")?"bg-gradient-to-r from-blue-500 to-indigo-600 dark:from-blue-600 dark:to-indigo-700 shadow-inner":"bg-gray-300 dark:bg-gray-600"," group-hover:shadow-md"),children:(0,a.jsx)("div",{className:"w-3.5 h-3.5 bg-white rounded-full shadow-sm transform transition-all duration-200 ease-in-out ".concat(u.target_roles.includes("admin")?"translate-x-3":"translate-x-0.5"," ").concat(u.target_roles.includes("admin")?"shadow-blue-200/50":""),style:{marginTop:"2px"}})})]}),(0,a.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Admin"})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-2 py-1 cursor-pointer group",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"checkbox",checked:u.target_roles.includes("super_admin"),onChange:e=>{e.target.checked?g(e=>({...e,target_roles:[...e.target_roles,"super_admin"]})):g(e=>({...e,target_roles:e.target_roles.filter(e=>"super_admin"!==e)}))},className:"sr-only"}),(0,a.jsx)("div",{className:"w-7 h-4 rounded-full transition-all duration-200 ease-in-out ".concat(u.target_roles.includes("super_admin")?"bg-gradient-to-r from-blue-500 to-indigo-600 dark:from-blue-600 dark:to-indigo-700 shadow-inner":"bg-gray-300 dark:bg-gray-600"," group-hover:shadow-md"),children:(0,a.jsx)("div",{className:"w-3.5 h-3.5 bg-white rounded-full shadow-sm transform transition-all duration-200 ease-in-out ".concat(u.target_roles.includes("super_admin")?"translate-x-3":"translate-x-0.5"," ").concat(u.target_roles.includes("super_admin")?"shadow-blue-200/50":""),style:{marginTop:"2px"}})})]}),(0,a.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Super Admin"})]})]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer group",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"checkbox",checked:u.is_pinned,onChange:e=>g(r=>({...r,is_pinned:e.target.checked})),className:"sr-only"}),(0,a.jsx)("div",{className:"w-7 h-4 rounded-full transition-all duration-200 ease-in-out ".concat(u.is_pinned?"bg-gradient-to-r from-blue-500 to-indigo-600 dark:from-blue-600 dark:to-indigo-700 shadow-inner":"bg-gray-300 dark:bg-gray-600"," group-hover:shadow-md"),children:(0,a.jsx)("div",{className:"w-3.5 h-3.5 bg-white rounded-full shadow-sm transform transition-all duration-200 ease-in-out ".concat(u.is_pinned?"translate-x-3":"translate-x-0.5"," ").concat(u.is_pinned?"shadow-blue-200/50":""),style:{marginTop:"2px"}})})]}),(0,a.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Fijar en la parte superior"})]}),"super_admin"===c&&(0,a.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer group",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"checkbox",checked:u.share_with_affiliates,onChange:e=>g(r=>({...r,share_with_affiliates:e.target.checked})),className:"sr-only"}),(0,a.jsx)("div",{className:"w-7 h-4 rounded-full transition-all duration-200 ease-in-out ".concat(u.share_with_affiliates?"bg-gradient-to-r from-green-500 to-emerald-600 dark:from-green-600 dark:to-emerald-700 shadow-inner":"bg-gray-300 dark:bg-gray-600"," group-hover:shadow-md"),children:(0,a.jsx)("div",{className:"w-3.5 h-3.5 bg-white rounded-full shadow-sm transform transition-all duration-200 ease-in-out ".concat(u.share_with_affiliates?"translate-x-3":"translate-x-0.5"," ").concat(u.share_with_affiliates?"shadow-green-200/50":""),style:{marginTop:"2px"}})})]}),(0,a.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Compartir con estudios afiliados"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Fecha de expiraci\xf3n (opcional)"}),(0,a.jsx)("input",{type:"date",value:u.expires_at,onChange:e=>g(r=>({...r,expires_at:e.target.value})),className:"apple-input"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("button",{type:"button",onClick:x,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-all duration-200",children:"Cancelar"}),(0,a.jsx)("button",{type:"submit",disabled:b,className:"px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg hover:from-purple-600 hover:to-purple-700 focus:ring-2 focus:ring-purple-500/20 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 shadow-md hover:shadow-lg",children:b?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,a.jsx)("span",{children:"Guardando..."})]}):(0,a.jsx)("span",{children:"Guardar"})})]})]})})]})});return(0,o.createPortal)(_,document.body)}var y=t(2507);function v(e){var r,t,l,d,i,o,n,c;let{userId:x,userRole:m,groupId:u}=e,[g,h]=(0,s.useState)(!1),[p,b]=(0,s.useState)(null),[f,v]=(0,s.useState)(null),[j,k]=(0,s.useState)(null),[w,N]=(0,s.useState)(!1),[_,S]=(0,s.useState)(!1),[D,C]=(0,s.useState)(!1),[L,E]=(0,s.useState)(!1),[M,A]=(0,s.useState)(!1),[B,U]=(0,s.useState)(!1),[z,P]=(0,s.useState)(!1),[I,R]=(0,s.useState)(null),[O,T]=(0,s.useState)(null),[W,q]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(H(),(0,y.Ck)()){F(),$();let e=setInterval(()=>{F(),$()},3e4);return()=>clearInterval(e)}},[]);let H=()=>{let e=(0,y.Ck)();h(e),e&&b((0,y.sF)())},F=async()=>{try{P(!0);let e=(0,y.sF)(),r=await fetch("/api/calculator/period-closure/archive-period?periodDate=".concat(e.periodDate)),t=await r.json();t.success&&(v(t),t.archived&&!I&&console.log("Archivo hist\xf3rico ya existe (ejecutado por otro admin)"))}catch(e){console.error("Error loading archive status:",e)}finally{P(!1)}},$=async()=>{try{P(!0);let e=await fetch("/api/calculator/period-closure/cleanup-period?userId=".concat(x)),r=await e.json();r.success&&(k(r),r.stats&&0===r.stats.total_records_in_values&&console.log("Limpieza ya ejecutada (por este u otro admin)"))}catch(e){console.error("Error loading cleanup validation:",e)}finally{P(!1)}},V=async()=>{E(!0),q(null),R(null);try{let e=await fetch("/api/calculator/period-closure/archive-period",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:x,groupId:u})}),r=await e.json();if(!r.success)throw Error(r.error||"Error desconocido");R(r),N(!1),await F(),await $()}catch(e){q(e.message)}finally{E(!1)}},G=async()=>{A(!0),q(null),T(null);try{let e=await fetch("/api/calculator/period-closure/cleanup-period",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:x,groupId:u})}),r=await e.json();if(!r.success)throw Error(r.error||"Error desconocido");T(r),S(!1),await F(),await $()}catch(e){q(e.message)}finally{A(!1)}};return g?(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-950/30 dark:to-purple-950/30 rounded-xl border border-indigo-200 dark:border-indigo-800 shadow-lg p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center shadow-md",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"\uD83D\uDD12 Cierre Manual de Per\xedodo"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Per\xedodo a cerrar: ",(0,a.jsx)("span",{className:"font-semibold",children:null==p?void 0:p.periodType})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[z&&(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400",children:[(0,a.jsx)("div",{className:"w-3 h-3 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}),"Verificando..."]}),!z&&(null==f?void 0:f.archived)&&(0,a.jsx)("span",{className:"px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"✅ Archivado"}),!z&&(null==j?void 0:j.can_cleanup)&&(null==j?void 0:null===(r=j.stats)||void 0===r?void 0:r.total_records_in_values)>0&&(0,a.jsx)("span",{className:"px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"⚠️ Pendiente limpieza"}),!z&&(null==j?void 0:null===(t=j.stats)||void 0===t?void 0:t.total_records_in_values)===0&&(null==f?void 0:f.archived)&&(0,a.jsx)("span",{className:"px-3 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:"\uD83C\uDF89 Completado"})]})]}),W&&(0,a.jsx)("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-red-800 dark:text-red-400",children:["❌ ",W]})}),I&&!W&&(0,a.jsxs)("div",{className:"mb-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-green-800 dark:text-green-400 font-semibold mb-2",children:"✅ Archivo hist\xf3rico creado exitosamente por ti"}),(0,a.jsxs)("div",{className:"text-xs text-green-700 dark:text-green-300 space-y-1",children:[(0,a.jsxs)("p",{children:["• Modelos archivadas: ",I.models_archived]}),(0,a.jsxs)("p",{children:["• Tiempo de ejecuci\xf3n: ",(I.execution_time_ms/1e3).toFixed(2),"s"]}),I.partial&&(0,a.jsxs)("p",{className:"text-yellow-700 dark:text-yellow-400 font-semibold",children:["⚠️ ",I.partial.models_failed," modelos fallaron. Revisa el log."]})]})]}),!I&&(null==f?void 0:f.archived)&&(null==f?void 0:f.last_log)&&(0,a.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-400 font-semibold mb-2",children:"ℹ️ Archivo hist\xf3rico ya creado"}),(0,a.jsxs)("div",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1",children:[(0,a.jsxs)("p",{children:["• Ejecutado por: ",f.last_log.user_email||"Admin"]}),(0,a.jsxs)("p",{children:["• Fecha: ",new Date(f.last_log.timestamp).toLocaleString("es-CO")]}),f.last_log.models_affected&&(0,a.jsxs)("p",{children:["• Modelos archivadas: ",f.last_log.models_affected]})]})]}),O&&!W&&(0,a.jsxs)("div",{className:"mb-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-green-800 dark:text-green-400 font-semibold mb-2",children:"\uD83C\uDF89 Limpieza completada por ti - Nuevo per\xedodo iniciado"}),(0,a.jsxs)("div",{className:"text-xs text-green-700 dark:text-green-300 space-y-1",children:[(0,a.jsxs)("p",{children:["• Registros archivados: ",O.records_archived]}),(0,a.jsxs)("p",{children:["• Totales reseteados: ",O.totals_reset]}),(0,a.jsx)("p",{children:"• Calculadoras descongeladas: ✅"})]})]}),!O&&(null==j?void 0:null===(l=j.stats)||void 0===l?void 0:l.total_records_in_values)===0&&(null==f?void 0:f.archived)&&(0,a.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-400 font-semibold mb-2",children:"ℹ️ Per\xedodo ya cerrado y limpiado"}),(0,a.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"El proceso de cierre ya fue completado. Las calculadoras est\xe1n listas para el nuevo per\xedodo."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)("button",{onClick:()=>N(!0),disabled:(null==f?void 0:f.archived)||(null==f?void 0:f.in_progress)||L||z,title:(null==f?void 0:f.archived)?"Archivo ya creado por "+((null==f?void 0:null===(d=f.last_log)||void 0===d?void 0:d.user_email)||"otro admin"):"",className:"relative group p-4 rounded-lg border-2 transition-all duration-200 ".concat((null==f?void 0:f.archived)?"bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-700 cursor-not-allowed opacity-60":"bg-white dark:bg-gray-900 border-indigo-300 dark:border-indigo-700 hover:border-indigo-500 hover:shadow-lg cursor-pointer"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center ".concat((null==f?void 0:f.archived)?"bg-gray-300 dark:bg-gray-700":"bg-gradient-to-br from-indigo-500 to-purple-600"),children:(null==f?void 0:f.archived)?(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):(0,a.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})})}),(0,a.jsxs)("div",{className:"flex-1 text-left",children:[(0,a.jsx)("h4",{className:"text-sm font-bold text-gray-900 dark:text-white",children:"Paso 1: Crear Archivo"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:(null==f?void 0:f.archived)?"Completado ✅":(null==f?void 0:f.in_progress)?"En progreso...":"Archivar datos del per\xedodo"})]})]})}),(0,a.jsx)("button",{onClick:()=>S(!0),disabled:!(null==j?void 0:j.can_cleanup)||M||z||(null==j?void 0:null===(i=j.stats)||void 0===i?void 0:i.total_records_in_values)===0,title:(null==j?void 0:null===(o=j.stats)||void 0===o?void 0:o.total_records_in_values)===0?"Limpieza ya ejecutada":(null==j?void 0:j.can_cleanup)?"":"Debes ejecutar el Paso 1 primero",className:"relative group p-4 rounded-lg border-2 transition-all duration-200 ".concat((null==j?void 0:j.can_cleanup)&&(null==j?void 0:null===(n=j.stats)||void 0===n?void 0:n.total_records_in_values)!==0?"bg-white dark:bg-gray-900 border-purple-300 dark:border-purple-700 hover:border-purple-500 hover:shadow-lg cursor-pointer":"bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-700 cursor-not-allowed opacity-60"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center ".concat(O?"bg-gray-300 dark:bg-gray-700":(null==j?void 0:j.can_cleanup)?"bg-gradient-to-br from-purple-500 to-pink-600":"bg-gray-300 dark:bg-gray-700"),children:O?(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):(0,a.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(0,a.jsxs)("div",{className:"flex-1 text-left",children:[(0,a.jsx)("h4",{className:"text-sm font-bold text-gray-900 dark:text-white",children:"Paso 2: Limpiar"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:(null==j?void 0:null===(c=j.stats)||void 0===c?void 0:c.total_records_in_values)===0?"Completado ✅":(null==j?void 0:j.can_cleanup)?"Resetear y descongelar":"Requiere paso 1"})]})]})}),(0,a.jsx)("button",{onClick:()=>C(!0),disabled:!(null==f?void 0:f.archived)||B,className:"relative group p-4 rounded-lg border-2 border-red-300 dark:border-red-700 bg-white dark:bg-gray-900 hover:border-red-500 hover:shadow-lg transition-all duration-200 disabled:bg-gray-100 disabled:border-gray-300 disabled:cursor-not-allowed",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center bg-gradient-to-br from-red-500 to-orange-600",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,a.jsxs)("div",{className:"flex-1 text-left",children:[(0,a.jsx)("h4",{className:"text-sm font-bold text-gray-900 dark:text-white",children:"\uD83D\uDEA8 Restaurar"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Solo emergencias"})]})]})})]}),j&&!j.can_cleanup&&j.validation_errors.length>0&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-yellow-800 dark:text-yellow-400 mb-2",children:"⚠️ No se puede ejecutar la limpieza:"}),(0,a.jsx)("ul",{className:"text-xs text-yellow-700 dark:text-yellow-300 space-y-1 list-disc list-inside",children:j.validation_errors.map((e,r)=>(0,a.jsx)("li",{children:e},r))})]})]}),w&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-md w-full p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"\uD83D\uDCE6 Confirmar Creaci\xf3n de Archivo Hist\xf3rico"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:["Se crear\xe1 el archivo hist\xf3rico del per\xedodo ",(0,a.jsx)("strong",{children:null==p?void 0:p.periodType}),". Este proceso puede tardar varios minutos."]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-500 mb-6",children:"⚠️ Una vez iniciado, no se puede cancelar. Aseg\xfarate de que todas las modelos hayan terminado de ingresar sus valores."}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>N(!1),disabled:L,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 disabled:opacity-50",children:"Cancelar"}),(0,a.jsx)("button",{onClick:V,disabled:L,className:"flex-1 px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg hover:from-indigo-600 hover:to-purple-700 disabled:opacity-50 flex items-center justify-center gap-2",children:L?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Archivando..."]}):"Confirmar"})]})]})}),_&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-md w-full p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"\uD83E\uDDF9 Confirmar Limpieza y Reseteo"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Se realizar\xe1n las siguientes acciones:"}),(0,a.jsxs)("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-2 mb-6 list-disc list-inside",children:[(0,a.jsx)("li",{children:"Los datos se mover\xe1n a la tabla de archivo"}),(0,a.jsx)("li",{children:"Las calculadoras se resetear\xe1n a 0.00"}),(0,a.jsx)("li",{children:"Se descongelar\xe1n todas las calculadoras"}),(0,a.jsxs)("li",{children:["Se iniciar\xe1 el per\xedodo ",(0,a.jsx)("strong",{children:(0,y.ns)().periodType})]})]}),(0,a.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400 mb-6 font-semibold",children:"⚠️ Esta acci\xf3n es irreversible. Aseg\xfarate de que el archivado se complet\xf3 correctamente."}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>S(!1),disabled:M,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 disabled:opacity-50",children:"Cancelar"}),(0,a.jsx)("button",{onClick:G,disabled:M,className:"flex-1 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 disabled:opacity-50 flex items-center justify-center gap-2",children:M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Limpiando..."]}):"Confirmar"})]})]})}),D&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-md w-full p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-red-600 dark:text-red-400 mb-4",children:"\uD83D\uDEA8 Restaurar Per\xedodo (Emergencia)"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:"Esta funci\xf3n est\xe1 reservada para situaciones de emergencia. Contacta al desarrollador para implementar la restauraci\xf3n."}),(0,a.jsx)("button",{onClick:()=>C(!1),className:"w-full px-4 py-2 bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-600",children:"Cerrar"})]})})]}):null}function j(){var e;let[r,l]=(0,s.useState)({totalSedes:0,totalRooms:0,totalModelos:0,asignacionesActivas:0,sedesConRooms:0,sedesSinRooms:0}),[d,o]=(0,s.useState)(!1),[n,c]=(0,s.useState)(""),[x,m]=(0,s.useState)(""),[u,g]=(0,s.useState)("P1"),[h,p]=(0,s.useState)(""),[f,y]=(0,s.useState)(!0),[j,k]=(0,s.useState)(null),[w,N]=(0,s.useState)("admin"),[_,S]=(0,s.useState)([]),[D,C]=(0,s.useState)(""),[L,E]=(0,s.useState)(""),[M,A]=(0,s.useState)(null),[B,U]=(0,s.useState)(!1),[z,P]=(0,s.useState)([]),[I,R]=(0,s.useState)(null),[O,T]=(0,s.useState)(!1),[W,q]=(0,s.useState)(!1),[H,F]=(0,s.useState)(null),[$,V]=(0,s.useState)({eur_usd:"",gbp_usd:"",usd_cop:""}),[G,J]=(0,s.useState)(!1),[Y,Z]=(0,s.useState)(null),K=e=>["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][parseInt(e)-1]||"",Q=()=>{let e;if(!n||!x)return;let r=parseInt(x),t=parseInt(n);e="P1"===u?15:new Date(r,t,0).getDate(),p("".concat(r,"-").concat(String(t).padStart(2,"0"),"-").concat(String(e).padStart(2,"0")))};(0,s.useEffect)(()=>{window.scrollTo(0,0),X();let e=e=>{var r;let t=(null===(r=e.reason)||void 0===r?void 0:r.message)||"";if(t.includes("message channel closed")||t.includes("listener indicated an asynchronous response")||t.includes("Extension context invalidated")){e.preventDefault(),console.debug("Error de extensi\xf3n del navegador silenciado:",t);return}};return window.addEventListener("unhandledrejection",e),()=>{window.removeEventListener("unhandledrejection",e)}},[]),(0,s.useEffect)(()=>{n&&x&&u&&Q()},[n,x,u]),(0,s.useEffect)(()=>{I&&setTimeout(()=>{let e=document.querySelector(".dropdown-container");e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)},[I]),(0,s.useEffect)(()=>{if(!I)return;let e=e=>{try{let r=e.target;I&&!r.closest(".dropdown-container")&&R(null)}catch(e){console.debug("Error en handleClickOutside (probablemente extensi\xf3n del navegador):",e)}};return document.addEventListener("mousedown",e,{capture:!0}),()=>{document.removeEventListener("mousedown",e,{capture:!0})}},[I]),(0,s.useEffect)(()=>{w&&_.length>=0&&ea()},[w,_]),(0,s.useEffect)(()=>{L&&z.length>0&&et(L)},[L,z]);let X=()=>{try{let r=localStorage.getItem("user");if(r){var e;let t=JSON.parse(r);N(t.role||"admin"),S((null===(e=t.groups)||void 0===e?void 0:e.map(e=>e.id))||[]),C(t.id||"")}}catch(e){console.warn("Error parsing user data from localStorage:",e)}},ee=async(e,r)=>{try{var a,s,l,d,i,o;q(!0),Z(null);let{createClient:n}=await Promise.resolve().then(t.bind(t,5257)),c=(await Promise.resolve().then(t.bind(t,5922))).supabase,{data:{session:x}}=await c.auth.getSession(),m=null==x?void 0:x.access_token;if(!m){Z("Sesi\xf3n no v\xe1lida");return}let u=await fetch("/api/admin/calculator-history/update-period-rates?period_date=".concat(e,"&period_type=").concat(r),{headers:{Authorization:"Bearer ".concat(m)}}),g=await u.json();if(!g.success){Z(g.error||"Error al cargar informaci\xf3n del per\xedodo");return}F(g),V({eur_usd:(null===(s=g.current_rates)||void 0===s?void 0:null===(a=s.eur_usd)||void 0===a?void 0:a.toString())||"",gbp_usd:(null===(d=g.current_rates)||void 0===d?void 0:null===(l=d.gbp_usd)||void 0===l?void 0:l.toString())||"",usd_cop:(null===(o=g.current_rates)||void 0===o?void 0:null===(i=o.usd_cop)||void 0===i?void 0:i.toString())||""})}catch(e){console.error("Error cargando informaci\xf3n del per\xedodo:",e),Z(e.message||"Error al cargar informaci\xf3n del per\xedodo")}finally{q(!1)}},er=async()=>{if(n&&x&&u)try{let e;J(!0),Z(null);let r=parseInt(x),a=parseInt(n),s="P1"===u?"1-15":"16-31";e="P1"===u?1:16;let l="".concat(r,"-").concat(String(a).padStart(2,"0"),"-").concat(String(e).padStart(2,"0")),{createClient:d}=await Promise.resolve().then(t.bind(t,5257)),i=(await Promise.resolve().then(t.bind(t,5922))).supabase,{data:{session:o}}=await i.auth.getSession(),c=null==o?void 0:o.access_token;if(!c){Z("Sesi\xf3n no v\xe1lida");return}let m=localStorage.getItem("user"),g="Desconocido";if(m)try{let e=JSON.parse(m);g=e.name||e.email||"Desconocido"}catch(e){}let h=await fetch("/api/admin/calculator-history/update-period-rates",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c)},body:JSON.stringify({period_date:l,period_type:s,rates:{eur_usd:$.eur_usd?Number($.eur_usd):void 0,gbp_usd:$.gbp_usd?Number($.gbp_usd):void 0,usd_cop:$.usd_cop?Number($.usd_cop):void 0},admin_id:D,admin_name:g})}),p=await h.json();if(!p.success){Z(p.error||"Error al actualizar tasas");return}T(!1),Z(null),alert("✅ Tasas actualizadas exitosamente para ".concat(p.updated_count," registros del per\xedodo ").concat(l," (").concat(s,")")),window.location.reload()}catch(e){console.error("Error guardando tasas:",e),Z(e.message||"Error al guardar tasas")}finally{J(!1)}},et=async e=>{if(!e){A(null);return}try{U(!0),console.log("\uD83D\uDD0D [DASHBOARD] Cargando disponibilidad para sede:",e);let r=await fetch("/api/groups/rooms"),t=await r.json();if(!t.success)throw Error("Error obteniendo rooms");let a=t.rooms.filter(r=>r.group_id===e);console.log("\uD83D\uDD0D [DASHBOARD] Rooms de la sede:",a.length);let s=a.map(async e=>{try{let r=await fetch("/api/room-assignments?roomId=".concat(e.id)),t=await r.json();return t.success?t.assignments:[]}catch(r){return console.warn("Error obteniendo asignaciones para room ".concat(e.id,":"),r),[]}}),l=(await Promise.all(s)).flat(),d={manana:0,tarde:0,noche:0},i={manana:0,tarde:0,noche:0};["MA\xd1ANA","TARDE","NOCHE"].forEach((e,r)=>{let t=0===r?"manana":1===r?"tarde":"noche",s=l.filter(r=>r.jornada===e),o=new Set(s.map(e=>e.model_id)),n=Math.max(0,a.length-o.size);d[t]=n;let c=Math.max(0,s.length-o.size);i[t]=c});let o=z.find(r=>r.id===e),n={sede_id:e,sede_nombre:(null==o?void 0:o.name)||"Sede Desconocida",rooms_disponibles:a.filter(e=>e.is_active).length,rooms_totales:a.length,jornadas_disponibles:d,jornadas_dobladas:i,total_espacios:3*a.length};A(n),console.log("✅ [DASHBOARD] Disponibilidad calculada:",n)}catch(e){console.error("❌ [DASHBOARD] Error cargando disponibilidad:",e),k("Error cargando disponibilidad de la sede")}finally{U(!1)}},ea=async()=>{try{y(!0),k(null);let[e,r,t,a]=await Promise.all([fetch("/api/groups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userRole:w,userGroups:_})}),fetch("/api/groups/rooms"),fetch("/api/users"),fetch("/api/assignments/all")]),[s,d,i,o]=await Promise.all([e.json(),r.json(),t.json(),a.json()]),n=s.success&&s.groups||[],c=d.success&&d.rooms||[],x=o.success&&o.assignments||[];"super_admin"!==w&&"superadmin_aff"!==w&&_.length>0&&(c=c.filter(e=>_.includes(e.group_id)),x=x.filter(e=>_.includes(e.group_id)));let m=n.filter(e=>"Otros"!==e.name&&"Sat\xe9lites"!==e.name);P(m);let u=n.length,g=c.length,h=0;console.log("\uD83D\uDD0D [DASHBOARD] usersData:",i),i.success&&i.users&&Array.isArray(i.users)?(h=i.users.filter(e=>"modelo"===e.role&&e.is_active).length,console.log("✅ [DASHBOARD] Modelos encontrados:",h)):console.error("❌ [DASHBOARD] Error en usersData:",{success:i.success,hasUsers:!!i.users,isArray:Array.isArray(i.users),error:i.error});let p=x.length,b=n.filter(e=>c.some(r=>r.group_id===e.id)).length;l({totalSedes:u,totalRooms:g,totalModelos:h,asignacionesActivas:p,sedesConRooms:b,sedesSinRooms:u-b})}catch(e){console.error("Error cargando datos del dashboard:",e),k("Error cargando datos del dashboard")}finally{y(!1)}};return f?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,a.jsx)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Cargando dashboard..."})]})})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 pb-48",children:(0,a.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:["admin"===w&&0===z.length&&(0,a.jsx)("div",{className:"mb-4 sm:mb-8",children:(0,a.jsx)("div",{className:"bg-gradient-to-r from-yellow-50/80 to-orange-50/80 dark:bg-yellow-900/20 dark:border-yellow-700/50 backdrop-blur-sm rounded-xl p-3 sm:p-6 border border-yellow-200/30 dark:border-yellow-700/50",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h3",{className:"text-sm sm:text-lg font-semibold text-yellow-800 dark:text-yellow-200",children:"Sin Sedes Asignadas"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-yellow-700 dark:text-yellow-300 mt-0.5 sm:mt-1",children:"No tienes sedes asignadas para ver estad\xedsticas. Contacta al Super Admin para que te asigne sedes."})]})]})})}),(0,a.jsx)("div",{className:"mb-8 sm:mb-12",children:(0,a.jsx)("div",{className:"bg-white/80 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 md:gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h1",{className:"text-base sm:text-lg md:text-2xl font-bold text-gray-900 dark:text-gray-100 leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:"Dashboard Sedes"}),(0,a.jsx)("p",{className:"mt-1 text-xs sm:text-sm text-gray-600 dark:text-gray-300 hidden sm:block",children:"super_admin"===w?"Vista global del estado de todas las sedes y asignaciones":"superadmin_aff"===w?"Vista del estado de las sedes de tu estudio":"Vista del estado de tus sedes asignadas"})]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400 hidden md:block",children:["Acceso: ",(0,a.jsx)("span",{className:"font-medium text-blue-600 dark:text-blue-400 dark:text-blue-400",children:"super_admin"===w?"Super Admin":"superadmin_aff"===w?"Superadmin AFF":"Admin"})]})]})})}),D&&("super_admin"===w||"admin"===w||"superadmin_aff"===w)&&(0,a.jsx)(i,{userRole:w,userId:D,userGroups:_}),D&&("super_admin"===w||"admin"===w||"superadmin_aff"===w||"admin_aff"===w)&&(0,a.jsx)(v,{userId:D,userRole:w,groupId:_[0]}),(0,a.jsx)("div",{className:"mb-4 sm:mb-8 relative z-40",children:(0,a.jsxs)("div",{className:"bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl p-3 sm:p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0 mb-3 sm:mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-md flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h2",{className:"text-sm sm:text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Consulta Hist\xf3rica"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 hidden sm:block",children:"Consulta per\xedodos hist\xf3ricos de facturaci\xf3n"})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[("admin"===w||"super_admin"===w||"superadmin_aff"===w)&&n&&x&&u&&(0,a.jsxs)("button",{onClick:async()=>{let e;let r=parseInt(x),t=parseInt(n),a="P1"===u?"1-15":"16-31";e="P1"===u?1:16;let s="".concat(r,"-").concat(String(t).padStart(2,"0"),"-").concat(String(e).padStart(2,"0"));await ee(s,a),T(!0)},disabled:!n||!x||!u,className:"flex-1 sm:flex-none px-2.5 sm:px-3 py-1.5 sm:py-2 text-[10px] sm:text-xs font-medium bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg hover:from-purple-600 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:hover:shadow-md flex items-center justify-center gap-1 active:scale-95 touch-manipulation",children:[(0,a.jsx)("svg",{className:"w-3 h-3 sm:w-3.5 sm:h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Editar RATES de cierre"}),(0,a.jsx)("span",{className:"sm:hidden",children:"RATES"})]}),(0,a.jsxs)("button",{onClick:()=>o(!d),className:"flex-1 sm:flex-none px-2.5 sm:px-3 py-1.5 sm:py-2 text-[10px] sm:text-xs font-medium bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 flex items-center justify-center gap-1 active:scale-95 touch-manipulation",children:[(0,a.jsx)("svg",{className:"w-3 h-3 sm:w-3.5 sm:h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:d?"M5 15l7-7 7 7":"M19 9l-7 7-7-7"})}),(0,a.jsx)("span",{className:"hidden sm:inline",children:d?"Ocultar":"Consultar Per\xedodos"}),(0,a.jsx)("span",{className:"sm:hidden",children:d?"Ocultar":"Consultar"})]})]})]}),d&&(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{className:"dropdown-container",children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1 sm:mb-2",children:"A\xf1o"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>R("year"===I?null:"year"),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border-0 bg-gray-50/80 dark:bg-gray-700/80 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:bg-white dark:focus:bg-gray-600 text-xs sm:text-sm text-gray-700 dark:text-gray-200 transition-all duration-200 flex items-center justify-between active:scale-95 touch-manipulation",children:[(0,a.jsx)("span",{children:x||"Seleccionar a\xf1o"}),(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400 transition-transform duration-200 ".concat("year"===I?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),"year"===I&&(0,a.jsx)("div",{className:"absolute z-[999999] mt-2 left-0 w-full bg-white dark:bg-gray-700 backdrop-blur-sm border border-gray-200 dark:border-gray-600 rounded-xl shadow-lg max-h-56 overflow-auto",children:(0,a.jsx)("div",{className:"py-2",children:Array.from({length:5},(e,r)=>{let t=new Date().getFullYear()-r;return(0,a.jsxs)("button",{onClick:()=>{m(t.toString()),R(null)},className:"w-full text-left px-4 py-3 text-sm transition-colors duration-200 flex items-center justify-between ".concat(r<4?"border-b border-gray-100/50 dark:border-gray-600/50":""," ").concat(x===t.toString()?"bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-300 font-medium":"hover:bg-gray-50 dark:hover:bg-gray-600 text-gray-900 dark:text-gray-100"),children:[(0,a.jsx)("span",{children:t}),x===t.toString()&&(0,a.jsx)("svg",{className:"w-4 h-4 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},t)})})})]})]}),(0,a.jsxs)("div",{className:"dropdown-container",children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1 sm:mb-2",children:"Mes"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>R("month"===I?null:"month"),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border-0 bg-gray-50/80 dark:bg-gray-700/80 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:bg-white dark:focus:bg-gray-600 text-xs sm:text-sm text-gray-700 dark:text-gray-200 transition-all duration-200 flex items-center justify-between active:scale-95 touch-manipulation",children:[(0,a.jsx)("span",{children:n?K(n):"Seleccionar mes"}),(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400 transition-transform duration-200 ".concat("month"===I?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),"month"===I&&(0,a.jsx)("div",{className:"absolute z-[999999] mt-2 left-0 w-full bg-white dark:bg-gray-700 backdrop-blur-sm border border-gray-200 dark:border-gray-600 rounded-xl shadow-lg max-h-56 overflow-auto",children:(0,a.jsx)("div",{className:"py-2",children:Array.from({length:12},(e,r)=>{let t=r+1,s=K(t.toString());return(0,a.jsxs)("button",{onClick:()=>{c(t.toString()),R(null)},className:"w-full text-left px-4 py-3 text-sm transition-colors duration-200 flex items-center justify-between ".concat(r<11?"border-b border-gray-100/50 dark:border-gray-600/50":""," ").concat(n===t.toString()?"bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-300 font-medium":"hover:bg-gray-50 dark:hover:bg-gray-600 text-gray-900 dark:text-gray-100"),children:[(0,a.jsx)("span",{children:s}),n===t.toString()&&(0,a.jsx)("svg",{className:"w-4 h-4 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},t)})})})]})]}),(0,a.jsxs)("div",{className:"dropdown-container col-span-2 md:col-span-1",children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1 sm:mb-2",children:"Per\xedodo"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>R("period"===I?null:"period"),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border-0 bg-gray-50/80 dark:bg-gray-700/80 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:bg-white dark:focus:bg-gray-600 text-xs sm:text-sm text-gray-700 dark:text-gray-200 transition-all duration-200 flex items-center justify-between active:scale-95 touch-manipulation",children:[(0,a.jsx)("span",{children:u}),(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400 transition-transform duration-200 ".concat("period"===I?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),"period"===I&&(0,a.jsx)("div",{className:"absolute z-[999999] mt-2 left-0 w-full bg-white dark:bg-gray-700 backdrop-blur-sm border border-gray-200 dark:border-gray-600 rounded-xl shadow-lg max-h-56 overflow-auto",children:(0,a.jsx)("div",{className:"py-2",children:["P1","P2"].map((e,r)=>(0,a.jsxs)("button",{onClick:()=>{g(e),R(null)},className:"w-full text-left px-4 py-3 text-sm transition-colors duration-200 flex items-center justify-between ".concat(r<1?"border-b border-gray-100/50 dark:border-gray-600/50":""," ").concat(u===e?"bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-300 font-medium":"hover:bg-gray-50 dark:hover:bg-gray-600 text-gray-900 dark:text-gray-100"),children:[(0,a.jsx)("span",{children:e}),u===e&&(0,a.jsx)("svg",{className:"w-4 h-4 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},e))})})]})]})]}),d&&n&&x&&u&&h&&(0,a.jsx)("div",{className:"mt-3 sm:mt-6 -mx-3 sm:-mx-0 sm:mx-0",children:(0,a.jsx)(i,{userRole:w,userId:D,userGroups:_,selectedDate:h,selectedPeriod:"P1"===u?"period-1":"period-2"})})]})}),j&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 dark:border-red-700/50 border border-red-200 dark:border-red-700/50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsx)("p",{className:"text-sm text-red-800 dark:text-red-400",children:j})})]})}),D&&("super_admin"===w||"admin"===w||"superadmin_aff"===w)&&(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)(b,{userId:D,userRole:w,userGroups:_})}),O&&(0,a.jsxs)("div",{className:"fixed inset-0 z-[999999] flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>{G||(T(!1),Z(null))}}),(0,a.jsxs)("div",{className:"relative w-full max-w-2xl bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h2",{className:"text-sm sm:text-xl font-semibold text-gray-900 dark:text-gray-100 truncate",children:"Editar RATES de cierre"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 truncate",children:n&&x&&u?"".concat(K(n)," ").concat(x," - ").concat(u," (").concat("P1"===u?"D\xedas 1-15":"D\xedas 16-31",")"):"Selecciona un per\xedodo"})]})]}),(0,a.jsx)("button",{onClick:()=>{G||(T(!1),Z(null))},disabled:G,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 disabled:opacity-50 disabled:cursor-not-allowed p-1 active:scale-95 touch-manipulation flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:W?(0,a.jsx)("div",{className:"flex items-center justify-center py-6 sm:py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-purple-600"})}):H?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700/50 rounded-lg p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1.5 sm:mb-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600 dark:text-blue-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsx)("h3",{className:"text-xs sm:text-sm font-semibold text-blue-900 dark:text-blue-300",children:"Resumen del per\xedodo"})]}),(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-blue-800 dark:text-blue-400 leading-relaxed",children:["Esta acci\xf3n ",(0,a.jsx)("strong",{className:"font-semibold",children:"reemplazar\xe1"})," las tasas hist\xf3ricas guardadas y ",(0,a.jsx)("strong",{className:"font-semibold",children:"recalcular\xe1"})," todos los valores derivados en ",(0,a.jsx)("strong",{className:"font-semibold",children:H.records_count})," registros hist\xf3ricos del per\xedodo seleccionado."]}),(0,a.jsxs)("p",{className:"text-[10px] sm:text-xs text-blue-700 dark:text-blue-500 mt-1.5 sm:mt-2 leading-relaxed",children:["⚠️ ",(0,a.jsx)("strong",{children:"Importante:"}),' Las tasas guardadas en "Mi Historial" de todas las modelos para este per\xedodo ser\xe1n reemplazadas por las nuevas tasas. Todos los valores (USD bruto, USD modelo, COP modelo) ser\xe1n recalculados autom\xe1ticamente.']}),(0,a.jsxs)("p",{className:"text-[10px] sm:text-xs text-green-700 dark:text-green-500 mt-1.5 sm:mt-2 leading-relaxed",children:["✅ Solo afecta per\xedodos ",(0,a.jsx)("strong",{children:"cerrados"})," (archivados). No afecta las RATES actuales ni los c\xe1lculos del per\xedodo en curso."]})]}),H.current_rates&&(null!==H.current_rates.eur_usd||null!==H.current_rates.gbp_usd||null!==H.current_rates.usd_cop)&&(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg p-3 sm:p-4",children:[(0,a.jsx)("h4",{className:"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 sm:mb-3",children:"Tasas actuales del per\xedodo:"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:"EUR → USD"}),(0,a.jsx)("div",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-gray-100",children:null!==H.current_rates.eur_usd?H.current_rates.eur_usd.toFixed(4):"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:"GBP → USD"}),(0,a.jsx)("div",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-gray-100",children:null!==H.current_rates.gbp_usd?H.current_rates.gbp_usd.toFixed(4):"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:"USD → COP"}),(0,a.jsx)("div",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-gray-100",children:null!==H.current_rates.usd_cop?H.current_rates.usd_cop.toFixed(2):"N/A"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsx)("h4",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Nuevas tasas:"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:"EUR → USD"}),(0,a.jsx)("input",{type:"number",step:"0.0001",value:$.eur_usd,onChange:e=>V({...$,eur_usd:e.target.value}),className:"w-full px-2.5 sm:px-3 py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"1.0100",disabled:G})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:"GBP → USD"}),(0,a.jsx)("input",{type:"number",step:"0.0001",value:$.gbp_usd,onChange:e=>V({...$,gbp_usd:e.target.value}),className:"w-full px-2.5 sm:px-3 py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"1.2000",disabled:G})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:"USD → COP"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:$.usd_cop,onChange:e=>V({...$,usd_cop:e.target.value}),className:"w-full px-2.5 sm:px-3 py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"3900.00",disabled:G})]})]})]}),Y&&(0,a.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700/50 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsx)("p",{className:"text-sm text-red-800 dark:text-red-400",children:Y})]})})]}):(0,a.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No se pudo cargar la informaci\xf3n del per\xedodo"})}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-end gap-2 sm:gap-3 p-4 sm:p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 rounded-b-xl",children:[(0,a.jsx)("button",{onClick:()=>{G||(T(!1),Z(null))},disabled:G,className:"w-full sm:w-auto px-4 py-2 text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 focus:ring-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors active:scale-95 touch-manipulation",children:"Cancelar"}),(0,a.jsx)("button",{onClick:async()=>{let e="super_admin"===w?"todas las modelos globalmente":"superadmin_aff"===w?"las modelos de tu estudio":"las modelos de tus grupos",r="\xbfEst\xe1s seguro de actualizar las tasas hist\xf3ricas para ".concat((null==H?void 0:H.records_count)||0," registros del per\xedodo ").concat(n&&x&&u?"".concat(K(n)," ").concat(x," - ").concat(u):"",'?\n\n⚠️ Esta acci\xf3n:\n- Reemplazar\xe1 las tasas guardadas en "Mi Historial" de ').concat(e,"\n- Recalcular\xe1 todos los valores derivados (USD bruto, USD modelo, COP modelo)\n- Solo afecta per\xedodos CERRADOS (archivados), NO afecta el per\xedodo en curso\n\n\xbfContinuar?");window.confirm(r)&&await er()},disabled:G||!H||!$.eur_usd||!$.gbp_usd||!$.usd_cop,className:"w-full sm:w-auto px-4 py-2 text-xs sm:text-sm font-medium text-white bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg hover:from-purple-600 hover:to-purple-700 focus:ring-2 focus:ring-purple-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2 active:scale-95 touch-manipulation",children:G?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-3.5 w-3.5 sm:h-4 sm:w-4 border-b-2 border-white"}),(0,a.jsx)("span",{children:"Guardando..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsx)("span",{children:"Guardar Tasas"})]})})]})]})]}),(0,a.jsx)("div",{className:"mb-4 sm:mb-6 relative z-40 overflow-visible",children:(0,a.jsx)("div",{className:"bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-3 sm:p-6 pb-4 sm:pb-8 overflow-visible dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 sm:space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1.5 sm:space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 sm:w-5 sm:h-5 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200",children:"Consultar Disponibilidad:"})]}),(0,a.jsx)("div",{className:"flex-1 sm:max-w-xs relative",children:(0,a.jsxs)("div",{className:"relative dropdown-container",children:[(0,a.jsxs)("button",{onClick:()=>R("sede"===I?null:"sede"),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border-0 bg-gray-50/80 dark:bg-gray-700/80 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:bg-white dark:focus:bg-gray-600 text-xs sm:text-sm text-gray-700 dark:text-gray-200 transition-all duration-200 cursor-pointer text-left flex items-center justify-between active:scale-95 touch-manipulation",children:[(0,a.jsx)("span",{className:L?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-400",children:L&&(null===(e=z.find(e=>e.id===L))||void 0===e?void 0:e.name)||"Selecciona una sede..."}),(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-500 dark:text-gray-400 transition-transform duration-200 ".concat("sede"===I?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),"sede"===I&&(0,a.jsx)("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 dark:border-gray-700/20 z-[99999] max-h-60 overflow-y-auto",children:(0,a.jsxs)("div",{className:"py-2",children:[(0,a.jsx)("button",{onClick:()=>{E(""),R(null)},className:"w-full px-4 py-3 text-left text-sm text-gray-700 dark:text-gray-200 hover:bg-blue-50/80 dark:hover:bg-blue-900/20 transition-colors duration-200 flex items-center border-b border-gray-100/50 dark:border-gray-700/50",children:(0,a.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Selecciona una sede..."})}),z.map((e,r)=>(0,a.jsxs)("button",{onClick:()=>{E(e.id),R(null)},className:"w-full px-4 py-3 text-left text-sm transition-colors duration-200 flex items-center ".concat(r<z.length-1?"border-b border-gray-100/50 dark:border-gray-700/50":""," ").concat(L===e.id?"bg-blue-50/80 dark:bg-blue-900/20 text-blue-900 dark:text-blue-100 font-medium":"text-gray-700 dark:text-gray-200 hover:bg-gray-50/80 dark:hover:bg-gray-700/50"),children:[(0,a.jsx)("span",{children:e.name}),L===e.id&&(0,a.jsx)("svg",{className:"w-4 h-4 text-blue-600 dark:text-blue-400 dark:text-blue-400 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},e.id))]})})]})}),L&&(0,a.jsx)("button",{onClick:()=>E(""),className:"p-1.5 sm:p-2 hover:bg-gray-100/80 rounded-lg transition-colors duration-200 active:scale-95 touch-manipulation flex-shrink-0",title:"Cerrar consulta",children:(0,a.jsx)("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}),L&&(0,a.jsx)("div",{className:"mb-6 sm:mb-10 relative z-0",children:(0,a.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15",children:[(0,a.jsx)("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-b border-gray-200/50 dark:border-gray-600/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1.5 sm:space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 sm:w-5 sm:h-5 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-2 h-2 sm:w-2.5 sm:h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,a.jsx)("h2",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-gray-100",children:"Resumen de Disponibilidad"})]}),(0,a.jsx)("button",{onClick:()=>E(""),className:"p-1 sm:p-1.5 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition-colors duration-200 active:scale-95 touch-manipulation",title:"Cerrar consulta",children:(0,a.jsx)("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,a.jsx)("div",{className:"p-3 sm:p-6",children:(0,a.jsx)("div",{className:"space-y-4",children:B?(0,a.jsxs)("div",{className:"flex items-center justify-center py-6 sm:py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-2 sm:ml-3 text-xs sm:text-sm text-gray-600",children:"Cargando disponibilidad..."})]}):M?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-3 sm:p-4 border border-blue-200/50 dark:border-blue-700/50",children:[(0,a.jsx)("h3",{className:"text-sm sm:text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:M.sede_nombre}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-lg sm:text-2xl font-bold text-blue-600 dark:text-blue-400 dark:text-blue-400",children:[M.rooms_disponibles,"/",M.rooms_totales]}),(0,a.jsx)("p",{className:"text-[10px] sm:text-sm text-gray-600 dark:text-gray-400",children:"Rooms Disponibles"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-lg sm:text-2xl font-bold text-green-600 dark:text-green-400",children:M.total_espacios}),(0,a.jsx)("p",{className:"text-[10px] sm:text-sm text-gray-600 dark:text-gray-400",children:"Total Espacios"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-lg sm:text-2xl font-bold text-purple-600 dark:text-purple-400",children:Object.values(M.jornadas_dobladas).reduce((e,r)=>e+r,0)}),(0,a.jsx)("p",{className:"text-[10px] sm:text-sm text-gray-600 dark:text-gray-400",children:"Doblajes Activos"})]})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 sm:gap-4",children:[{key:"manana",label:"Ma\xf1ana",color:"from-orange-500 to-amber-600"},{key:"tarde",label:"Tarde",color:"from-blue-500 to-indigo-600"},{key:"noche",label:"Noche",color:"from-purple-500 to-violet-600"}].map(e=>(0,a.jsxs)("div",{className:"bg-white/80 dark:bg-gray-600/80 backdrop-blur-sm rounded-lg p-2.5 sm:p-4 border border-gray-200/50 dark:border-gray-500/50",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1.5 sm:space-x-2 mb-2 sm:mb-3",children:[(0,a.jsx)("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 bg-gradient-to-r ".concat(e.color," rounded-full flex-shrink-0")}),(0,a.jsx)("h4",{className:"text-xs sm:text-sm font-medium text-gray-900 dark:text-gray-100",children:e.label})]}),(0,a.jsxs)("div",{className:"space-y-1.5 sm:space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-[10px] sm:text-sm text-gray-600 dark:text-gray-400",children:"Disponibles:"}),(0,a.jsx)("span",{className:"text-xs sm:text-sm font-semibold text-green-600 dark:text-green-400",children:M.jornadas_disponibles[e.key]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-[10px] sm:text-sm text-gray-600 dark:text-gray-400",children:"Dobladas:"}),(0,a.jsx)("span",{className:"text-xs sm:text-sm font-semibold text-blue-600 dark:text-blue-400 dark:text-blue-400",children:M.jornadas_dobladas[e.key]})]})]})]},e.key))}),(0,a.jsx)("div",{className:"bg-gray-50/80 dark:bg-gray-600/80 rounded-lg p-2.5 sm:p-4 border border-gray-200/50 dark:border-gray-500/50",children:(0,a.jsxs)("div",{className:"flex items-start space-x-1.5 sm:space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 sm:w-4 sm:h-4 bg-blue-500 rounded-full flex items-center justify-center mt-0.5 flex-shrink-0",children:(0,a.jsx)("svg",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 text-white",fill:"currentColor",viewBox:"0 0 8 8",children:(0,a.jsx)("circle",{cx:"4",cy:"4",r:"3"})})}),(0,a.jsxs)("div",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-300",children:[(0,a.jsx)("p",{className:"font-medium mb-0.5 sm:mb-1",children:"Informaci\xf3n para nuevas modelos:"}),(0,a.jsxs)("p",{className:"leading-relaxed",children:["• ",(0,a.jsx)("strong",{children:"Disponibles:"})," Espacios libres para asignar nuevas modelos"]}),(0,a.jsxs)("p",{className:"leading-relaxed",children:["• ",(0,a.jsx)("strong",{children:"Dobladas:"})," Modelos que trabajan en m\xfaltiples jornadas"]}),(0,a.jsxs)("p",{className:"leading-relaxed",children:["• ",(0,a.jsx)("strong",{children:"Total Espacios:"})," Capacidad m\xe1xima (rooms \xd7 3 jornadas)"]})]})]})})]}):(0,a.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:(0,a.jsx)("p",{children:"No se pudo cargar la disponibilidad de esta sede"})})})})]})})]})})}},883:function(e,r,t){"use strict";t.d(r,{Z:function(){return d}});var a=t(7437),s=t(2265);let l={green:"bg-green-100 text-green-800",blue:"bg-blue-100 text-blue-800",red:"bg-red-100 text-red-800",yellow:"bg-yellow-100 text-yellow-800",gray:"bg-gray-100 text-gray-800"};function d(e){let{options:r,value:t,onChange:d,placeholder:i="Selecciona una opci\xf3n",className:o="",disabled:n=!1,maxHeight:c="max-h-60",autoOpen:x=!1}=e,[m,u]=(0,s.useState)(!1),g=(0,s.useRef)(null);(0,s.useEffect)(()=>{x&&r.length>1?u(!0):x||u(!1)},[x,r.length]),(0,s.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&u(!1)};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[]),(0,s.useEffect)(()=>{m&&g.current&&setTimeout(()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)},[m]);let h=r.find(e=>e.value===t),p=e=>{d(e),u(!1)};return(0,a.jsxs)("div",{className:"relative ".concat(o),ref:g,children:[(0,a.jsx)("button",{type:"button",className:"w-full px-3 py-2 text-sm text-left border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 cursor-pointer flex items-center justify-between hover:border-gray-400 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200 ".concat(n?"opacity-50 cursor-not-allowed":""),onClick:()=>!n&&u(!m),disabled:n,"aria-haspopup":"listbox","aria-expanded":m,children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("span",{className:h?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-400",children:h?h.label:i}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(null==h?void 0:h.badge)&&(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat(l[h.badgeColor||"gray"]),children:h.badge}),(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400 transition-transform duration-200 ".concat(m?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}),m&&(0,a.jsx)("div",{className:"absolute z-[99998] w-full mt-1 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg dark:shadow-lg dark:shadow-cyan-900/10 dark:ring-0.5 dark:ring-cyan-500/15 ".concat(c," overflow-auto apple-scroll"),children:0===r.length?(0,a.jsx)("div",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:"No hay opciones disponibles"}):r.map((e,r)=>(0,a.jsxs)("div",{children:[r>0&&(0,a.jsx)("div",{className:"w-full h-px bg-gray-100 dark:bg-gray-600/50 dark:shadow-sm dark:shadow-blue-900/10"}),(0,a.jsxs)("div",{className:"px-4 py-3 text-sm cursor-pointer transition-colors duration-150 flex items-center justify-between ".concat(e.disabled?"text-gray-400 dark:text-gray-500 cursor-not-allowed":"hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-900 dark:text-gray-100"," ").concat(e.value===t?"bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-100":""),onClick:()=>!e.disabled&&p(e.value),children:[(0,a.jsx)("span",{children:e.label}),e.badge&&(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat(l[e.badgeColor||"gray"]),children:e.badge})]})]},e.value))})]})}},6605:function(e,r,t){"use strict";t.d(r,{t:function(){return s}});var a=t(2265);function s(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{refreshInterval:s=3e4,enabled:l=!0,onRefresh:d,silentUpdate:i=!0}=t,o=(0,a.useRef)(null),n=(0,a.useRef)(!0),[c,x]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),g=(0,a.useCallback)(()=>{d&&d(),e()},[e,d]),h=(0,a.useCallback)(async()=>{if(n.current){u(!0);try{d&&d(),await e(!0)}catch(e){console.error("\uD83D\uDD04 [BILLING-POLLING] Error en actualizaci\xf3n silenciosa:",e)}finally{n.current&&u(!1)}}},[e,d]);return(0,a.useEffect)(()=>(n.current=!0,()=>{n.current=!1}),[]),(0,a.useEffect)(()=>(o.current&&clearInterval(o.current),l&&n.current?(x(!0),o.current=setInterval(()=>{n.current&&(console.log("\uD83D\uDD04 [BILLING-POLLING] Actualizaci\xf3n silenciosa iniciada"),i?h():(d&&d(),e()))},s)):x(!1),()=>{o.current&&clearInterval(o.current)}),[s,l,e,d,i,h,...r]),(0,a.useEffect)(()=>()=>{o.current&&clearInterval(o.current)},[]),{isPolling:c,isSilentUpdating:m,manualRefresh:g}}},4930:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return d}});let a=t(1024);t(2265);let s=a._(t(4795));function l(e){return{default:(null==e?void 0:e.default)||e}}function d(e,r){let t=s.default,a={loading:e=>{let{error:r,isLoading:t,pastDelay:a}=e;return null}};"function"==typeof e&&(a.loader=e),Object.assign(a,r);let d=a.loader;return t({...a,loader:()=>null!=d?d().then(l):Promise.resolve(l(()=>null))})}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),e.exports=r.default)},6005:function(e,r,t){"use strict";function a(e){let{children:r}=e;return r}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"NoSSR",{enumerable:!0,get:function(){return a}}),t(6491)},4795:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return l}});let a=t(1024)._(t(2265)),s=t(6005),l=function(e){let r=Object.assign({loader:null,loading:null,ssr:!0},e);function t(e){let t=r.loading,l=a.default.createElement(t,{isLoading:!0,pastDelay:!0,error:null}),d=r.ssr?a.default.Fragment:s.NoSSR,i=r.lazy;return a.default.createElement(a.default.Suspense,{fallback:l},a.default.createElement(d,null,a.default.createElement(i,e)))}return r.lazy=a.default.lazy(r.loader),t.displayName="LoadableComponent",t}},1851:function(){}},function(e){e.O(0,[5257,1585,606,8153,2971,4938,1744],function(){return e(e.s=8506)}),_N_E=e.O()}]);