(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6230,5922],{8822:function(e,r,a){Promise.resolve().then(a.bind(a,4899))},4899:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return l}});var s=a(7437),t=a(2265),o=a(5922);function l(){let[e,r]=(0,t.useState)(!1),[a,l]=(0,t.useState)(!1),[n,d]=(0,t.useState)(null),[i,c]=(0,t.useState)(null),[u,m]=(0,t.useState)(null),b=async()=>{try{let{data:{session:e},error:r}=await o.supabase.auth.getSession();if(r||!e)return null;let a=e.expires_at;if(a&&a-Math.floor(Date.now()/1e3)<60){let{data:{session:r},error:a}=await o.supabase.auth.refreshSession();if(a||!r)return e.access_token;return r.access_token}return e.access_token}catch(e){return null}},p=async()=>{l(!0),c(null),d(null);try{let e=await b();if(!e)throw Error("No hay sesi\xf3n activa. Por favor, inicia sesi\xf3n.");let r=await fetch("/api/admin/unfreeze-platforms",{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!r.ok){let e;let a=await r.text();try{e=JSON.parse(a)}catch(s){e={error:a||"Error ".concat(r.status)}}throw Error(e.error||"Error ".concat(r.status))}let a=await r.json();d(a)}catch(e){c(e.message||"Error desconocido")}finally{l(!1)}},h=async()=>{if(confirm("⚠️ \xbfEst\xe1s seguro de que quieres descongelar TODAS las plataformas especiales de TODOS los modelos?\n\nEsto eliminar\xe1 todos los registros de congelamiento y forzar\xe1 el descongelamiento inmediato.")){r(!0),c(null),m(null);try{let e=await b();if(!e)throw Error("No hay sesi\xf3n activa. Por favor, inicia sesi\xf3n.");let r=await fetch("/api/admin/unfreeze-platforms?all=true",{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!r.ok){let e;let a=await r.text();try{e=JSON.parse(a)}catch(s){e={error:a||"Error ".concat(r.status)}}throw Error(e.error||"Error ".concat(r.status))}let a=await r.json(),s=await fetch("/api/users?role=modelo&is_active=true",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(s.ok){let r=(await s.json()).users||[],t=0;for(let a of r.slice(0,50))try{await fetch("/api/calculator/period-closure/platform-freeze-status?modelId=".concat(a.id,"&forceUnfreeze=true"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),t++}catch(e){console.error("Error forzando descongelamiento para modelo ".concat(a.id,":"),e)}m({...a,forced_unfreeze_count:t,message:"Se descongelaron ".concat(a.deleted_count||0," registro(s) y se forz\xf3 el descongelamiento para ").concat(t," modelo(s)")})}else m(a);setTimeout(()=>{p()},1e3)}catch(e){c(e.message||"Error desconocido")}finally{r(!1)}}};return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-4 sm:p-6 lg:p-8",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 sm:p-8",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"\uD83D\uDD13 Descongelar Plataformas Especiales"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:'Descongela las plataformas especiales que est\xe1n bloqueadas en "Mi Calculadora"'})]}),(0,s.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:[(0,s.jsx)("h2",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"ℹ️ Informaci\xf3n:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[(0,s.jsx)("li",{children:"Las plataformas especiales se congelan autom\xe1ticamente en d\xedas de cierre de per\xedodo"}),(0,s.jsx)("li",{children:"Este proceso elimina los registros de congelamiento de la base de datos"}),(0,s.jsx)("li",{children:"Las plataformas quedar\xe1n disponibles inmediatamente despu\xe9s de descongelar"})]})]}),(0,s.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row gap-3",children:[(0,s.jsx)("button",{onClick:p,disabled:a||e,className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white font-semibold rounded-lg shadow-md transition-colors duration-200 disabled:cursor-not-allowed",children:a?"⏳ Verificando...":"\uD83D\uDD0D Verificar Estado"}),(0,s.jsx)("button",{onClick:h,disabled:e||a,className:"px-6 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-semibold rounded-lg shadow-md transition-colors duration-200 disabled:cursor-not-allowed",children:e?"⏳ Descongelando...":"\uD83D\uDD13 Descongelar Todas las Plataformas"})]}),n&&(0,s.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-3",children:"\uD83D\uDCCA Estado Actual:"}),(0,s.jsxs)("div",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-2",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Total de registros congelados:"})," ",n.total_records||0]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Modelos afectados:"})," ",n.total_models||0]}),n.summary&&n.summary.length>0&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("p",{className:"font-semibold mb-2",children:"Modelos con plataformas congeladas:"}),(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2",children:n.summary.map((e,r)=>(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-700 p-3 rounded border border-blue-200 dark:border-blue-700",children:[(0,s.jsx)("p",{className:"font-medium",children:e.email}),(0,s.jsxs)("p",{className:"text-xs opacity-75 mt-1",children:[e.frozen_count," plataforma(s) congelada(s): ",e.platforms.join(", ")]}),(0,s.jsxs)("p",{className:"text-xs opacity-60 mt-1",children:["Per\xedodos: ",e.periods.join(", ")]})]},r))})]}),0===n.total_records&&(0,s.jsx)("p",{className:"text-green-700 dark:text-green-300 font-semibold",children:"✅ No hay plataformas congeladas"})]})]}),i&&(0,s.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-red-800 dark:text-red-200 mb-2",children:"❌ Error:"}),(0,s.jsx)("p",{className:"text-red-700 dark:text-red-300",children:i})]}),u&&(0,s.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-green-800 dark:text-green-200 mb-2",children:"✅ Resultado:"}),(0,s.jsx)("p",{className:"text-green-700 dark:text-green-300",children:u.message||"Se descongelaron ".concat(u.deleted_count||0," plataforma(s)")})]})]})})})}},5922:function(e,r,a){"use strict";a.r(r),a.d(r,{supabase:function(){return s}});let s=(0,a(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")},622:function(e,r,a){"use strict";var s=a(2265),t=Symbol.for("react.element"),o=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function i(e,r,a){var s,o={},i=null,c=null;for(s in void 0!==a&&(i=""+a),void 0!==r.key&&(i=""+r.key),void 0!==r.ref&&(c=r.ref),r)l.call(r,s)&&!d.hasOwnProperty(s)&&(o[s]=r[s]);if(e&&e.defaultProps)for(s in r=e.defaultProps)void 0===o[s]&&(o[s]=r[s]);return{$$typeof:t,type:e,key:i,ref:c,props:o,_owner:n.current}}r.Fragment=o,r.jsx=i,r.jsxs=i},7437:function(e,r,a){"use strict";e.exports=a(622)}},function(e){e.O(0,[5257,2971,4938,1744],function(){return e(e.s=8822)}),_N_E=e.O()}]);