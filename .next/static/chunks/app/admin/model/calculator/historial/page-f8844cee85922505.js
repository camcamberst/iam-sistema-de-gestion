(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5600,5922],{5531:function(e,t,a){"use strict";a.d(t,{Z:function(){return x}});var r=a(2265);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase()),d=e=>{let t=l(e);return t.charAt(0).toUpperCase()+t.slice(1)},o=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim(),n=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:s,className:l="",children:d,iconNode:c,...x},m)=>(0,r.createElement)("svg",{ref:m,...i,width:t,height:t,stroke:e,strokeWidth:s?24*Number(a)/Number(t):a,className:o("lucide",l),...!d&&!n(x)&&{"aria-hidden":"true"},...x},[...c.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(d)?d:[d]])),x=(e,t)=>{let a=(0,r.forwardRef)(({className:a,...l},n)=>(0,r.createElement)(c,{ref:n,iconNode:t,className:o(`lucide-${s(d(e))}`,`lucide-${e}`,a),...l}));return a.displayName=d(e),a}},8203:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(5531).Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},8244:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(5531).Z)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]])},2549:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(5531).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},1282:function(e,t,a){Promise.resolve().then(a.bind(a,8959))},8959:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var r=a(7437),s=a(2265),l=a(5922),d=a(8244),o=a(8203),n=a(5531);let i=(0,n.Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),c=(0,n.Z)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),x=(0,n.Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var m=a(2549);let u=(0,n.Z)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),p=(0,n.Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),h=(0,n.Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var g=a(883);function b(){let[e,t]=(0,s.useState)(null),[a,n]=(0,s.useState)("modelo"),[b,y]=(0,s.useState)(null),[f,v]=(0,s.useState)([]),[j,k]=(0,s.useState)([]),[N,w]=(0,s.useState)(!0),[_,C]=(0,s.useState)(null),[S,E]=(0,s.useState)(""),[M,O]=(0,s.useState)(""),[Z,I]=(0,s.useState)(""),[P,A]=(0,s.useState)([]),[D,U]=(0,s.useState)([]),[L,z]=(0,s.useState)(null),[T,B]=(0,s.useState)(null),[F,J]=(0,s.useState)(""),[R,V]=(0,s.useState)({eur_usd:"",gbp_usd:"",usd_cop:""}),[G,W]=(0,s.useState)(null),[q,H]=(0,s.useState)({concept:"",amount:""}),[$,K]=(0,s.useState)("deduction"),[Y,X]=(0,s.useState)(!1),Q=async()=>{try{if(!b)return;let{data:{session:e}}=await l.supabase.auth.getSession(),t=null==e?void 0:e.access_token;if(!t)return;let a=await fetch("/api/model/calculator/historial?modelId=".concat(b),{headers:{Authorization:"Bearer ".concat(t)}}),r=await a.json();r.success&&(k(r.periods||[]),v(r.periods||[]))}catch(e){console.error("Error reloading data",e)}};(0,s.useEffect)(()=>{(async()=>{try{var e;w(!0),C(null);let{data:a}=await l.supabase.auth.getUser(),r=null==a?void 0:null===(e=a.user)||void 0===e?void 0:e.id;if(!r){C("No hay usuario"),w(!1);return}let{data:s}=await l.supabase.from("users").select("id, name, email, role").eq("id",r).single();if(!s){C("Usuario no encontrado"),w(!1);return}n(s.role||"modelo"),t({id:s.id,name:s.name||"Usuario",email:s.email||""});let d=new URLSearchParams(window.location.search).get("modelId"),o=s.id;d&&("admin"===s.role||"super_admin"===s.role||"superadmin_aff"===s.role)&&(o=d),y(o);let{data:{session:i}}=await l.supabase.auth.getSession(),c=null==i?void 0:i.access_token;if(!c)return;let x=await fetch("/api/model/calculator/historial?modelId=".concat(o),{headers:{Authorization:"Bearer ".concat(c)}}),m=await x.json();if(!m.success){C(m.error);return}let u=m.periods||[],p=u.filter(e=>"2026-01-01"!==e.period_date||"1-15"!==e.period_type);k(p),v(p);let h=new Set;u.forEach(e=>{if(e.period_date){let t=parseInt(e.period_date.split("-")[0]);isNaN(t)||h.add(t)}});let g=new Date().getFullYear();h.add(g),A(Array.from(h).sort((e,t)=>t-e).map(e=>({value:e.toString(),label:e.toString()}))),U([{value:"1",label:"Enero"},{value:"2",label:"Febrero"},{value:"3",label:"Marzo"},{value:"4",label:"Abril"},{value:"5",label:"Mayo"},{value:"6",label:"Junio"},{value:"7",label:"Julio"},{value:"8",label:"Agosto"},{value:"9",label:"Septiembre"},{value:"10",label:"Octubre"},{value:"11",label:"Noviembre"},{value:"12",label:"Diciembre"}])}catch(e){C(e.message)}finally{w(!1)}})()},[]);let ee=(e,t)=>{let a=new Date(e).toLocaleDateString("es-CO",{month:"long"});return"".concat(a.charAt(0).toUpperCase()+a.slice(1)," - ").concat("1-15"===t?"1ra Quincena":"2da Quincena")},et=e=>{let t=new Date(e);return"".concat(t.toLocaleDateString("es-CO")," (").concat(t.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit",hour12:!1}),")")},ea=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"USD";return new Intl.NumberFormat("es-CO",{style:"currency",currency:t,minimumFractionDigits:2}).format(e)},er=e=>new Intl.NumberFormat("es-CO",{minimumFractionDigits:2}).format(e),es=(0,s.useMemo)(()=>{if(!S||!M||!Z)return[];let e=parseInt(S),t=parseInt(M);return j.filter(a=>{if(!a.period_date)return!1;let[r,s]=a.period_date.split("-").map(Number);return r===e&&s===t&&a.period_type===Z})},[j,S,M,Z]),el="admin"===a||"super_admin"===a,ed=(e,t,a)=>{z({periodKey:e,platformId:t}),J(a.toString())},eo=e=>{var t,a,r,s,l,d;B("".concat(e.period_date,"-").concat(e.period_type)),V({eur_usd:(null===(a=e.rates)||void 0===a?void 0:null===(t=a.eur_usd)||void 0===t?void 0:t.toString())||"",gbp_usd:(null===(s=e.rates)||void 0===s?void 0:null===(r=s.gbp_usd)||void 0===r?void 0:r.toString())||"",usd_cop:(null===(d=e.rates)||void 0===d?void 0:null===(l=d.usd_cop)||void 0===l?void 0:l.toString())||""})},en=()=>{z(null),B(null),J(""),W(null),K("deduction")},ei=async(t,a)=>{if(el)try{X(!0);let r=j.find(e=>"".concat(e.period_date,"-").concat(e.period_type)===t);if(!r)throw Error("Per\xedodo no encontrado");let{data:{session:s}}=await l.supabase.auth.getSession(),d=null==s?void 0:s.access_token;if(!d)throw Error("Sesi\xf3n no v\xe1lida");let o=await fetch("/api/model/calculator/historial/update",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(d)},body:JSON.stringify({period_date:r.period_date,period_type:r.period_type,model_id:b||(null==e?void 0:e.id),platform_id:a,value:Number(F)})}),n=await o.json();if(!n.success)throw Error(n.error);z(null),await Q()}catch(e){alert(e.message)}finally{X(!1)}},ec=async t=>{if(el)try{X(!0);let{data:{session:a}}=await l.supabase.auth.getSession(),r=null==a?void 0:a.access_token;if(!r)throw Error("Sesi\xf3n no v\xe1lida");let s=await fetch("/api/admin/calculator-history/update-period-rates",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({period_date:t.period_date,period_type:t.period_type,rates:{eur_usd:R.eur_usd?Number(R.eur_usd):null,gbp_usd:R.gbp_usd?Number(R.gbp_usd):null,usd_cop:R.usd_cop?Number(R.usd_cop):null},admin_id:null==e?void 0:e.id,admin_name:(null==e?void 0:e.name)||"Admin"})}),d=await s.json();if(!d.success)throw Error(d.error);B(null),await Q()}catch(e){alert(e.message)}finally{X(!1)}},ex=async e=>{if(q.concept&&q.amount)try{X(!0);let{data:{session:t}}=await l.supabase.auth.getSession(),a=null==t?void 0:t.access_token,r=Number(q.amount),s="deduction"===$?r:-r,d=await fetch("/api/model/calculator/historial/deductions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({model_id:b,period_date:e.period_date,period_type:e.period_type,concept:q.concept,amount:s})}),o=await d.json();if(!o.success)throw Error(o.error);W(null),H({concept:"",amount:""}),K("deduction"),await Q()}catch(e){alert(e.message)}finally{X(!1)}},em=async e=>{if(confirm("\xbfEst\xe1s seguro de eliminar este \xedtem?"))try{X(!0);let{data:{session:t}}=await l.supabase.auth.getSession(),a=null==t?void 0:t.access_token,r=await fetch("/api/model/calculator/historial/deductions?id=".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}}),s=await r.json();if(!s.success)throw Error(s.error);await Q()}catch(e){alert(e.message)}finally{X(!1)}};return N?(0,r.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mb-8 sm:mb-12",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 to-indigo-600/10 rounded-xl blur-xl"}),(0,r.jsx)("div",{className:"relative bg-white/80 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl p-4 sm:p-6 border border-white/20 dark:border-gray-600/20 shadow-lg dark:shadow-lg dark:shadow-blue-900/15 dark:ring-0.5 dark:ring-blue-400/20",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 md:gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 md:gap-4 min-w-0 flex-1",children:[(0,r.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md flex-shrink-0",children:(0,r.jsx)(d.Z,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("h1",{className:"text-base sm:text-lg md:text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:"Mi Historial"}),(0,r.jsx)("p",{className:"hidden sm:block text-xs sm:text-sm text-gray-600 dark:text-gray-300 mt-1",children:"Historial de per\xedodos archivados"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[(0,r.jsxs)("div",{className:"flex-shrink-0",children:[(0,r.jsx)("label",{className:"block text-[10px] sm:text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"A\xf1o"}),(0,r.jsx)(g.Z,{options:P,value:S,onChange:E,placeholder:"A\xf1o",className:"min-w-[80px] sm:min-w-[100px] text-xs sm:text-sm"})]}),(0,r.jsxs)("div",{className:"flex-shrink-0",children:[(0,r.jsx)("label",{className:"block text-[10px] sm:text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Mes"}),(0,r.jsx)(g.Z,{options:D,value:M,onChange:O,placeholder:"Mes",className:"min-w-[100px] sm:min-w-[120px] text-xs sm:text-sm"})]}),(0,r.jsxs)("div",{className:"flex-shrink-0",children:[(0,r.jsx)("label",{className:"block text-[10px] sm:text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Per\xedodo"}),(0,r.jsx)(g.Z,{options:[{value:"1-15",label:"P1"},{value:"16-31",label:"P2"}],value:Z,onChange:I,placeholder:"Per\xedodo",className:"min-w-[80px] sm:min-w-[100px] text-xs sm:text-sm"})]})]})]})})]})}),_&&(0,r.jsx)("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg mb-4 text-center border border-red-100 dark:border-red-800",children:_}),!_&&0===es.length&&(0,r.jsxs)("div",{className:"p-12 bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 text-center",children:[(0,r.jsx)(d.Z,{className:"w-16 h-16 text-gray-400 dark:text-gray-600 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"No hay datos"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Selecciona un per\xedodo v\xe1lido con los filtros."})]}),!_&&es.length>0&&(0,r.jsx)("div",{className:"space-y-4",children:es.map(e=>{var t,a,s,l,d,n,g;let b="".concat(e.period_date,"-").concat(e.period_type);return(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl sm:rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-3 sm:p-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between mb-3 sm:mb-4 pb-3 sm:pb-4 border-b border-gray-200 dark:border-gray-700 gap-3 sm:gap-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,r.jsx)(o.Z,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("h3",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-white truncate",children:ee(e.period_date,e.period_type)}),(0,r.jsx)("p",{className:"text-[10px] sm:text-xs text-gray-500",children:et(e.archived_at)}),e.is_synthetic&&(0,r.jsxs)("p",{className:"text-[10px] sm:text-xs text-amber-600 dark:text-amber-400 mt-1 flex items-center gap-1",children:[(0,r.jsx)(i,{className:"w-3 h-3"}),(0,r.jsx)("span",{className:"truncate",children:e.synthetic_note||"Per\xedodo reconstruido desde totales (sin desglose por plataforma)"})]})]})]}),(0,r.jsxs)("div",{className:"ml-0 sm:ml-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-start sm:justify-end gap-1.5 sm:gap-2 mb-1.5 sm:mb-2",children:[(0,r.jsx)("div",{className:"text-[10px] sm:text-xs font-semibold uppercase text-gray-600 dark:text-gray-400",children:"RATES"}),el&&T!==b&&(0,r.jsxs)("button",{onClick:()=>eo(e),className:"text-[10px] sm:text-xs text-blue-600 flex items-center gap-1 active:scale-95 touch-manipulation",children:[(0,r.jsx)(c,{className:"w-3 h-3"}),"Editar"]})]}),T===b?(0,r.jsxs)("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:[(0,r.jsx)("input",{type:"number",value:R.eur_usd,onChange:e=>V({...R,eur_usd:e.target.value}),placeholder:"EUR",className:"w-14 sm:w-16 text-[10px] sm:text-xs border rounded px-1"}),(0,r.jsx)("input",{type:"number",value:R.gbp_usd,onChange:e=>V({...R,gbp_usd:e.target.value}),placeholder:"GBP",className:"w-14 sm:w-16 text-[10px] sm:text-xs border rounded px-1"}),(0,r.jsx)("input",{type:"number",value:R.usd_cop,onChange:e=>V({...R,usd_cop:e.target.value}),placeholder:"COP",className:"w-14 sm:w-16 text-[10px] sm:text-xs border rounded px-1"}),(0,r.jsx)("button",{onClick:()=>ec(e),className:"text-green-600 active:scale-95 touch-manipulation",children:(0,r.jsx)(x,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),(0,r.jsx)("button",{onClick:en,className:"text-red-600 active:scale-95 touch-manipulation",children:(0,r.jsx)(m.Z,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]}):(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 sm:gap-2 text-[10px] sm:text-xs",children:[(0,r.jsxs)("span",{className:"bg-blue-50 dark:bg-blue-900/30 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-800",children:["EUR→USD: ",null===(a=e.rates)||void 0===a?void 0:null===(t=a.eur_usd)||void 0===t?void 0:t.toFixed(4)]}),(0,r.jsxs)("span",{className:"bg-blue-50 dark:bg-blue-900/30 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-800",children:["GBP→USD: ",null===(l=e.rates)||void 0===l?void 0:null===(s=l.gbp_usd)||void 0===s?void 0:s.toFixed(4)]}),(0,r.jsxs)("span",{className:"bg-blue-50 dark:bg-blue-900/30 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-800",children:["USD→COP: ",null===(n=e.rates)||void 0===n?void 0:null===(d=n.usd_cop)||void 0===d?void 0:d.toFixed(0)]})]})]})]}),(0,r.jsx)("div",{className:"mb-4",children:e.is_synthetic?(0,r.jsxs)("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3 sm:p-4 text-center",children:[(0,r.jsx)(u,{className:"w-4 h-4 sm:w-5 sm:h-5 text-amber-600 dark:text-amber-400 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-xs sm:text-sm text-amber-800 dark:text-amber-300 font-medium",children:"Este per\xedodo fue reconstruido desde totales consolidados"}),(0,r.jsx)("p",{className:"text-[10px] sm:text-xs text-amber-600 dark:text-amber-400 mt-1",children:"No hay desglose por plataforma disponible. Solo se muestran los totales."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"md:hidden space-y-2",children:e.platforms.filter(e=>e.value>0).map(e=>(0,r.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:e.platform_name}),(0,r.jsxs)("p",{className:"text-[10px] text-gray-500 dark:text-gray-400",children:["Reparto: ",e.platform_percentage,"%"]})]}),el&&(0,r.jsx)("div",{className:"flex-shrink-0 ml-2",children:(null==L?void 0:L.periodKey)===b&&(null==L?void 0:L.platformId)===e.platform_id?(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)("button",{onClick:()=>ei(b,e.platform_id),className:"text-green-600 active:scale-95 touch-manipulation",children:(0,r.jsx)(x,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:en,className:"text-red-600 active:scale-95 touch-manipulation",children:(0,r.jsx)(m.Z,{className:"w-4 h-4"})})]}):(0,r.jsx)("button",{onClick:()=>ed(b,e.platform_id,e.value),className:"text-blue-600 hover:text-blue-500 active:scale-95 touch-manipulation",children:(0,r.jsx)(c,{className:"w-4 h-4"})})})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mb-0.5",children:"Valor"}),(null==L?void 0:L.periodKey)===b&&(null==L?void 0:L.platformId)===e.platform_id?(0,r.jsx)("input",{type:"number",value:F,onChange:e=>J(e.target.value),className:"w-full px-2 py-1.5 text-sm border rounded-lg text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-800"}):(0,r.jsxs)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:[er(e.value)," ",(0,r.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.platform_currency})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mb-0.5",children:"USD Modelo"}),(0,r.jsx)("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:ea(e.value_usd_modelo||0,"USD")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mb-0.5",children:"COP Modelo"}),(0,r.jsx)("p",{className:"font-medium text-gray-700 dark:text-gray-300",children:ea(e.value_cop_modelo||0,"COP")})]})]})]})]},e.platform_id))}),(0,r.jsx)("div",{className:"hidden md:block overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm text-gray-900 dark:text-gray-100",children:[(0,r.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700/50 text-xs uppercase text-gray-500 dark:text-gray-400",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-3 py-2 text-left",children:"Plataforma"}),(0,r.jsx)("th",{className:"px-3 py-2 text-left",children:"Valor"}),(0,r.jsx)("th",{className:"px-3 py-2 text-left",children:"USD"}),(0,r.jsx)("th",{className:"px-3 py-2 text-left",children:"COP"}),el&&(0,r.jsx)("th",{})]})}),(0,r.jsx)("tbody",{children:e.platforms.filter(e=>e.value>0).map(e=>(0,r.jsxs)("tr",{className:"border-b border-gray-100 dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700/20 transition-colors",children:[(0,r.jsxs)("td",{className:"px-3 py-2 font-medium",children:[e.platform_name," ",(0,r.jsxs)("span",{className:"text-xs text-gray-400 dark:text-gray-500 block",children:[e.platform_percentage,"%"]})]}),(0,r.jsxs)("td",{className:"px-3 py-2 font-medium",children:[(null==L?void 0:L.periodKey)===b&&(null==L?void 0:L.platformId)===e.platform_id?(0,r.jsx)("input",{type:"number",value:F,onChange:e=>J(e.target.value),className:"w-20 border rounded px-1 text-xs text-gray-900"}):er(e.value)," ",(0,r.jsx)("span",{className:"text-gray-500 dark:text-gray-400 text-xs",children:e.platform_currency})]}),(0,r.jsx)("td",{className:"px-3 py-2",children:ea(e.value_usd_modelo||0,"USD")}),(0,r.jsx)("td",{className:"px-3 py-2",children:ea(e.value_cop_modelo||0,"COP")}),el&&(0,r.jsx)("td",{className:"px-3 py-2",children:(null==L?void 0:L.periodKey)===b&&(null==L?void 0:L.platformId)===e.platform_id?(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)("button",{onClick:()=>ei(b,e.platform_id),className:"text-green-600",children:(0,r.jsx)(x,{className:"w-3 h-3"})}),(0,r.jsx)("button",{onClick:en,className:"text-red-600",children:(0,r.jsx)(m.Z,{className:"w-3 h-3"})})]}):(0,r.jsx)("button",{onClick:()=>ed(b,e.platform_id,e.value),className:"text-blue-600 hover:text-blue-500",children:(0,r.jsx)(c,{className:"w-3 h-3"})})})]},e.platform_id))})]})})]})}),(0,r.jsxs)("div",{className:"mt-4 sm:mt-6 pt-3 sm:pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 mb-3 sm:mb-4",children:[(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 p-2.5 sm:p-3 rounded-lg sm:rounded-xl border border-gray-100 dark:border-gray-700",children:[(0,r.jsx)("div",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 mb-0.5 sm:mb-1",children:"USD Modelo"}),(0,r.jsx)("div",{className:"text-base sm:text-lg font-bold text-green-600 dark:text-green-400",children:ea(e.total_usd_modelo||0,"USD")})]}),(0,r.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/40 p-2.5 sm:p-3 rounded-lg sm:rounded-xl border border-blue-100 dark:border-blue-800/50",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-0.5 sm:mb-1",children:[(0,r.jsx)("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400",children:"COP Generado"}),(0,r.jsx)("span",{className:"text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300",children:ea(e.total_cop_modelo||0,"COP")})]}),(e.total_anticipos||0)>0&&(0,r.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,r.jsxs)("span",{className:"text-xs text-red-500 dark:text-red-400 flex items-center gap-1",children:[(0,r.jsx)("span",{children:"(-)"})," Anticipos"]}),(0,r.jsxs)("span",{className:"text-sm font-medium text-red-600 dark:text-red-400",children:["- ",ea(e.total_anticipos||0,"COP")]})]}),e.deducciones&&e.deducciones.length>0||el&&G===b?(0,r.jsxs)("div",{className:"mb-2 pb-2 border-b border-gray-200 dark:border-gray-700 border-dashed",children:[null===(g=e.deducciones)||void 0===g?void 0:g.map(e=>(0,r.jsxs)("div",{className:"flex justify-between items-center mb-1 group hover:bg-white/50 dark:hover:bg-gray-700/30 p-1 rounded",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[e.amount>0?(0,r.jsxs)("span",{className:"text-xs text-orange-600 dark:text-orange-400 flex items-center gap-1",children:[(0,r.jsx)("span",{children:"(-)"})," ",e.concept]}):(0,r.jsxs)("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:[(0,r.jsx)("span",{children:"(+)"})," ",e.concept]}),el&&(0,r.jsx)("button",{onClick:()=>em(e.id),className:"opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-400 transition-opacity",title:"Eliminar",children:(0,r.jsx)(p,{className:"w-3 h-3"})})]}),e.amount>0?(0,r.jsxs)("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:["- ",ea(e.amount,"COP")]}):(0,r.jsxs)("span",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:["+ ",ea(Math.abs(e.amount),"COP")]})]},e.id)),el&&G===b&&(0,r.jsxs)("div",{className:"mt-2 bg-white dark:bg-gray-700 p-2 rounded border border-orange-200 dark:border-orange-500/30 shadow-sm",children:[(0,r.jsxs)("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1 flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Nueva entrada"}),(0,r.jsxs)("select",{value:$,onChange:e=>K(e.target.value),className:"text-xs border rounded bg-gray-50 dark:bg-gray-800 dark:text-white border-gray-300 dark:border-gray-600 px-1 py-0.5",children:[(0,r.jsx)("option",{value:"deduction",children:"Deducci\xf3n (-)"}),(0,r.jsx)("option",{value:"bonus",children:"Excedente (+)"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,r.jsx)("input",{type:"text",placeholder:"deduction"===$?"Concepto (ej: Multa)":"Concepto (ej: Bono)",className:"flex-1 text-xs border rounded px-2 py-1 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:placeholder-gray-500",value:q.concept,onChange:e=>H({...q,concept:e.target.value})}),(0,r.jsx)("input",{type:"number",placeholder:"Monto",className:"w-24 text-xs border rounded px-2 py-1 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:placeholder-gray-500",value:q.amount,onChange:e=>H({...q,amount:e.target.value})})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{onClick:()=>{W(null),K("deduction")},className:"text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 px-2 py-1",children:"Cancelar"}),(0,r.jsx)("button",{onClick:()=>ex(e),disabled:!q.concept||!q.amount,className:"text-xs text-white px-2 py-1 rounded disabled:opacity-50 ".concat("deduction"===$?"bg-orange-500 hover:bg-orange-600":"bg-green-600 hover:bg-green-700"),children:"Guardar"})]})]})]}):null,el&&G!==b&&(0,r.jsx)("div",{className:"mb-2 text-right",children:(0,r.jsxs)("button",{onClick:()=>{W(b),H({concept:"",amount:""}),K("deduction")},className:"text-[10px] text-blue-600 dark:text-blue-400 hover:underline inline-flex items-center gap-1",children:[(0,r.jsx)(h,{className:"w-3 h-3"})," Agregar ajuste"]})}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-1 border-t border-blue-200/50 dark:border-blue-800/30",children:[(0,r.jsx)("span",{className:"text-xs font-bold text-gray-900 dark:text-white uppercase tracking-wide",children:"Neto a Pagar"}),(0,r.jsx)("span",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:ea(void 0!==e.neto_pagar?e.neto_pagar:e.total_cop_modelo||0,"COP")})]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 p-3 rounded-xl mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsxs)("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Objetivo (",ea(e.cuota_minima||0,"USD"),")"]}),(0,r.jsxs)("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:[e.porcentaje_alcanzado,"%"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:"".concat(Math.min(e.porcentaje_alcanzado||0,100),"%")}})})]})]})]},b)})})]})}},883:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});var r=a(7437),s=a(2265);let l={green:"bg-green-100 text-green-800",blue:"bg-blue-100 text-blue-800",red:"bg-red-100 text-red-800",yellow:"bg-yellow-100 text-yellow-800",gray:"bg-gray-100 text-gray-800"};function d(e){let{options:t,value:a,onChange:d,placeholder:o="Selecciona una opci\xf3n",className:n="",disabled:i=!1,maxHeight:c="max-h-60",autoOpen:x=!1}=e,[m,u]=(0,s.useState)(!1),p=(0,s.useRef)(null);(0,s.useEffect)(()=>{x&&t.length>1?u(!0):x||u(!1)},[x,t.length]),(0,s.useEffect)(()=>{let e=e=>{p.current&&!p.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&u(!1)};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[]),(0,s.useEffect)(()=>{m&&p.current&&setTimeout(()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)},[m]);let h=t.find(e=>e.value===a),g=e=>{d(e),u(!1)};return(0,r.jsxs)("div",{className:"relative ".concat(n),ref:p,children:[(0,r.jsx)("button",{type:"button",className:"w-full px-3 py-2 text-sm text-left border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 cursor-pointer flex items-center justify-between hover:border-gray-400 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all duration-200 ".concat(i?"opacity-50 cursor-not-allowed":""),onClick:()=>!i&&u(!m),disabled:i,"aria-haspopup":"listbox","aria-expanded":m,children:(0,r.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,r.jsx)("span",{className:h?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-400",children:h?h.label:o}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(null==h?void 0:h.badge)&&(0,r.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat(l[h.badgeColor||"gray"]),children:h.badge}),(0,r.jsx)("svg",{className:"w-5 h-5 text-gray-400 transition-transform duration-200 ".concat(m?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}),m&&(0,r.jsx)("div",{className:"absolute z-[99998] w-full mt-1 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg dark:shadow-lg dark:shadow-cyan-900/10 dark:ring-0.5 dark:ring-cyan-500/15 ".concat(c," overflow-auto apple-scroll"),children:0===t.length?(0,r.jsx)("div",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:"No hay opciones disponibles"}):t.map((e,t)=>(0,r.jsxs)("div",{children:[t>0&&(0,r.jsx)("div",{className:"w-full h-px bg-gray-100 dark:bg-gray-600/50 dark:shadow-sm dark:shadow-blue-900/10"}),(0,r.jsxs)("div",{className:"px-4 py-3 text-sm cursor-pointer transition-colors duration-150 flex items-center justify-between ".concat(e.disabled?"text-gray-400 dark:text-gray-500 cursor-not-allowed":"hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-900 dark:text-gray-100"," ").concat(e.value===a?"bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-100":""),onClick:()=>!e.disabled&&g(e.value),children:[(0,r.jsx)("span",{children:e.label}),e.badge&&(0,r.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat(l[e.badgeColor||"gray"]),children:e.badge})]})]},e.value))})]})}},5922:function(e,t,a){"use strict";a.r(t),a.d(t,{supabase:function(){return r}});let r=(0,a(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")},622:function(e,t,a){"use strict";var r=a(2265),s=Symbol.for("react.element"),l=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function i(e,t,a){var r,l={},i=null,c=null;for(r in void 0!==a&&(i=""+a),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(c=t.ref),t)d.call(t,r)&&!n.hasOwnProperty(r)&&(l[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===l[r]&&(l[r]=t[r]);return{$$typeof:s,type:e,key:i,ref:c,props:l,_owner:o.current}}t.Fragment=l,t.jsx=i,t.jsxs=i},7437:function(e,t,a){"use strict";e.exports=a(622)}},function(e){e.O(0,[5257,2971,4938,1744],function(){return e(e.s=1282)}),_N_E=e.O()}]);