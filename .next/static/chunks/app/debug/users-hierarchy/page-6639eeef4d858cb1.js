(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2620],{2601:function(e,r,s){"use strict";var t,n;e.exports=(null==(t=s.g.process)?void 0:t.env)&&"object"==typeof(null==(n=s.g.process)?void 0:n.env)?s.g.process:s(8960)},2850:function(e,r,s){Promise.resolve().then(s.bind(s,185))},185:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return o}});var t=s(7437),n=s(2265),a=s(5922);function o(){let[e,r]=(0,n.useState)(null),[s,o]=(0,n.useState)(!0),[l,i]=(0,n.useState)(null);return((0,n.useEffect)(()=>{(async()=>{try{var e;console.log("\uD83D\uDD0D [DEBUG-USERS] Iniciando diagn\xf3stico de jerarqu\xeda de usuarios...");let{data:{user:s}}=await a.O.auth.getUser();if(!s){i("Usuario no autenticado");return}console.log("\uD83D\uDD0D [DEBUG-USERS] Usuario autenticado:",s.id);let{data:t,error:n}=await a.O.from("users").select("\n            role,\n            user_groups(\n              groups!inner(\n                id,\n                name\n              )\n            )\n          ").eq("id",s.id).single();if(n){console.error("❌ [DEBUG-USERS] Error obteniendo datos del usuario:",n),i("Error obteniendo datos del usuario: "+n.message);return}if(!t){i("Error obteniendo datos del usuario");return}let o=(null===(e=t.user_groups)||void 0===e?void 0:e.map(e=>e.groups.id))||[];console.log("\uD83D\uDD0D [DEBUG-USERS] Datos del usuario actual:",{id:s.id,role:t.role,groups:o});let{data:l,error:d}=await a.O.from("users").select("\n            id,\n            name,\n            email,\n            role,\n            is_active,\n            user_groups(\n              groups!inner(\n                id,\n                name\n              )\n            )\n          ").order("created_at",{ascending:!1});if(d){console.error("❌ [DEBUG-USERS] Error obteniendo usuarios:",d),i("Error obteniendo usuarios: "+d.message);return}console.log("\uD83D\uDD0D [DEBUG-USERS] Usuarios obtenidos de Supabase:",(null==l?void 0:l.length)||0);let u=l||[];"admin"===t.role?(console.log("\uD83D\uDD0D [DEBUG-USERS] Aplicando filtro de jerarqu\xeda para admin:",{userGroupIds:o,totalUsers:u.length}),u=(l||[]).filter(e=>{if("super_admin"===e.role)return!1;if(("admin"===e.role||"modelo"===e.role)&&e.user_groups&&e.user_groups.length>0){let r=e.user_groups.map(e=>e.groups.id),s=r.some(e=>o.includes(e));return console.log("\uD83D\uDD0D [DEBUG-USERS] Usuario:",e.name,{role:e.role,targetGroups:r,hasCommonGroup:s,willShow:s}),s}return!1}),console.log("\uD83D\uDD0D [DEBUG-USERS] Usuarios despu\xe9s del filtro:",u.length)):"super_admin"===t.role&&console.log("\uD83D\uDD0D [DEBUG-USERS] Super admin - mostrando todos los usuarios"),r({id:s.id,role:t.role,groups:o,totalUsers:(null==l?void 0:l.length)||0,filteredUsers:u.length})}catch(e){console.error("❌ [DEBUG-USERS] Error general:",e),i("Error general: "+e.message)}finally{o(!1)}})()},[]),s)?(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:"Diagnosticando jerarqu\xeda de usuarios..."})]})}):l?(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-red-600 dark:text-red-400 mb-4",children:"Error"}),(0,t.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:l})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 py-8",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto px-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"\uD83D\uDD0D Diagn\xf3stico de Jerarqu\xeda de Usuarios"}),e&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-3",children:"Informaci\xf3n del Usuario Actual"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ID:"}),(0,t.jsx)("p",{className:"font-mono text-sm text-gray-900 dark:text-white",children:e.id})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Rol:"}),(0,t.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:e.role})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Grupos Asignados:"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:e.groups.length>0?e.groups.map((e,r)=>(0,t.jsx)("span",{className:"bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 px-2 py-1 rounded text-sm",children:e},r)):(0,t.jsx)("span",{className:"text-gray-500 dark:text-gray-400 italic",children:"Sin grupos asignados"})})]})]})]}),(0,t.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-green-900 dark:text-green-100 mb-3",children:"Resultados del Filtrado"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total de Usuarios:"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.totalUsers})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Usuarios Visibles:"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.filteredUsers})]})]})]}),(0,t.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-yellow-900 dark:text-yellow-100 mb-3",children:"An\xe1lisis"}),(0,t.jsxs)("div",{className:"space-y-2",children:["admin"===e.role&&0===e.groups.length&&(0,t.jsxs)("p",{className:"text-yellow-800 dark:text-yellow-200",children:["⚠️ ",(0,t.jsx)("strong",{children:"Problema detectado:"})," El usuario admin no tiene grupos asignados. Esto causar\xe1 que vea todos los usuarios sin filtro de jerarqu\xeda."]}),"admin"===e.role&&e.groups.length>0&&e.filteredUsers===e.totalUsers&&(0,t.jsxs)("p",{className:"text-yellow-800 dark:text-yellow-200",children:["⚠️ ",(0,t.jsx)("strong",{children:"Posible problema:"})," El filtro de jerarqu\xeda no est\xe1 funcionando correctamente. Se est\xe1n mostrando todos los usuarios."]}),"admin"===e.role&&e.groups.length>0&&e.filteredUsers<e.totalUsers&&(0,t.jsxs)("p",{className:"text-green-800 dark:text-green-200",children:["✅ ",(0,t.jsx)("strong",{children:"Funcionando correctamente:"})," El filtro de jerarqu\xeda est\xe1 aplic\xe1ndose. Solo se muestran los usuarios de los grupos asignados."]}),"super_admin"===e.role&&(0,t.jsxs)("p",{className:"text-blue-800 dark:text-blue-200",children:["ℹ️ ",(0,t.jsx)("strong",{children:"Super Admin:"})," Puede ver todos los usuarios sin restricciones."]})]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Instrucciones"}),(0,t.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-2",children:[(0,t.jsx)("p",{children:"1. Revisa la consola del navegador para ver los logs detallados"}),(0,t.jsx)("p",{children:"2. Si hay problemas, verifica que el usuario tenga grupos asignados"}),(0,t.jsx)("p",{children:'3. Compara estos resultados con lo que ves en "Consultar Usuarios"'})]})]})]})]})})})}},5922:function(e,r,s){"use strict";s.d(r,{O:function(){return t}});let t=(0,s(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")},8960:function(e){!function(){var r={229:function(e){var r,s,t,n=e.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(s){try{return r.call(null,e,0)}catch(s){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{s="function"==typeof clearTimeout?clearTimeout:o}catch(e){s=o}}();var i=[],d=!1,u=-1;function c(){d&&t&&(d=!1,t.length?i=t.concat(i):u=-1,i.length&&g())}function g(){if(!d){var e=l(c);d=!0;for(var r=i.length;r;){for(t=i,i=[];++u<r;)t&&t[u].run();u=-1,r=i.length}t=null,d=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===o||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(r){try{return s.call(null,e)}catch(r){return s.call(this,e)}}}(e)}}function m(e,r){this.fun=e,this.array=r}function x(){}n.nextTick=function(e){var r=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)r[s-1]=arguments[s];i.push(new m(e,r)),1!==i.length||d||l(g)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=x,n.addListener=x,n.once=x,n.off=x,n.removeListener=x,n.removeAllListeners=x,n.emit=x,n.prependListener=x,n.prependOnceListener=x,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},s={};function t(e){var n=s[e];if(void 0!==n)return n.exports;var a=s[e]={exports:{}},o=!0;try{r[e](a,a.exports,t),o=!1}finally{o&&delete s[e]}return a.exports}t.ab="//";var n=t(229);e.exports=n}()},622:function(e,r,s){"use strict";var t=s(2265),n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function d(e,r,s){var t,a={},d=null,u=null;for(t in void 0!==s&&(d=""+s),void 0!==r.key&&(d=""+r.key),void 0!==r.ref&&(u=r.ref),r)o.call(r,t)&&!i.hasOwnProperty(t)&&(a[t]=r[t]);if(e&&e.defaultProps)for(t in r=e.defaultProps)void 0===a[t]&&(a[t]=r[t]);return{$$typeof:n,type:e,key:d,ref:u,props:a,_owner:l.current}}r.Fragment=a,r.jsx=d,r.jsxs=d},7437:function(e,r,s){"use strict";e.exports=s(622)}},function(e){e.O(0,[5257,2971,4938,1744],function(){return e(e.s=2850)}),_N_E=e.O()}]);