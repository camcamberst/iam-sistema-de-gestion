(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2620,5922],{2850:function(e,s,r){Promise.resolve().then(r.bind(r,185))},185:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return o}});var a=r(7437),t=r(2265),l=r(5922);function o(){let[e,s]=(0,t.useState)(null),[r,o]=(0,t.useState)(!0),[n,i]=(0,t.useState)(null);return((0,t.useEffect)(()=>{(async()=>{try{var e;console.log("\uD83D\uDD0D [DEBUG-USERS] Iniciando diagn\xf3stico de jerarqu\xeda de usuarios...");let{data:{user:r}}=await l.supabase.auth.getUser();if(!r){i("Usuario no autenticado");return}console.log("\uD83D\uDD0D [DEBUG-USERS] Usuario autenticado:",r.id);let{data:a,error:t}=await l.supabase.from("users").select("\n            role,\n            user_groups(\n              groups!inner(\n                id,\n                name\n              )\n            )\n          ").eq("id",r.id).single();if(t){console.error("❌ [DEBUG-USERS] Error obteniendo datos del usuario:",t),i("Error obteniendo datos del usuario: "+t.message);return}if(!a){i("Error obteniendo datos del usuario");return}let o=(null===(e=a.user_groups)||void 0===e?void 0:e.map(e=>e.groups.id))||[];console.log("\uD83D\uDD0D [DEBUG-USERS] Datos del usuario actual:",{id:r.id,role:a.role,groups:o});let{data:n,error:d}=await l.supabase.from("users").select("\n            id,\n            name,\n            email,\n            role,\n            is_active,\n            user_groups(\n              groups!inner(\n                id,\n                name\n              )\n            )\n          ").order("created_at",{ascending:!1});if(d){console.error("❌ [DEBUG-USERS] Error obteniendo usuarios:",d),i("Error obteniendo usuarios: "+d.message);return}console.log("\uD83D\uDD0D [DEBUG-USERS] Usuarios obtenidos de Supabase:",(null==n?void 0:n.length)||0);let u=n||[];"admin"===a.role?(console.log("\uD83D\uDD0D [DEBUG-USERS] Aplicando filtro de jerarqu\xeda para admin:",{userGroupIds:o,totalUsers:u.length}),u=(n||[]).filter(e=>{if("super_admin"===e.role)return!1;if(("admin"===e.role||"modelo"===e.role)&&e.user_groups&&e.user_groups.length>0){let s=e.user_groups.map(e=>e.groups.id),r=s.some(e=>o.includes(e));return console.log("\uD83D\uDD0D [DEBUG-USERS] Usuario:",e.name,{role:e.role,targetGroups:s,hasCommonGroup:r,willShow:r}),r}return!1}),console.log("\uD83D\uDD0D [DEBUG-USERS] Usuarios despu\xe9s del filtro:",u.length)):"super_admin"===a.role&&console.log("\uD83D\uDD0D [DEBUG-USERS] Super admin - mostrando todos los usuarios"),s({id:r.id,role:a.role,groups:o,totalUsers:(null==n?void 0:n.length)||0,filteredUsers:u.length})}catch(e){console.error("❌ [DEBUG-USERS] Error general:",e),i("Error general: "+e.message)}finally{o(!1)}})()},[]),r)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:"Diagnosticando jerarqu\xeda de usuarios..."})]})}):n?(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-red-600 dark:text-red-400 mb-4",children:"Error"}),(0,a.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:n})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 py-8",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"\uD83D\uDD0D Diagn\xf3stico de Jerarqu\xeda de Usuarios"}),e&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-3",children:"Informaci\xf3n del Usuario Actual"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ID:"}),(0,a.jsx)("p",{className:"font-mono text-sm text-gray-900 dark:text-white",children:e.id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Rol:"}),(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:e.role})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Grupos Asignados:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:e.groups.length>0?e.groups.map((e,s)=>(0,a.jsx)("span",{className:"bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 px-2 py-1 rounded text-sm",children:e},s)):(0,a.jsx)("span",{className:"text-gray-500 dark:text-gray-400 italic",children:"Sin grupos asignados"})})]})]})]}),(0,a.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-green-900 dark:text-green-100 mb-3",children:"Resultados del Filtrado"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total de Usuarios:"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.totalUsers})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Usuarios Visibles:"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.filteredUsers})]})]})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-yellow-900 dark:text-yellow-100 mb-3",children:"An\xe1lisis"}),(0,a.jsxs)("div",{className:"space-y-2",children:["admin"===e.role&&0===e.groups.length&&(0,a.jsxs)("p",{className:"text-yellow-800 dark:text-yellow-200",children:["⚠️ ",(0,a.jsx)("strong",{children:"Problema detectado:"})," El usuario admin no tiene grupos asignados. Esto causar\xe1 que vea todos los usuarios sin filtro de jerarqu\xeda."]}),"admin"===e.role&&e.groups.length>0&&e.filteredUsers===e.totalUsers&&(0,a.jsxs)("p",{className:"text-yellow-800 dark:text-yellow-200",children:["⚠️ ",(0,a.jsx)("strong",{children:"Posible problema:"})," El filtro de jerarqu\xeda no est\xe1 funcionando correctamente. Se est\xe1n mostrando todos los usuarios."]}),"admin"===e.role&&e.groups.length>0&&e.filteredUsers<e.totalUsers&&(0,a.jsxs)("p",{className:"text-green-800 dark:text-green-200",children:["✅ ",(0,a.jsx)("strong",{children:"Funcionando correctamente:"})," El filtro de jerarqu\xeda est\xe1 aplic\xe1ndose. Solo se muestran los usuarios de los grupos asignados."]}),"super_admin"===e.role&&(0,a.jsxs)("p",{className:"text-blue-800 dark:text-blue-200",children:["ℹ️ ",(0,a.jsx)("strong",{children:"Super Admin:"})," Puede ver todos los usuarios sin restricciones."]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Instrucciones"}),(0,a.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-2",children:[(0,a.jsx)("p",{children:"1. Revisa la consola del navegador para ver los logs detallados"}),(0,a.jsx)("p",{children:"2. Si hay problemas, verifica que el usuario tenga grupos asignados"}),(0,a.jsx)("p",{children:'3. Compara estos resultados con lo que ves en "Consultar Usuarios"'})]})]})]})]})})})}},5922:function(e,s,r){"use strict";r.r(s),r.d(s,{supabase:function(){return a}});let a=(0,r(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")},622:function(e,s,r){"use strict";var a=r(2265),t=Symbol.for("react.element"),l=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,n=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function d(e,s,r){var a,l={},d=null,u=null;for(a in void 0!==r&&(d=""+r),void 0!==s.key&&(d=""+s.key),void 0!==s.ref&&(u=s.ref),s)o.call(s,a)&&!i.hasOwnProperty(a)&&(l[a]=s[a]);if(e&&e.defaultProps)for(a in s=e.defaultProps)void 0===l[a]&&(l[a]=s[a]);return{$$typeof:t,type:e,key:d,ref:u,props:l,_owner:n.current}}s.Fragment=l,s.jsx=d,s.jsxs=d},7437:function(e,s,r){"use strict";e.exports=r(622)}},function(e){e.O(0,[5257,2971,4938,1744],function(){return e(e.s=2850)}),_N_E=e.O()}]);