(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3561],{345:function(e,r,o){Promise.resolve().then(o.bind(o,1345))},1345:function(e,r,o){"use strict";o.r(r),o.d(r,{default:function(){return t}});var a=o(7437),s=o(2265);let l=(0,o(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c");function t(){let[e,r]=(0,s.useState)(!0),[o,t]=(0,s.useState)([]),[n,d]=(0,s.useState)([]),[i,c]=(0,s.useState)(null);(0,s.useEffect)(()=>{u()},[]);let u=async()=>{try{r(!0),c(null),console.log("\uD83D\uDD0D [DIAGN\xd3STICO] Iniciando an\xe1lisis de sincronizaci\xf3n..."),console.log("\uD83D\uDD0D [DIAGN\xd3STICO] Variables de entorno:",{supabaseUrl:"✅ Configurado",supabaseAnonKey:"✅ Configurado"});let e=new Date().toISOString().split("T")[0];console.log("\uD83D\uDCC5 [DIAGN\xd3STICO] Fecha actual:",e),console.log("\uD83D\uDC65 [DIAGN\xd3STICO] Obteniendo modelos activos...");let{data:o,error:a}=await l.from("users").select("id, email, name, role, is_active").limit(50);console.log("\uD83D\uDD0D [DIAGN\xd3STICO] Todos los usuarios (primeros 50):",o),console.log("\uD83D\uDD0D [DIAGN\xd3STICO] Error obteniendo todos los usuarios:",a),o&&o.length>0&&console.log("\uD83D\uDD0D [DIAGN\xd3STICO] Detalles del usuario encontrado:",{id:o[0].id,email:o[0].email,name:o[0].name,role:o[0].role,is_active:o[0].is_active});let{data:s,error:n}=await l.from("users").select("id, email, name, role").eq("role","modelo").eq("is_active",!0);console.log("\uD83D\uDD0D [DIAGN\xd3STICO] Error obteniendo modelos:",n),console.log("\uD83D\uDD0D [DIAGN\xd3STICO] Modelos encontrados:",s);let{data:i,error:u}=await l.from("users").select("role").eq("is_active",!0);if(u)console.log("❌ [DIAGN\xd3STICO] Error obteniendo roles:",u);else{let e=Array.from(new Set((null==i?void 0:i.map(e=>e.role))||[]));console.log("\uD83D\uDD0D [DIAGN\xd3STICO] Roles \xfanicos encontrados:",e),console.log('\uD83D\uDD0D [DIAGN\xd3STICO] \xbfExiste rol "modelo"?',e.includes("modelo"))}if(n)throw Error("Error obteniendo modelos: ".concat(n.message));console.log("✅ [DIAGN\xd3STICO] Modelos encontrados: ".concat((null==s?void 0:s.length)||0)),d(s||[]);let m=[];for(let r of s||[]){console.log("\uD83D\uDD0D [DIAGN\xd3STICO] Analizando modelo: ".concat(r.name," (").concat(r.email,")"));let{data:o,error:a}=await l.from("model_values").select("*").eq("model_id",r.id).eq("period_date",e);if(a){console.error("❌ [DIAGN\xd3STICO] Error obteniendo model_values para ".concat(r.name,":"),a);continue}let{data:s,error:t}=await l.from("calculator_totals").select("*").eq("model_id",r.id).eq("period_date",e);if(t){console.error("❌ [DIAGN\xd3STICO] Error obteniendo calculator_totals para ".concat(r.name,":"),t);continue}let n=o&&o.length>0,d=s&&s.length>0;if(console.log("  \uD83D\uDCCA [DIAGN\xd3STICO] Model Values: ".concat(n?"✅":"❌"," (").concat((null==o?void 0:o.length)||0," registros)")),console.log("  \uD83D\uDCCA [DIAGN\xd3STICO] Calculator Totals: ".concat(d?"✅":"❌"," (").concat((null==s?void 0:s.length)||0," registros)")),n&&!d?(console.log("  ⚠️  [DIAGN\xd3STICO] PROBLEMA: Tiene datos en Mi Calculadora pero NO en Resumen de Facturaci\xf3n"),m.push({model:r.name,email:r.email,issue:"missing_totals",modelValues:o.length,calculatorTotals:0})):!n&&d?(console.log("  ⚠️  [DIAGN\xd3STICO] PROBLEMA: Tiene datos en Resumen de Facturaci\xf3n pero NO en Mi Calculadora"),m.push({model:r.name,email:r.email,issue:"missing_values",modelValues:0,calculatorTotals:s.length})):n&&d?console.log("  ✅ [DIAGN\xd3STICO] Sincronizaci\xf3n correcta"):console.log("  ℹ️  [DIAGN\xd3STICO] Sin datos en ninguna tabla (normal si no ha usado la calculadora hoy)"),n){let e=o.reduce((e,r)=>e+(r.value||0),0);console.log("    \uD83D\uDCB0 [DIAGN\xd3STICO] Total en Model Values: $".concat(e.toFixed(2)))}if(d){let e=s[0];console.log("    \uD83D\uDCB0 [DIAGN\xd3STICO] Total USD Bruto: $".concat(e.total_usd_bruto||0)),console.log("    \uD83D\uDCB0 [DIAGN\xd3STICO] Total USD Modelo: $".concat(e.total_usd_modelo||0)),console.log("    \uD83D\uDCB0 [DIAGN\xd3STICO] Total COP Modelo: $".concat(e.total_cop_modelo||0))}}t(m),console.log("\n\uD83D\uDCCB [DIAGN\xd3STICO] An\xe1lisis completado. Problemas encontrados: ".concat(m.length))}catch(e){console.error("❌ [DIAGN\xd3STICO] Error:",e),c(e.message)}finally{r(!1)}},m=async e=>{try{console.log("\uD83D\uDD27 [FIX] Intentando corregir problema para ".concat(e.model,"..."));let r=n.find(r=>r.email===e.email);if(!r)throw Error("Modelo no encontrado");if("missing_totals"===e.issue){let o=new Date().toISOString().split("T")[0],{data:a,error:s}=await l.from("model_values").select("*").eq("model_id",r.id).eq("period_date",o);if(s||!a)throw Error("Error obteniendo valores del modelo");let t=a.reduce((e,r)=>e+(r.value||0),0),n=.7*t,{error:d}=await l.from("calculator_totals").upsert({model_id:r.id,period_date:o,total_usd_bruto:t,total_usd_modelo:n,total_cop_modelo:3900*n,updated_at:new Date().toISOString()},{onConflict:"model_id,period_date"});if(d)throw Error("Error guardando totales: ".concat(d.message));console.log("✅ [FIX] Totales calculados y guardados para ".concat(e.model)),alert("✅ Problema corregido para ".concat(e.model,". Los totales han sido calculados y guardados."))}else"missing_values"===e.issue&&(console.log("⚠️  [FIX] No se puede corregir autom\xe1ticamente el problema de ".concat(e.model," (datos obsoletos en calculator_totals)")),alert("⚠️ No se puede corregir autom\xe1ticamente el problema de ".concat(e.model,". Los datos en calculator_totals parecen ser obsoletos.")));await u()}catch(e){console.error("❌ [FIX] Error:",e),alert("❌ Error corrigiendo problema: ".concat(e.message))}};return e?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,a.jsx)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Analizando sincronizaci\xf3n de calculadoras..."})]})})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,a.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"\uD83D\uDD0D Diagn\xf3stico de Sincronizaci\xf3n Mi Calculadora ↔ Resumen de Facturaci\xf3n"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"An\xe1lisis de problemas de sincronizaci\xf3n entre las calculadoras de modelos y el resumen de facturaci\xf3n"})]}),i&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-red-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,a.jsxs)("p",{className:"text-red-800 dark:text-red-200 font-medium",children:["Error: ",i]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"\uD83D\uDCCA Resumen General"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:"Total Modelos:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:n.length})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:"Problemas Encontrados:"}),(0,a.jsx)("span",{className:"font-medium ".concat(o.length>0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"),children:o.length})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:"Estado:"}),(0,a.jsx)("span",{className:"font-medium ".concat(0===o.length?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:0===o.length?"✅ Sincronizaci\xf3n Correcta":"❌ Problemas Detectados"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"\uD83D\uDD27 Acciones Disponibles"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("button",{onClick:u,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"\uD83D\uDD04 Reanalizar Sincronizaci\xf3n"}),o.length>0&&(0,a.jsx)("button",{onClick:()=>{confirm("\xbfEst\xe1s seguro de que quieres intentar corregir todos los problemas autom\xe1ticamente?")&&o.forEach(e=>m(e))},className:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:"\uD83D\uDEE0️ Corregir Todos los Problemas"})]})]})]}),o.length>0&&(0,a.jsxs)("div",{className:"bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"⚠️ Problemas de Sincronizaci\xf3n Detectados"}),(0,a.jsx)("div",{className:"space-y-4",children:o.map((e,r)=>(0,a.jsxs)("div",{className:"border border-red-200 dark:border-red-800 rounded-lg p-4 bg-red-50 dark:bg-red-900/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("h3",{className:"font-medium text-red-900 dark:text-red-100",children:[e.model," (",e.email,")"]}),(0,a.jsx)("button",{onClick:()=>m(e),className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-sm rounded transition-colors",children:"\uD83D\uDEE0️ Corregir"})]}),(0,a.jsxs)("div",{className:"text-sm text-red-700 dark:text-red-300",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Problema:"})," ","missing_totals"===e.issue?"Tiene datos en Mi Calculadora pero NO en Resumen de Facturaci\xf3n":"Tiene datos en Resumen de Facturaci\xf3n pero NO en Mi Calculadora"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Model Values:"})," ",e.modelValues," registros"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Calculator Totals:"})," ",e.calculatorTotals," registros"]})]})]},r))})]}),0===o.length&&(0,a.jsx)("div",{className:"bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"✅ Sincronizaci\xf3n Correcta"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"No se encontraron problemas de sincronizaci\xf3n entre Mi Calculadora y Resumen de Facturaci\xf3n."})]})}),(0,a.jsxs)("div",{className:"mt-8 bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"\uD83D\uDCCB Informaci\xf3n T\xe9cnica"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-300 space-y-2",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Fecha de An\xe1lisis:"})," ",new Date().toLocaleString()]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Tablas Analizadas:"})," model_values, calculator_totals"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Per\xedodo:"})," ",new Date().toISOString().split("T")[0]]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Filtros:"})," role = 'modelo', is_active = true"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Supabase URL:"})," ","✅ Configurado"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Supabase Key:"})," ","✅ Configurado"]})]})]}),(0,a.jsxs)("div",{className:"mt-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,a.jsx)("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:"⚠️ Informaci\xf3n de Debugging"})]}),(0,a.jsxs)("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[(0,a.jsx)("p",{className:"mb-2",children:'Si el diagn\xf3stico muestra "0 modelos", esto puede indicar:'}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[(0,a.jsx)("li",{children:"Problema de permisos RLS (Row Level Security) en Supabase"}),(0,a.jsx)("li",{children:"Error en la consulta de usuarios"}),(0,a.jsx)("li",{children:"Problema con las variables de entorno"}),(0,a.jsx)("li",{children:"Filtros incorrectos en la consulta"})]}),(0,a.jsxs)("p",{className:"mt-2",children:[(0,a.jsx)("strong",{children:"Revisa la consola del navegador"})," para ver los logs detallados del diagn\xf3stico."]})]})]})]})})}},622:function(e,r,o){"use strict";var a=o(2265),s=Symbol.for("react.element"),l=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,n=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function i(e,r,o){var a,l={},i=null,c=null;for(a in void 0!==o&&(i=""+o),void 0!==r.key&&(i=""+r.key),void 0!==r.ref&&(c=r.ref),r)t.call(r,a)&&!d.hasOwnProperty(a)&&(l[a]=r[a]);if(e&&e.defaultProps)for(a in r=e.defaultProps)void 0===l[a]&&(l[a]=r[a]);return{$$typeof:s,type:e,key:i,ref:c,props:l,_owner:n.current}}r.Fragment=l,r.jsx=i,r.jsxs=i},7437:function(e,r,o){"use strict";e.exports=o(622)}},function(e){e.O(0,[5257,2971,4938,1744],function(){return e(e.s=345)}),_N_E=e.O()}]);