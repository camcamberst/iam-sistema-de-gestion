(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7424],{3835:function(e,t,a){Promise.resolve().then(a.bind(a,2324))},2324:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(7437),s=a(2265);let l=(0,a(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c");function o(){let[e,t]=(0,s.useState)([]),[a,o]=(0,s.useState)(!1),[n,d]=(0,s.useState)(!1),i=async()=>{try{o(!0),d(!1),console.log("\uD83D\uDD0D [PARTIAL-SYNC] Iniciando an\xe1lisis de sincronizaci\xf3n parcial...");let e=new Date().toISOString().split("T")[0];console.log("\uD83D\uDCC5 [PARTIAL-SYNC] Fecha actual:",e);let{data:a,error:r}=await l.from("users").select("id, email, name, role, is_active").eq("role","modelo").eq("is_active",!0);if(r)throw Error("Error obteniendo modelos: ".concat(r.message));if(console.log("✅ [PARTIAL-SYNC] Modelos encontrados: ".concat((null==a?void 0:a.length)||0)),!a||0===a.length){console.log("❌ [PARTIAL-SYNC] No se encontraron modelos");return}let s=[];for(let t of a){console.log("\uD83D\uDD0D [PARTIAL-SYNC] Analizando: ".concat(t.name," (").concat(t.id,")"));try{let a;let{data:r,error:o}=await l.from("model_values").select("*").eq("model_id",t.id).eq("period_date",e),{data:n,error:d}=await l.from("calculator_totals").select("*").eq("model_id",t.id).eq("period_date",e),i=r&&r.length>0,c=n&&n.length>0,x=0,u=0,g="working";if(c&&n[0]&&(x=n[0].total_usd_bruto||0,u=n[0].total_usd_modelo||0),i||c){if(c){if(0===x&&0===u)g="zero-values",a="Totales en $0.00 (posible problema de c\xe1lculo)";else if(o||d){g="error";let e=(null==o?void 0:o.message)||(null==d?void 0:d.message)||"Error desconocido";a="Error en consulta: ".concat(e)}}else g="no-data",a="Sin totales consolidados (calculator_totals)"}else g="no-data",a="Sin datos en ambas tablas";let m={id:t.id,name:t.name,email:t.email,modelValues:r||[],calculatorTotals:n||[],totalUsdBruto:x,totalUsdModelo:u,status:g,issue:a};s.push(m),console.log("\uD83D\uDCCA [PARTIAL-SYNC] ".concat(t.name,":"),{status:g,issue:a,modelValues:i?"".concat(r.length," registros"):"Sin datos",calculatorTotals:c?"".concat(n.length," registros"):"Sin datos",totalUsdBruto:x,totalUsdModelo:u,valuesError:null==o?void 0:o.message,totalsError:null==d?void 0:d.message})}catch(e){console.error("❌ [PARTIAL-SYNC] Error analizando ".concat(t.name,":"),e),s.push({id:t.id,name:t.name,email:t.email,modelValues:[],calculatorTotals:[],totalUsdBruto:0,totalUsdModelo:0,status:"error",issue:"Error: ".concat((null==e?void 0:e.message)||"Error desconocido")})}}t(s),d(!0);let n=s.filter(e=>"working"===e.status).length,i=s.filter(e=>"no-data"===e.status).length,c=s.filter(e=>"zero-values"===e.status).length,x=s.filter(e=>"error"===e.status).length;console.log("\uD83D\uDCCB [PARTIAL-SYNC] Resumen final:",{total:s.length,working:n,noData:i,zeroValues:c,errors:x})}catch(e){console.error("❌ [PARTIAL-SYNC] Error general:",e)}finally{o(!1)}},c=async e=>{try{console.log("\uD83D\uDD27 [PARTIAL-SYNC] Intentando corregir modelo: ".concat(e));let t=await fetch("/api/calculator/recalculate-totals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({modelId:e})}),a=await t.json();a.success?(console.log("✅ [PARTIAL-SYNC] Modelo ".concat(e," corregido")),await i()):console.error("❌ [PARTIAL-SYNC] Error corrigiendo ".concat(e,":"),a.error)}catch(e){console.error("❌ [PARTIAL-SYNC] Error en correcci\xf3n:",e)}},x=e=>{switch(e){case"working":return"text-green-600 bg-green-50";case"no-data":return"text-red-600 bg-red-50";case"zero-values":return"text-yellow-600 bg-yellow-50";default:return"text-gray-600 bg-gray-50"}},u=e=>{switch(e){case"working":return"✅";case"no-data":return"❌";case"zero-values":return"⚠️";case"error":return"\uD83D\uDD34";default:return"❓"}};return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"\uD83D\uDD0D Diagn\xf3stico de Sincronizaci\xf3n Parcial"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:'Analiza por qu\xe9 algunos modelos muestran valores en "Resumen de Facturaci\xf3n" y otros muestran $0.00'}),(0,r.jsx)("button",{onClick:i,disabled:a,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:a?"Analizando...":"Iniciar An\xe1lisis"})]}),n&&(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"\uD83D\uDCCA Resumen del An\xe1lisis"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:"✅"}),(0,r.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Funcionando"}),(0,r.jsx)("div",{className:"text-lg font-semibold text-green-600",children:e.filter(e=>"working"===e.status).length})]}),(0,r.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-red-600",children:"❌"}),(0,r.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Sin Datos"}),(0,r.jsx)("div",{className:"text-lg font-semibold text-red-600",children:e.filter(e=>"no-data"===e.status).length})]}),(0,r.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:"⚠️"}),(0,r.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Valores en $0"}),(0,r.jsx)("div",{className:"text-lg font-semibold text-yellow-600",children:e.filter(e=>"zero-values"===e.status).length})]}),(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/20 p-4 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:"\uD83D\uDD34"}),(0,r.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Errores"}),(0,r.jsx)("div",{className:"text-lg font-semibold text-gray-600",children:e.filter(e=>"error"===e.status).length})]})]})]}),e.length>0&&(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"\uD83D\uDCCB Detalles por Modelo"})}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Modelo"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Estado"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"USD Bruto"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"USD Modelo"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Model Values"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Calculator Totals"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Acci\xf3n"})]})}),(0,r.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0 h-8 w-8",children:(0,r.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:e.name.charAt(0).toUpperCase()})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.name}),(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})]})}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,r.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(x(e.status)),children:[u(e.status)," ",e.status]}),e.issue&&(0,r.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e.issue})]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:["$",e.totalUsdBruto.toFixed(2)]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:["$",e.totalUsdModelo.toFixed(2)]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.modelValues.length," registros"]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.calculatorTotals.length," registros"]}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:"working"!==e.status&&(0,r.jsx)("button",{onClick:()=>c(e.id),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",children:"\uD83D\uDD27 Corregir"})})]},e.id))})]})})]}),(0,r.jsxs)("div",{className:"mt-8 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"\uD83D\uDCA1 Interpretaci\xf3n de Resultados"}),(0,r.jsxs)("div",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"✅ Funcionando:"})," Modelo con datos correctos en ambas tablas"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"❌ Sin Datos:"})," Modelo sin registros en model_values o calculator_totals"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"⚠️ Valores en $0:"})," Modelo con datos pero totales calculados en $0.00"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"\uD83D\uDD34 Errores:"})," Problemas t\xe9cnicos en la consulta de datos"]})]})]})]})})}},622:function(e,t,a){"use strict";var r=a(2265),s=Symbol.for("react.element"),l=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,n=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function i(e,t,a){var r,l={},i=null,c=null;for(r in void 0!==a&&(i=""+a),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,r)&&!d.hasOwnProperty(r)&&(l[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===l[r]&&(l[r]=t[r]);return{$$typeof:s,type:e,key:i,ref:c,props:l,_owner:n.current}}t.Fragment=l,t.jsx=i,t.jsxs=i},7437:function(e,t,a){"use strict";e.exports=a(622)}},function(e){e.O(0,[5257,2971,4938,1744],function(){return e(e.s=3835)}),_N_E=e.O()}]);