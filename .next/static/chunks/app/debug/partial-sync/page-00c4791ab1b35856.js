(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7424],{2601:function(e,t,r){"use strict";var a,s;e.exports=(null==(a=r.g.process)?void 0:a.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(8960)},3835:function(e,t,r){Promise.resolve().then(r.bind(r,2324))},2324:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var a=r(7437),s=r(2265);let l=(0,r(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c");function o(){let[e,t]=(0,s.useState)([]),[r,o]=(0,s.useState)(!1),[n,i]=(0,s.useState)(!1),c=async()=>{try{o(!0),i(!1),console.log("\uD83D\uDD0D [PARTIAL-SYNC] Iniciando an\xe1lisis de sincronizaci\xf3n parcial...");let e=new Date().toISOString().split("T")[0];console.log("\uD83D\uDCC5 [PARTIAL-SYNC] Fecha actual:",e);let{data:r,error:a}=await l.from("users").select("id, email, name, role, is_active").eq("role","modelo").eq("is_active",!0);if(a)throw Error("Error obteniendo modelos: ".concat(a.message));if(console.log("✅ [PARTIAL-SYNC] Modelos encontrados: ".concat((null==r?void 0:r.length)||0)),!r||0===r.length){console.log("❌ [PARTIAL-SYNC] No se encontraron modelos");return}let s=[];for(let t of r){console.log("\uD83D\uDD0D [PARTIAL-SYNC] Analizando: ".concat(t.name," (").concat(t.id,")"));try{let r;let{data:a,error:o}=await l.from("model_values").select("*").eq("model_id",t.id).eq("period_date",e),{data:n,error:i}=await l.from("calculator_totals").select("*").eq("model_id",t.id).eq("period_date",e),c=a&&a.length>0,d=n&&n.length>0,u=0,x=0,g="working";if(d&&n[0]&&(u=n[0].total_usd_bruto||0,x=n[0].total_usd_modelo||0),c||d){if(d){if(0===u&&0===x)g="zero-values",r="Totales en $0.00 (posible problema de c\xe1lculo)";else if(o||i){g="error";let e=(null==o?void 0:o.message)||(null==i?void 0:i.message)||"Error desconocido";r="Error en consulta: ".concat(e)}}else g="no-data",r="Sin totales consolidados (calculator_totals)"}else g="no-data",r="Sin datos en ambas tablas";let m={id:t.id,name:t.name,email:t.email,modelValues:a||[],calculatorTotals:n||[],totalUsdBruto:u,totalUsdModelo:x,status:g,issue:r};s.push(m),console.log("\uD83D\uDCCA [PARTIAL-SYNC] ".concat(t.name,":"),{status:g,issue:r,modelValues:c?"".concat(a.length," registros"):"Sin datos",calculatorTotals:d?"".concat(n.length," registros"):"Sin datos",totalUsdBruto:u,totalUsdModelo:x,valuesError:null==o?void 0:o.message,totalsError:null==i?void 0:i.message})}catch(e){console.error("❌ [PARTIAL-SYNC] Error analizando ".concat(t.name,":"),e),s.push({id:t.id,name:t.name,email:t.email,modelValues:[],calculatorTotals:[],totalUsdBruto:0,totalUsdModelo:0,status:"error",issue:"Error: ".concat((null==e?void 0:e.message)||"Error desconocido")})}}t(s),i(!0);let n=s.filter(e=>"working"===e.status).length,c=s.filter(e=>"no-data"===e.status).length,d=s.filter(e=>"zero-values"===e.status).length,u=s.filter(e=>"error"===e.status).length;console.log("\uD83D\uDCCB [PARTIAL-SYNC] Resumen final:",{total:s.length,working:n,noData:c,zeroValues:d,errors:u})}catch(e){console.error("❌ [PARTIAL-SYNC] Error general:",e)}finally{o(!1)}},d=async e=>{try{console.log("\uD83D\uDD27 [PARTIAL-SYNC] Intentando corregir modelo: ".concat(e));let t=await fetch("/api/calculator/recalculate-totals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({modelId:e})}),r=await t.json();r.success?(console.log("✅ [PARTIAL-SYNC] Modelo ".concat(e," corregido")),await c()):console.error("❌ [PARTIAL-SYNC] Error corrigiendo ".concat(e,":"),r.error)}catch(e){console.error("❌ [PARTIAL-SYNC] Error en correcci\xf3n:",e)}},u=e=>{switch(e){case"working":return"text-green-600 bg-green-50";case"no-data":return"text-red-600 bg-red-50";case"zero-values":return"text-yellow-600 bg-yellow-50";default:return"text-gray-600 bg-gray-50"}},x=e=>{switch(e){case"working":return"✅";case"no-data":return"❌";case"zero-values":return"⚠️";case"error":return"\uD83D\uDD34";default:return"❓"}};return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"\uD83D\uDD0D Diagn\xf3stico de Sincronizaci\xf3n Parcial"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:'Analiza por qu\xe9 algunos modelos muestran valores en "Resumen de Facturaci\xf3n" y otros muestran $0.00'}),(0,a.jsx)("button",{onClick:c,disabled:r,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:r?"Analizando...":"Iniciar An\xe1lisis"})]}),n&&(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"\uD83D\uDCCA Resumen del An\xe1lisis"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:"✅"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Funcionando"}),(0,a.jsx)("div",{className:"text-lg font-semibold text-green-600",children:e.filter(e=>"working"===e.status).length})]}),(0,a.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:"❌"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Sin Datos"}),(0,a.jsx)("div",{className:"text-lg font-semibold text-red-600",children:e.filter(e=>"no-data"===e.status).length})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:"⚠️"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Valores en $0"}),(0,a.jsx)("div",{className:"text-lg font-semibold text-yellow-600",children:e.filter(e=>"zero-values"===e.status).length})]}),(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/20 p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:"\uD83D\uDD34"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Errores"}),(0,a.jsx)("div",{className:"text-lg font-semibold text-gray-600",children:e.filter(e=>"error"===e.status).length})]})]})]}),e.length>0&&(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"\uD83D\uDCCB Detalles por Modelo"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Modelo"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Estado"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"USD Bruto"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"USD Modelo"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Model Values"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Calculator Totals"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Acci\xf3n"})]})}),(0,a.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-8 w-8",children:(0,a.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:e.name.charAt(0).toUpperCase()})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.name}),(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})]})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(u(e.status)),children:[x(e.status)," ",e.status]}),e.issue&&(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e.issue})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:["$",e.totalUsdBruto.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:["$",e.totalUsdModelo.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.modelValues.length," registros"]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.calculatorTotals.length," registros"]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:"working"!==e.status&&(0,a.jsx)("button",{onClick:()=>d(e.id),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",children:"\uD83D\uDD27 Corregir"})})]},e.id))})]})})]}),(0,a.jsxs)("div",{className:"mt-8 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"\uD83D\uDCA1 Interpretaci\xf3n de Resultados"}),(0,a.jsxs)("div",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"✅ Funcionando:"})," Modelo con datos correctos en ambas tablas"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"❌ Sin Datos:"})," Modelo sin registros en model_values o calculator_totals"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"⚠️ Valores en $0:"})," Modelo con datos pero totales calculados en $0.00"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"\uD83D\uDD34 Errores:"})," Problemas t\xe9cnicos en la consulta de datos"]})]})]})]})})}},8960:function(e){!function(){var t={229:function(e){var t,r,a,s=e.exports={};function l(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function n(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var i=[],c=!1,d=-1;function u(){c&&a&&(c=!1,a.length?i=a.concat(i):d=-1,i.length&&x())}function x(){if(!c){var e=n(u);c=!0;for(var t=i.length;t;){for(a=i,i=[];++d<t;)a&&a[d].run();d=-1,t=i.length}a=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];i.push(new g(e,t)),1!==i.length||c||n(x)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function a(e){var s=r[e];if(void 0!==s)return s.exports;var l=r[e]={exports:{}},o=!0;try{t[e](l,l.exports,a),o=!1}finally{o&&delete r[e]}return l.exports}a.ab="//";var s=a(229);e.exports=s}()},622:function(e,t,r){"use strict";var a=r(2265),s=Symbol.for("react.element"),l=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,n=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var a,l={},c=null,d=null;for(a in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)o.call(t,a)&&!i.hasOwnProperty(a)&&(l[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===l[a]&&(l[a]=t[a]);return{$$typeof:s,type:e,key:c,ref:d,props:l,_owner:n.current}}t.Fragment=l,t.jsx=c,t.jsxs=c},7437:function(e,t,r){"use strict";e.exports=r(622)}},function(e){e.O(0,[5257,2971,4938,1744],function(){return e(e.s=3835)}),_N_E=e.O()}]);