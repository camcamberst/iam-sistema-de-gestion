(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9769],{4775:function(e,a,s){"use strict";s.d(a,{Z:function(){return o}});var t=s(7437),r=s(2265),n=s(5922);function o(e){let{userId:a,userGroups:s,userRole:o="modelo"}=e,[l,i]=(0,r.useState)([]),[d,c]=(0,r.useState)(!0),[m,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)(new Set),[g,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e="announcements_read_".concat(a),s=localStorage.getItem(e);if(s)try{let e=JSON.parse(s);h(new Set(e))}catch(e){console.warn("⚠️ [ANNOUNCEMENTS-WIDGET] Error parseando publicaciones le\xeddas:",e)}},[a]),(0,r.useEffect)(()=>{b();let e=n.supabase.channel("announcements-realtime-".concat(a)).on("postgres_changes",{event:"*",schema:"public",table:"announcements"},e=>{console.log("\uD83D\uDCE2 [ANNOUNCEMENTS-WIDGET] Cambio detectado en tiempo real:",e);let a=e.eventType||e.event;if("INSERT"===a||"UPDATE"===a){let a=e.new;a&&!0===a.is_published&&(console.log("\uD83D\uDD04 [ANNOUNCEMENTS-WIDGET] Recargando anuncios por cambio en tiempo real"),b())}else"DELETE"===a&&(console.log("\uD83D\uDD04 [ANNOUNCEMENTS-WIDGET] Recargando anuncios por eliminaci\xf3n"),b())}).subscribe(e=>{console.log("\uD83D\uDCE1 [ANNOUNCEMENTS-WIDGET] Estado de suscripci\xf3n:",e)});return()=>{console.log("\uD83E\uDDF9 [ANNOUNCEMENTS-WIDGET] Limpiando suscripci\xf3n"),n.supabase.removeChannel(e)}},[a,s]),(0,r.useEffect)(()=>{if(0===l.length){p(!1);return}p(l.some(e=>!x.has(e.id)));let e="announcements_read_".concat(a);!localStorage.getItem(e)&&l.length>0&&console.log("\uD83C\uDD95 [ANNOUNCEMENTS-WIDGET] Primera carga: todas las publicaciones son nuevas")},[l,x,a]);let b=async()=>{try{var e;c(!0);let{data:{session:s}}=await n.supabase.auth.getSession();if(!s){console.warn("⚠️ [ANNOUNCEMENTS-WIDGET] No hay sesi\xf3n activa");return}let{data:t,error:r}=await n.supabase.from("user_groups").select("group_id").eq("user_id",a);r&&console.error("❌ [ANNOUNCEMENTS-WIDGET] Error obteniendo grupos:",r);let l=(null==t?void 0:t.map(e=>e.group_id))||[],d=l.length>0?l.join(","):"";console.log("\uD83D\uDD0D [ANNOUNCEMENTS-WIDGET] Cargando anuncios para:",{userId:a,userGroupIds:l,userGroupsParam:d});let m=await fetch("/api/announcements?limit=5&userId=".concat(a,"&userRole=").concat(o).concat(d?"&userGroups=".concat(d):""),{headers:{Authorization:"Bearer ".concat(s.access_token)}});if(!m.ok){console.error("❌ [ANNOUNCEMENTS-WIDGET] Error en respuesta:",m.status,m.statusText);return}let u=await m.json();console.log("\uD83D\uDCCA [ANNOUNCEMENTS-WIDGET] Resultado:",{success:u.success,count:(null===(e=u.data)||void 0===e?void 0:e.length)||0,data:u.data}),u.success?i(u.data||[]):console.error("❌ [ANNOUNCEMENTS-WIDGET] Error en respuesta:",u.error)}catch(e){console.error("❌ [ANNOUNCEMENTS-WIDGET] Error cargando anuncios:",e)}finally{c(!1)}},N=e=>{let s="announcements_read_".concat(a),t=new Set(x);t.add(e),h(t),localStorage.setItem(s,JSON.stringify(Array.from(t))),p(l.some(e=>!t.has(e.id)))},f=e=>{let a=new Date(e),s=new Date().getTime()-a.getTime(),t=Math.floor(s/6e4),r=Math.floor(s/36e5),n=Math.floor(s/864e5);return t<1?"Ahora":t<60?"hace ".concat(t," min"):r<24?"hace ".concat(r," h"):n<7?"hace ".concat(n," d"):a.toLocaleDateString("es-CO",{day:"numeric",month:"short"})};if(d)return(0,t.jsx)("div",{className:"relative bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-4 sm:p-6",children:(0,t.jsx)("div",{className:"flex items-center justify-center py-6 sm:py-8",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 sm:h-6 sm:w-6 border-b-2 border-blue-600"})})});let y=m?l:l.slice(0,3),v=l.filter(e=>!x.has(e.id)).length;return(0,t.jsxs)("div",{className:"relative bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15",children:[(0,t.jsx)("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200/50 dark:border-gray-600/50",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3 min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,t.jsx)("div",{className:"w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md",children:(0,t.jsx)("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})})}),g&&(0,t.jsx)("div",{className:"absolute -top-0.5 -right-0.5",children:(0,t.jsxs)("div",{className:"relative w-3 h-3 sm:w-3.5 sm:h-3.5 bg-red-500 rounded-full border-2 border-white dark:border-gray-700 shadow-sm",children:[v>1&&(0,t.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-[7px] sm:text-[8px] font-semibold text-white leading-none",children:v>9?"9+":v}),(0,t.jsx)("span",{className:"absolute inset-0 bg-red-500 rounded-full animate-ping opacity-40"})]})})]}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("h2",{className:"text-sm sm:text-lg font-semibold text-gray-900 dark:text-white leading-tight",children:"Corcho Informativo"}),(0,t.jsx)("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-300 hidden sm:block",children:"Informaci\xf3n relevante para ti"})]})]}),l.length>3&&(0,t.jsx)("button",{onClick:()=>u(!m),className:"text-[10px] sm:text-xs font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors flex-shrink-0 whitespace-nowrap",children:m?"Ver menos":"Ver todas (".concat(l.length,")")})]})}),0===l.length?(0,t.jsxs)("div",{className:"p-4 sm:p-6 text-center",children:[(0,t.jsx)("div",{className:"text-gray-400 dark:text-gray-500 mb-2",children:(0,t.jsx)("svg",{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})})}),(0,t.jsx)("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"No hay publicaciones disponibles en este momento"}),(0,t.jsx)("p",{className:"text-[10px] sm:text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Las publicaciones aparecer\xe1n aqu\xed cuando los administradores las creen"})]}):(0,t.jsx)("div",{className:"p-4 sm:p-6 space-y-3 sm:space-y-4",children:y.map(e=>{let a=!x.has(e.id);return(0,t.jsxs)("div",{onClick:()=>{N(e.id);let a="/announcements/".concat(e.id);window.open(a,"_blank","width=800,height=900,scrollbars=yes,resizable=yes")},className:"relative cursor-pointer group rounded-lg p-3 sm:p-4 border transition-all duration-200 hover:shadow-md ".concat(a?"bg-blue-50/60 dark:bg-blue-900/10 border-blue-200/60 dark:border-blue-500/30":"bg-gray-50/50 dark:bg-gray-600/30 border-gray-200/50 dark:border-gray-500/30 hover:border-blue-300 dark:hover:border-blue-500/50"),children:[a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{children:"\n                    @keyframes badgeBlink {\n                      0%, 100% { opacity: 1; }\n                      50% { opacity: 0.5; }\n                    }\n                    .badge-nuevo-blink {\n                      animation: badgeBlink 1.5s ease-in-out infinite;\n                    }\n                  "}),(0,t.jsxs)("span",{className:"badge-nuevo-blink absolute top-2 right-2 sm:top-4 sm:right-4 inline-flex items-center gap-0.5 sm:gap-1 px-1 sm:px-1.5 py-0.5 text-[10px] sm:text-xs font-medium text-white bg-gradient-to-r from-red-500 via-pink-500 to-red-500 rounded-full shadow-sm shadow-red-500/30 hover:shadow-md hover:shadow-red-500/50 transition-all duration-200 z-10",children:[(0,t.jsxs)("span",{className:"relative flex h-0.5 w-0.5 sm:h-1 sm:w-1",children:[(0,t.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-70"}),(0,t.jsx)("span",{className:"relative inline-flex rounded-full h-0.5 w-0.5 sm:h-1 sm:w-1 bg-white"})]}),(0,t.jsx)("span",{className:"relative",children:"Nuevo"}),(0,t.jsx)("span",{className:"absolute inset-0 bg-gradient-to-r from-red-400 via-pink-400 to-red-400 rounded-full opacity-40 blur-sm -z-10 animate-pulse"})]})]}),(0,t.jsxs)("div",{className:"flex items-start space-x-2 sm:space-x-3",children:[(()=>{var a,s,r;let n=e.featured_image_url||(e.image_urls&&e.image_urls.length>0?e.image_urls[0]:null);return n?(0,t.jsx)("img",{src:n,alt:e.title,className:"w-12 h-12 sm:w-16 sm:h-16 object-cover rounded-lg flex-shrink-0"}):(0,t.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-lg flex items-center justify-center flex-shrink-0 text-lg sm:text-2xl",style:{backgroundColor:(null===(a=e.category)||void 0===a?void 0:a.color)?"".concat(e.category.color,"20"):"#3B82F620",color:(null===(s=e.category)||void 0===s?void 0:s.color)||"#3B82F6"},children:(null===(r=e.category)||void 0===r?void 0:r.icon)||"\uD83D\uDCCC"})})(),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center flex-wrap gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[e.is_pinned&&(0,t.jsx)("span",{className:"text-[10px] sm:text-xs text-blue-600 dark:text-blue-400",children:"\uD83D\uDCCC"}),e.priority>0&&(0,t.jsx)("span",{className:"text-[10px] sm:text-xs px-1 sm:px-1.5 py-0.5 rounded ".concat(2===e.priority?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300"),children:2===e.priority?"Urgente":"Alta"}),e.category&&(0,t.jsx)("span",{className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 rounded font-medium",style:{backgroundColor:"".concat(e.category.color,"20"),color:e.category.color},children:e.category.name})]}),(0,t.jsx)("h3",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors mb-1.5 sm:mb-2.5 leading-snug",children:e.title}),(0,t.jsx)("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-300 line-clamp-2 mb-2 sm:mb-3 leading-relaxed",children:e.excerpt}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-1.5 sm:pt-2 border-t border-gray-200/30 dark:border-gray-600/30",children:[(0,t.jsx)("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400",children:f(e.published_at||e.created_at)}),(0,t.jsx)("span",{className:"text-[10px] sm:text-xs text-blue-600 dark:text-blue-400 font-medium group-hover:underline",children:"Leer m\xe1s →"})]})]})]})]},e.id)})})]})}},4033:function(e,a,s){e.exports=s(5313)}}]);