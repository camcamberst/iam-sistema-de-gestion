"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3792],{5531:function(e,t,r){r.d(t,{Z:function(){return x}});var a=r(2265);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),d=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),l=e=>{let t=d(e);return t.charAt(0).toUpperCase()+t.slice(1)},i=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),n=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:d="",children:l,iconNode:c,...x},u)=>(0,a.createElement)("svg",{ref:u,...o,width:t,height:t,stroke:e,strokeWidth:s?24*Number(r)/Number(t):r,className:i("lucide",d),...!l&&!n(x)&&{"aria-hidden":"true"},...x},[...c.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(l)?l:[l]])),x=(e,t)=>{let r=(0,a.forwardRef)(({className:r,...d},n)=>(0,a.createElement)(c,{ref:n,iconNode:t,className:i(`lucide-${s(l(e))}`,`lucide-${e}`,r),...d}));return r.displayName=l(e),r}},4530:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(5531).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9806:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(5531).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},6141:function(e,t,r){r.d(t,{Z:function(){return a}});let a=(0,r(5531).Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},1185:function(e,t,r){r.d(t,{Z:function(){return d}});var a=r(7437),s=r(2265);function d(e){let{compact:t=!1,showTitle:r=!0,refreshTrigger:d}=e,[l,i]=(0,s.useState)([]),[n,o]=(0,s.useState)(!1),[c,x]=(0,s.useState)(null);async function u(){try{o(!0),x(null);let e=await fetch("/api/rates?activeOnly=true"),t=await e.json();if(!t.success)throw Error(t.error||"Error al cargar tasas");let r=new Date,a=["USD→COP","EUR→USD","GBP→USD"],s=t.data.filter(e=>{let t=e.valid_to?new Date(e.valid_to):null;return(!t||t>r)&&a.includes(e.kind)}).sort((e,t)=>new Date(t.valid_from).getTime()-new Date(e.valid_from).getTime()).reduce((e,t)=>(e.find(e=>e.kind===t.kind)||e.push(t),e),[]).sort((e,t)=>{let r={"USD→COP":1,"EUR→USD":2,"GBP→USD":3};return(r[e.kind]||4)-(r[t.kind]||4)});i(s)}catch(e){x(e.message||"Error inesperado")}finally{o(!1)}}(0,s.useEffect)(()=>{u()},[]),(0,s.useEffect)(()=>{void 0!==d&&u()},[d]);let m=e=>{switch(e){case"USD→COP":return"USD → COP";case"EUR→USD":return"EUR → USD";case"GBP→USD":return"GBP → USD";default:return e}},h=e=>"global"===e?"Global":e.startsWith("group:")?"Grupo: ".concat(e.replace("group:","")):e,g=e=>{switch(e){case"manual":return"✏️";case"ECB":return"\uD83C\uDFDB️";case"system":return"\uD83E\uDD16";case"OXR":return"\uD83D\uDCCA";default:return"\uD83D\uDCCB"}};return t?(0,a.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-600/20 p-4 hover:shadow-xl hover:bg-white/95 dark:hover:bg-gray-600/80 hover:scale-[1.02] transition-all duration-300 cursor-pointer",children:[r&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-md flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Tasas de Calculadora"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-300",children:"Solo manuales"})]}),n&&(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin ml-auto"})]}),c?(0,a.jsx)("p",{className:"text-red-600 text-xs",children:c}):(0,a.jsx)("div",{className:"space-y-1",children:0===l.length?(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-300 text-xs text-center py-2",children:"No hay tasas de calculadora"}):l.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between py-1 px-2 bg-gray-50 dark:bg-white rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-xs",children:g(e.source)}),(0,a.jsx)("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-900",children:m(e.kind)})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-gray-900 dark:text-gray-900",children:e.value}),(0,a.jsx)("div",{className:"text-xs text-gray-800 dark:text-gray-900",children:h(e.scope)})]})]},e.id))})]}):(0,a.jsxs)("div",{className:"bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl p-4 border border-white/20 dark:border-gray-600/20 shadow-md dark:shadow-lg dark:shadow-blue-900/10 dark:ring-0.5 dark:ring-blue-500/15",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Tasas de Calculadora"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Solo tasas manuales"})]})]}),(0,a.jsx)("button",{onClick:u,className:"px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50/80 backdrop-blur-sm border border-blue-200/50 rounded-lg hover:bg-blue-100/80 focus:ring-2 focus:ring-blue-500/20 transition-all duration-200",disabled:n,children:n?"Actualizando...":"Actualizar"})]}),c?(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsx)("p",{className:"text-red-600 text-xs mb-3",children:c}),(0,a.jsx)("button",{onClick:u,className:"px-3 py-1.5 text-xs font-medium text-red-600 bg-red-50/80 backdrop-blur-sm border border-red-200/50 rounded-lg hover:bg-red-100/80 focus:ring-2 focus:ring-red-500/20 transition-all duration-200",children:"Reintentar"})]}):(0,a.jsx)("div",{className:"space-y-2",children:0===l.length?(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-300 text-sm font-medium mb-1",children:"No hay tasas de calculadora"}),(0,a.jsx)("p",{className:"text-gray-400 dark:text-gray-400 text-xs",children:"Configura las tasas manualmente"})]}):l.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-white dark:bg-white backdrop-blur-sm rounded-lg border border-gray-200/30 dark:border-gray-500/30 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-gray-50 dark:bg-gray-50 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs",children:g(e.source)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-gray-900 dark:text-gray-900",children:m(e.kind)}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-900",children:h(e.scope)})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-sm font-bold text-gray-900 dark:text-gray-900",children:e.value}),(0,a.jsx)("div",{className:"text-xs text-gray-800 dark:text-gray-900",children:new Date(e.valid_from).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]})]},e.id))})]})}},4065:function(e,t,r){r.d(t,{Z:function(){return n}});var a=r(7437),s=r(2265),d=r(1396),l=r.n(d),i=r(6605);function n(e){let{userRole:t,userId:r,userGroups:d=[]}=e,[n,o]=(0,s.useState)(null),[c,x]=(0,s.useState)([]),[u,m]=(0,s.useState)(!0),[h,g]=(0,s.useState)(null),[p,b]=(0,s.useState)("current"),f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"USD";return"COP"===t?new Intl.NumberFormat("es-CO",{minimumFractionDigits:0,maximumFractionDigits:0}).format(e):new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)},y=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e||m(!0),g(null);let a=new Date().toISOString().split("T")[0];if("period-1"===p){let e=new Date;a="".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-15")}else if("period-2"===p){let e=new Date,t=new Date(e.getFullYear(),e.getMonth()+1,0).getDate();a="".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(t).padStart(2,"0"))}let s=new URLSearchParams({adminId:r,userRole:t,periodDate:a}),l=await fetch("/api/admin/billing-summary?".concat(s)),i=await l.json();if(!i.success)throw Error(i.error||"Error al cargar los datos");let n=i.data||[];"admin"===t&&d.length>0&&(n=n.filter(e=>d.includes(e.groupName)));let c={totalModels:n.length,totalUsdBruto:n.reduce((e,t)=>e+t.usdBruto,0),totalUsdModelo:n.reduce((e,t)=>e+t.usdModelo,0),totalUsdSede:n.reduce((e,t)=>e+t.usdSede,0),totalCopModelo:n.reduce((e,t)=>e+t.copModelo,0),totalCopSede:n.reduce((e,t)=>e+t.copSede,0)},u=new Map;n.forEach(e=>{let t=e.organizationId||"unknown",r=e.groupId||"unknown";u.has(t)||u.set(t,{sedeId:t,sedeName:(e.organizationId,"Agencia Innova"),totalModels:0,groups:[],totalUsdBruto:0,totalUsdModelo:0,totalUsdSede:0});let a=u.get(t);a.totalModels++,a.totalUsdBruto+=e.usdBruto,a.totalUsdModelo+=e.usdModelo,a.totalUsdSede+=e.usdSede;let s=a.groups.find(e=>e.groupId===r);s||(s={groupId:r,groupName:e.groupName||"Grupo Desconocido",totalModels:0,totalUsdBruto:0,totalUsdModelo:0,totalUsdSede:0},a.groups.push(s)),s.totalModels++,s.totalUsdBruto+=e.usdBruto,s.totalUsdModelo+=e.usdModelo,s.totalUsdSede+=e.usdSede}),o(c),x(Array.from(u.values()))}catch(e){console.error("Error loading billing data:",e),g(e.message||"Error al cargar los datos")}finally{e||m(!1)}},{isPolling:v,isSilentUpdating:j}=(0,i.t)(y,[r,t,d],{refreshInterval:3e4,enabled:!0,silentUpdate:!0,onRefresh:()=>{console.log("\uD83D\uDD04 [BILLING-SUMMARY-COMPACT] Datos actualizados autom\xe1ticamente")}});return((0,s.useEffect)(()=>{r&&t&&y()},[r,t,d,p]),u)?(0,a.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-700/20 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-gradient-to-br from-green-500 to-emerald-600 rounded-md flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Resumen de Facturaci\xf3n"})]}),(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-green-500"})})]}):h?(0,a.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl shadow-md border border-white/20 dark:border-gray-700/20 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-gradient-to-br from-red-500 to-red-600 rounded-md flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Resumen de Facturaci\xf3n"})]}),(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"text-sm text-red-600 mb-2",children:h}),(0,a.jsx)("button",{onClick:()=>y(),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Reintentar"})]})]}):(0,a.jsxs)("div",{className:"relative bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md dark:shadow-lg dark:shadow-green-900/10 dark:ring-0.5 dark:ring-green-500/15 border border-white/20 dark:border-gray-600/20 p-4 hover:shadow-xl hover:bg-white/95 dark:hover:bg-gray-600/80 hover:scale-[1.02] transition-all duration-300",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 bg-gradient-to-br from-green-500 to-emerald-600 rounded-md flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Resumen de Facturaci\xf3n"})]}),(0,a.jsx)(l(),{href:"/admin/sedes/dashboard",className:"text-xs text-blue-600 dark:text-white hover:text-blue-800 dark:hover:text-gray-200 font-medium",children:"Ver completo →"})]}),n&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,a.jsxs)("div",{className:"text-center p-2 rounded-lg bg-gray-50/80",children:[(0,a.jsxs)("div",{className:"text-sm font-bold text-gray-900 dark:text-gray-900",children:["$",f(n.totalUsdBruto)]}),(0,a.jsx)("div",{className:"text-xs text-gray-900 dark:text-gray-900",children:"USD Bruto"})]}),(0,a.jsxs)("div",{className:"text-center p-2 rounded-lg bg-green-50/80",children:[(0,a.jsxs)("div",{className:"text-sm font-bold text-green-600",children:["$",f(n.totalUsdModelo)]}),(0,a.jsx)("div",{className:"text-xs text-gray-900 dark:text-gray-900",children:"USD Modelo"})]}),(0,a.jsxs)("div",{className:"text-center p-2 rounded-lg bg-orange-50/80",children:[(0,a.jsxs)("div",{className:"text-sm font-bold text-orange-600",children:["$",f(n.totalUsdSede)]}),(0,a.jsx)("div",{className:"text-xs text-gray-900 dark:text-gray-900",children:"USD Sede"})]})]}),c.length>0&&(0,a.jsxs)("div",{className:"border-t border-gray-200/50 pt-3",children:[(0,a.jsxs)("div",{className:"text-xs font-medium text-gray-900 dark:text-white mb-2",children:[n.totalModels," modelos • ","super_admin"===t?"Todas las sedes":"Tu sede"]}),(0,a.jsx)("div",{className:"max-h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:(0,a.jsx)("div",{className:"space-y-2 pr-2",children:c.map(e=>(0,a.jsxs)("div",{className:"bg-white dark:bg-white rounded-lg border border-gray-200/40 dark:border-gray-600/40 p-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-gradient-to-br from-blue-500/10 to-indigo-500/10 rounded flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-2.5 h-2.5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-gray-900 dark:text-gray-900",children:e.sedeName}),(0,a.jsxs)("div",{className:"text-xs text-gray-900 dark:text-gray-900",children:[e.totalModels," modelos • ",e.groups.length," grupos"]})]})]}),e.groups.length>0&&(0,a.jsx)("div",{className:"ml-6 space-y-1",children:e.groups.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-1.5 bg-gray-50/60 rounded",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1.5",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-gradient-to-br from-gray-400/20 to-gray-500/20 rounded flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-1.5 h-1.5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-medium text-gray-900 dark:text-gray-900",children:e.groupName}),(0,a.jsxs)("div",{className:"text-xs text-gray-900 dark:text-gray-900",children:[e.totalModels," modelos"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-xs font-semibold text-gray-900 dark:text-gray-900",children:["$",f(e.totalUsdBruto)]}),(0,a.jsx)("div",{className:"text-xs text-gray-900 dark:text-gray-900",children:"USD Bruto"})]})]},e.groupId))})]},e.sedeId))})})]})]})]})}},9728:function(e,t,r){r.d(t,{Z:function(){return c}});var a=r(7437),s=r(2265),d=r(6141),l=r(4530),i=r(9806);let n=(0,r(5531).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var o=r(327);function c(e){let{userRole:t,userGroups:r}=e,[c,x]=(0,s.useState)([]),[u,m]=(0,s.useState)(!0),[h,g]=(0,s.useState)(null);(0,s.useEffect)(()=>{p()},[t,r]),(0,s.useEffect)(()=>{c.length>0&&console.log("\uD83D\uDD0D Timeline requests con fechas:",c.map(e=>({id:e.id,status:e.status,requested_at:e.requested_at,delivered_at:e.delivered_at,confirmed_at:e.confirmed_at,deactivated_at:e.deactivated_at,reverted_at:e.reverted_at,updated_at:e.updated_at})))},[c]);let p=async()=>{try{m(!0),g(null);let e=await fetch("/api/modelo-plataformas/timeline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userRole:t,userGroups:r||[]})});if(!e.ok)throw Error("Error al cargar timeline");let a=await e.json();x(a.requests||[])}catch(e){g(e instanceof Error?e.message:"Error desconocido")}finally{m(!1)}},b=async e=>{try{if(!(await fetch("/api/modelo-plataformas/timeline/".concat(e,"/close"),{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw Error("Error al cerrar solicitud");await p()}catch(e){g(e instanceof Error?e.message:"Error al cerrar solicitud")}},f=e=>{switch(e){case"solicitada":return"#93c5fd";case"pendiente":return"#fde047";case"entregada":return"#86efac";case"inviable":return"#fca5a5";default:return"#e2e8f0"}},y=e=>{switch(e){case"solicitada":case"pendiente":default:return(0,a.jsx)(d.Z,{className:"w-4 h-4"});case"entregada":return(0,a.jsx)(l.Z,{className:"w-4 h-4"});case"inviable":return(0,a.jsx)(i.Z,{className:"w-4 h-4"})}},v=e=>"entregada"===e||"inviable"===e;return u?(0,a.jsx)("div",{className:"bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md dark:shadow-lg dark:shadow-purple-900/10 dark:ring-0.5 dark:ring-purple-500/15 border border-white/20 dark:border-gray-600/20 p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600 dark:text-gray-300 text-sm",children:"Cargando timeline..."})]})}):h?(0,a.jsx)("div",{className:"bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md dark:shadow-lg dark:shadow-purple-900/10 dark:ring-0.5 dark:ring-purple-500/15 border border-white/20 dark:border-gray-600/20 p-4",children:(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)(i.Z,{className:"w-6 h-6 text-red-500 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-red-600 text-sm",children:h})]})}):(0,a.jsxs)("div",{className:"bg-white/70 dark:bg-gray-700/70 backdrop-blur-sm rounded-xl shadow-md dark:shadow-lg dark:shadow-purple-900/10 dark:ring-0.5 dark:ring-purple-500/15 border border-white/20 dark:border-gray-600/20 p-4",style:{overflow:"visible"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-base font-semibold text-gray-900 dark:text-gray-100 flex items-center",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),"Timeline Portafolio Modelos"]}),(0,a.jsxs)("span",{className:"text-sm text-gray-500 dark:text-gray-300",children:[c.length," solicitud",1!==c.length?"es":""]})]}),0===c.length?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)(d.Z,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-300 text-sm",children:"No hay solicitudes de plataformas activas"})]}):(0,a.jsxs)("div",{className:"max-h-80 overflow-y-auto space-y-3 relative",style:{overflowX:"visible"},children:[c.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-lg border border-white/30 dark:border-gray-600/30 p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:f(e.status)}}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:(0,o.W)(e.model_email)}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-300",children:"•"}),(0,a.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded-full text-white",style:{backgroundColor:f(e.status),textShadow:"0 1px 2px rgba(0,0,0,0.3)",display:"inline-block"},children:e.platform_name}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-300",children:"•"}),(0,a.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:e.group_name})]}),v(e.status)&&(0,a.jsx)("button",{onClick:()=>b(e.id),className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",title:"Cerrar solicitud",children:(0,a.jsx)(n,{className:"w-3 h-3"})})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",style:{marginLeft:"calc(2rem + 1.5rem + 0.5rem + 1.5rem + 0.5rem + 3.5rem)"},children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("div",{className:"w-5 h-5 rounded-full flex items-center justify-center text-white text-xs cursor-help",style:{backgroundColor:f("solicitada")},children:y("solicitada")}),(0,a.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-[99999]",children:[new Date(e.requested_at).toLocaleDateString()," ",new Date(e.requested_at).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),(0,a.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-3 border-r-3 border-t-3 border-transparent border-t-gray-900"})]})]}),(0,a.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Solicitada"})]}),["pendiente","entregada","inviable"].includes(e.status)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-6 h-0.5 bg-gray-300"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("div",{className:"w-5 h-5 rounded-full flex items-center justify-center text-white text-xs cursor-help",style:{backgroundColor:f("pendiente")},children:y("pendiente")}),(0,a.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-[99999]",children:[e.updated_at?"".concat(new Date(e.updated_at).toLocaleDateString()," ").concat(new Date(e.updated_at).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})):"Sin fecha",(0,a.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-3 border-r-3 border-t-3 border-transparent border-t-gray-900"})]})]}),(0,a.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Pendiente"})]})]}),["entregada","inviable"].includes(e.status)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-6 h-0.5 bg-gray-300"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("div",{className:"w-5 h-5 rounded-full flex items-center justify-center text-white text-xs cursor-help",style:{backgroundColor:f(e.status)},children:y(e.status)}),(0,a.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded shadow-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-[99999]",children:["entregada"===e.status&&e.delivered_at?"".concat(new Date(e.delivered_at).toLocaleDateString()," ").concat(new Date(e.delivered_at).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})):"inviable"===e.status&&e.reverted_at?"".concat(new Date(e.reverted_at).toLocaleDateString()," ").concat(new Date(e.reverted_at).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})):"Finalizado",(0,a.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-3 border-r-3 border-t-3 border-transparent border-t-gray-900"})]})]}),(0,a.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-300 capitalize",children:"entregada"===e.status?"Entregada":"Inviable"})]})]})]})]},e.id)),c.length>5&&(0,a.jsx)("div",{className:"text-center py-2",children:(0,a.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-300",children:["Y ",c.length-5," solicitud",c.length-5!=1?"es":""," m\xe1s..."]})})]})]})}},6605:function(e,t,r){r.d(t,{t:function(){return s}});var a=r(2265);function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{refreshInterval:s=3e4,enabled:d=!0,onRefresh:l,silentUpdate:i=!0}=r,n=(0,a.useRef)(null),o=(0,a.useRef)(!0),[c,x]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),h=(0,a.useCallback)(()=>{l&&l(),e()},[e,l]),g=(0,a.useCallback)(async()=>{if(o.current){m(!0);try{l&&l(),await e(!0)}catch(e){console.error("\uD83D\uDD04 [BILLING-POLLING] Error en actualizaci\xf3n silenciosa:",e)}finally{o.current&&m(!1)}}},[e,l]);return(0,a.useEffect)(()=>(o.current=!0,()=>{o.current=!1}),[]),(0,a.useEffect)(()=>(n.current&&clearInterval(n.current),d&&o.current?(x(!0),n.current=setInterval(()=>{o.current&&(console.log("\uD83D\uDD04 [BILLING-POLLING] Actualizaci\xf3n silenciosa iniciada"),i?g():(l&&l(),e()))},s)):x(!1),()=>{n.current&&clearInterval(n.current)}),[s,d,e,l,i,g,...t]),(0,a.useEffect)(()=>()=>{n.current&&clearInterval(n.current)},[]),{isPolling:c,isSilentUpdating:u,manualRefresh:h}}},5922:function(e,t,r){r.d(t,{O:function(){return a}});let a=(0,r(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")},6727:function(e,t,r){r.d(t,{dB:function(){return a},iR:function(){return s}}),r(2601);let a=()=>(console.warn("⚠️ getCalculatorDate() is deprecated. Use getColombiaDate() instead."),s()),s=()=>new Date().toLocaleDateString("en-CA",{timeZone:"America/Bogota"})},327:function(e,t,r){r.d(t,{W:function(){return a}});let a=e=>e?e.split("@")[0].split(".").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(""):""}}]);