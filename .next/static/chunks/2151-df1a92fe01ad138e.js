(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2151,5922],{3782:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var o=r(7437),n=r(2265);function a(e){let{children:t}=e,[r,a]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{a(!0)},[]),r)?(0,o.jsx)(o.Fragment,{children:t}):null}},2344:function(e,t,r){"use strict";var o=r(7437),n=r(2265);t.Z=()=>{let[e,t]=(0,n.useState)("light"),[r,a]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{a(!0);let e=localStorage.getItem("theme");if(e)t(e),document.documentElement.classList.toggle("dark","dark"===e);else{let e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";t(e),document.documentElement.classList.toggle("dark","dark"===e)}},[]),r)?(0,o.jsx)("button",{"data-theme-toggle":!0,onClick:()=>{let r="light"===e?"dark":"light";document.documentElement.style.transition="all 0.6s cubic-bezier(0.4, 0, 0.2, 1)",document.body.style.transition="all 0.6s cubic-bezier(0.4, 0, 0.2, 1)",t(r),localStorage.setItem("theme",r),document.documentElement.classList.toggle("dark","dark"===r);let o=document.querySelector("[data-theme-toggle]");o&&(o.style.transform="scale(0.95)",setTimeout(()=>{o.style.transform="scale(1)"},150)),setTimeout(()=>{document.documentElement.style.transition="",document.body.style.transition=""},600)},className:"p-2.5 text-gray-600 hover:text-gray-900 hover:bg-white/60 rounded-lg transition-all duration-200 hover:shadow-sm   dark:text-gray-300 dark:hover:text-white dark:hover:bg-gray-700",title:"light"===e?"Cambiar a modo oscuro":"Cambiar a modo claro",children:"light"===e?(0,o.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9 9 0 008.354-5.646z"})}):(0,o.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h1M3 12H2m15.325 6.675l-.707.707M6.707 6.707l-.707-.707m10.626 0l.707-.707M6.707 17.293l-.707.707M12 18a6 6 0 100-12 6 6 0 000 12z"})})}):(0,o.jsx)("div",{className:"p-2.5 text-gray-600 rounded-lg",children:(0,o.jsx)("div",{className:"w-5 h-5"})})}},9853:function(e,t,r){"use strict";r.d(t,{E4:function(){return a},P1:function(){return s}});var o=r(5922),n=r(8115);async function a(e){try{console.log("\uD83D\uDD10 [AUTH] Iniciando login moderno:",{email:e.email});let{data:t,error:r}=await o.supabase.auth.signInWithPassword({email:e.email,password:e.password});if(r)return console.error("❌ [AUTH] Error de autenticaci\xf3n:",r.message),{success:!1,error:"Credenciales inv\xe1lidas"};if(!t.user)return{success:!1,error:"Usuario no encontrado"};console.log("✅ [AUTH] Usuario autenticado en Supabase:",t.user.id);let{data:a,error:s}=await o.supabase.from("users").select("id, name, email, role, is_active, last_login, organization_id").eq("id",t.user.id).single();if(s)return console.error("❌ [AUTH] Error obteniendo perfil base:",s.message),{success:!1,error:"Error obteniendo perfil de usuario"};let{data:i,error:l}=await o.supabase.from("user_groups").select("is_manager, groups(id, name)").eq("user_id",t.user.id);if(!a)return{success:!1,error:"Perfil de usuario no encontrado"};if(!a.is_active)return{success:!1,error:"Usuario inactivo"};await o.supabase.from("users").update({last_login:new Date().toISOString()}).eq("id",t.user.id);let u={id:a.id,email:t.user.email,name:a.name,role:a.role,organization_id:a.organization_id,groups:(i||[]).map(e=>{var t,r;return{id:null===(t=e.groups)||void 0===t?void 0:t.id,name:null===(r=e.groups)||void 0===r?void 0:r.name,is_manager:e.is_manager}}),is_active:a.is_active,last_login:a.last_login};console.log("✅ [AUTH] Login exitoso:",{id:u.id,email:u.email,role:u.role,groups:u.groups.length});try{await (0,n.MY)(u.id),console.log("\uD83D\uDCCA [AUTH] Usuario marcado como en l\xednea en el chat")}catch(e){console.error("❌ [AUTH] Error marcando usuario como en l\xednea:",e)}return{success:!0,user:u}}catch(e){return console.error("❌ [AUTH] Error general:",e),{success:!1,error:"Error interno del servidor"}}}async function s(){try{let{data:{user:e}}=await o.supabase.auth.getUser(),{error:t}=await o.supabase.auth.signOut();if(t&&console.error("❌ [AUTH] Error en logout:",t.message),e)try{await (0,n.lH)(e.id),console.log("\uD83D\uDCCA [AUTH] Usuario marcado como offline en el chat")}catch(e){console.error("❌ [AUTH] Error marcando usuario como offline:",e)}}catch(e){console.error("❌ [AUTH] Error general en logout:",e)}}},8115:function(e,t,r){"use strict";r.d(t,{MY:function(){return s},do:function(){return l},lH:function(){return i}});var o=r(5257);function n(){return(0,o.createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")}async function a(e,t){try{console.log("\uD83D\uDCCA [CHAT-STATUS] Actualizando estado de usuario ".concat(e,": ").concat(t?"EN L\xcdNEA":"OFFLINE"));let r=n(),{error:o}=await r.from("chat_user_status").upsert({user_id:e,is_online:t,last_seen:new Date().toISOString(),updated_at:new Date().toISOString()});o?console.error("❌ [CHAT-STATUS] Error actualizando estado:",o):console.log("✅ [CHAT-STATUS] Estado actualizado exitosamente: ".concat(t?"EN L\xcdNEA":"OFFLINE"))}catch(e){console.error("❌ [CHAT-STATUS] Error general:",e)}}async function s(e){await a(e,!0)}async function i(e){await a(e,!1)}async function l(e){try{let t=n(),{error:r}=await t.from("chat_user_status").upsert({user_id:e,is_online:!0,last_seen:new Date().toISOString(),updated_at:new Date().toISOString()});r&&console.error("❌ [CHAT-STATUS] Error actualizando heartbeat:",r)}catch(e){console.error("❌ [CHAT-STATUS] Error en heartbeat:",e)}}},5922:function(e,t,r){"use strict";r.r(t),r.d(t,{supabase:function(){return o}});let o=(0,r(5257).createClient)("https://mhernfrkvwigxdubiozm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZXJuZnJrdndpZ3hkdWJpb3ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MTY1NDcsImV4cCI6MjA3NDM5MjU0N30.v7qBceGTwaqyDZe5h9yLBjWwuuGEwAq6KVsAH_RNw8c")},4930:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s}});let o=r(1024);r(2265);let n=o._(r(4795));function a(e){return{default:(null==e?void 0:e.default)||e}}function s(e,t){let r=n.default,o={loading:e=>{let{error:t,isLoading:r,pastDelay:o}=e;return null}};"function"==typeof e&&(o.loader=e),Object.assign(o,t);let s=o.loader;return r({...o,loader:()=>null!=s?s().then(a):Promise.resolve(a(()=>null))})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6005:function(e,t,r){"use strict";function o(e){let{children:t}=e;return t}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NoSSR",{enumerable:!0,get:function(){return o}}),r(6491)},4795:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});let o=r(1024)._(r(2265)),n=r(6005),a=function(e){let t=Object.assign({loader:null,loading:null,ssr:!0},e);function r(e){let r=t.loading,a=o.default.createElement(r,{isLoading:!0,pastDelay:!0,error:null}),s=t.ssr?o.default.Fragment:n.NoSSR,i=t.lazy;return o.default.createElement(o.default.Suspense,{fallback:a},o.default.createElement(s,null,o.default.createElement(i,e)))}return t.lazy=o.default.lazy(t.loader),r.displayName="LoadableComponent",r}},622:function(e,t,r){"use strict";var o=r(2265),n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,r){var o,a={},u=null,c=null;for(o in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(c=t.ref),t)s.call(t,o)&&!l.hasOwnProperty(o)&&(a[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===a[o]&&(a[o]=t[o]);return{$$typeof:n,type:e,key:u,ref:c,props:a,_owner:i.current}}t.Fragment=a,t.jsx=u,t.jsxs=u},7437:function(e,t,r){"use strict";e.exports=r(622)},4033:function(e,t,r){e.exports=r(5313)}}]);